{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Dashboard - Clean Care Bangladesh{% endblock %}

{% block extrastyle %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f7fa;
    }

    .dashboard-wrapper {
        display: flex;
        min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
        width: 280px;
        background: linear-gradient(180deg, #2E8B57 0%, #1a5c3a 100%);
        color: white;
        padding: 30px 0;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar-header {
        text-align: center;
        padding: 0 20px 30px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .admin-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: white;
        margin: 0 auto 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .admin-name {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .admin-role {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        margin-top: 8px;
    }

    .sidebar-menu {
        padding: 20px 0;
    }

    .menu-item {
        padding: 12px 30px;
        display: flex;
        align-items: center;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s;
        cursor: pointer;
    }

    .menu-item:hover,
    .menu-item.active {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border-left: 4px solid #FFD700;
    }

    .menu-item i {
        margin-right: 12px;
        font-size: 18px;
        width: 24px;
    }

    /* Main Content */
    .main-content {
        margin-left: 280px;
        flex: 1;
        padding: 30px;
    }

    .top-bar {
        background: white;
        padding: 20px 30px;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .page-title {
        font-size: 28px;
        color: #2E8B57;
        font-weight: 700;
    }

    .page-subtitle {
        color: #666;
        font-size: 14px;
        margin-top: 5px;
    }

    /* KPI Cards */
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .kpi-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .kpi-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .kpi-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
    }

    .kpi-card.blue::before {
        background: #4facfe;
    }

    .kpi-card.green::before {
        background: #2E8B57;
    }

    .kpi-card.orange::before {
        background: #ff9a56;
    }

    .kpi-card.purple::before {
        background: #a18cd1;
    }

    .kpi-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 15px;
    }

    .kpi-card.blue .kpi-icon {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .kpi-card.green .kpi-icon {
        background: linear-gradient(135deg, #2E8B57 0%, #1a5c3a 100%);
        color: white;
    }

    .kpi-card.orange .kpi-icon {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        color: white;
    }

    .kpi-card.purple .kpi-icon {
        background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
        color: white;
    }

    .kpi-label {
        font-size: 13px;
        color: #666;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .kpi-value {
        font-size: 32px;
        font-weight: 700;
        color: #333;
        margin-bottom: 8px;
    }

    .kpi-change {
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .kpi-change.positive {
        color: #2E8B57;
    }

    .kpi-change.negative {
        color: #dc3545;
    }

    /* Charts Section */
    .charts-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .chart-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
    }

    .chart-filter {
        padding: 6px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 13px;
        cursor: pointer;
    }

    /* Status Table */
    .status-table {
        width: 100%;
        border-collapse: collapse;
    }

    .status-table tr {
        border-bottom: 1px solid #f0f0f0;
    }

    .status-table td {
        padding: 12px 0;
    }

    .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 10px;
    }

    .status-dot.blue {
        background: #4facfe;
    }

    .status-dot.green {
        background: #2E8B57;
    }

    .status-dot.orange {
        background: #ff9a56;
    }

    .status-dot.red {
        background: #dc3545;
    }

    /* Recent Activity */
    .activity-list {
        list-style: none;
    }

    .activity-item {
        padding: 15px 0;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        gap: 15px;
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .activity-icon.success {
        background: #d4edda;
        color: #2E8B57;
    }

    .activity-icon.warning {
        background: #fff3cd;
        color: #ff9a56;
    }

    .activity-icon.info {
        background: #d1ecf1;
        color: #0dcaf0;
    }

    .activity-content {
        flex: 1;
    }

    .activity-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
    }

    .activity-time {
        font-size: 12px;
        color: #999;
    }

    /* Ward Performance */
    .ward-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
    }

    .ward-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        transition: all 0.3s;
    }

    .ward-card:hover {
        background: #2E8B57;
        color: white;
        transform: scale(1.05);
    }

    .ward-number {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .ward-complaints {
        font-size: 13px;
        opacity: 0.8;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .charts-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .sidebar {
            width: 70px;
        }

        .main-content {
            margin-left: 70px;
        }

        .menu-item span {
            display: none;
        }

        .admin-name,
        .admin-role {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="admin-avatar">
                üë§
            </div>
            <div class="admin-name">{{ request.user.get_full_name|default:"Admin" }}</div>
            <span class="admin-role">üî∞ SUPER ADMIN</span>
            <div style="margin-top: 10px; font-size: 12px; opacity: 0.7;">
                ‚úì Active Now
            </div>
        </div>

        <div class="sidebar-menu">
            <div
                style="padding: 10px 30px; font-size: 11px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px;">
                MAIN MENU
            </div>
            <a href="#" class="menu-item active">
                <i>üìä</i> <span>Dashboard</span>
            </a>
            <a href="/admin/complaints/complaint/" class="menu-item">
                <i>üìù</i> <span>All Complaints</span>
            </a>
            <a href="/admin/users/user/" class="menu-item">
                <i>üë•</i> <span>User Management</span>
            </a>
            <a href="/admin/payments/payment/" class="menu-item">
                <i>üí∞</i> <span>Payments</span>
            </a>
            <a href="#" class="menu-item">
                <i>üìà</i> <span>Reports</span>
            </a>
            <a href="#" class="menu-item">
                <i>üîî</i> <span>Notifications</span>
            </a>
            <a href="#" class="menu-item">
                <i>‚öôÔ∏è</i> <span>Settings</span>
            </a>
        </div>

        <div
            style="position: absolute; bottom: 20px; left: 30px; right: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="font-size: 11px; opacity: 0.6;">Smart Complaint System</div>
            <div style="font-size: 10px; opacity: 0.4; margin-top: 5px;">¬© 2025 Clean Care</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div>
                <div class="page-title">üìä Dashboard Overview</div>
                <div class="page-subtitle">Real-time analytics and system insights</div>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <input type="text" placeholder="üîç Search..."
                    style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 8px; width: 250px;">
                <button
                    style="padding: 10px 20px; background: #2E8B57; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    üì• Export Report
                </button>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card blue">
                <div class="kpi-icon">üìã</div>
                <div class="kpi-label">Total Complaints</div>
                <div class="kpi-value">{{ total_complaints|default:"1,028" }}</div>
                <div class="kpi-change positive">
                    ‚Üë +18.2% <span style="opacity: 0.7;">from last month</span>
                </div>
            </div>

            <div class="kpi-card green">
                <div class="kpi-icon">‚úÖ</div>
                <div class="kpi-label">Solved</div>
                <div class="kpi-value">{{ complaints_by_status.0.count|default:"342" }}</div>
                <div class="kpi-change positive">
                    66.3% rate
                </div>
            </div>

            <div class="kpi-card orange">
                <div class="kpi-icon">‚è≥</div>
                <div class="kpi-label">Pending</div>
                <div class="kpi-value">{{ complaints_by_status.1.count|default:"127" }}</div>
                <div class="kpi-change">
                    24.7%
                </div>
            </div>

            <div class="kpi-card purple">
                <div class="kpi-icon">üîÑ</div>
                <div class="kpi-label">In Progress</div>
                <div class="kpi-value">{{ complaints_by_status.2.count|default:"45" }}</div>
                <div class="kpi-change">
                    8.8%
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- Complaint Status Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">üìä Complaint Status Overview</div>
                    <select class="chart-filter">
                        <option>Last 7 Days</option>
                        <option>Last 30 Days</option>
                        <option>Last 3 Months</option>
                    </select>
                </div>
                <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                    <div
                        style="width: 200px; height: 200px; border-radius: 50%; background: conic-gradient(#2E8B57 0% 50%, #4facfe 50% 80%, #ff9a56 80% 95%, #dc3545 95% 100%); position: relative;">
                        <div
                            style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 120px; height: 120px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                            <div style="font-size: 32px; font-weight: 700; color: #2E8B57;">50%</div>
                            <div style="font-size: 12px; color: #666;">Solved</div>
                        </div>
                    </div>
                </div>
                <table class="status-table" style="margin-top: 20px;">
                    <tr>
                        <td><span class="status-dot green"></span> Submitted</td>
                        <td style="text-align: right; font-weight: 600;">514</td>
                    </tr>
                    <tr>
                        <td><span class="status-dot blue"></span> Solved</td>
                        <td style="text-align: right; font-weight: 600;">342</td>
                    </tr>
                    <tr>
                        <td><span class="status-dot orange"></span> Pending</td>
                        <td style="text-align: right; font-weight: 600;">127</td>
                    </tr>
                    <tr>
                        <td><span class="status-dot red"></span> In Progress</td>
                        <td style="text-align: right; font-weight: 600;">45</td>
                    </tr>
                </table>
            </div>

            <!-- Satisfaction & Service Time -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Citizen Satisfaction -->
                <div class="chart-card">
                    <div class="chart-title" style="margin-bottom: 20px;">‚≠ê Citizen Satisfaction Score</div>
                    <div style="text-align: center;">
                        <div style="font-size: 48px; font-weight: 700; color: #2E8B57; margin-bottom: 10px;">4.2</div>
                        <div style="color: #FFD700; font-size: 24px; margin-bottom: 10px;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                        <div style="font-size: 13px; color: #666;">out of 5.0</div>
                    </div>
                </div>

                <!-- Average Service Time -->
                <div class="chart-card">
                    <div class="chart-title" style="margin-bottom: 20px;">‚è±Ô∏è Average Service Time</div>
                    <div style="text-align: center;">
                        <div style="font-size: 48px; font-weight: 700; color: #4facfe; margin-bottom: 10px;">4.3</div>
                        <div style="font-size: 13px; color: #666; margin-bottom: 15px;">days</div>
                        <div style="background: #f0f0f0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div
                                style="width: 86%; height: 100%; background: linear-gradient(90deg, #4facfe, #00f2fe);">
                            </div>
                        </div>
                        <div style="font-size: 11px; color: #999; margin-top: 8px;">Target: ‚â§ 5 days</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ward Performance & Recent Activity -->
        <div class="charts-grid">
            <!-- Ward Performance -->
            <div class="chart-card">
                <div class="chart-title" style="margin-bottom: 20px;">üìç Ward & Zone Performance</div>
                <div class="ward-grid">
                    {% for ward in ward_performance %}
                    <div class="ward-card">
                        <div class="ward-number">Ward {{ ward.ward_number|default:"40" }}</div>
                        <div class="ward-complaints">{{ ward.total|default:"95" }} complaints</div>
                    </div>
                    {% empty %}
                    <div class="ward-card">
                        <div class="ward-number">Ward 40</div>
                        <div class="ward-complaints">95 complaints</div>
                    </div>
                    <div class="ward-card">
                        <div class="ward-number">Ward 41</div>
                        <div class="ward-complaints">78 complaints</div>
                    </div>
                    <div class="ward-card">
                        <div class="ward-number">Ward 42</div>
                        <div class="ward-complaints">112 complaints</div>
                    </div>
                    <div class="ward-card">
                        <div class="ward-number">Ward 43</div>
                        <div class="ward-complaints">68 complaints</div>
                    </div>
                    <div class="ward-card">
                        <div class="ward-number">Ward 44</div>
                        <div class="ward-complaints">87 complaints</div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Total Users -->
            <div class="chart-card">
                <div class="chart-title" style="margin-bottom: 20px;">üë• Total Users</div>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div
                        style="background: #f0f9f4; padding: 15px; border-radius: 8px; display: flex; align-items: center; gap: 15px;">
                        <div
                            style="width: 50px; height: 50px; background: #2E8B57; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                            üëë
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 12px; color: #666;">Super Admins</div>
                            <div style="font-size: 24px; font-weight: 700; color: #2E8B57;">3</div>
                        </div>
                    </div>

                    <div
                        style="background: #fff8e6; padding: 15px; border-radius: 8px; display: flex; align-items: center; gap: 15px;">
                        <div
                            style="width: 50px; height: 50px; background: #ff9a56; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                            üõ°Ô∏è
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 12px; color: #666;">Admins</div>
                            <div style="font-size: 24px; font-weight: 700; color: #ff9a56;">24</div>
                        </div>
                    </div>

                    <div
                        style="background: #e8f4fd; padding: 15px; border-radius: 8px; display: flex; align-items: center; gap: 15px;">
                        <div
                            style="width: 50px; height: 50px; background: #4facfe; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                            üë§
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 12px; color: #666;">Citizens</div>
                            <div style="font-size: 24px; font-weight: 700; color: #4facfe;">12,847</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Complaints -->
        <div class="chart-card">
            <div class="chart-header">
                <div class="chart-title">üìã Recent Complaints</div>
                <a href="/admin/complaints/complaint/"
                    style="color: #2E8B57; text-decoration: none; font-size: 14px;">View All ‚Üí</a>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                        <th style="padding: 12px; text-align: left; font-size: 13px; color: #666;">Tracking #</th>
                        <th style="padding: 12px; text-align: left; font-size: 13px; color: #666;">Title</th>
                        <th style="padding: 12px; text-align: left; font-size: 13px; color: #666;">User</th>
                        <th style="padding: 12px; text-align: left; font-size: 13px; color: #666;">Status</th>
                        <th style="padding: 12px; text-align: left; font-size: 13px; color: #666;">Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for complaint in recent_complaints %}
                    <tr style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 12px; font-weight: 600; color: #2E8B57;">{{ complaint.tracking_number }}
                        </td>
                        <td style="padding: 12px;">{{ complaint.title|truncatewords:5 }}</td>
                        <td style="padding: 12px;">{{ complaint.user.name }}</td>
                        <td style="padding: 12px;">
                            <span
                                style="background: #d1ecf1; color: #0c5460; padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                                {{ complaint.status }}
                            </span>
                        </td>
                        <td style="padding: 12px; color: #666;">{{ complaint.created_at|date:"d M Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 12px; font-weight: 600; color: #2E8B57;">CC20251107001</td>
                        <td style="padding: 12px;">‡¶∞‡¶æ‡¶∏‡ßç‡¶§‡¶æ‡¶∞ ‡¶Ü‡¶¨‡¶∞‡ßç‡¶ú‡¶®‡¶æ ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ</td>
                        <td style="padding: 12px;">‡¶Æ‡ßã‡¶É ‡¶∞‡¶π‡¶ø‡¶Æ</td>
                        <td style="padding: 12px;">
                            <span
                                style="background: #d1ecf1; color: #0c5460; padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                                ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
                            </span>
                        </td>
                        <td style="padding: 12px; color: #666;">07 Nov 2025</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 12px; font-weight: 600; color: #2E8B57;">CC20251107002</td>
                        <td style="padding: 12px;">‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶™‡¶æ‡¶á‡¶™ ‡¶≠‡¶æ‡¶ô‡¶æ</td>
                        <td style="padding: 12px;">‡¶∏‡¶æ‡¶≤‡¶Æ‡¶æ ‡¶ñ‡¶æ‡¶§‡ßÅ‡¶®</td>
                        <td style="padding: 12px;">
                            <span
                                style="background: #fff3cd; color: #856404; padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                                ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶ß‡ßÄ‡¶®
                            </span>
                        </td>
                        <td style="padding: 12px; color: #666;">06 Nov 2025</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 12px; font-weight: 600; color: #2E8B57;">CC20251106003</td>
                        <td style="padding: 12px;">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ</td>
                        <td style="padding: 12px;">‡¶ï‡¶∞‡¶ø‡¶Æ ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ</td>
                        <td style="padding: 12px;">
                            <span
                                style="background: #d4edda; color: #155724; padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                                ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
                            </span>
                        </td>
                        <td style="padding: 12px; color: #666;">06 Nov 2025</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}