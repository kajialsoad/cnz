# Requirements Document

## Introduction

The complaint detail view page displays a broken image icon instead of showing the actual uploaded complaint images. This occurs because there is a mismatch between how image URLs are generated by the backend and how they are served. The backend generates URLs pointing to `/uploads/complaints/images/filename` but the server routes are configured to serve files through `/api/uploads/:type/:filename`. This requirement addresses fixing the image URL generation and serving mechanism to ensure images display correctly in the mobile application.

## Glossary

- **Backend Server**: The Node.js/Express server that handles API requests and serves uploaded files
- **Upload Service**: The backend service responsible for processing and managing file uploads
- **Image URL**: The complete URL path used to access uploaded images from the server
- **Static File Serving**: The mechanism by which the server delivers uploaded files to clients
- **Complaint Detail View**: The mobile app page that displays full details of a complaint including images

## Requirements

### Requirement 1

**User Story:** As a mobile app user, I want to see complaint images displayed correctly in the detail view, so that I can view the visual evidence associated with each complaint

#### Acceptance Criteria

1. WHEN THE Backend Server generates an image URL, THE Backend Server SHALL construct the URL using the pattern `/api/uploads/image/{filename}` where filename is the stored file name
2. WHEN THE Backend Server generates an audio URL, THE Backend Server SHALL construct the URL using the pattern `/api/uploads/voice/{filename}` where filename is the stored file name
3. WHEN THE Upload Service processes uploaded files, THE Upload Service SHALL return URLs that match the server's file serving routes
4. WHEN THE Mobile App requests an image from the generated URL, THE Backend Server SHALL serve the file with appropriate content-type headers
5. WHEN THE Mobile App displays the complaint detail view, THE Mobile App SHALL successfully load and display all associated images without showing broken image icons

### Requirement 2

**User Story:** As a developer, I want the file URL generation to be consistent across the codebase, so that there are no mismatches between URL generation and file serving routes

#### Acceptance Criteria

1. THE Upload Service SHALL use a centralized function to generate file URLs
2. THE Upload Service SHALL generate URLs that exactly match the server route pattern `/api/uploads/:type/:filename`
3. WHEN THE Backend Server stores file references in the database, THE Backend Server SHALL store only the filename without the full path
4. WHEN THE Backend Server retrieves complaints from the database, THE Backend Server SHALL construct full URLs using the centralized URL generation function
5. THE Backend Server SHALL NOT store absolute URLs in the database to maintain flexibility for different deployment environments

### Requirement 3

**User Story:** As a system administrator, I want uploaded files to be served efficiently with proper caching, so that the application performs well and reduces server load

#### Acceptance Criteria

1. WHEN THE Backend Server serves an uploaded file, THE Backend Server SHALL set cache-control headers with a maximum age of at least 1 year
2. WHEN THE Backend Server serves an uploaded file, THE Backend Server SHALL set the correct content-type header based on the file's MIME type
3. WHEN THE Backend Server receives a request for a non-existent file, THE Backend Server SHALL return a 404 status code with an appropriate error message
4. THE Backend Server SHALL serve files through the existing `/api/uploads/:type/:filename` route without requiring authentication for file access
5. THE Backend Server SHALL validate that the requested file type is either 'image' or 'voice' before attempting to serve the file
