import{bT as y,bU as f,cc as k,bV as C,j as e,bX as A,c as g,bY as v,T as r,cr as ae,P as b,B as x,p as w,q as G,i as W,ab as ce,bk as de,y as xe,aX as pe,n as ue,z as me,b0 as he,s as Te,t as Ee,w as je,az as m,D as O,x as ye,b as D,R as fe,aJ as Ce,aP as Ae,A as ge,_ as X,av as Y,$ as J,a1 as L,g as q,C as ve}from"./mui-vendor-Y6GvQTLC.js";import{r as c}from"./react-vendor-D7yrL1sD.js";import{a as _}from"./activityLogService-LRIzCQKD.js";import{f as K}from"./format-B_T1Ok2z.js";import"./query-vendor-D4yC0Jq7.js";import"./index-B_PiLh6w.js";import"./chart-vendor-BgnY-Lfo.js";const Se={CREATE_USER:"CREATE_USER",UPDATE_USER:"UPDATE_USER",DELETE_USER:"DELETE_USER",UPDATE_USER_STATUS:"UPDATE_USER_STATUS",UPDATE_USER_PERMISSIONS:"UPDATE_USER_PERMISSIONS",CREATE_COMPLAINT:"CREATE_COMPLAINT",UPDATE_COMPLAINT:"UPDATE_COMPLAINT",DELETE_COMPLAINT:"DELETE_COMPLAINT",ASSIGN_COMPLAINT:"ASSIGN_COMPLAINT",UPDATE_COMPLAINT_STATUS:"UPDATE_COMPLAINT_STATUS",SEND_MESSAGE:"SEND_MESSAGE",DELETE_MESSAGE:"DELETE_MESSAGE",LOGIN:"LOGIN",LOGOUT:"LOGOUT",FAILED_LOGIN:"FAILED_LOGIN",CREATE_ZONE:"CREATE_ZONE",UPDATE_ZONE:"UPDATE_ZONE",DELETE_ZONE:"DELETE_ZONE",CREATE_WARD:"CREATE_WARD",UPDATE_WARD:"UPDATE_WARD",DELETE_WARD:"DELETE_WARD",EXPORT_DATA:"EXPORT_DATA"},De={USER:"USER",COMPLAINT:"COMPLAINT",MESSAGE:"MESSAGE",ZONE:"ZONE",WARD:"WARD",CITY_CORPORATION:"CITY_CORPORATION"};function F(t){return{CREATE_USER:"Created User",UPDATE_USER:"Updated User",DELETE_USER:"Deleted User",UPDATE_USER_STATUS:"Updated User Status",UPDATE_USER_PERMISSIONS:"Updated User Permissions",CREATE_COMPLAINT:"Created Complaint",UPDATE_COMPLAINT:"Updated Complaint",DELETE_COMPLAINT:"Deleted Complaint",ASSIGN_COMPLAINT:"Assigned Complaint",UPDATE_COMPLAINT_STATUS:"Updated Complaint Status",SEND_MESSAGE:"Sent Message",DELETE_MESSAGE:"Deleted Message",LOGIN:"Logged In",LOGOUT:"Logged Out",FAILED_LOGIN:"Failed Login",CREATE_ZONE:"Created Zone",UPDATE_ZONE:"Updated Zone",DELETE_ZONE:"Deleted Zone",CREATE_WARD:"Created Ward",UPDATE_WARD:"Updated Ward",DELETE_WARD:"Deleted Ward",EXPORT_DATA:"Exported Data"}[t]||t}function be(t){return t.startsWith("CREATE")?"success":t.startsWith("UPDATE")?"info":t.startsWith("DELETE")?"error":t==="LOGIN"?"success":t==="LOGOUT"?"grey":t==="FAILED_LOGIN"?"error":"grey"}const R=c.createContext({});function Re(t){return y("MuiTimeline",t)}f("MuiTimeline",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function j(t){return t==="alternate-reverse"?"positionAlternateReverse":`position${k(t)}`}const Ie=t=>{const{position:s,classes:i}=t,o={root:["root",s&&j(s)]};return v(o,Re,i)},Oe=A("ul",{name:"MuiTimeline",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:i}=t;return[s.root,i.position&&s[j(i.position)]]}})({display:"flex",flexDirection:"column",padding:"6px 16px",flexGrow:1}),Le=c.forwardRef(function(s,i){const o=C({props:s,name:"MuiTimeline"}),{position:l="right",className:n,...p}=o,u={...o,position:l},a=Ie(u),E=c.useMemo(()=>({position:l}),[l]);return e.jsx(R.Provider,{value:E,children:e.jsx(Oe,{className:g(a.root,n),ownerState:u,ref:i,...p})})});function Ue(t){return y("MuiTimelineConnector",t)}f("MuiTimelineConnector",["root"]);const Me=t=>{const{classes:s}=t;return v({root:["root"]},Ue,s)},Ne=A("span",{name:"MuiTimelineConnector",slot:"Root"})(({theme:t})=>({width:2,backgroundColor:(t.vars||t).palette.grey[400],flexGrow:1})),Pe=c.forwardRef(function(s,i){const o=C({props:s,name:"MuiTimelineConnector"}),{className:l,...n}=o,p=o,u=Me(p);return e.jsx(Ne,{className:g(u.root,l),ownerState:p,ref:i,...n})});function _e(t){return y("MuiTimelineContent",t)}const we=f("MuiTimelineContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),Ge=t=>{const{position:s,classes:i}=t,o={root:["root",j(s)]};return v(o,_e,i)},We=A(r,{name:"MuiTimelineContent",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:i}=t;return[s.root,s[j(i.position)]]}})(({ownerState:t})=>({flex:1,padding:"6px 16px",textAlign:"left",...t.position==="left"&&{textAlign:"right"}})),ke=c.forwardRef(function(s,i){const o=C({props:s,name:"MuiTimelineContent"}),{className:l,...n}=o,{position:p}=c.useContext(R),u={...o,position:p||"right"},a=Ge(u);return e.jsx(We,{component:"div",className:g(a.root,l),ownerState:u,ref:i,...n})});function Fe(t){return y("MuiTimelineDot",t)}f("MuiTimelineDot",["root","filled","outlined","filledGrey","outlinedGrey","filledPrimary","outlinedPrimary","filledSecondary","outlinedSecondary"]);const $e=t=>{const{color:s,variant:i,classes:o}=t,l={root:["root",i,s!=="inherit"&&`${i}${k(s)}`]};return v(l,Fe,o)},Be=A("span",{name:"MuiTimelineDot",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:i}=t;return[s.root,s[i.color!=="inherit"&&`${i.variant}${k(i.color)}`],s[i.variant]]}})(({ownerState:t,theme:s})=>({display:"flex",alignSelf:"baseline",borderStyle:"solid",borderWidth:2,padding:4,borderRadius:"50%",boxShadow:(s.vars||s).shadows[1],margin:"11.5px 0",...t.variant==="filled"&&{borderColor:"transparent",...t.color!=="inherit"&&{...t.color==="grey"?{color:(s.vars||s).palette.grey[50],backgroundColor:(s.vars||s).palette.grey[400]}:{color:(s.vars||s).palette[t.color].contrastText,backgroundColor:(s.vars||s).palette[t.color].main}}},...t.variant==="outlined"&&{boxShadow:"none",backgroundColor:"transparent",...t.color!=="inherit"&&{...t.color==="grey"?{borderColor:(s.vars||s).palette.grey[400]}:{borderColor:(s.vars||s).palette[t.color].main}}}})),Ze=c.forwardRef(function(s,i){const o=C({props:s,name:"MuiTimelineDot"}),{className:l,color:n="grey",variant:p="filled",...u}=o,a={...o,color:n,variant:p},E=$e(a);return e.jsx(Be,{className:g(E.root,l),ownerState:a,ref:i,...u})});function Ve(t){return y("MuiTimelineOppositeContent",t)}const ze=f("MuiTimelineOppositeContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),He=t=>{const{position:s,classes:i}=t,o={root:["root",j(s)]};return v(o,Ve,i)},Xe=A(r,{name:"MuiTimelineOppositeContent",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:i}=t;return[s.root,s[j(i.position)]]}})(({ownerState:t})=>({padding:"6px 16px",marginRight:"auto",textAlign:"right",flex:1,...t.position==="left"&&{textAlign:"left"}})),Q=c.forwardRef(function(s,i){const o=C({props:s,name:"MuiTimelineOppositeContent"}),{className:l,...n}=o,{position:p}=c.useContext(R),u={...o,position:p||"left"},a=He(u);return e.jsx(Xe,{component:"div",className:g(a.root,l),ownerState:u,ref:i,...n})});Q.muiName="TimelineOppositeContent";function Ye(t){return y("MuiTimelineItem",t)}f("MuiTimelineItem",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse","missingOppositeContent"]);const Je=t=>{const{position:s,classes:i,hasOppositeContent:o}=t,l={root:["root",j(s),!o&&"missingOppositeContent"]};return v(l,Ye,i)},qe=A("li",{name:"MuiTimelineItem",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:i}=t;return[s.root,s[j(i.position)]]}})(({ownerState:t})=>({listStyle:"none",display:"flex",position:"relative",minHeight:70,...t.position==="left"&&{flexDirection:"row-reverse"},...(t.position==="alternate"||t.position==="alternate-reverse")&&{[`&:nth-of-type(${t.position==="alternate"?"even":"odd"})`]:{flexDirection:"row-reverse",[`& .${we.root}`]:{textAlign:"right"},[`& .${ze.root}`]:{textAlign:"left"}}},...!t.hasOppositeContent&&{"&::before":{content:'""',flex:1,padding:"6px 16px"}}})),Ke=c.forwardRef(function(s,i){const o=C({props:s,name:"MuiTimelineItem"}),{position:l,className:n,...p}=o,{position:u}=c.useContext(R);let a=!1;c.Children.forEach(o.children,N=>{ae(N,["TimelineOppositeContent"])&&(a=!0)});const E={...o,position:l||u||"right",hasOppositeContent:a},U=Je(E),M=c.useMemo(()=>({position:E.position}),[E.position]);return e.jsx(R.Provider,{value:M,children:e.jsx(qe,{className:g(U.root,n),ownerState:E,ref:i,...p})})});function Qe(t){return y("MuiTimelineSeparator",t)}f("MuiTimelineSeparator",["root"]);const et=t=>{const{classes:s}=t;return v({root:["root"]},Qe,s)},tt=A("div",{name:"MuiTimelineSeparator",slot:"Root"})({display:"flex",flexDirection:"column",flex:0,alignItems:"center"}),st=c.forwardRef(function(s,i){const o=C({props:s,name:"MuiTimelineSeparator"}),{className:l,...n}=o,p=o,u=et(p);return e.jsx(tt,{className:g(u.root,l),ownerState:p,ref:i,...n})}),nt=({logs:t,onLogClick:s})=>{const i=n=>n.startsWith("CREATE")?e.jsx(de,{}):n.startsWith("UPDATE")?e.jsx(xe,{}):n.startsWith("DELETE")?e.jsx(pe,{}):n==="LOGIN"?e.jsx(ue,{}):n==="LOGOUT"?e.jsx(me,{}):e.jsx(he,{}),o=n=>K(new Date(n),"MMM dd, yyyy HH:mm:ss"),l=n=>{const p=new Date,u=new Date(n),a=Math.floor((p.getTime()-u.getTime())/1e3);return a<60?`${a}s ago`:a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:`${Math.floor(a/86400)}d ago`};return e.jsx(Le,{position:"right",children:t.map((n,p)=>e.jsxs(Ke,{children:[e.jsxs(Q,{sx:{m:"auto 0",minWidth:150},align:"right",variant:"body2",color:"text.secondary",children:[e.jsx(r,{variant:"caption",display:"block",children:l(n.timestamp)}),e.jsx(r,{variant:"caption",display:"block",color:"text.disabled",children:o(n.timestamp)})]}),e.jsxs(st,{children:[e.jsx(Ze,{color:be(n.action),children:i(n.action)}),p<t.length-1&&e.jsx(Pe,{})]}),e.jsx(ke,{sx:{py:"12px",px:2},children:e.jsxs(b,{elevation:1,sx:{p:2,cursor:"pointer","&:hover":{elevation:3,backgroundColor:"action.hover"}},onClick:()=>s(n),children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsxs(x,{children:[e.jsx(r,{variant:"h6",component:"span",children:F(n.action)}),e.jsx(w,{label:n.entityType,size:"small",sx:{ml:1}})]}),e.jsx(G,{title:"View Details",children:e.jsx("span",{children:e.jsx(W,{size:"small",children:e.jsx(ce,{fontSize:"small"})})})})]}),n.user&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["By: ",n.user.firstName," ",n.user.lastName,n.user.email&&` (${n.user.email})`]}),n.entityId&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Entity ID: ",n.entityId]}),n.ipAddress&&e.jsxs(r,{variant:"caption",color:"text.disabled",display:"block",sx:{mt:1},children:["IP: ",n.ipAddress]})]})})]},n.id))})},it=({log:t,open:s,onClose:i})=>{if(!t)return null;const o=n=>K(new Date(n),"MMMM dd, yyyy HH:mm:ss"),l=n=>n==null?e.jsx(r,{color:"text.disabled",children:"N/A"}):typeof n=="object"?e.jsx(b,{variant:"outlined",sx:{p:2,backgroundColor:"grey.50"},children:e.jsx("pre",{style:{margin:0,fontSize:"0.875rem",overflow:"auto"},children:JSON.stringify(n,null,2)})}):e.jsx(r,{children:String(n)});return e.jsxs(Te,{open:s,onClose:i,maxWidth:"md",fullWidth:!0,children:[e.jsx(Ee,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"h6",children:"Activity Log Details"}),e.jsx(w,{label:t.action,size:"small"})]})}),e.jsx(je,{dividers:!0,children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Basic Information"}),e.jsxs(x,{sx:{pl:2},children:[e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Action:"}),e.jsx(r,{variant:"body1",children:F(t.action)})]}),e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Entity Type:"}),e.jsx(r,{variant:"body1",children:t.entityType})]}),t.entityId&&e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Entity ID:"}),e.jsx(r,{variant:"body1",children:t.entityId})]}),e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Timestamp:"}),e.jsx(r,{variant:"body1",children:o(t.timestamp)})]})]})]}),e.jsx(m,{item:!0,xs:12,children:e.jsx(O,{})}),t.user&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Performed By"}),e.jsxs(x,{sx:{pl:2},children:[e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Name:"}),e.jsxs(r,{variant:"body1",children:[t.user.firstName," ",t.user.lastName]})]}),t.user.email&&e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Email:"}),e.jsx(r,{variant:"body1",children:t.user.email})]}),e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Role:"}),e.jsx(w,{label:t.user.role,size:"small"})]})]})]}),e.jsx(m,{item:!0,xs:12,children:e.jsx(O,{})})]}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Technical Information"}),e.jsxs(x,{sx:{pl:2},children:[t.ipAddress&&e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"IP Address:"}),e.jsx(r,{variant:"body1",children:t.ipAddress})]}),t.userAgent&&e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"User Agent:"}),e.jsx(r,{variant:"body1",sx:{wordBreak:"break-word"},children:t.userAgent})]})]})]}),t.oldValue&&e.jsxs(e.Fragment,{children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(O,{})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Old Value"}),e.jsx(x,{sx:{pl:2},children:l(t.oldValue)})]})]}),t.newValue&&e.jsxs(e.Fragment,{children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(O,{})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"New Value"}),e.jsx(x,{sx:{pl:2},children:l(t.newValue)})]})]})]})}),e.jsx(ye,{children:e.jsx(D,{onClick:i,children:"Close"})})]})},pt=()=>{const[t,s]=c.useState([]),[i,o]=c.useState(!1),[l,n]=c.useState(null),[p,u]=c.useState(!1),[a,E]=c.useState(1),[U]=c.useState(50),[M,N]=c.useState(0),[$,ee]=c.useState(0),[S,B]=c.useState({page:1,limit:50}),[Z,te]=c.useState(!1),[se,V]=c.useState(null),[ne,z]=c.useState(!1),P=async()=>{var d,h;try{o(!0),n(null);const T=await _.getActivityLogs({...S,page:a,limit:U});s(T.logs),N(T.pagination.total),ee(T.pagination.totalPages)}catch(T){console.error("Error fetching activity logs:",T),n(((h=(d=T.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to fetch activity logs")}finally{o(!1)}},ie=async()=>{var d,h;try{u(!0);const T=await _.exportActivityLogs(S);_.downloadActivityLogs(T)}catch(T){console.error("Error exporting activity logs:",T),n(((h=(d=T.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to export activity logs")}finally{u(!1)}},I=(d,h)=>{B(T=>({...T,[d]:h}))},oe=()=>{E(1),P()},re=()=>{B({page:1,limit:50}),E(1)},le=d=>{V(d),z(!0)},H=d=>{E(d)};return c.useEffect(()=>{P()},[a]),e.jsxs(x,{sx:{p:3},children:[e.jsxs(x,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"h4",component:"h1",children:"Activity Logs"}),e.jsxs(x,{sx:{display:"flex",gap:1},children:[e.jsx(G,{title:"Refresh",children:e.jsx(W,{onClick:P,disabled:i,children:e.jsx(fe,{})})}),e.jsx(G,{title:"Toggle Filters",children:e.jsx(W,{onClick:()=>te(!Z),children:e.jsx(Ce,{})})}),e.jsx(D,{variant:"contained",startIcon:e.jsx(Ae,{}),onClick:ie,disabled:p||i,children:p?"Exporting...":"Export CSV"})]})]}),l&&e.jsx(ge,{severity:"error",sx:{mb:2},onClose:()=>n(null),children:l}),Z&&e.jsxs(b,{sx:{p:2,mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Filters"}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(Y,{children:"Action"}),e.jsxs(J,{value:S.action||"",onChange:d=>I("action",d.target.value||void 0),label:"Action",children:[e.jsx(L,{value:"",children:"All Actions"}),Object.entries(Se).map(([d,h])=>e.jsx(L,{value:h,children:F(h)},d))]})]})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(Y,{children:"Entity Type"}),e.jsxs(J,{value:S.entityType||"",onChange:d=>I("entityType",d.target.value||void 0),label:"Entity Type",children:[e.jsx(L,{value:"",children:"All Types"}),Object.entries(De).map(([d,h])=>e.jsx(L,{value:h,children:h},d))]})]})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(q,{fullWidth:!0,label:"Start Date",type:"date",value:S.startDate||"",onChange:d=>I("startDate",d.target.value||void 0),InputLabelProps:{shrink:!0}})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(q,{fullWidth:!0,label:"End Date",type:"date",value:S.endDate||"",onChange:d=>I("endDate",d.target.value||void 0),InputLabelProps:{shrink:!0}})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(x,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(D,{onClick:re,children:"Clear Filters"}),e.jsx(D,{variant:"contained",onClick:oe,children:"Apply Filters"})]})})]})]}),e.jsx(b,{sx:{p:2,mb:3},children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Showing ",t.length," of ",M," activity logs"]})}),i?e.jsx(x,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(ve,{})}):t.length===0?e.jsx(b,{sx:{p:4,textAlign:"center"},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:"No activity logs found"})}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{logs:t,onLogClick:le}),e.jsxs(x,{sx:{mt:3,display:"flex",justifyContent:"center",gap:1},children:[e.jsx(D,{disabled:a===1,onClick:()=>H(a-1),children:"Previous"}),e.jsxs(r,{sx:{px:2,py:1},children:["Page ",a," of ",$]}),e.jsx(D,{disabled:a===$,onClick:()=>H(a+1),children:"Next"})]})]}),e.jsx(it,{log:se,open:ne,onClose:()=>{z(!1),V(null)}})]})};export{pt as default};
