import{j as e,b as B,B as r,C as ve,G as Xs,p as ue,aE as Ys,u as Fs,o as Ks,s as we,t as Bs,i as $,v as Q,w as _s,d as Qs,A as Gs,az as d,T as o,aT as Vs,aU as De,aV as We,aW as As,aX as le,g as Hs,x as Zs,aY as er,e as E,f as sr,H as v,ao as rr,_ as Ee,av as Ne,$ as ke,a1 as re,aZ as Ds,N as Ws,a_ as or,K as xe,D as je,a$ as ze,J as K,b0 as oe,O as he,y as Ts,h as Ps,b1 as tr,b2 as Ls,q as $s}from"./mui-vendor-Y6GvQTLC.js";import{r as c,i as nr,d as ir}from"./react-vendor-D7yrL1sD.js";import{a as Us,g as ar,A as lr,i as cr,u as dr,M as Oe,w as Ms}from"./index-B_PiLh6w.js";import{c as Ae,a as te,C as xr,M as hr}from"./ChatConversationPanel-BD4nv1FE.js";import{f as fr}from"./dateUtils-Ct98g1e7.js";import{s as ne,b as ie}from"./toastUtils-aBfeJSyv.js";import"./query-vendor-D4yC0Jq7.js";import"./chart-vendor-BgnY-Lfo.js";import"./ErrorDisplay-BztN8unE.js";const q=({loading:x=!1,loadingText:f,children:y,disabled:s,startIcon:z,...a})=>e.jsx(B,{...a,disabled:s||x,startIcon:x?e.jsx(r,{sx:{display:"flex",alignItems:"center",animation:`${ar} 1s linear infinite`},children:e.jsx(ve,{size:16,color:"inherit"})}):z,sx:{...a.sx,transition:`all ${Us.fast.duration} ${Us.fast.timing}`,"&:not(:disabled):hover":{transform:"translateY(-1px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},"&:not(:disabled):active":{transform:"translateY(0)"}},children:x&&f?f:y}),ur=({categoryId:x,subcategoryId:f,size:y="small",showSubcategory:s=!0})=>{const[z,a]=c.useState(""),[p,R]=c.useState(""),[w,u]=c.useState("#808080"),[T,h]=c.useState(!0);if(c.useEffect(()=>{(async()=>{try{if(h(!0),!x||!f){a("Not Categorized"),R(""),u("#f5f5f5"),h(!1);return}try{const[b,k,G]=await Promise.all([Ae.getCategoryName(x,"en").catch(()=>"Unknown Category"),Ae.getSubcategoryName(x,f,"en").catch(()=>"Unknown"),Ae.getCategoryColor(x).catch(()=>"#808080")]);a(b),R(k),u(G)}catch(b){console.error("Error fetching category details:",b),a("Unknown"),R("Unknown"),u("#808080")}}catch(b){console.error("Error fetching category info:",b),a("Unknown"),R("Unknown"),u("#808080")}finally{h(!1)}})()},[x,f]),T)return e.jsx(Xs,{variant:"rectangular",width:120,height:y==="small"?24:32,sx:{borderRadius:2}});const N=s&&p?`${z} - ${p}`:z,g=!x||!f;return e.jsx(ue,{label:N,size:y,icon:g?e.jsx(Ys,{sx:{fontSize:16}}):void 0,sx:{backgroundColor:g?"#f5f5f5":w,color:g?"#757575":"#fff",border:g?"1px dashed #bdbdbd":"none",fontWeight:500,fontSize:y==="small"?"0.75rem":"0.875rem",height:y==="small"?24:32,"& .MuiChip-label":{px:1.5},"& .MuiChip-icon":{color:g?"#757575":"inherit",marginLeft:1},boxShadow:g?"none":"0 1px 3px rgba(0,0,0,0.12)"}})},ae=5,pr=5*1024*1024,gr=["image/jpeg","image/jpg","image/png","image/webp"],ye=20,fe=500,br=({open:x,complaintId:f,status:y,existingImages:s="",onClose:z,onSuccess:a})=>{const p=Fs(),R=Ks(p.breakpoints.down("sm")),w=c.useRef(null),[u,T]=c.useState(""),[h,N]=c.useState([]),[g,O]=c.useState(s?s.split(",").filter(n=>n.trim()):[]),[b,k]=c.useState(!1),[G,A]=c.useState(""),[U,X]=c.useState({note:!1,images:!1}),[Y,V]=c.useState(!1),D=y==="RESOLVED",_=D,H=D,l=U.note&&_&&u.length<ye?`Resolution note must be at least ${ye} characters`:U.note&&u.length>fe?`Resolution note must not exceed ${fe} characters`:"",S=h.length+g.length,P=U.images&&H&&S===0?"At least one image is required for resolved status":S>ae?`Maximum ${ae} images allowed`:"",Z=()=>!(_&&(u.length<ye||u.length>fe)||H&&h.length+g.length===0||h.length+g.length>ae),J=c.useCallback(n=>{if(!n)return;const C=[],m=[];Array.from(n).forEach(L=>{if(!gr.includes(L.type)){m.push(`${L.name}: Invalid file type. Only JPEG, PNG, and WebP are allowed.`);return}if(L.size>pr){m.push(`${L.name}: File size exceeds 5MB limit.`);return}if(h.length+g.length+C.length>=ae){m.push(`Maximum ${ae} images allowed.`);return}const M=URL.createObjectURL(L);C.push({file:L,preview:M})}),m.length>0&&(A(m.join(" ")),setTimeout(()=>A(""),5e3)),C.length>0&&(N(L=>[...L,...C]),X({...U,images:!0}))},[h.length,U]),pe=n=>{J(n.target.files),w.current&&(w.current.value="")},ee=c.useCallback(n=>{n.preventDefault(),n.stopPropagation(),n.type==="dragenter"||n.type==="dragover"?V(!0):n.type==="dragleave"&&V(!1)},[]),ge=c.useCallback(n=>{n.preventDefault(),n.stopPropagation(),V(!1),n.dataTransfer.files&&n.dataTransfer.files.length>0&&J(n.dataTransfer.files)},[J]),Ce=n=>{N(C=>{const m=[...C];return URL.revokeObjectURL(m[n].preview),m.splice(n,1),m})},Se=n=>{O(C=>{const m=[...C];return m.splice(n,1),m})},be=async()=>{if(X({note:!0,images:!0}),!!Z()){k(!0),A("");try{const n=new FormData;n.append("status",y),u.trim()&&n.append("resolutionNote",u.trim()),g.length>0&&n.append("resolutionImages",g.join(",")),h.forEach(ce=>{n.append("resolutionImages",ce.file)});const C=localStorage.getItem("accessToken");if(!C)throw new Error("Authentication token not found");const m=await fetch(`${lr.BASE_URL}/api/admin/complaints/${f}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${C}`},body:n}),L=m.headers.get("content-type");if(!L||!L.includes("application/json")){const ce=await m.text();throw console.error("Non-JSON response received:",ce.substring(0,200)),new Error("Server returned an invalid response. Please check if the backend server is running.")}const M=await m.json();if(!m.ok)throw new Error(M.message||"Failed to update complaint status");a(),se()}catch(n){console.error("Error updating status:",n),A(n.message||"Failed to update complaint status")}finally{k(!1)}}},se=()=>{b||(h.forEach(n=>{URL.revokeObjectURL(n.preview)}),T(""),N([]),O(s?s.split(",").filter(n=>n.trim()):[]),A(""),X({note:!1,images:!1}),V(!1),z())};return e.jsxs(we,{open:x,onClose:se,maxWidth:"md",fullWidth:!0,fullScreen:R,PaperProps:{sx:{borderRadius:R?0:2}},children:[e.jsxs(Bs,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:["Mark as ",y==="RESOLVED"?"Resolved":"In Progress",e.jsx($,{onClick:se,disabled:b,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(Q,{})})]}),e.jsxs(_s,{sx:{pt:3,pb:2},children:[b&&e.jsx(Qs,{sx:{mb:2}}),G&&e.jsx(Gs,{severity:"error",sx:{mb:2},onClose:()=>A(""),children:G}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{size:12,children:[e.jsxs(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:["Upload Images ",H&&e.jsx("span",{style:{color:p.palette.error.main},children:"*"})]}),e.jsx(o,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:2},children:H?"At least 1 image required, maximum 5 images, 5MB each":"Optional: Maximum 5 images, 5MB each"}),e.jsxs(r,{onDragEnter:ee,onDragLeave:ee,onDragOver:ee,onDrop:ge,sx:{border:"2px dashed",borderColor:Y?"primary.main":P?"error.main":"#ccc",borderRadius:2,p:3,textAlign:"center",bgcolor:Y?"action.hover":"background.paper",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:"primary.main",bgcolor:"action.hover"}},onClick:()=>{var n;return(n=w.current)==null?void 0:n.click()},children:[e.jsx("input",{ref:w,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:pe,style:{display:"none"},disabled:b}),e.jsx(Vs,{sx:{fontSize:48,color:"text.secondary",mb:1}}),e.jsx(o,{variant:"body1",color:"text.secondary",children:"Drag & drop images here, or click to select"}),e.jsx(o,{variant:"caption",color:"text.secondary",children:"JPEG, PNG, WebP (max 5MB each)"})]}),P&&e.jsx(o,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:P}),g.length>0&&e.jsxs(r,{sx:{mt:2},children:[e.jsx(o,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Existing Images:"}),e.jsx(De,{sx:{width:"100%",height:"auto"},cols:R?3:4,rowHeight:100,gap:8,children:g.map((n,C)=>e.jsxs(We,{children:[e.jsx("img",{src:n,alt:`Existing ${C+1}`,loading:"lazy",style:{height:100,objectFit:"cover",borderRadius:8}}),e.jsx(As,{sx:{background:"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%)",borderRadius:"8px 8px 0 0"},position:"top",actionIcon:e.jsx($,{sx:{color:"white"},onClick:m=>{m.stopPropagation(),Se(C)},size:"small",disabled:b,children:e.jsx(le,{fontSize:"small"})}),actionPosition:"right"})]},`existing-${C}`))})]}),h.length>0&&e.jsx(r,{sx:{mt:2},children:e.jsx(De,{sx:{width:"100%",height:"auto"},cols:R?2:3,gap:8,children:h.map((n,C)=>e.jsxs(We,{children:[e.jsx("img",{src:n.preview,alt:`Preview ${C+1}`,loading:"lazy",style:{height:150,objectFit:"cover",borderRadius:8}}),e.jsx(As,{sx:{background:"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0) 100%)",borderRadius:"8px 8px 0 0"},position:"top",actionIcon:e.jsx($,{sx:{color:"white"},onClick:m=>{m.stopPropagation(),Ce(C)},disabled:b,children:e.jsx(le,{})}),actionPosition:"right"})]},C))})}),e.jsxs(o,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[h.length+g.length," / ",ae," images selected"]})]}),e.jsx(d,{size:12,children:e.jsx(Hs,{fullWidth:!0,label:`Resolution Note ${_?"*":"(Optional)"}`,multiline:!0,rows:4,value:u,onChange:n=>{T(n.target.value),X({...U,note:!0})},disabled:b,placeholder:D?"Describe how the complaint was resolved...":"Add any notes about the progress...",error:!!l,helperText:l||`${u.length}/${fe} characters${_?` (minimum ${ye})`:""}`,inputProps:{maxLength:fe},required:_})}),e.jsx(d,{size:12,children:e.jsx(r,{sx:{p:2,bgcolor:D?"success.lighter":"info.lighter",borderRadius:1,border:"1px solid",borderColor:D?"success.light":"info.light"},children:e.jsxs(o,{variant:"body2",color:D?"success.dark":"info.dark",children:[e.jsx("strong",{children:"Note:"})," ",D?e.jsxs(e.Fragment,{children:["This complaint will be marked as ",e.jsx("strong",{children:"Resolved"}),". The user will receive a notification with your resolution images and notes. They will be able to submit a review after viewing the resolution."]}):e.jsxs(e.Fragment,{children:["This complaint will be marked as ",e.jsx("strong",{children:"In Progress"}),". The user will receive a notification that their complaint is being processed."]})]})})})]})]}),e.jsxs(Zs,{sx:{borderTop:"1px solid #e0e0e0",px:3,py:2,gap:1.5,flexDirection:{xs:"column-reverse",sm:"row"},"& > button":{width:{xs:"100%",sm:"auto"},minHeight:{xs:48,sm:36}}},children:[e.jsx(B,{onClick:se,disabled:b,color:"inherit",variant:"outlined",children:"Cancel"}),e.jsx(B,{onClick:be,variant:"contained",color:D?"success":"primary",disabled:b||!Z(),startIcon:b?void 0:e.jsx(er,{}),children:b?"Updating...":D?"Mark as Resolved":"Mark as In Progress"})]})]})},mr=({review:x})=>{var a,p,R;const f=Fs(),y=x.user?`${x.user.firstName} ${x.user.lastName}`:"Anonymous User",s=(w,u)=>!w||!u?"AU":`${w.charAt(0)}${u.charAt(0)}`.toUpperCase(),z=w=>{try{const u=new Date(w);return cr(u,{addSuffix:!0})}catch{return"Recently"}};return e.jsx(E,{sx:{mb:2,boxShadow:f.shadows[1],transition:"box-shadow 0.3s ease","&:hover":{boxShadow:f.shadows[3]},borderRadius:2},children:e.jsx(sr,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(v,{src:((a=x.user)==null?void 0:a.avatar)||void 0,alt:y,sx:{width:48,height:48,bgcolor:f.palette.primary.main,fontSize:"1rem",fontWeight:600},children:s((p=x.user)==null?void 0:p.firstName,(R=x.user)==null?void 0:R.lastName)}),e.jsxs(r,{sx:{flex:1,minWidth:0},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:f.palette.text.primary,mb:.5},children:y}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(rr,{value:x.rating,readOnly:!0,precision:1,size:"small",sx:{color:f.palette.warning.main}}),e.jsxs(o,{variant:"body2",sx:{color:f.palette.text.secondary,fontWeight:500},children:["(",x.rating," ",x.rating===1?"star":"stars",")"]})]}),x.comment&&e.jsxs(o,{variant:"body2",sx:{color:f.palette.text.secondary,mb:1,lineHeight:1.6,fontStyle:"italic",wordBreak:"break-word"},children:['"',x.comment,'"']}),e.jsx(o,{variant:"caption",sx:{color:f.palette.text.disabled,display:"block"},children:z(x.createdAt)})]})]})})})},jr={CORPORATION_INTERNAL:{label:"Corporation Internal",description:"Issues within city corporation jurisdiction handled by specific departments"},CORPORATION_EXTERNAL:{label:"Corporation External",description:"Issues outside city corporation jurisdiction handled by external agencies"}},yr={CORPORATION_INTERNAL:["Engineering","Electricity","Health","Property (Eviction)"],CORPORATION_EXTERNAL:["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"]},vr=({open:x,onClose:f,onSave:y,complaint:s,type:z,loading:a=!1})=>{var H;const[p,R]=c.useState(s.status),[w,u]=c.useState(s.resolutionNote||""),[T,h]=c.useState([]),[N,g]=c.useState([]),[O,b]=c.useState([]),[k,G]=c.useState(""),[A,U]=c.useState("");c.useEffect(()=>{x&&(R(s.status),u(s.resolutionNote||""),G(s.category||""),U(s.subcategory||""),s.resolutionImages?h(s.resolutionImages.split(",").filter(l=>l.trim())):h([]),g([]),b([]))},[x,s]);const X=l=>{G(l),U("")},Y=l=>{if(l.target.files){const S=Array.from(l.target.files),P=[...N,...S];g(P);const Z=S.map(J=>URL.createObjectURL(J));b([...O,...Z])}},V=l=>{h(T.filter((S,P)=>P!==l))},D=l=>{g(N.filter((S,P)=>P!==l)),URL.revokeObjectURL(O[l]),b(O.filter((S,P)=>P!==l))},_=async()=>{try{await y({status:p,note:w,existingImages:T,newImages:N,category:p==="OTHERS"?k:void 0,subcategory:p==="OTHERS"?A:void 0}),f()}catch(l){console.error("Failed to save resolution changes:",l)}};return e.jsxs(we,{open:x,onClose:f,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Bs,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Edit ",z==="RESOLVED"?"Resolution":"Others"," Details",e.jsx($,{onClick:f,size:"small",children:e.jsx(Q,{})})]}),e.jsx(_s,{dividers:!0,children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(Ee,{fullWidth:!0,children:[e.jsx(Ne,{children:"Status"}),e.jsxs(ke,{value:p,label:"Status",onChange:l=>R(l.target.value),children:[e.jsx(re,{value:"RESOLVED",children:"RESOLVED"}),e.jsx(re,{value:"OTHERS",children:"OTHERS"}),e.jsx(re,{value:"IN_PROGRESS",children:"IN PROGRESS"}),e.jsx(re,{value:"PENDING",children:"PENDING"})]})]}),p==="OTHERS"&&e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{size:{xs:12},children:e.jsxs(Ee,{fullWidth:!0,required:!0,children:[e.jsx(Ne,{children:"Category"}),e.jsx(ke,{value:k,label:"Category",onChange:l=>X(l.target.value),children:Object.entries(jr).map(([l,S])=>e.jsx(re,{value:l,children:S.label},l))})]})}),e.jsx(d,{size:{xs:12},children:e.jsxs(Ee,{fullWidth:!0,required:!0,disabled:!k,children:[e.jsx(Ne,{children:"Sub Category"}),e.jsx(ke,{value:A,label:"Sub Category",onChange:l=>U(l.target.value),children:k&&((H=yr[k])==null?void 0:H.map(l=>e.jsx(re,{value:l,children:l},l)))})]})})]}),e.jsx(Hs,{label:p==="RESOLVED"?"Resolution Note":"Admin Note",multiline:!0,rows:4,value:w,onChange:l=>u(l.target.value),placeholder:p==="RESOLVED"?"Enter resolution details (min 20 chars)...":"Enter note here...",fullWidth:!0,error:p==="RESOLVED"&&w.length<20,helperText:p==="RESOLVED"&&w.length<20?`Note must be at least 20 characters (${w.length}/20)`:""}),e.jsxs(r,{children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1},children:"Images"}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[T.map((l,S)=>e.jsxs(r,{sx:{position:"relative",width:80,height:80},children:[e.jsx("img",{src:l,alt:`Existing ${S}`,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4}}),e.jsx($,{size:"small",sx:{position:"absolute",top:-8,right:-8,bgcolor:"background.paper","&:hover":{bgcolor:"error.light",color:"white"}},onClick:()=>V(S),children:e.jsx(Q,{fontSize:"small"})})]},`existing-${S}`)),O.map((l,S)=>e.jsxs(r,{sx:{position:"relative",width:80,height:80},children:[e.jsx("img",{src:l,alt:`New ${S}`,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4,opacity:.8}}),e.jsx($,{size:"small",sx:{position:"absolute",top:-8,right:-8,bgcolor:"background.paper","&:hover":{bgcolor:"error.light",color:"white"}},onClick:()=>D(S),children:e.jsx(Q,{fontSize:"small"})})]},`new-${S}`)),e.jsxs(B,{variant:"outlined",component:"label",sx:{width:80,height:80,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:1,borderStyle:"dashed"},children:[e.jsx(Vs,{}),e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:Y})]})]}),p==="RESOLVED"&&T.length===0&&N.length===0&&e.jsx(o,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:"At least one image is required for RESOLVED status."})]})]})}),e.jsxs(Zs,{children:[e.jsx(B,{onClick:f,disabled:a,children:"Cancel"}),e.jsx(B,{onClick:_,variant:"contained",disabled:a||p==="RESOLVED"&&(w.length<20||T.length===0&&N.length===0)||p==="OTHERS"&&(!k||!A),children:a?"Saving...":"Save Changes"})]})]})},Or=()=>{var Te,Pe,Le,$e,Ue,Me,Fe,Be,_e,Ge,Ve,He,Ze,Je,qe,Xe,Ye,Ke,Qe,es,ss,rs,os,ts,ns,is,as,ls,cs,ds,xs,hs,fs,us,ps,gs,bs,ms,js,ys,vs,ws,Cs,Ss,Is,Rs,Es,Ns;const{id:x}=nr(),f=ir(),{user:y}=dr(),[s,z]=c.useState(null),[a,p]=c.useState(null),[R,w]=c.useState(!0),[u,T]=c.useState(null),[h,N]=c.useState(!1),[g,O]=c.useState(null),[b,k]=c.useState(!1),[G,A]=c.useState(!1),[U,X]=c.useState("IN_PROGRESS"),[Y,V]=c.useState([]),[D,_]=c.useState(!1),[H,l]=c.useState(!1),[S,P]=c.useState("RESOLVED"),[Z,J]=c.useState({open:!1,audioUrl:null,index:0}),pe=()=>{const t=[];return t.push({id:1,action:"Complaint Submitted",date:new Date((s==null?void 0:s.createdAt)||"").toLocaleString("en-US"),description:"The complaint has been successfully submitted"}),s!=null&&s.status&&s.status!=="PENDING"&&t.push({id:2,action:s.status==="IN_PROGRESS"?"In Progress":s.status==="RESOLVED"?"Resolved":"Rejected",date:new Date((s==null?void 0:s.updatedAt)||"").toLocaleString("en-US"),description:s.status==="IN_PROGRESS"?"The complaint is now in progress":s.status==="RESOLVED"?"The complaint has been resolved":"The complaint has been rejected"}),t};c.useEffect(()=>{x&&(n(),C())},[x]),c.useEffect(()=>{s&&(async()=>{var W,F,ks,zs,Os;if(!s)return;console.log("ðŸ” Checking for ward mismatch...",{locationDetails:s.locationDetails,location:s.location,systemWard:s.wards});let i=null,j=s.locationDetails;if(typeof j=="string")try{j=JSON.parse(j)}catch(I){console.error("Error parsing locationDetails JSON:",I)}if(j!=null&&j.ward){const de=String(j.ward).match(/\d+/);de&&(i=parseInt(de[0]))}if(!i&&s.location){const I=s.location.match(/Ward\s*(\d+)/i);I&&(i=parseInt(I[1]))}if(!i&&typeof((W=s.user)==null?void 0:W.ward)=="object"&&s.user.ward.wardNumber&&(i=s.user.ward.wardNumber),console.log("ðŸ” Debug Location Data:",{locDetails:j,locationString:s.location,extractedWard:i}),!i){console.log("âŒ Could not extract ward number from location");return}console.log("ðŸŽ¯ Target Ward Number:",i);try{let I=(F=s.cityCorporation)==null?void 0:F.code;!I&&s.location&&(s.location.toLowerCase().includes("south")||s.location.includes("à¦¦à¦•à§à¦·à¦¿à¦£")?I="DSCC":(s.location.toLowerCase().includes("north")||s.location.includes("à¦‰à¦¤à§à¦¤à¦°"))&&(I="DNCC")),I||(typeof((ks=s.user)==null?void 0:ks.cityCorporation)=="string"?s.user.cityCorporation.includes("South")?I="DSCC":s.user.cityCorporation.includes("North")&&(I="DNCC"):(Os=(zs=s.user)==null?void 0:zs.cityCorporation)!=null&&Os.code&&(I=s.user.cityCorporation.code)),I||(I="DNCC"),console.log("ðŸŒ Fetching wards for:",I);const de=await Ms.getWards({cityCorporationCode:I});if(de.wards){const Ie=de.wards.find(me=>me.wardNumber===i);if(Ie)console.log("âœ¨ Found correct ward data:",Ie),p(Ie);else{console.warn(`âš ï¸ Ward ${i} not found in ${I}`);const me=await Ms.getWards({status:"ACTIVE"});if(me.wards){const Re=me.wards.find(qs=>qs.wardNumber===i);Re&&(console.log("âœ¨ Found correct ward data (global search):",Re),p(Re))}}}}catch(I){console.error("âŒ Error fetching correct ward details:",I)}})()},[s]);const ee=t=>{P(t),l(!0)},ge=async()=>{if(!(!s||!window.confirm("Are you sure you want to delete this resolution/report? This will revert the status to IN PROGRESS.")))try{await te.updateComplaintStatus(s.id,{status:"IN_PROGRESS",note:"Resolution deleted by admin",resolutionNote:"",resolutionImages:""}),n(),ie("Resolution deleted successfully. Status reverted to In Progress.")}catch(t){console.error("Failed to delete resolution:",t),ne("Failed to delete resolution.")}},Ce=async(t,i)=>{s&&J({open:!0,audioUrl:t,index:i})},Se=async()=>{if(!(!s||!Z.audioUrl))try{const t=s.audioUrls.filter(j=>j!==Z.audioUrl),i=await te.updateComplaintAudioUrls(s.id,t);z(i),J({open:!1,audioUrl:null,index:0}),ie("Voice recording deleted successfully.")}catch(t){console.error("Failed to delete audio recording:",t),ne("Failed to delete audio recording.")}},be=()=>{J({open:!1,audioUrl:null,index:0})},se=async t=>{var i,j;if(s)try{await te.updateComplaintStatus(s.id,{status:t.status,resolutionNote:t.note,resolutionImages:t.existingImages.join(","),resolutionImageFiles:t.newImages,category:t.category,subcategory:t.subcategory}),l(!1),n(),ie("Resolution updated successfully.")}catch(W){console.error("Failed to save resolution changes:",W);const F=((j=(i=W.response)==null?void 0:i.data)==null?void 0:j.message)||W.message||"Failed to save resolution changes.";ne(F)}},n=async()=>{try{w(!0),T(null);const t=await te.getComplaintById(Number(x));z(t),t.reviews&&V(t.reviews)}catch(t){console.error("Error fetching complaint details:",t),T("Failed to load complaint details"),ne("Failed to load complaint details")}finally{w(!1)}},C=async()=>{var t;if(x)try{_(!0);const i=await fetch(`/api/complaints/${x}/reviews`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(i.ok){const j=await i.json();V(((t=j.data)==null?void 0:t.reviews)||[])}}catch(i){console.error("Error fetching reviews:",i)}finally{_(!1)}},m=async(t,i,j,W)=>{if(s)try{N(!0),await te.markComplaintAsOthers(s.id,{othersCategory:t,othersSubcategory:i,note:j,images:W}),k(!1),await n(),ie("Complaint marked as Others successfully")}catch(F){console.error("Error marking as others:",F),ne("Failed to mark as others")}finally{N(!1)}},L=async()=>{await n(),A(!1),ie("Status updated successfully")},M=async t=>{if(s){if(t==="RESOLVED"||t==="IN_PROGRESS"){X(t),A(!0);return}try{N(!0);const i=await te.updateComplaintStatus(s.id,{status:t});z(i),ie("Status updated successfully")}catch(i){console.error("Error updating status:",i),ne("Failed to update status")}finally{N(!1)}}},ce=t=>{switch(t){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724"};case"REJECTED":return{backgroundColor:"#f8d7da",color:"#721c24"};default:return{backgroundColor:"#f8f9fa",color:"#6c757d"}}},Js=t=>{switch(t){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Solved";case"REJECTED":return"Others";default:return t}};return R?e.jsx(Oe,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(ve,{size:60,sx:{color:"#4CAF50"}})})}):u||!s?e.jsx(Oe,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:e.jsxs(r,{sx:{p:3},children:[e.jsx(Gs,{severity:"error",sx:{mb:2},children:u||"Complaint not found"}),e.jsx(B,{variant:"outlined",startIcon:e.jsx(Ds,{}),onClick:()=>f("/complaints"),children:"Back to Complaints"})]})}):e.jsxs(Oe,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:[e.jsxs(r,{sx:{p:{xs:2,md:3},maxWidth:1400,mx:"auto",backgroundColor:"#f9fafb",minHeight:"100vh"},children:[e.jsx(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:e.jsxs(r,{sx:{p:{xs:2,md:2.5}},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx($,{onClick:()=>f("/complaints"),sx:{color:"#3fa564",backgroundColor:"#f0fdf4","&:hover":{backgroundColor:"#dcfce7"},width:40,height:40},children:e.jsx(Ds,{})}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(o,{variant:"h5",sx:{fontWeight:700,color:"#1e2939",fontSize:{xs:"1.25rem",md:"1.5rem"},mb:.5},children:["à¦…à¦­à¦¿à¦¯à§‹à¦— #",s.trackingNumber||`CC-${String(s.id).padStart(7,"0")}`]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ws,{sx:{fontSize:16,color:"#6b7280"}}),e.jsx(o,{variant:"body2",sx:{color:"#6b7280",fontSize:"0.875rem"},children:new Date(s.createdAt).toLocaleDateString("bn-BD")})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(or,{sx:{fontSize:16,color:"#6b7280"}}),e.jsx(o,{variant:"body2",sx:{color:"#6b7280",fontSize:"0.875rem"},children:fr(s.createdAt)})]})]})]}),e.jsx(ue,{label:Js(s.status),sx:{...ce(s.status),fontWeight:600,fontSize:"0.875rem",height:32,px:2,borderRadius:2}})]}),s.category&&e.jsx(r,{sx:{mt:2},children:e.jsx(ur,{categoryId:s.category,subcategoryId:s.subcategory})})]})}),e.jsxs(d,{container:!0,spacing:2.5,children:[e.jsxs(d,{size:{xs:12,md:7},children:[e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¸à§à¦¤à¦¾à¦°à¦¿à¦¤"})}),e.jsxs(r,{sx:{p:3},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2,color:"#1e2939"},children:s.title}),e.jsx(d,{container:!0,spacing:2,sx:{mb:3},children:e.jsx(d,{size:{xs:12},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:32,height:32,bgcolor:"#f0fdf4",color:"#3fa564"},children:e.jsx(xe,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦²à§‹à¦•à§‡à¦¶à¦¨"}),e.jsx(o,{variant:"body1",sx:{color:"#1e2939"},children:s.location}),e.jsxs(r,{sx:{display:"flex",gap:2,mt:1,flexWrap:"wrap"},children:[((a==null?void 0:a.zone)||s.zone||((Te=s.user)==null?void 0:Te.zone))&&e.jsx(ue,{label:`Zone: ${((Pe=a==null?void 0:a.zone)==null?void 0:Pe.name)||((Le=s.zone)==null?void 0:Le.name)||((Ue=($e=s.user)==null?void 0:$e.zone)==null?void 0:Ue.name)||"N/A"}`,size:"small",sx:{bgcolor:"#eff6ff",color:"#1d4ed8",border:"1px solid #dbeafe",fontSize:"0.75rem"}}),(a||s.wards||((Me=s.user)==null?void 0:Me.ward))&&e.jsx(ue,{label:`Ward: ${(a==null?void 0:a.wardNumber)||((Fe=s.wards)==null?void 0:Fe.wardNumber)||((_e=(Be=s.user)==null?void 0:Be.ward)==null?void 0:_e.wardNumber)||"N/A"}`,size:"small",sx:{bgcolor:"#fdf2f8",color:"#be185d",border:"1px solid #fce7f3",fontSize:"0.75rem"}})]})]})]})})}),e.jsxs(r,{sx:{backgroundColor:"#f9fafb",p:2.5,borderRadius:2,border:"1px solid #f3f4f6"},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,mb:1,color:"#374151"},children:"à¦¬à¦¿à¦¬à¦°à¦£:"}),e.jsx(o,{variant:"body2",sx:{whiteSpace:"pre-wrap",color:"#4b5563",lineHeight:1.6},children:s.description||"à¦•à§‹à¦¨ à¦¬à¦¿à¦¬à¦°à¦£ à¦ªà§à¦°à¦¦à¦¾à¦¨ à¦•à¦°à¦¾ à¦¹à¦¯à¦¼à¦¨à¦¿"})]}),(s.wardInspector||s.zoneOfficer)&&e.jsxs(r,{sx:{mt:3},children:[e.jsx(je,{sx:{mb:2}}),e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,mb:2,color:"#374151"},children:"à¦¦à¦¾à¦¯à¦¼à¦¿à¦¤à§à¦¬à¦ªà§à¦°à¦¾à¦ªà§à¦¤ à¦•à¦°à§à¦®à¦•à¦°à§à¦¤à¦¾ (Responsible Officers):"}),e.jsxs(d,{container:!0,spacing:2,children:[s.zoneOfficer&&e.jsx(d,{size:{xs:12,md:6},children:e.jsxs(r,{sx:{p:2,borderRadius:2,border:"1px solid #dbeafe",backgroundColor:"#eff6ff"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1.5},children:[e.jsx(ze,{sx:{color:"#1d4ed8",fontSize:20}}),e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#1e40af"},children:"à¦œà§‹à¦¨ à¦…à¦«à¦¿à¦¸à¦¾à¦° (Zone Officer)"})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[s.zoneOfficer.zoneNumber&&e.jsxs(o,{variant:"body2",sx:{color:"#1e3a8a"},children:[e.jsx("strong",{children:"Zone:"})," ",s.zoneOfficer.zoneNumber," - ",s.zoneOfficer.zoneName||"N/A"]}),s.zoneOfficer.name&&e.jsxs(o,{variant:"body2",sx:{color:"#1e3a8a"},children:[e.jsx("strong",{children:"Name:"})," ",s.zoneOfficer.name]}),s.zoneOfficer.designation&&e.jsxs(o,{variant:"body2",sx:{color:"#1e3a8a"},children:[e.jsx("strong",{children:"Designation:"})," ",s.zoneOfficer.designation]}),s.zoneOfficer.phone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(K,{sx:{fontSize:16,color:"#1d4ed8"}}),e.jsx(o,{component:"a",href:`tel:${s.zoneOfficer.phone}`,variant:"body2",sx:{color:"#1d4ed8",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:s.zoneOfficer.phone})]}),s.zoneOfficer.supervisorName&&e.jsxs(o,{variant:"body2",sx:{color:"#1e3a8a",mt:1,pt:1,borderTop:"1px solid #bfdbfe"},children:[e.jsx("strong",{children:"Supervisor:"})," ",s.zoneOfficer.supervisorName,s.zoneOfficer.supervisorTitle&&` (${s.zoneOfficer.supervisorTitle})`]})]})]})}),s.wardInspector&&e.jsx(d,{size:{xs:12,md:6},children:e.jsxs(r,{sx:{p:2,borderRadius:2,border:"1px solid #fce7f3",backgroundColor:"#fdf2f8"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1.5},children:[e.jsx(oe,{sx:{color:"#be185d",fontSize:20}}),e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#9f1239"},children:"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦‡à¦¨à§à¦¸à¦ªà§‡à¦•à§à¦Ÿà¦° (Ward Inspector)"})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[s.wardInspector.wardNumber&&e.jsxs(o,{variant:"body2",sx:{color:"#831843"},children:[e.jsx("strong",{children:"Ward:"})," ",s.wardInspector.wardNumber]}),s.wardInspector.name&&e.jsxs(o,{variant:"body2",sx:{color:"#831843"},children:[e.jsx("strong",{children:"Name:"})," ",s.wardInspector.name]}),s.wardInspector.phone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(K,{sx:{fontSize:16,color:"#be185d"}}),e.jsx(o,{component:"a",href:`tel:${s.wardInspector.phone}`,variant:"body2",sx:{color:"#be185d",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:s.wardInspector.phone})]}),s.wardInspector.serialNumber&&e.jsxs(o,{variant:"body2",sx:{color:"#831843"},children:[e.jsx("strong",{children:"Serial:"})," ",s.wardInspector.serialNumber]})]})]})})]})]})]})]}),(s.status==="RESOLVED"||s.resolutionNote||s.resolutionImages)&&e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f0fdf4"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{sx:{color:"#15803d"}}),e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#14532d"},children:"à¦¸à¦®à¦¾à¦§à¦¾à¦¨à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£ (Resolution Details)"})]})}),e.jsxs(r,{sx:{p:3},children:[s.status==="OTHERS"&&e.jsxs(r,{sx:{mb:3,p:2,bgcolor:"#fff7ed",borderRadius:1,border:"1px solid #ffedd5"},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#c2410c",mb:1},children:"à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯ à¦•à§à¦¯à¦¾à¦Ÿà¦¾à¦—à¦°à¦¿ à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦šà¦¿à¦¹à§à¦¨à¦¿à¦¤ (Marked as Others):"}),e.jsxs(o,{variant:"body2",sx:{color:"#9a3412",display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Category:"})," ",s.othersCategory==="CORPORATION_INTERNAL"?"Corp. Internal":s.othersCategory==="CORPORATION_EXTERNAL"?"Corp. External":s.othersCategory]}),s.othersSubcategory&&e.jsxs("span",{children:[e.jsx("strong",{children:"Sub-category:"})," ",s.othersSubcategory]})]})]}),s.resolutionNote&&e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#374151"},children:(()=>{var j,W;const t=(j=s.statusHistory)==null?void 0:j.find(F=>F.newStatus==="RESOLVED"||F.newStatus==="OTHERS"),i=(W=t==null?void 0:t.changer)==null?void 0:W.role;return i==="MASTER_ADMIN"?"à¦®à¦¾à¦¸à§à¦Ÿà¦¾à¦° à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦®à¦¨à§à¦¤à¦¬à§à¦¯ (Master Admin Note):":i==="SUPER_ADMIN"?"à¦¸à§à¦ªà¦¾à¦° à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦®à¦¨à§à¦¤à¦¬à§à¦¯ (Super Admin Note):":"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦®à¦¨à§à¦¤à¦¬à§à¦¯ (Ward Admin Note):"})()}),e.jsxs(r,{children:[e.jsx($,{size:"small",onClick:()=>ee("RESOLVED"),color:"primary",children:e.jsx(Ts,{fontSize:"small"})}),e.jsx($,{size:"small",onClick:ge,color:"error",children:e.jsx(le,{fontSize:"small"})})]})]}),e.jsx(o,{variant:"body1",sx:{color:"#1f2937",whiteSpace:"pre-wrap",backgroundColor:"#ffffff",p:2,borderRadius:1,border:"1px solid #e5e7eb"},children:s.resolutionNote})]}),s.resolutionImages&&e.jsxs(r,{children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,mb:1.5,color:"#374151"},children:"à¦•à¦¾à¦œà§‡à¦° à¦ªà§à¦°à¦®à¦¾à¦£ (Proof of Work):"}),e.jsx(r,{sx:{display:"flex",gap:1.5,flexWrap:"wrap"},children:s.resolutionImages.split(",").filter(t=>t.trim()).map((t,i)=>e.jsx(r,{component:"img",src:t.trim(),alt:`Resolution Proof ${i+1}`,sx:{width:{xs:"100%",sm:"calc(50% - 12px)",md:"calc(33.333% - 12px)"},maxWidth:300,height:200,objectFit:"cover",borderRadius:2,border:"1px solid #e5e7eb",cursor:"pointer",transition:"all 0.2s","&:hover":{transform:"scale(1.02)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},onClick:()=>O(t.trim())},i))})]})]})]}),(s.status==="RESOLVED"||s.status==="OTHERS")&&e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:["User Reviews (",Y.length,")"]}),D&&e.jsx(ve,{size:20,sx:{color:"#3fa564"}})]})}),e.jsx(r,{sx:{p:3},children:D?e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(ve,{size:30,sx:{color:"#3fa564"}})}):Y.length===0?e.jsx(r,{sx:{textAlign:"center",py:4},children:e.jsx(o,{variant:"body2",sx:{color:"#6b7280"},children:"No reviews yet. User can submit a review after complaint is resolved or marked as others."})}):e.jsx(r,{children:Y.map(t=>e.jsx(mr,{review:t},t.id))})})]}),(((Ge=s.wards)==null?void 0:Ge.inspectorName)||((Ve=s.zone)==null?void 0:Ve.officerName))&&e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦¦à¦¾à¦¯à¦¼à¦¿à¦¤à§à¦¬à¦ªà§à¦°à¦¾à¦ªà§à¦¤ à¦•à¦°à§à¦®à¦•à¦°à§à¦¤à¦¾à¦—à¦£"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{size:{xs:12},children:e.jsx(r,{sx:{p:2,border:"1px solid #bfdbfe",borderRadius:2,backgroundColor:"#eff6ff"},children:e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(v,{sx:{bgcolor:"#fff",color:"#2563eb",width:48,height:48,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e.jsx(ze,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"Ward Inspector / à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦‡à¦¨à§à¦¸à¦ªà§‡à¦•à§à¦Ÿà¦°"}),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:700,color:"#1e2939"},children:(a==null?void 0:a.inspectorName)||((He=s.wards)==null?void 0:He.inspectorName)||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"}),((a==null?void 0:a.inspectorPhone)||((Ze=s.wards)==null?void 0:Ze.inspectorPhone))&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(K,{sx:{fontSize:16,color:"#2563eb"}}),e.jsx(o,{variant:"body2",sx:{color:"#4b5563",fontWeight:500},children:(a==null?void 0:a.inspectorPhone)||((Je=s.wards)==null?void 0:Je.inspectorPhone)})]})]})]})})}),e.jsx(d,{size:{xs:12},children:e.jsx(r,{sx:{p:2,border:"1px solid #fed7aa",borderRadius:2,backgroundColor:"#fff7ed"},children:e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(v,{sx:{bgcolor:"#fff",color:"#f97316",width:48,height:48,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e.jsx(oe,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"Zone Officer / à¦œà§‹à¦¨ à¦…à¦«à¦¿à¦¸à¦¾à¦°"}),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:700,color:"#1e2939"},children:((qe=a==null?void 0:a.zone)==null?void 0:qe.officerName)||((Xe=s.zone)==null?void 0:Xe.officerName)||"No Info"}),(((Ye=a==null?void 0:a.zone)==null?void 0:Ye.officerPhone)||((Ke=s.zone)==null?void 0:Ke.officerPhone))&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(K,{sx:{fontSize:16,color:"#f97316"}}),e.jsx(o,{variant:"body2",sx:{color:"#4b5563",fontWeight:500},children:((Qe=a==null?void 0:a.zone)==null?void 0:Qe.officerPhone)||((es=s.zone)==null?void 0:es.officerPhone)})]})]})]})})})]})})]}),e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦…à¦­à¦¿à¦¯à§‹à¦—à¦•à¦¾à¦°à§€à¦° à¦¤à¦¥à§à¦¯ (Complainant Info)"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#f0fdf4",color:"#3fa564"},children:e.jsx(oe,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¨à¦¾à¦®"}),e.jsxs(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:[s.user.firstName," ",s.user.lastName]})]})]})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#eff6ff",color:"#2563eb"},children:e.jsx(K,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦«à§‹à¦¨ à¦¨à¦®à§à¦¬à¦°"}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:s.user.phone||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"})]})]})}),s.user.email&&e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#fef3c7",color:"#d97706"},children:e.jsx(Ps,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦‡à¦®à§‡à¦‡à¦²"}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:s.user.email})]})]})}),s.user.address&&e.jsx(d,{size:{xs:12},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#f3e8ff",color:"#7c3aed"},children:e.jsx(xe,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦ à¦¿à¦•à¦¾à¦¨à¦¾"}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:s.user.address})]})]})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#fce7f3",color:"#be185d"},children:e.jsx(ze,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦‡à¦‰à¦œà¦¾à¦° à¦†à¦‡à¦¡à¦¿"}),e.jsxs(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:["CC-USER-",String(s.user.id).padStart(3,"0")]})]})]})}),s.user.createdAt&&e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#dbeafe",color:"#1d4ed8"},children:e.jsx(Ws,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦°à§‡à¦œà¦¿à¦¸à§à¦Ÿà§à¦°à§‡à¦¶à¦¨ à¦¤à¦¾à¦°à¦¿à¦–"}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:new Date(s.user.createdAt).toLocaleDateString("bn-BD",{year:"numeric",month:"long",day:"numeric"})})]})]})}),(s.user.cityCorporation||s.user.cityCorporationCode)&&e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#d1fae5",color:"#059669"},children:e.jsx(xe,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨ (à¦‡à¦‰à¦œà¦¾à¦°)"}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:typeof s.user.cityCorporation=="object"?(ss=s.user.cityCorporation)==null?void 0:ss.name:s.user.cityCorporation||(s.user.cityCorporationCode==="DSCC"?"à¦¢à¦¾à¦•à¦¾ à¦¦à¦•à§à¦·à¦¿à¦£ à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨":s.user.cityCorporationCode==="DNCC"?"à¦¢à¦¾à¦•à¦¾ à¦‰à¦¤à§à¦¤à¦° à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨":s.user.cityCorporationCode)})]})]})}),(s.user.zone||s.user.zoneId)&&e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#e0e7ff",color:"#4f46e5"},children:e.jsx(xe,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦œà§‹à¦¨ (à¦‡à¦‰à¦œà¦¾à¦°)"}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:typeof s.user.zone=="object"?`Zone ${s.user.zone.zoneNumber} - ${s.user.zone.name||""}`:s.user.zone||`Zone ${s.user.zoneId}`})]})]})}),(s.user.ward||s.user.wardId)&&e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#fef3c7",color:"#f59e0b"},children:e.jsx(xe,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ (à¦‡à¦‰à¦œà¦¾à¦°)"}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:typeof s.user.ward=="object"?`Ward ${s.user.ward.wardNumber||s.user.ward.number||""}`:s.user.ward||`Ward ${s.user.wardId}`})]})]})}),s.user.role&&e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(v,{sx:{width:36,height:36,bgcolor:"#fee2e2",color:"#dc2626"},children:e.jsx(oe,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦­à§‚à¦®à¦¿à¦•à¦¾"}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:s.user.role==="USER"?"à¦¨à¦¾à¦—à¦°à¦¿à¦•":s.user.role==="ADMIN"?"à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨":s.user.role})]})]})})]})})]}),e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦²à§‹à¦•à§‡à¦¶à¦¨ à¦“ à¦•à§à¦¯à¦¾à¦Ÿà¦¾à¦—à¦°à¦¿"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨"}),e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#3fa564"},children:((rs=s.cityCorporation)==null?void 0:rs.name)||((os=s.cityCorporation)==null?void 0:os.nameBangla)||(typeof((ts=s.user)==null?void 0:ts.cityCorporation)=="object"?(ns=s.user.cityCorporation)==null?void 0:ns.name:null)||(typeof((is=s.user)==null?void 0:is.cityCorporation)=="string"?s.user.cityCorporation:"à¦¢à¦¾à¦•à¦¾ à¦‰à¦¤à§à¦¤à¦° à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨")})]})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡"}),e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:a?`Ward ${a.wardNumber}`:((as=s.wards)==null?void 0:as.displayName)||((ls=s.wards)!=null&&ls.wardNumber?`Ward ${s.wards.wardNumber}`:null)||((cs=s.wards)!=null&&cs.number?`Ward ${s.wards.number}`:null)||(typeof((ds=s.user)==null?void 0:ds.ward)=="object"?((xs=s.user.ward)==null?void 0:xs.wardNumber)||((hs=s.user.ward)==null?void 0:hs.number):(fs=s.user)==null?void 0:fs.ward)||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"})]})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦œà§‹à¦¨"}),e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:((us=a==null?void 0:a.zone)==null?void 0:us.name)||((ps=s.zone)==null?void 0:ps.displayName)||((gs=s.zone)==null?void 0:gs.name)||((bs=s.zone)!=null&&bs.zoneNumber?`Zone ${s.zone.zoneNumber}`:null)||(typeof((ms=s.user)==null?void 0:ms.zone)=="object"?((js=s.user.zone)==null?void 0:js.name)||((ys=s.user.zone)==null?void 0:ys.zoneNumber):(vs=s.user)==null?void 0:vs.zone)||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"})]})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¥à¦¾à¦¨à¦¾"}),e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:((ws=s.user.thana)==null?void 0:ws.name)||"à¦®à¦¿à¦°à¦ªà§à¦°"})]})})]})})]}),s.imageUrls&&s.imageUrls.length>0&&e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.01)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsxs(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:["ðŸ“· à¦¸à¦‚à¦¯à§à¦•à§à¦¤ à¦›à¦¬à¦¿ (",s.imageUrls.length,")"]})}),e.jsx(r,{sx:{p:2},children:e.jsx(De,{cols:2,gap:12,children:s.imageUrls.map((t,i)=>e.jsxs(We,{sx:{cursor:"pointer",borderRadius:2,overflow:"hidden",position:"relative",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover .zoom-icon":{opacity:1},"&:hover img":{transform:"scale(1.05)"}},onClick:()=>O(t),children:[e.jsx("img",{src:t,alt:`Complaint image ${i+1}`,loading:"lazy",style:{width:"100%",height:160,objectFit:"cover",transition:"transform 0.3s ease"}}),e.jsx(r,{className:"zoom-icon",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.4)",opacity:0,transition:"opacity 0.3s"},children:e.jsx(tr,{sx:{color:"white",fontSize:32}})})]},i))})})]}),s.audioUrls&&s.audioUrls.length>0&&e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f0fdf4"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ls,{sx:{color:"#15803d"}}),e.jsxs(o,{variant:"h6",sx:{fontWeight:700,color:"#14532d"},children:["ðŸŽ¤ à¦­à¦¯à¦¼à§‡à¦¸ à¦°à§‡à¦•à¦°à§à¦¡à¦¿à¦‚ (",s.audioUrls.length,")"]})]}),(y==null?void 0:y.role)==="MASTER_ADMIN"&&e.jsx($s,{title:"Master Admin can delete audio recordings",children:e.jsx(ue,{label:"Deletable",size:"small",sx:{bgcolor:"#fef3c7",color:"#92400e",fontSize:"0.75rem",fontWeight:600}})})]})}),e.jsx(r,{sx:{p:3},children:s.audioUrls.map((t,i)=>e.jsxs(r,{sx:{mb:i<s.audioUrls.length-1?2:0,p:2,backgroundColor:"#f9fafb",borderRadius:2,border:"1px solid #e5e7eb",position:"relative"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.5},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(v,{sx:{bgcolor:"#dcfce7",color:"#15803d",width:32,height:32},children:e.jsx(Ls,{fontSize:"small"})}),e.jsxs(o,{variant:"subtitle2",sx:{fontWeight:600,color:"#1e2939"},children:["Voice Recording ",i+1]})]}),(y==null?void 0:y.role)==="MASTER_ADMIN"&&e.jsx($s,{title:"Delete this audio recording",children:e.jsx($,{size:"small",onClick:()=>Ce(t,i),sx:{color:"#dc2626","&:hover":{backgroundColor:"#fee2e2"}},children:e.jsx(le,{fontSize:"small"})})})]}),e.jsxs("audio",{controls:!0,style:{width:"100%",height:40,borderRadius:8,outline:"none"},preload:"metadata",children:[e.jsx("source",{src:t,type:"audio/mpeg"}),e.jsx("source",{src:t,type:"audio/wav"}),e.jsx("source",{src:t,type:"audio/ogg"}),"Your browser does not support the audio element."]})]},i))})]}),e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦Ÿà¦¾à¦‡à¦®à¦²à¦¾à¦‡à¦¨"})}),e.jsx(r,{sx:{p:3},children:e.jsx(r,{sx:{display:"flex",flexDirection:"column"},children:pe().map((t,i)=>e.jsxs(r,{sx:{display:"flex",gap:2,position:"relative"},children:[i<pe().length-1&&e.jsx(r,{sx:{position:"absolute",left:11,top:24,bottom:-24,width:2,backgroundColor:"#e5e7eb",zIndex:0}}),e.jsx(r,{sx:{zIndex:1,mt:.5},children:e.jsx(r,{sx:{width:24,height:24,borderRadius:"50%",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid #fff",boxShadow:"0 0 0 2px #dcfce7"},children:e.jsx(he,{sx:{color:"#3fa564",fontSize:16}})})}),e.jsxs(r,{sx:{flex:1,pb:3},children:[e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:t.action}),e.jsx(o,{variant:"caption",sx:{display:"block",mb:.5,color:"#6b7280"},children:t.date}),e.jsx(o,{variant:"body2",sx:{color:"#4b5563",fontSize:"0.875rem"},children:t.description})]})]},t.id))})})]}),e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦¨à¦¾à¦—à¦°à¦¿à¦•à§‡à¦° à¦¤à¦¥à§à¦¯"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(v,{src:s.user.avatar||void 0,sx:{bgcolor:"#eff6ff",color:"#1d4ed8"},children:!s.user.avatar&&e.jsx(oe,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦¨à¦¾à¦®"}),e.jsxs(o,{variant:"body1",sx:{fontWeight:600,color:"#1f2937"},children:[s.user.firstName," ",s.user.lastName]})]})]})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(v,{sx:{bgcolor:"#f0fdf4",color:"#15803d"},children:e.jsx(K,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦«à§‹à¦¨"}),e.jsx(o,{variant:"body1",component:"a",href:`tel:${s.user.phone}`,sx:{fontWeight:600,color:"#1f2937",textDecoration:"none","&:hover":{color:"#3fa564"}},children:s.user.phone||"N/A"})]})]})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(v,{sx:{bgcolor:"#fff7ed",color:"#c2410c"},children:e.jsx(Ps,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦‡à¦®à§‡à¦‡à¦²"}),e.jsx(o,{variant:"body1",component:"a",href:`mailto:${s.user.email}`,sx:{fontWeight:600,color:"#1f2937",textDecoration:"none","&:hover":{color:"#3fa564"},wordBreak:"break-all"},children:s.user.email||"N/A"})]})]})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(v,{sx:{bgcolor:"#f3f4f6",color:"#374151",fontSize:"0.8rem",fontWeight:700},children:"ID"}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦‡à¦‰à¦œà¦¾à¦° à¦†à¦‡à¦¡à¦¿"}),e.jsxs(o,{variant:"body1",sx:{fontWeight:600,color:"#1f2937"},children:["CC-USER-",s.user.id]})]})]})})]})})]}),((Cs=s.wards)==null?void 0:Cs.inspectorName)&&e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦‡à¦¨à§à¦¸à¦ªà§‡à¦•à§à¦Ÿà¦°"})}),e.jsxs(r,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(v,{sx:{width:48,height:48,bgcolor:"#eff6ff",color:"#2563eb",fontWeight:600},children:((Ss=s.wards.inspectorName)==null?void 0:Ss.charAt(0))||"WI"}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.wards.inspectorName||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"}),e.jsxs(o,{variant:"caption",sx:{display:"block",color:"#6b7280",mt:.5},children:["Ward ",s.wards.wardNumber||s.wards.number||s.wards.id]}),s.wards.inspectorPhone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[e.jsx(K,{sx:{fontSize:14,color:"#6b7280"}}),e.jsx(o,{variant:"body2",component:"a",href:`tel:${s.wards.inspectorPhone}`,sx:{color:"#6b7280",textDecoration:"none","&:hover":{color:"#3fa564"}},children:s.wards.inspectorPhone})]})]}),s.wards.inspectorPhone&&e.jsx(B,{variant:"outlined",size:"small",component:"a",href:`tel:${s.wards.inspectorPhone}`,sx:{borderColor:"#e5e7eb",color:"#374151"},children:"à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦—"})]})]}),((Is=s.zone)==null?void 0:Is.officerName)&&e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Zone Officer"})}),e.jsxs(r,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(v,{sx:{width:48,height:48,bgcolor:"#fff7ed",color:"#f97316",fontWeight:600},children:((Rs=s.zone.officerName)==null?void 0:Rs.charAt(0))||"ZO"}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.zone.officerName||"No Info"}),e.jsx(o,{variant:"caption",sx:{color:"#6b7280"},children:"Zone Officer"})]})]})]}),e.jsxs(E,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Admin Report"})}),e.jsxs(r,{sx:{p:3},children:[e.jsx(o,{variant:"body2",sx:{color:"#6b7280",mb:2},children:"This complaint is managed by"}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(v,{sx:{width:40,height:40,bgcolor:"#fff7ed",color:"#f97316"},children:((Ns=(Es=s.assignedAdmin)==null?void 0:Es.firstName)==null?void 0:Ns.charAt(0))||e.jsx(oe,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.assignedAdmin?`${s.assignedAdmin.firstName} ${s.assignedAdmin.lastName}`:"Not Assigned Yet"}),e.jsx(o,{variant:"body2",sx:{color:"#6b7280"},children:s.assignedAdmin?"Ward Admin":"Pending"})]})]}),e.jsx(B,{variant:"outlined",fullWidth:!0,sx:{borderColor:"#3fa564",color:"#3fa564",textTransform:"none","&:hover":{backgroundColor:"#f0fdf4",borderColor:"#3fa564"}},children:"Assign New Admin"})]})]}),e.jsxs(E,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Action"})}),e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(q,{variant:"contained",onClick:()=>M("IN_PROGRESS"),loading:h,startIcon:e.jsx(he,{}),sx:{backgroundColor:"#3fa564","&:hover":{backgroundColor:"#15803d"},textTransform:"none",px:3,flex:1},children:"Mark In Progress"}),e.jsx(q,{variant:"contained",onClick:()=>M("RESOLVED"),loading:h,startIcon:e.jsx(he,{}),sx:{backgroundColor:"#15803d","&:hover":{backgroundColor:"#166534"},textTransform:"none",px:3,flex:1},children:"Mark Solved"})]}),s.status==="IN_PROGRESS"&&e.jsxs(e.Fragment,{children:[e.jsx(q,{variant:"contained",onClick:()=>M("RESOLVED"),loading:h,startIcon:e.jsx(he,{}),sx:{backgroundColor:"#3fa564","&:hover":{backgroundColor:"#15803d"},textTransform:"none",px:3,flex:1},children:"Mark Solved"}),e.jsx(q,{variant:"outlined",onClick:()=>M("PENDING"),loading:h,sx:{borderColor:"#f59e0b",color:"#d97706",textTransform:"none",px:3,"&:hover":{backgroundColor:"#fffbeb",borderColor:"#f59e0b"}},children:"Mark Pending"})]}),s.status==="RESOLVED"&&e.jsx(q,{variant:"outlined",onClick:()=>M("IN_PROGRESS"),loading:h,sx:{borderColor:"#3b82f6",color:"#2563eb",textTransform:"none",px:3,flex:1,"&:hover":{backgroundColor:"#eff6ff",borderColor:"#3b82f6"}},children:"Reopen (In Progress)"}),s.status==="REJECTED"&&e.jsx(q,{variant:"outlined",onClick:()=>M("PENDING"),loading:h,sx:{borderColor:"#f59e0b",color:"#d97706",textTransform:"none",px:3,flex:1,"&:hover":{backgroundColor:"#fffbeb",borderColor:"#f59e0b"}},children:"Reopen (Pending)"}),s.status==="OTHERS"&&e.jsx(q,{variant:"outlined",onClick:()=>M("PENDING"),loading:h,sx:{borderColor:"#f59e0b",color:"#d97706",textTransform:"none",px:3,flex:1,"&:hover":{backgroundColor:"#fffbeb",borderColor:"#f59e0b"}},children:"Reopen (Pending)"})]}),(s.status==="PENDING"||s.status==="IN_PROGRESS")&&e.jsxs(e.Fragment,{children:[e.jsx(je,{sx:{my:2},children:e.jsx(o,{variant:"caption",color:"text.secondary",children:"Other Actions"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"center",flexDirection:"column",gap:2},children:e.jsx(q,{variant:"outlined",onClick:()=>k(!0),loading:h,startIcon:e.jsx(Q,{}),sx:{borderColor:"#ef4444",color:"#ef4444",textTransform:"none",width:"100%","&:hover":{backgroundColor:"#fef2f2",borderColor:"#ef4444"}},children:"Mark as Others"})})]}),(s.status==="REJECTED"||s.status==="OTHERS")&&e.jsxs(e.Fragment,{children:[e.jsx(je,{sx:{my:2},children:e.jsx(o,{variant:"caption",color:"text.secondary",children:"Other Actions"})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"center",flexDirection:"column",gap:2},children:[e.jsx(q,{variant:"outlined",onClick:()=>k(!0),loading:h,startIcon:e.jsx(Q,{}),sx:{borderColor:"#ef4444",color:"#ef4444",textTransform:"none",width:"100%","&:hover":{backgroundColor:"#fef2f2",borderColor:"#ef4444"}},children:"Update Others Category"}),(s.othersCategory||s.category)&&e.jsxs(r,{sx:{p:2,bgcolor:"#fef2f2",borderRadius:1,border:"1px solid #fee2e2"},children:[e.jsx(o,{variant:"subtitle2",color:"error.main",gutterBottom:!0,children:"Marked as Others"}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Category:"})," ",s.othersCategory||s.category]}),(s.othersSubcategory||s.subcategory)&&e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Sub-category:"})," ",s.othersSubcategory||s.subcategory]}),s.resolutionNote&&e.jsxs(r,{sx:{mt:1.5},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"caption",sx:{fontWeight:600,color:"#ef4444"},children:(()=>{var j,W;const t=(j=s.statusHistory)==null?void 0:j.find(F=>F.newStatus==="OTHERS"),i=(W=t==null?void 0:t.changer)==null?void 0:W.role;return i==="SUPER_ADMIN"||i==="MASTER_ADMIN"?"Super Admin Note:":"Ward Admin Note:"})()}),e.jsxs(r,{children:[e.jsx($,{size:"small",onClick:()=>ee("OTHERS"),sx:{color:"#ef4444"},children:e.jsx(Ts,{fontSize:"small"})}),e.jsx($,{size:"small",onClick:ge,sx:{color:"#ef4444"},children:e.jsx(le,{fontSize:"small"})})]})]}),e.jsx(o,{variant:"body2",sx:{color:"#374151",bgcolor:"#fff",p:1,borderRadius:1,border:"1px solid #fee2e2",mt:.5,whiteSpace:"pre-wrap"},children:s.resolutionNote})]}),s.resolutionImages&&e.jsxs(r,{sx:{mt:1.5},children:[e.jsx(o,{variant:"caption",sx:{fontWeight:600,color:"#ef4444",display:"block",mb:.5},children:"Attached Images:"}),e.jsx(r,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:s.resolutionImages.split(",").filter(t=>t.trim()).map((t,i)=>e.jsx(r,{component:"img",src:t.trim(),alt:`Admin report ${i+1}`,sx:{width:60,height:60,objectFit:"cover",borderRadius:1,cursor:"pointer",border:"1px solid #fee2e2"},onClick:()=>O(t.trim())},i))})]}),s.status==="REJECTED"&&e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mt:1,fontStyle:"italic"},children:"Note: This complaint is marked as REJECTED but contains Others/External categorization."})]})]})]})]})]})]}),e.jsx(d,{size:{xs:12,md:5},children:e.jsx(E,{sx:{borderRadius:3,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",border:"1px solid #e5e7eb",height:"1000px",display:"flex",flexDirection:"column",overflow:"hidden",bgcolor:"#fff"},children:x&&e.jsx(xr,{complaintId:Number(x),hideHeader:!1,onStatusUpdate:t=>{s&&z({...s,status:t})}})})})]})]}),e.jsx(hr,{open:b,onClose:()=>k(!1),onConfirm:m,loading:h}),e.jsx(br,{open:G,complaintId:(s==null?void 0:s.id)||0,status:U,existingImages:(s==null?void 0:s.resolutionImages)||"",onClose:()=>A(!1),onSuccess:L}),g&&e.jsx(we,{open:!!g,onClose:()=>O(null),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{bgcolor:"transparent",boxShadow:"none",overflow:"hidden"}},children:e.jsxs(r,{sx:{position:"relative",bgcolor:"transparent",display:"flex",justifyContent:"center"},children:[e.jsx($,{onClick:()=>O(null),sx:{position:"absolute",right:0,top:0,color:"white",bgcolor:"rgba(0,0,0,0.5)","&:hover":{bgcolor:"rgba(0,0,0,0.7)"},m:1},children:e.jsx(Q,{})}),e.jsx("img",{src:g,alt:"Full size",style:{maxWidth:"100%",maxHeight:"90vh",objectFit:"contain",borderRadius:8}})]})}),s&&e.jsx(vr,{open:H,onClose:()=>l(!1),onSave:se,complaint:s,type:S}),e.jsx(we,{open:Z.open,onClose:be,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(r,{sx:{width:48,height:48,borderRadius:"50%",bgcolor:"error.light",display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:e.jsx(le,{sx:{color:"error.main",fontSize:24}})}),e.jsxs(r,{children:[e.jsxs(o,{variant:"h6",fontWeight:600,color:"text.primary",children:["Delete Voice Recording ",Z.index+1,"?"]}),e.jsx(o,{variant:"caption",color:"text.secondary",children:"This action cannot be undone"})]})]}),e.jsx(je,{sx:{my:2}}),e.jsx(o,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Are you sure you want to permanently delete this voice recording? Once deleted, it cannot be recovered."}),e.jsxs(r,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(B,{onClick:be,variant:"outlined",color:"inherit",sx:{minWidth:100,textTransform:"none",fontWeight:500},children:"Cancel"}),e.jsx(B,{onClick:Se,variant:"contained",color:"error",sx:{minWidth:100,textTransform:"none",fontWeight:500,boxShadow:"none","&:hover":{boxShadow:"0 4px 12px rgba(211, 47, 47, 0.3)"}},children:"Delete"})]})]})})]})};export{Or as default};
