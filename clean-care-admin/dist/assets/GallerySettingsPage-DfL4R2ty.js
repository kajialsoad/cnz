var xe=Object.defineProperty;var ue=(r,s,a)=>s in r?xe(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a;var O=(r,s,a)=>ue(r,typeof s!="symbol"?s+"":s,a);import{j as e,B as i,C as N,T as g,cP as ge,b as f,bn as he,A as H,az as L,b0 as K,cl as h,s as q,t as Y,w as _,g as Z,i as F,a$ as te,x as J,c5 as me,b$ as fe,aF as be,p as je,cG as ye,y as Ce,V as Ie,l as Se,f as ve,e as we}from"./mui-vendor-Brc-2iiC.js";import{r as o}from"./react-vendor-D7yrL1sD.js";import{a as Ue,b as Q,D as De,c as Ae,S as Re,r as Te,d as Fe,s as ke,K as ze,P as Ee,u as Pe,C as We}from"./sortable.esm-CBBmJpQ9.js";import{A as X,M as ee}from"./index-DBuvollO.js";import{a as $e}from"./query-vendor-CZVuOxbJ.js";import"./chart-vendor-CrjdDA16.js";class Oe{constructor(){O(this,"apiClient");O(this,"baseUrl","/api/gallery");this.apiClient=$e.create({baseURL:X.BASE_URL,timeout:X.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(s=>{try{const a=localStorage.getItem("accessToken");a&&(s.headers.Authorization=`Bearer ${a}`)}catch(a){console.error("Error getting token:",a)}return s},s=>Promise.reject(s)),this.apiClient.interceptors.response.use(s=>s,s=>{var a;return((a=s.response)==null?void 0:a.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(s)})}async getAllImagesForAdmin(){return(await this.apiClient.get(`${this.baseUrl}/admin/images`)).data}async createImage(s){return(await this.apiClient.post(`${this.baseUrl}/admin/images`,s)).data}async updateImage(s,a){return(await this.apiClient.put(`${this.baseUrl}/admin/images/${s}`,a)).data}async toggleStatus(s){return(await this.apiClient.post(`${this.baseUrl}/admin/images/${s}/toggle-status`)).data}async reorderImages(s){await this.apiClient.post(`${this.baseUrl}/admin/images/reorder`,{imageIds:s})}async deleteImage(s){await this.apiClient.delete(`${this.baseUrl}/admin/images/${s}`)}async uploadImage(s){try{const a=new FormData;a.append("images",s);const x=await this.apiClient.post("/api/uploads",a,{headers:{"Content-Type":"multipart/form-data"}});if(x.data.success&&x.data.data.fileUrls.length>0)return x.data.data.fileUrls[0];throw new Error("Failed to upload image")}catch(a){throw console.error("Error uploading image:",a),a}}}const b=new Oe,Le=fe(we)(({theme:r})=>({height:"100%",display:"flex",flexDirection:"column",position:"relative",borderRadius:"20px",transition:"all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",border:"1px solid",borderColor:h(r.palette.divider,.1),boxShadow:`0 10px 30px -10px ${h(r.palette.common.black,.1)}`,"&:hover":{transform:"translateY(-10px) scale(1.02)",boxShadow:`0 20px 40px -15px ${h(r.palette.common.black,.2)}`}})),Be=({image:r,index:s,onEdit:a,onToggleStatus:x,onDelete:k})=>{const{attributes:D,listeners:j,setNodeRef:S,transform:z,transition:y,isDragging:v}=Pe({id:r.id}),A={transform:We.Transform.toString(z),transition:y,zIndex:v?1:"auto"};return e.jsx(L,{size:{xs:12,sm:6,md:4,lg:3},ref:S,style:A,children:e.jsx(me,{in:!0,style:{transitionDelay:`${s*50}ms`},children:e.jsxs(Le,{sx:{opacity:v?.5:1},children:[e.jsxs(i,{sx:{position:"relative"},children:[e.jsx(be,{component:"img",height:"220",image:r.imageUrl,alt:r.title,onError:R=>{R.currentTarget.src="https://via.placeholder.com/400x220?text=Image+Not+Found"},sx:{objectFit:"cover",filter:r.status==="INACTIVE"?"grayscale(0.8)":"none"}}),e.jsx(i,{sx:{position:"absolute",top:12,right:12},children:e.jsx(je,{label:r.status==="ACTIVE"?"সক্রিয়":"নিষ্ক্রিয়",size:"small",sx:{bgcolor:r.status==="ACTIVE"?h("#4caf50",.9):h("#000",.6),color:"#fff",fontWeight:"700"}})}),e.jsx(i,{...D,...j,sx:{position:"absolute",top:12,left:12,bgcolor:h("#000",.6),color:"#fff",borderRadius:"50%",p:.5,cursor:"grab",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(4px)","&:hover":{bgcolor:h("#000",.8)},"&:active":{cursor:"grabbing"}},children:e.jsx(ye,{fontSize:"small"})}),e.jsxs(i,{sx:{position:"absolute",bottom:0,left:0,right:0,p:1.5,background:"linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 100%)",display:"flex",justifyContent:"flex-end",gap:1,opacity:0,transition:"opacity 0.3s ease",".MuiCard-root:hover &":{opacity:1}},children:[e.jsx(F,{size:"small",onClick:()=>a(r),sx:{bgcolor:"rgba(255,255,255,0.9)"},children:e.jsx(Ce,{fontSize:"small",color:"primary"})}),e.jsx(F,{size:"small",onClick:()=>x(r),sx:{bgcolor:"rgba(255,255,255,0.9)"},children:r.status==="ACTIVE"?e.jsx(Ie,{fontSize:"small"}):e.jsx(Se,{fontSize:"small"})}),e.jsx(F,{size:"small",onClick:()=>k(r.id),sx:{bgcolor:"rgba(255,255,255,0.9)"},children:e.jsx(te,{fontSize:"small",color:"error"})})]})]}),e.jsxs(ve,{sx:{flexGrow:1,pt:2.5},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,fontWeight:"800",sx:{lineHeight:1.3},children:r.title}),r.description&&e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:1},children:r.description})]})]})})})},Ye=()=>{const[r,s]=o.useState([]),[a,x]=o.useState(!0),[k,D]=o.useState(!1),[j,S]=o.useState(null),[z,y]=o.useState(!1),[v,A]=o.useState(null),[R,c]=o.useState(null),[B,n]=o.useState(null),[p,m]=o.useState({title:"",description:"",imageUrl:""}),[E,w]=o.useState(null),[d,C]=o.useState(null),[P,G]=o.useState(!1),se=Ue(Q(Ee,{activationConstraint:{distance:8}}),Q(ze,{coordinateGetter:ke})),re=async t=>{const{active:l,over:I}=t;if(!I||l.id===I.id)return;const T=r.findIndex(u=>u.id===l.id),M=r.findIndex(u=>u.id===I.id);if(T===-1||M===-1)return;const $=Fe(r,T,M);$.map((u,pe)=>({id:u.id,displayOrder:pe})),s($);try{await b.reorderImages($.map(u=>u.id)),n("Order updated successfully"),setTimeout(()=>n(null),2e3)}catch(u){console.error(u),c("Failed to update order"),U()}};o.useEffect(()=>{U()},[]);const U=async()=>{try{x(!0);const t=await b.getAllImagesForAdmin();s(t)}catch(t){c("Failed to fetch images"),console.error(t)}finally{x(!1)}},V=t=>{t?(S(t),m({title:t.title,description:t.description||"",imageUrl:t.imageUrl}),C(t.imageUrl)):(S(null),m({title:"",description:"",imageUrl:""}),C(null)),w(null),D(!0)},W=()=>{D(!1),S(null),m({title:"",description:"",imageUrl:""}),w(null),d&&!d.startsWith("http")&&URL.revokeObjectURL(d),C(null)},ae=async()=>{try{c(null),j?(await b.updateImage(j.id,p),n("ছবি সফলভাবে আপডেট হয়েছে")):(await b.createImage(p),n("ছবি সফলভাবে যোগ করা হয়েছে")),W(),U(),setTimeout(()=>n(null),3e3)}catch(t){c("ছবি সেভ করতে ব্যর্থ হয়েছে"),console.error(t)}},oe=async t=>{try{c(null),await b.toggleStatus(t.id),n("Status updated successfully"),U(),setTimeout(()=>n(null),3e3)}catch(l){c("Failed to update status"),console.error(l)}},ie=t=>{A(t),y(!0)},ne=async()=>{if(v)try{c(null),await b.deleteImage(v),n("Image deleted successfully"),U(),setTimeout(()=>n(null),3e3)}catch(t){c("Failed to delete image"),console.error(t)}y(!1),A(null)},le=t=>{var I;const l=(I=t.target.files)==null?void 0:I[0];if(l){w(l),d&&!d.startsWith("http")&&URL.revokeObjectURL(d);const T=URL.createObjectURL(l);C(T)}},ce=async()=>{if(E)try{G(!0),c(null);const t=await b.uploadImage(E);m(l=>({...l,imageUrl:t})),C(t),n("ছবি সফলভাবে আপলোড হয়েছে"),setTimeout(()=>n(null),3e3),w(null)}catch(t){c("ছবি আপলোড ব্যর্থ হয়েছে"),console.error(t)}finally{G(!1)}},de=()=>{w(null),d&&!d.startsWith("http")&&URL.revokeObjectURL(d),C(null),m(t=>({...t,imageUrl:""}))};return a?e.jsx(ee,{children:e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(N,{thickness:5,size:60,sx:{color:"#3FA564"}})})}):e.jsx(ee,{children:e.jsxs(i,{sx:{p:{xs:2,md:4},maxWidth:"1600px",mx:"auto"},children:[e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",mb:4,flexWrap:"wrap",gap:2,children:[e.jsxs(i,{children:[e.jsx(g,{variant:"h3",fontWeight:"800",sx:{color:"#1a3321",letterSpacing:"-0.5px"},children:"গ্যালারি সেটিংস"}),e.jsx(g,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"ইউজার অ্যাপে দেখানোর জন্য ছবি আপলোড করুন"})]}),e.jsx(ge,{in:!0,children:e.jsx(f,{variant:"contained",size:"large",startIcon:e.jsx(he,{}),onClick:()=>V(),sx:{borderRadius:"16px",px:4,py:1.5,textTransform:"none",fontSize:"1.1rem",fontWeight:"600",bgcolor:"#3FA564",boxShadow:"0 8px 20px -4px rgba(63, 165, 100, 0.4)","&:hover":{bgcolor:"#2D7A4A",transform:"translateY(-2px)",boxShadow:"0 12px 25px -5px rgba(63, 165, 100, 0.5)"},transition:"all 0.3s ease"},children:"নতুন ছবি যোগ করুন"})})]}),R&&e.jsx(H,{severity:"error",sx:{mb:3,borderRadius:"12px"},onClose:()=>c(null),children:R}),B&&e.jsx(H,{severity:"success",sx:{mb:3,borderRadius:"12px"},onClose:()=>n(null),children:B}),e.jsx(De,{sensors:se,collisionDetection:Ae,onDragEnd:re,children:e.jsx(Re,{items:r.map(t=>t.id),strategy:Te,children:e.jsxs(L,{container:!0,spacing:4,children:[r.map((t,l)=>e.jsx(Be,{image:t,index:l,onEdit:V,onToggleStatus:oe,onDelete:ie},t.id)),r.length===0&&e.jsx(L,{size:{xs:12},children:e.jsxs(i,{textAlign:"center",py:8,children:[e.jsx(K,{sx:{fontSize:80,color:h("#000",.1),mb:2}}),e.jsx(g,{variant:"h6",color:"text.secondary",children:"কোনো ছবি নেই"}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"নতুন ছবি যোগ করতে উপরের বাটনে ক্লিক করুন"})]})})]})})}),e.jsxs(q,{open:k,onClose:W,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"24px",p:1}},children:[e.jsx(Y,{sx:{fontWeight:"800",fontSize:"1.5rem"},children:j?"ছবি সম্পাদনা করুন":"নতুন ছবি যোগ করুন"}),e.jsx(_,{children:e.jsxs(i,{sx:{pt:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsx(Z,{label:"শিরোনাম",fullWidth:!0,variant:"filled",value:p.title,onChange:t=>m({...p,title:t.target.value}),required:!0,InputProps:{sx:{borderRadius:"12px"}}}),e.jsx(Z,{label:"বিবরণ (ঐচ্ছিক)",fullWidth:!0,multiline:!0,rows:3,variant:"filled",value:p.description,onChange:t=>m({...p,description:t.target.value}),InputProps:{sx:{borderRadius:"12px"}}}),e.jsxs(i,{children:[e.jsx(g,{variant:"subtitle2",fontWeight:"700",gutterBottom:!0,children:"ছবি আপলোড"}),e.jsxs(i,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs(f,{variant:"outlined",component:"label",startIcon:e.jsx(K,{}),disabled:P,sx:{borderRadius:"12px",textTransform:"none"},children:["ছবি নির্বাচন",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:le})]}),E&&e.jsx(f,{variant:"contained",onClick:ce,disabled:P,sx:{borderRadius:"12px",bgcolor:"#3FA564","&:hover":{bgcolor:"#2D7A4A"}},children:P?e.jsx(N,{size:20,color:"inherit"}):"আপলোড"})]}),(d||p.imageUrl)&&e.jsxs(i,{sx:{mt:2,position:"relative",borderRadius:"16px",overflow:"hidden"},children:[e.jsx("img",{src:d||p.imageUrl,alt:"Preview",style:{width:"100%",maxHeight:"250px",objectFit:"cover"}}),e.jsx(F,{size:"small",onClick:de,sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(255,255,255,0.8)"},children:e.jsx(te,{color:"error"})})]})]})]})}),e.jsxs(J,{sx:{p:3},children:[e.jsx(f,{onClick:W,sx:{borderRadius:"12px"},children:"বাতিল"}),e.jsx(f,{onClick:ae,variant:"contained",disabled:!p.title||!p.imageUrl,sx:{borderRadius:"12px",bgcolor:"#3FA564","&:hover":{bgcolor:"#2D7A4A"}},children:j?"আপডেট করুন":"যোগ করুন"})]})]}),e.jsxs(q,{open:z,onClose:()=>y(!1),children:[e.jsx(Y,{children:"ছবি মুছে ফেলবেন?"}),e.jsx(_,{children:e.jsx(g,{children:"আপনি কি নিশ্চিত যে এই ছবিটি মুছে ফেলতে চান?"})}),e.jsxs(J,{children:[e.jsx(f,{onClick:()=>y(!1),children:"বাতিল"}),e.jsx(f,{onClick:ne,color:"error",variant:"contained",children:"মুছে ফেলুন"})]})]})]})})};export{Ye as default};
