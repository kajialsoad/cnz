var B=Object.defineProperty;var F=(r,n,i)=>n in r?B(r,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[n]=i;var j=(r,n,i)=>F(r,typeof n!="symbol"?n+"":n,i);import{j as e,B as s,T as O,aJ as _,p as D,_ as v,av as S,$ as A,a1 as d,b as k,bM as Y,G as y}from"./mui-vendor-DhgYLev2.js";import{r as c}from"./react-vendor-D7yrL1sD.js";import{u as H,Z as K,d as Q,e as X,w as R}from"./index-pueUXdzt.js";const re=({filters:r,onFilterChange:n,statistics:i,showStatusFilter:u=!0,statusOptions:N})=>{const{user:t}=H(),[h,z]=c.useState([]),[T,E]=c.useState(!1),[L,b]=c.useState([]),[M,w]=c.useState(!1),[W,P]=c.useState([]);c.useEffect(()=>{t&&(async()=>{var a;try{E(!0);let l=(await Q.getCityCorporations("ACTIVE")).cityCorporations||[];if(t&&t.role!=="MASTER_ADMIN"){const f=t.cityCorporationCode||((a=t.cityCorporation)==null?void 0:a.code);f&&(l=l.filter(p=>p.code===f),r.cityCorporationCode||n({cityCorporationCode:f}))}if(z(l),(t==null?void 0:t.role)==="SUPER_ADMIN"&&t.id)try{const p=(await X.getAssignedZones(Number(t.id))).map(m=>{const C=m.zone||m;return!C||!C.id?null:{id:C.id,zoneNumber:C.zoneNumber,name:C.name,cityCorporationId:C.cityCorporationId||0,status:"ACTIVE",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}).filter(m=>m!==null);P(p),p.length===1&&!r.zone&&n({zone:p[0].id.toString()})}catch(f){console.error("Error fetching assigned zones:",f)}}catch(g){console.error("Error fetching city corporations:",g),z([])}finally{E(!1)}})()},[t]),c.useEffect(()=>{(async()=>{if(r.zone)try{w(!0);const a=await R.getWardsByZone(Number(r.zone),"ACTIVE");b(a)}catch(a){console.error("Error fetching wards:",a),b([])}finally{w(!1)}else b([])})()},[r.zone]),c.useEffect(()=>{if((t==null?void 0:t.role)==="ADMIN"){let o=[];if(t.permissions)try{const a=JSON.parse(t.permissions);a.wards&&Array.isArray(a.wards)&&(o=a.wards)}catch(a){console.error("Error parsing admin permissions:",a)}o.length>0&&(async()=>{var g;try{w(!0);const l=t.cityCorporationCode||((g=t.cityCorporation)==null?void 0:g.code);if(l){const p=(await R.getWards({cityCorporationCode:l,status:"ACTIVE"})).wards.filter(m=>o.includes(m.id));b(p)}}catch(l){console.error("Error fetching admin wards:",l)}finally{w(!1)}})()}},[t]);const G=o=>{n({cityCorporationCode:o==="ALL"?void 0:o,thanaId:void 0,zone:void 0,ward:void 0})},Z=o=>{n({ward:o==="ALL"?void 0:o})},q=o=>{n({zone:o===""?void 0:o.toString(),ward:void 0})},J=o=>{n({status:o==="ALL"?void 0:o})},V=()=>{n({unreadOnly:!r.unreadOnly})},$=()=>{var a;let o;(t==null?void 0:t.role)!=="MASTER_ADMIN"&&(o=t.cityCorporationCode||((a=t.cityCorporation)==null?void 0:a.code)),n({cityCorporationCode:o,ward:void 0,zone:void 0,status:void 0,unreadOnly:!1})};return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[e.jsxs(s,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(O,{variant:"h6",sx:{fontWeight:600,mb:1.5,display:"flex",alignItems:"center",gap:1},children:[e.jsx(_,{}),"Filters"]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(D,{label:`${i.totalChats} Total`,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}}),e.jsx(D,{label:`${i.unreadCount} Unread`,size:"small",sx:{backgroundColor:"#4CAF50",color:"white",fontWeight:500}})]})]}),e.jsxs(s,{sx:{flex:1,overflowY:"auto",p:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(v,{fullWidth:!0,size:"small",children:[e.jsx(S,{id:"city-filter-label",children:"City Corporation"}),e.jsxs(A,{labelId:"city-filter-label",label:"City Corporation",value:r.cityCorporationCode||"ALL",onChange:o=>G(o.target.value),disabled:T||(t==null?void 0:t.role)!=="MASTER_ADMIN"&&h.length<=1,sx:{backgroundColor:"background.default",fontSize:"0.875rem"},children:[(t==null?void 0:t.role)==="MASTER_ADMIN"&&e.jsx(d,{value:"ALL",children:"All City Corporations"}),h.map(o=>e.jsx(d,{value:o.code,children:typeof o.name=="object"?JSON.stringify(o.name):o.name},o.code))]})]}),(t==null?void 0:t.role)!=="ADMIN"&&e.jsxs(s,{children:[e.jsx(O,{variant:"caption",sx:{mb:.5,fontWeight:500,display:"block"},children:"Zone"}),e.jsx(K,{value:r.zone?Number(r.zone):"",onChange:q,cityCorporationCode:r.cityCorporationCode||"",disabled:!1,zones:W.length>0?W:void 0})]}),e.jsxs(v,{fullWidth:!0,size:"small",children:[e.jsx(S,{id:"ward-filter-label",children:"Ward"}),e.jsxs(A,{labelId:"ward-filter-label",label:"Ward",value:r.ward||"ALL",onChange:o=>Z(o.target.value),disabled:M||L.length===0,sx:{backgroundColor:"background.default",fontSize:"0.875rem"},children:[e.jsx(d,{value:"ALL",children:"All Wards"}),L.map(o=>e.jsxs(d,{value:o.id.toString(),children:["Ward ",typeof o.wardNumber=="object"?JSON.stringify(o.wardNumber):o.wardNumber]},o.id))]})]}),u&&e.jsxs(v,{fullWidth:!0,size:"small",children:[e.jsx(S,{id:"status-filter-label",children:"Status"}),e.jsxs(A,{labelId:"status-filter-label",label:"Status",value:r.status||"ALL",onChange:o=>J(o.target.value),sx:{backgroundColor:"background.default",fontSize:"0.875rem"},children:[e.jsx(d,{value:"ALL",children:"All Status"}),e.jsx(d,{value:"PENDING",children:"Pending"}),e.jsx(d,{value:"IN_PROGRESS",children:"In Progress"}),e.jsx(d,{value:"RESOLVED",children:"Solved"}),e.jsx(d,{value:"REJECTED",children:"Rejected"})]})]}),e.jsx(k,{fullWidth:!0,variant:r.unreadOnly?"contained":"outlined",size:"small",onClick:V,sx:{textTransform:"none",fontSize:"0.875rem",backgroundColor:r.unreadOnly?"#4CAF50":"transparent",borderColor:r.unreadOnly?"#4CAF50":"divider",color:r.unreadOnly?"white":"text.primary","&:hover":{backgroundColor:r.unreadOnly?"#45a049":"action.hover",borderColor:r.unreadOnly?"#45a049":"#4CAF50"}},children:r.unreadOnly?"âœ“ Unread Only":"Show Unread Only"}),e.jsx(k,{fullWidth:!0,variant:"text",size:"small",startIcon:e.jsx(Y,{}),onClick:$,sx:{textTransform:"none",fontSize:"0.875rem",color:"text.secondary","&:hover":{color:"error.main"}},children:"Clear All Filters"})]})]})},ne=({count:r=5})=>e.jsx(s,{sx:{p:2},children:Array.from({length:r}).map((n,i)=>e.jsx(s,{sx:{mb:2},children:e.jsxs(s,{sx:{display:"flex",gap:1.5,mb:1},children:[e.jsx(y,{variant:"circular",width:48,height:48}),e.jsxs(s,{sx:{flex:1},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(y,{variant:"text",width:"60%",height:20}),e.jsx(y,{variant:"text",width:"20%",height:16})]}),e.jsx(y,{variant:"text",width:"40%",height:16,sx:{mb:.5}}),e.jsx(y,{variant:"text",width:"80%",height:16})]})]})},i))}),x=class x{constructor(){j(this,"permissionGranted",!1);this.checkPermission()}static getInstance(){return x.instance||(x.instance=new x),x.instance}isSupported(){return"Notification"in window}checkPermission(){this.isSupported()&&(this.permissionGranted=Notification.permission==="granted")}async requestPermission(){if(!this.isSupported())return console.warn("Browser notifications are not supported"),!1;if(Notification.permission==="granted")return this.permissionGranted=!0,!0;if(Notification.permission==="denied")return console.warn("Notification permission was denied"),!1;try{const n=await Notification.requestPermission();return this.permissionGranted=n==="granted",this.permissionGranted}catch(n){return console.error("Error requesting notification permission:",n),!1}}showNotification(n,i){if(!this.isSupported()||!this.permissionGranted)return null;try{return new Notification(n,{...i,icon:i.icon||"/favicon.png",badge:i.badge||"/favicon.png",requireInteraction:i.requireInteraction??!1})}catch(u){return console.error("Error showing notification:",u),null}}showNewMessageNotification(n,i,u,N,t){const h=this.showNotification(`New message from ${n}`,{body:i,tag:`chat-${u}`,data:{complaintId:u,trackingNumber:N,type:"new-message"},requireInteraction:!1});return h&&t&&(h.onclick=()=>{window.focus(),t(),h.close()}),h}getPermissionStatus(){return this.isSupported()?Notification.permission:"denied"}hasPermission(){return this.permissionGranted}};j(x,"instance");let I=x;const ie=I.getInstance();export{re as C,ne as a,ie as b};
