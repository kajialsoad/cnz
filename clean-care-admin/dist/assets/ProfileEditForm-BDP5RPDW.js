import{cc as ee,r as n,cd as re,ce as A,l as ae,v as U,a1 as se,j as o,F as H,y as te,T as L,X as V,a8 as oe,A as ne,N as z,L as q,P as Q,bQ as ie,K as le,Z as de}from"./index-DskQCe3A.js";import{A as me}from"./AvatarUpload-D_ujr69h.js";import{S as ce}from"./Save-h7kKh1D0.js";import{S as K}from"./Snackbar-R_g9cqEG.js";import"./CloudUpload-mhJKxZ0s.js";const ue=r=>{const{updateProfile:S}=ee(),[M,N]=n.useState(!1),[l,v]=n.useState(null),[b,C]=n.useState({}),E=n.useCallback(async m=>{var t,w;N(!0),v(null),C({});try{if(!m||Object.keys(m).length===0)throw new Error("No data provided for update");const d=re(m);if(!d.isValid){C(d.errors);const B=Object.values(d.errors)[0];throw new Error(B)}const f={};m.firstName&&(f.firstName=A(m.firstName)),m.lastName&&(f.lastName=A(m.lastName)),m.avatar&&(f.avatar=m.avatar.trim()),m.ward&&(f.ward=A(m.ward)),m.zone&&(f.zone=A(m.zone)),m.address&&(f.address=A(m.address)),await S(f),(t=r==null?void 0:r.onSuccess)==null||t.call(r)}catch(d){const f=d instanceof Error?d.message:"Failed to update profile";throw v(f),(w=r==null?void 0:r.onError)==null||w.call(r,f),d}finally{N(!1)}},[S,r]),x=n.useCallback(()=>{v(null)},[]),e=n.useCallback(()=>{C({})},[]);return{updateProfile:E,isUpdating:M,updateError:l,validationErrors:b,clearUpdateError:x,clearValidationErrors:e}},ge=({initialData:r,onSave:S,onCancel:M})=>{const N=ae(),l=U(N.breakpoints.down("sm")),v=U(N.breakpoints.between("sm","md")),b=U("(orientation: landscape)"),{user:C}=se(),E=(C==null?void 0:C.role)==="MASTER_ADMIN",x=n.useCallback(a=>a?typeof a=="object"?a.name||(a.wardNumber?String(a.wardNumber):"")||(a.zoneNumber?String(a.zoneNumber):"")||(a.number?String(a.number):"")||"":String(a):"",[]),[e,m]=n.useState({firstName:r.firstName||"",lastName:r.lastName||"",avatar:r.avatar,ward:x(r.ward),zone:x(r.zone),address:r.address||"",email:r.email||"",phone:r.phone||""}),[t,w]=n.useState({}),[d,f]=n.useState(!1),[B,F]=n.useState(!1),[X,P]=n.useState(!1),[_,k]=n.useState(""),{isUpdating:u,updateError:O,clearUpdateError:T}=ue({onSuccess:()=>{F(!0)},onError:a=>{k(a),P(!0)}}),I=n.useRef(null),G=n.useMemo(()=>{var h,c,i,p;const a=((c=(h=e.firstName)==null?void 0:h.charAt(0))==null?void 0:c.toUpperCase())||"",s=((p=(i=e.lastName)==null?void 0:i.charAt(0))==null?void 0:p.toUpperCase())||"";return`${a}${s}`||"?"},[e.firstName,e.lastName]),g=n.useCallback((a,s)=>{switch(a){case"firstName":if(!s.trim())return"First name is required";if(s.trim().length<2)return"First name must be at least 2 characters";if(s.trim().length>50)return"First name must not exceed 50 characters";break;case"lastName":if(!s.trim())return"Last name is required";if(s.trim().length<2)return"Last name must be at least 2 characters";if(s.trim().length>50)return"Last name must not exceed 50 characters";break;case"email":if(!s.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return"Invalid email address";break;case"phone":if(!s.trim())return"Phone number is required";if(!/^\d{11}$/.test(s.replace(/\D/g,"")))return"Phone number must be 11 digits";break;case"ward":if(s&&s.trim().length>20)return"Ward must not exceed 20 characters";break;case"zone":if(s&&s.trim().length>20)return"Zone must not exceed 20 characters";break;case"address":if(s&&s.trim().length>200)return"Address must not exceed 200 characters";break}},[]),$=n.useCallback(()=>{const a={},s=g("firstName",e.firstName);s&&(a.firstName=s);const h=g("lastName",e.lastName);h&&(a.lastName=h);const c=g("email",e.email);c&&(a.email=c);const i=g("phone",e.phone);if(i&&(a.phone=i),e.ward){const p=g("ward",e.ward);p&&(a.ward=p)}if(e.zone){const p=g("zone",e.zone);p&&(a.zone=p)}if(e.address){const p=g("address",e.address);p&&(a.address=p)}return w(a),Object.keys(a).length===0},[e,g]),y=n.useCallback(a=>{const{name:s,value:h}=a.target;m(c=>({...c,[s]:h})),w(c=>{const i={...c};return delete i[s],i}),I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{const c=g(s,h);c&&w(i=>({...i,[s]:c}))},300)},[g]),j=n.useCallback(a=>{const{name:s,value:h}=a.target,c=g(s,h);c&&w(i=>({...i,[s]:c}))},[g]),J=n.useCallback(async a=>{m(s=>({...s,avatar:a}))},[]),W=n.useMemo(()=>e.firstName!==r.firstName||e.lastName!==r.lastName||e.avatar!==r.avatar||e.ward!==x(r.ward)||e.zone!==x(r.zone)||e.address!==(r.address||"")||e.email!==r.email||e.phone!==r.phone,[e,r,x]),Y=n.useCallback(async a=>{var s,h,c;if(a.preventDefault(),!$()){k("Please fix the validation errors"),P(!0);return}if(!W){k("No changes to save"),P(!0);return}f(!0),T();try{const i={};e.firstName!==r.firstName&&(i.firstName=e.firstName.trim()),e.lastName!==r.lastName&&(i.lastName=e.lastName.trim()),e.avatar!==r.avatar&&(i.avatar=e.avatar),e.ward!==x(r.ward)&&(i.ward=((s=e.ward)==null?void 0:s.trim())||void 0),e.zone!==x(r.zone)&&(i.zone=((h=e.zone)==null?void 0:h.trim())||void 0),e.address!==(r.address||"")&&(i.address=((c=e.address)==null?void 0:c.trim())||void 0),e.email!==r.email&&(i.email=e.email.trim()),e.phone!==r.phone&&(i.phone=e.phone.trim()),await S(i),F(!0)}catch(i){const p=i instanceof Error?i.message:"Failed to update profile";k(p),P(!0)}finally{f(!1)}},[e,r,$,W,S,T]),D=n.useCallback(()=>{m({firstName:r.firstName||"",lastName:r.lastName||"",avatar:r.avatar,ward:x(r.ward),zone:x(r.zone),address:r.address||"",email:r.email||"",phone:r.phone||""}),w({}),T(),M()},[r,M,T,x]),R=n.useCallback(()=>{F(!1)},[]),Z=n.useCallback(()=>{P(!1),k("")},[]);return n.useEffect(()=>()=>{I.current&&clearTimeout(I.current)},[]),o.jsxs(H,{component:"form",onSubmit:Y,role:"form","aria-label":"Profile edit form",sx:{animation:`${te} 0.3s ease-in-out`},children:[o.jsxs(H,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:l&&b?2:3,px:2,background:`linear-gradient(135deg, ${N.palette.primary.main}15 0%, ${N.palette.primary.main}05 100%)`},children:[o.jsx(me,{currentAvatar:e.avatar,onUpload:J,size:l?b?80:100:v?110:120,initials:G,disabled:d||u}),o.jsx(L,{variant:"caption",sx:{mt:l&&b?1:2,color:N.palette.text.secondary,textAlign:"center",px:2},children:l?"Tap to upload":"Click or drag to upload a new profile picture"})]}),o.jsx(V,{}),o.jsxs(H,{sx:{p:l?b?1.5:2:v?2.5:3},children:[o.jsxs(oe,{elevation:0,sx:{p:l?b?1.5:2:v?2.5:3,backgroundColor:N.palette.background.default,borderRadius:2,animation:`${ne} 0.4s ease-in-out`},children:[o.jsx(L,{variant:"subtitle2",sx:{fontWeight:600,mb:2,color:N.palette.text.primary},children:"Personal Information"}),o.jsx(z,{fullWidth:!0,label:"First Name",name:"firstName",value:e.firstName,onChange:y,onBlur:j,error:!!t.firstName,helperText:t.firstName,disabled:d||u,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:l?48:40}},slotProps:{input:{inputProps:{maxLength:50,"aria-label":"First name","aria-required":"true","aria-invalid":!!t.firstName,"aria-describedby":t.firstName?"firstName-error":void 0}},formHelperText:{id:"firstName-error",role:"alert"}}}),o.jsx(z,{fullWidth:!0,label:"Last Name",name:"lastName",value:e.lastName,onChange:y,onBlur:j,error:!!t.lastName,helperText:t.lastName,disabled:d||u,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:l?48:40}},slotProps:{input:{inputProps:{maxLength:50,"aria-label":"Last name","aria-required":"true","aria-invalid":!!t.lastName,"aria-describedby":t.lastName?"lastName-error":void 0}},formHelperText:{id:"lastName-error",role:"alert"}}}),o.jsx(z,{fullWidth:!0,label:"Email Address",name:"email",value:e.email,onChange:y,onBlur:j,error:!!t.email,helperText:t.email,disabled:d||u,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:l?48:40}},slotProps:{input:{inputProps:{"aria-label":"Email address","aria-invalid":!!t.email,"aria-describedby":t.email?"email-error":void 0}},formHelperText:{id:"email-error",role:"alert"}}}),o.jsx(z,{fullWidth:!0,label:"Phone Number",name:"phone",value:e.phone,onChange:y,onBlur:j,error:!!t.phone,helperText:t.phone,disabled:d||u,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:l?48:40}},slotProps:{input:{inputProps:{"aria-label":"Phone number","aria-invalid":!!t.phone,"aria-describedby":t.phone?"phone-error":void 0}},formHelperText:{id:"phone-error",role:"alert"}}}),o.jsx(V,{sx:{my:2}}),o.jsx(L,{variant:"subtitle2",sx:{fontWeight:600,mb:2,color:N.palette.text.primary},children:"Location Information (Optional)"}),o.jsx(z,{fullWidth:!0,label:"Ward",name:"ward",value:e.ward,onChange:y,onBlur:j,error:!!t.ward,helperText:t.ward||(E?void 0:"Only Master Admin can edit Ward"),disabled:d||u||!E,sx:{mb:2,"& .MuiInputBase-root":{minHeight:l?48:40}},slotProps:{input:{inputProps:{maxLength:20,"aria-label":"Ward (optional)","aria-invalid":!!t.ward,"aria-describedby":t.ward?"ward-error":void 0}},formHelperText:{id:"ward-error",role:"alert"}}}),o.jsx(z,{fullWidth:!0,label:"Zone",name:"zone",value:e.zone,onChange:y,onBlur:j,error:!!t.zone,helperText:t.zone||(E?void 0:"Only Master Admin can edit Zone"),disabled:d||u||!E,sx:{mb:2,"& .MuiInputBase-root":{minHeight:l?48:40}},slotProps:{input:{inputProps:{maxLength:20,"aria-label":"Zone (optional)","aria-invalid":!!t.zone,"aria-describedby":t.zone?"zone-error":void 0}},formHelperText:{id:"zone-error",role:"alert"}}}),o.jsx(z,{fullWidth:!0,label:"Address",name:"address",value:e.address,onChange:y,onBlur:j,error:!!t.address,helperText:t.address,disabled:d||u,multiline:!0,rows:l&&b?2:3,slotProps:{input:{inputProps:{maxLength:200,"aria-label":"Address (optional)","aria-invalid":!!t.address,"aria-describedby":t.address?"address-error":void 0}},formHelperText:{id:"address-error",role:"alert"}}})]}),O&&o.jsx(q,{severity:"error",sx:{mt:2},onClose:T,children:O}),o.jsxs(H,{sx:{display:"flex",gap:2,mt:l&&b?2:3,flexDirection:l||v&&!b?"column":"row",justifyContent:"flex-end"},children:[o.jsx(Q,{variant:"outlined",startIcon:o.jsx(ie,{}),onClick:D,disabled:d||u,fullWidth:l||v&&!b,"aria-label":"Cancel profile editing",sx:{borderRadius:2,textTransform:"none",fontWeight:600,minWidth:l?"auto":120,minHeight:l?44:36},children:"Cancel"}),o.jsx(Q,{type:"submit",variant:"contained",startIcon:d||u?o.jsx(le,{size:16,color:"inherit"}):o.jsx(ce,{}),disabled:d||u||!W,fullWidth:l||v&&!b,"aria-label":d||u?"Saving profile changes":"Save profile changes","aria-busy":d||u,"aria-disabled":!W,sx:{borderRadius:2,textTransform:"none",fontWeight:600,minWidth:l?"auto":120,minHeight:l?44:36},children:d||u?"Saving...":"Save Changes"})]})]}),o.jsx(K,{open:B,autoHideDuration:4e3,onClose:R,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:o.jsx(q,{onClose:R,severity:"success",icon:o.jsx(de,{}),sx:{width:"100%"},children:"Profile updated successfully!"})}),o.jsx(K,{open:X,autoHideDuration:6e3,onClose:Z,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:o.jsx(q,{onClose:Z,severity:"error",sx:{width:"100%"},children:_||"Failed to update profile"})})]})};export{ge as default};
