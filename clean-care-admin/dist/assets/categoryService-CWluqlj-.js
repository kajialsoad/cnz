var R=Object.defineProperty;var O=(n,t,e)=>t in n?R(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var v=(n,t,e)=>O(n,typeof t!="symbol"?t+"":t,e);import{a as S,g as b,r as u,u as x,j as h,s as L,c as D,d as M,b8 as j,e as E,R as g,S as m}from"./index-obvkHq0E.js";function T(n){return S("MuiImageList",n)}b("MuiImageList",["root","masonry","quilted","standard","woven"]);const $=u.createContext({}),B=n=>{const{classes:t,variant:e}=n;return M({root:["root",e]},T,t)},_=L("ul",{name:"MuiImageList",slot:"Root",overridesResolver:(n,t)=>{const{ownerState:e}=n;return[t.root,t[e.variant]]}})({display:"grid",overflowY:"auto",listStyle:"none",padding:0,WebkitOverflowScrolling:"touch",variants:[{props:{variant:"masonry"},style:{display:"block"}}]}),W=u.forwardRef(function(t,e){const a=x({props:t,name:"MuiImageList"}),{children:s,className:r,cols:o=2,component:i="ul",rowHeight:c="auto",gap:p=4,style:U,variant:l="standard",...w}=a,d=u.useMemo(()=>({rowHeight:c,gap:p,variant:l}),[c,p,l]),f=l==="masonry"?{columnCount:o,columnGap:p,...U}:{gridTemplateColumns:`repeat(${o}, 1fr)`,gap:p,...U},I={...a,component:i,gap:p,rowHeight:c,variant:l},y=B(I);return h.jsx(_,{as:i,className:D(y.root,y[l],r),ref:e,style:f,ownerState:I,...w,children:h.jsx($.Provider,{value:d,children:s})})});function k(n){return S("MuiImageListItem",n)}const A=b("MuiImageListItem",["root","img","standard","woven","masonry","quilted"]),z=n=>{const{classes:t,variant:e}=n;return M({root:["root",e],img:["img"]},k,t)},N=L("li",{name:"MuiImageListItem",slot:"Root",overridesResolver:(n,t)=>{const{ownerState:e}=n;return[{[`& .${A.img}`]:t.img},t.root,t[e.variant]]}})({display:"block",position:"relative",[`& .${A.img}`]:{objectFit:"cover",width:"100%",height:"100%",display:"block"},variants:[{props:{variant:"standard"},style:{display:"flex",flexDirection:"column"}},{props:{variant:"woven"},style:{height:"100%",alignSelf:"center","&:nth-of-type(even)":{height:"70%"}}},{props:{variant:"standard"},style:{[`& .${A.img}`]:{height:"auto",flexGrow:1}}}]}),V=u.forwardRef(function(t,e){const a=x({props:t,name:"MuiImageListItem"}),{children:s,className:r,cols:o=1,component:i="li",rows:c=1,style:p,...U}=a,{rowHeight:l="auto",gap:w,variant:d}=u.useContext($);let f="auto";d==="woven"?f=void 0:l!=="auto"&&(f=l*c+w*(c-1));const I={...a,cols:o,component:i,gap:w,rowHeight:l,rows:c,variant:d},y=z(I);return h.jsx(N,{as:i,className:D(y.root,y[d],r),ref:e,style:{height:f,gridColumnEnd:d!=="masonry"?`span ${o}`:void 0,gridRowEnd:d!=="masonry"?`span ${c}`:void 0,marginBottom:d==="masonry"?w:void 0,breakInside:d==="masonry"?"avoid":void 0,...p},ownerState:I,...U,children:u.Children.map(s,C=>u.isValidElement(C)?C.type==="img"||j(C,["Image"])?u.cloneElement(C,{className:D(y.img,C.props.className)}):C:null)})}),q=E([h.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),h.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")]),G=E(h.jsx("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"})),J=E(h.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"})),Z=E([h.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),h.jsx("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")]);class H{constructor(){v(this,"apiClient");this.apiClient=g.create({baseURL:m.BASE_URL,timeout:m.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const e=localStorage.getItem("accessToken");e&&(t.headers.Authorization=`Bearer ${e}`)}catch(e){console.error("Error getting token:",e)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var e;return((e=t.response)==null?void 0:e.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(this.handleError(t))})}handleError(t){var e,a,s,r,o;if(g.isAxiosError(t)){const i=((e=t.response)==null?void 0:e.status)||500,c=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"An error occurred",p=(o=(r=t.response)==null?void 0:r.data)==null?void 0:o.errors;return{name:"ApiError",statusCode:i,message:c,errors:p}}return{name:"ApiError",statusCode:500,message:t.message||"An unexpected error occurred"}}isCloudinaryUrl(t){return!!t&&t.includes("res.cloudinary.com")&&t.includes("/upload/")}fixLocalMediaUrl(t){if(!t||this.isCloudinaryUrl(t)||t.startsWith(m.BASE_URL))return t;const e=/^https?:\/\/[^\/]+/;return e.test(t)?t.replace(e,m.BASE_URL):t.startsWith("/")?`${m.BASE_URL}${t}`:`${m.BASE_URL}/${t}`}getCloudinaryThumbnail(t,e=200,a=200){return t&&(this.isCloudinaryUrl(t)?t.replace("/upload/",`/upload/w_${e},h_${a},c_fill,q_auto,f_auto/`):t)}getOptimizedCloudinaryUrl(t){return t&&(this.isCloudinaryUrl(t)?t.replace("/upload/","/upload/q_auto,f_auto/"):t)}parseMediaUrls(t){let e=[],a=[];try{if(t.imageUrl){let s;const r=t.imageUrl;if(typeof r=="string"&&r.trim().startsWith("["))try{s=JSON.parse(r)}catch{s=[r]}else Array.isArray(r)?s=r:s=[r];Array.isArray(s)&&(e=s.map(o=>this.fixLocalMediaUrl(o)))}}catch(s){console.error("Error processing imageUrl:",s)}try{if(t.audioUrl){let s;const r=t.audioUrl;if(typeof r=="string"&&r.trim().startsWith("["))try{s=JSON.parse(r)}catch{s=[r]}else Array.isArray(r)?s=r:s=[r];Array.isArray(s)&&(a=s.map(o=>this.fixLocalMediaUrl(o)))}}catch(s){console.error("Error processing audioUrl:",s)}return{...t,imageUrls:e,audioUrls:a}}async getComplaints(t=1,e=20,a){try{const s={page:t,limit:e};a&&(a.search&&(s.search=a.search),a.status&&a.status!=="ALL"&&(s.status=a.status),a.category==="uncategorized"?s.category="null":a.category&&(s.category=a.category),a.subcategory&&(s.subcategory=a.subcategory),a.cityCorporationCode&&(s.cityCorporationCode=a.cityCorporationCode),a.ward&&(s.ward=a.ward),a.thanaId&&(s.thanaId=a.thanaId),a.startDate&&(s.startDate=a.startDate),a.endDate&&(s.endDate=a.endDate),a.sortBy&&(s.sortBy=a.sortBy),a.sortOrder&&(s.sortOrder=a.sortOrder));const r=await this.apiClient.get("/api/admin/complaints",{params:s});if(!r.data||!r.data.data)throw console.error("Invalid response structure:",r.data),new Error("Invalid response structure from server");const o=r.data.data;if(!Array.isArray(o.complaints))throw console.error("Complaints is not an array:",o),new Error("Invalid complaints data from server");const i=o.complaints.map(c=>this.parseMediaUrls(c));return{...o,complaints:i}}catch(s){throw console.error("Error in getComplaints:",s),s}}async getComplaintById(t){try{const e=await this.apiClient.get(`/api/admin/complaints/${t}`);return this.parseMediaUrls(e.data.data.complaint)}catch(e){throw e}}async updateComplaintStatus(t,e){try{const a=await this.apiClient.patch(`/api/admin/complaints/${t}/status`,e);return this.parseMediaUrls(a.data.data.complaint)}catch(a){throw a}}async markComplaintAsOthers(t,e){try{const a=await this.apiClient.patch(`/api/admin/complaints/${t}/mark-others`,e);return this.parseMediaUrls(a.data.data.complaint)}catch(a){throw a}}async updateComplaintStatusWithResolution(t,e,a,s){try{const r=new FormData;r.append("status",e),a&&r.append("resolutionNote",a),s&&s.length>0&&s.forEach(c=>{r.append("resolutionImages",c)});const o=await this.apiClient.patch(`/api/admin/complaints/${t}/status`,r,{headers:{"Content-Type":"multipart/form-data"}});return this.parseMediaUrls(o.data.data.complaint)}catch(r){throw r}}async searchComplaints(t,e=1,a=20){try{return await this.getComplaints(e,a,{search:t})}catch(s){throw s}}async getComplaintsByUser(t,e=1,a=20){try{const s=await this.apiClient.get(`/api/admin/users/${t}/complaints`,{params:{page:e,limit:a}}),r=s.data.data.complaints.map(o=>this.parseMediaUrls(o));return{...s.data.data,complaints:r}}catch(s){throw s}}getThumbnailUrl(t,e=200,a=200){return this.getCloudinaryThumbnail(t,e,a)}getOptimizedUrl(t){return this.getOptimizedCloudinaryUrl(t)}async uploadImage(t){try{const e=new FormData;e.append("images",t);const a=await this.apiClient.post("/api/uploads",e,{headers:{"Content-Type":"multipart/form-data"}});if(a.data.success&&a.data.data.fileUrls.length>0)return a.data.data.fileUrls[0];throw new Error("Failed to upload image")}catch(e){throw console.error("Error uploading image:",e),e}}async getOthersAnalytics(t={}){try{const e={};return t.cityCorporationCode&&(e.cityCorporationCode=t.cityCorporationCode),t.zoneId!==void 0&&(e.zoneId=t.zoneId),t.startDate&&(e.startDate=t.startDate),t.endDate&&(e.endDate=t.endDate),(await this.apiClient.get("/api/admin/complaints/analytics/others",{params:e})).data.data}catch(e){throw console.error("Error fetching Others analytics:",e),e}}}const Y=new H;class F{constructor(){v(this,"apiClient");v(this,"cache");v(this,"CACHE_DURATION",30*60*1e3);this.apiClient=g.create({baseURL:m.BASE_URL,timeout:m.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.cache=new Map,this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const e=localStorage.getItem("accessToken");e&&(t.headers.Authorization=`Bearer ${e}`)}catch(e){console.error("Error getting token:",e)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var e;return((e=t.response)==null?void 0:e.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(t)})}getCacheKey(t,e){const a=e?JSON.stringify(e):"";return`${t}:${a}`}getCachedData(t){const e=this.cache.get(t);if(e){if(Date.now()-e.timestamp<this.CACHE_DURATION)return e.data;this.cache.delete(t)}return null}setCachedData(t,e){this.cache.set(t,{data:e,timestamp:Date.now()})}clearCache(){this.cache.clear()}async getAllCategories(){var t,e;try{const a=this.getCacheKey("categories"),s=this.getCachedData(a);if(s)return s;const o=(await this.apiClient.get("/api/categories")).data.data.categories;return this.setCachedData(a,o),o}catch(a){throw g.isAxiosError(a)?new Error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch categories"):a}}async getCategoryById(t){var e,a;try{const s=this.getCacheKey(`category-${t}`),r=this.getCachedData(s);if(r)return r;const i=(await this.apiClient.get(`/api/categories/${t}`)).data.data.category;return this.setCachedData(s,i),i}catch(s){throw g.isAxiosError(s)?new Error(((a=(e=s.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to fetch category"):s}}async getSubcategories(t){var e,a;try{const s=this.getCacheKey(`subcategories-${t}`),r=this.getCachedData(s);if(r)return r;const i=(await this.apiClient.get(`/api/categories/${t}/subcategories`)).data.data.subcategories;return this.setCachedData(s,i),i}catch(s){throw g.isAxiosError(s)?new Error(((a=(e=s.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to fetch subcategories"):s}}async getCategoryStatistics(t){var e,a;try{const s=this.getCacheKey("category-statistics",t),r=this.cache.get(s);if(r&&Date.now()-r.timestamp<5*60*1e3)return r.data;const i=(await this.apiClient.get("/api/admin/analytics/categories",{params:t})).data.data;return this.setCachedData(s,i),i}catch(s){throw g.isAxiosError(s)?new Error(((a=(e=s.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to fetch category statistics"):s}}async getCategoryTrends(t){var e,a;try{const s=this.getCacheKey("category-trends",t),r=this.cache.get(s);if(r&&Date.now()-r.timestamp<5*60*1e3)return r.data;const i=(await this.apiClient.get("/api/admin/analytics/categories/trends",{params:t})).data.data;return this.setCachedData(s,i),i}catch(s){throw g.isAxiosError(s)?new Error(((a=(e=s.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to fetch category trends"):s}}async getCategoryName(t,e="en"){const s=(await this.getAllCategories()).find(r=>r.id===t);return s?e==="bn"?s.bangla:s.english:"Unknown Category"}async getSubcategoryName(t,e,a="en"){const r=(await this.getCategoryById(t)).subcategories.find(o=>o.id===e);return r?a==="bn"?r.bangla:r.english:"Unknown Subcategory"}async getCategoryColor(t){const a=(await this.getAllCategories()).find(s=>s.id===t);return(a==null?void 0:a.color)||"#808080"}async categoryExists(t){try{return await this.getCategoryById(t),!0}catch{return!1}}async subcategoryExists(t,e){try{return(await this.getSubcategories(t)).some(s=>s.id===e)}catch{return!1}}}const Q=new F;export{q as A,G as H,J as I,Z,Y as a,W as b,Q as c,V as d};
