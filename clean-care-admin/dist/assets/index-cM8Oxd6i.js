var Jt=Object.defineProperty;var Zt=(o,t,r)=>t in o?Jt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r;var ht=(o,t,r)=>Zt(o,typeof t!="symbol"?t+"":t,r);import{g as Ct,a as St,r as n,u as yt,c as ce,j as e,s as xe,b as Ut,d as jt,B as _t,m as vt,e as Ee,f as qt,h as Vt,o as Xt,i as Gt,k as Ge,l as wt,n as pt,p as je,q as Qt,t as es,v as Kt,w as ve,x as ze,D as ts,y as At,z as ie,A as ss,C as os,E as rs,F as y,G as ns,T as S,I as ft,H as Tt,J as as,K as ke,L as ls,M as is,N as bt,O as Ne,P as fe,Q as we,R as Ke,S as Ye,U as Oe,V as Be,W as F,X as xt,Y as cs,Z as ds,_ as us,$ as hs,a0 as ps,a1 as Rt,a2 as Lt,a3 as fs,a4 as xs,a5 as Mt,a6 as gs,a7 as Pt,a8 as ms,a9 as bs,aa as Cs,ab as Ss,ac as ys,ad as gt,ae as V,af as js,ag as zt}from"./index-obvkHq0E.js";import{s as Ve,a as kt,b as vs}from"./toastUtils-D_6nG-GK.js";import{E as Ot,a as Bt,u as ws,C as Es,b as Is}from"./useDebounce-Y5BCcOMW.js";import{P as As}from"./Person-B5nnbIPf.js";import{I as Ts,c as Yt,H as Rs,a as Nt}from"./categoryService-CWluqlj-.js";import{S as Ls}from"./Send-ClfKfqo9.js";import"./userManagementService-nJqXhO3I.js";import{w as Ms}from"./wardService-DFaBk42Z.js";import{F as Ps}from"./FilterList-DeTw_LFN.js";import{C as zs}from"./Collapse-CfaxOBj8.js";import{G as ae}from"./Grid-DM8D4Ubi.js";import{D as ks}from"./Download-D581y-XL.js";import{P as Os}from"./Pagination-DEyf4Sc3.js";import"./styled-CPgIAkea.js";import"./useThemeProps-DyvIigua.js";function Bs(o){return St("MuiTab",o)}const Q=Ct("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper","icon"]),Ns=o=>{const{classes:t,textColor:r,fullWidth:u,wrapped:d,icon:h,label:p,selected:g,disabled:m}=o,j={root:["root",h&&p&&"labelIcon",`textColor${Ut(r)}`,u&&"fullWidth",d&&"wrapped",g&&"selected",m&&"disabled"],icon:["iconWrapper","icon"]};return jt(j,Bs,t)},Ds=xe(_t,{name:"MuiTab",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.root,r.label&&r.icon&&t.labelIcon,t[`textColor${Ut(r.textColor)}`],r.fullWidth&&t.fullWidth,r.wrapped&&t.wrapped,{[`& .${Q.iconWrapper}`]:t.iconWrapper},{[`& .${Q.icon}`]:t.icon}]}})(vt(({theme:o})=>({...o.typography.button,maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center",lineHeight:1.25,variants:[{props:({ownerState:t})=>t.label&&(t.iconPosition==="top"||t.iconPosition==="bottom"),style:{flexDirection:"column"}},{props:({ownerState:t})=>t.label&&t.iconPosition!=="top"&&t.iconPosition!=="bottom",style:{flexDirection:"row"}},{props:({ownerState:t})=>t.icon&&t.label,style:{minHeight:72,paddingTop:9,paddingBottom:9}},{props:({ownerState:t,iconPosition:r})=>t.icon&&t.label&&r==="top",style:{[`& > .${Q.icon}`]:{marginBottom:6}}},{props:({ownerState:t,iconPosition:r})=>t.icon&&t.label&&r==="bottom",style:{[`& > .${Q.icon}`]:{marginTop:6}}},{props:({ownerState:t,iconPosition:r})=>t.icon&&t.label&&r==="start",style:{[`& > .${Q.icon}`]:{marginRight:o.spacing(1)}}},{props:({ownerState:t,iconPosition:r})=>t.icon&&t.label&&r==="end",style:{[`& > .${Q.icon}`]:{marginLeft:o.spacing(1)}}},{props:{textColor:"inherit"},style:{color:"inherit",opacity:.6,[`&.${Q.selected}`]:{opacity:1},[`&.${Q.disabled}`]:{opacity:(o.vars||o).palette.action.disabledOpacity}}},{props:{textColor:"primary"},style:{color:(o.vars||o).palette.text.secondary,[`&.${Q.selected}`]:{color:(o.vars||o).palette.primary.main},[`&.${Q.disabled}`]:{color:(o.vars||o).palette.text.disabled}}},{props:{textColor:"secondary"},style:{color:(o.vars||o).palette.text.secondary,[`&.${Q.selected}`]:{color:(o.vars||o).palette.secondary.main},[`&.${Q.disabled}`]:{color:(o.vars||o).palette.text.disabled}}},{props:({ownerState:t})=>t.fullWidth,style:{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"}},{props:({ownerState:t})=>t.wrapped,style:{fontSize:o.typography.pxToRem(12)}}]}))),Pe=n.forwardRef(function(t,r){const u=yt({props:t,name:"MuiTab"}),{className:d,disabled:h=!1,disableFocusRipple:p=!1,fullWidth:g,icon:m,iconPosition:j="top",indicator:v,label:E,onChange:l,onClick:A,onFocus:I,selected:T,selectionFollowsFocus:k,textColor:O="inherit",value:_,wrapped:M=!1,...B}=u,W={...u,disabled:h,disableFocusRipple:p,selected:T,icon:!!m,iconPosition:j,label:!!E,fullWidth:g,textColor:O,wrapped:M},J=Ns(W),R=m&&E&&n.isValidElement(m)?n.cloneElement(m,{className:ce(J.icon,m.props.className)}):m,re=$=>{!T&&l&&l($,_),A&&A($)},Z=$=>{k&&!T&&l&&l($,_),I&&I($)};return e.jsxs(Ds,{focusRipple:!p,className:ce(J.root,d),ref:r,role:"tab","aria-selected":T,disabled:h,onClick:re,onFocus:Z,ownerState:W,tabIndex:T?0:-1,...B,children:[j==="top"||j==="start"?e.jsxs(n.Fragment,{children:[R,E]}):e.jsxs(n.Fragment,{children:[E,R]}),v]})}),Fs=Ee(e.jsx("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})),Ws=Ee(e.jsx("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}));function $s(o){return(1+Math.sin(Math.PI*o-Math.PI/2))/2}function Hs(o,t,r,u={},d=()=>{}){const{ease:h=$s,duration:p=300}=u;let g=null;const m=t[o];let j=!1;const v=()=>{j=!0},E=l=>{if(j){d(new Error("Animation cancelled"));return}g===null&&(g=l);const A=Math.min(1,(l-g)/p);if(t[o]=h(A)*(r-m)+m,A>=1){requestAnimationFrame(()=>{d(null)});return}requestAnimationFrame(E)};return m===r?(d(new Error("Element already at target position")),v):(requestAnimationFrame(E),v)}const Us={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};function _s(o){const{onChange:t,...r}=o,u=n.useRef(),d=n.useRef(null),h=()=>{u.current=d.current.offsetHeight-d.current.clientHeight};return qt(()=>{const p=Vt(()=>{const m=u.current;h(),m!==u.current&&t(u.current)}),g=Xt(d.current);return g.addEventListener("resize",p),()=>{p.clear(),g.removeEventListener("resize",p)}},[t]),n.useEffect(()=>{h(),t(u.current)},[t]),e.jsx("div",{style:Us,...r,ref:d})}function Vs(o){return St("MuiTabScrollButton",o)}const Xs=Ct("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),Gs=o=>{const{classes:t,orientation:r,disabled:u}=o;return jt({root:["root",r,u&&"disabled"]},Vs,t)},Ks=xe(_t,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.root,r.orientation&&t[r.orientation]]}})({width:40,flexShrink:0,opacity:.8,[`&.${Xs.disabled}`]:{opacity:0},variants:[{props:{orientation:"vertical"},style:{width:"100%",height:40,"& svg":{transform:"var(--TabScrollButton-svgRotate)"}}}]}),Ys=n.forwardRef(function(t,r){const u=yt({props:t,name:"MuiTabScrollButton"}),{className:d,slots:h={},slotProps:p={},direction:g,orientation:m,disabled:j,...v}=u,E=Gt(),l={isRtl:E,...u},A=Gs(l),I=h.StartScrollButtonIcon??Fs,T=h.EndScrollButtonIcon??Ws,k=Ge({elementType:I,externalSlotProps:p.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:l}),O=Ge({elementType:T,externalSlotProps:p.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:l});return e.jsx(Ks,{component:"div",className:ce(A.root,d),ref:r,role:null,ownerState:l,tabIndex:null,...v,style:{...v.style,...m==="vertical"&&{"--TabScrollButton-svgRotate":`rotate(${E?-90:90}deg)`}},children:g==="left"?e.jsx(I,{...k}):e.jsx(T,{...O})})});function Js(o){return St("MuiTabs",o)}const mt=Ct("MuiTabs",["root","vertical","list","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),Dt=(o,t)=>o===t?o.firstChild:t&&t.nextElementSibling?t.nextElementSibling:o.firstChild,Ft=(o,t)=>o===t?o.lastChild:t&&t.previousElementSibling?t.previousElementSibling:o.lastChild,Xe=(o,t,r)=>{let u=!1,d=r(o,t);for(;d;){if(d===o.firstChild){if(u)return;u=!0}const h=d.disabled||d.getAttribute("aria-disabled")==="true";if(!d.hasAttribute("tabindex")||h)d=r(o,d);else{d.focus();return}}},Zs=o=>{const{vertical:t,fixed:r,hideScrollbar:u,scrollableX:d,scrollableY:h,centered:p,scrollButtonsHideMobile:g,classes:m}=o;return jt({root:["root",t&&"vertical"],scroller:["scroller",r&&"fixed",u&&"hideScrollbar",d&&"scrollableX",h&&"scrollableY"],list:["list","flexContainer",t&&"flexContainerVertical",t&&"vertical",p&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",g&&"scrollButtonsHideMobile"],scrollableX:[d&&"scrollableX"],hideScrollbar:[u&&"hideScrollbar"]},Js,m)},qs=xe("div",{name:"MuiTabs",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[{[`& .${mt.scrollButtons}`]:t.scrollButtons},{[`& .${mt.scrollButtons}`]:r.scrollButtonsHideMobile&&t.scrollButtonsHideMobile},t.root,r.vertical&&t.vertical]}})(vt(({theme:o})=>({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex",variants:[{props:({ownerState:t})=>t.vertical,style:{flexDirection:"column"}},{props:({ownerState:t})=>t.scrollButtonsHideMobile,style:{[`& .${mt.scrollButtons}`]:{[o.breakpoints.down("sm")]:{display:"none"}}}}]}))),Qs=xe("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.scroller,r.fixed&&t.fixed,r.hideScrollbar&&t.hideScrollbar,r.scrollableX&&t.scrollableX,r.scrollableY&&t.scrollableY]}})({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap",variants:[{props:({ownerState:o})=>o.fixed,style:{overflowX:"hidden",width:"100%"}},{props:({ownerState:o})=>o.hideScrollbar,style:{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}},{props:({ownerState:o})=>o.scrollableX,style:{overflowX:"auto",overflowY:"hidden"}},{props:({ownerState:o})=>o.scrollableY,style:{overflowY:"auto",overflowX:"hidden"}}]}),eo=xe("div",{name:"MuiTabs",slot:"List",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.list,t.flexContainer,r.vertical&&t.flexContainerVertical,r.centered&&t.centered]}})({display:"flex",variants:[{props:({ownerState:o})=>o.vertical,style:{flexDirection:"column"}},{props:({ownerState:o})=>o.centered,style:{justifyContent:"center"}}]}),to=xe("span",{name:"MuiTabs",slot:"Indicator"})(vt(({theme:o})=>({position:"absolute",height:2,bottom:0,width:"100%",transition:o.transitions.create(),variants:[{props:{indicatorColor:"primary"},style:{backgroundColor:(o.vars||o).palette.primary.main}},{props:{indicatorColor:"secondary"},style:{backgroundColor:(o.vars||o).palette.secondary.main}},{props:({ownerState:t})=>t.vertical,style:{height:"100%",width:2,right:0}}]}))),so=xe(_s)({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),Wt={},oo=n.forwardRef(function(t,r){const u=yt({props:t,name:"MuiTabs"}),d=wt(),h=Gt(),{"aria-label":p,"aria-labelledby":g,action:m,centered:j=!1,children:v,className:E,component:l="div",allowScrollButtonsMobile:A=!1,indicatorColor:I="primary",onChange:T,orientation:k="horizontal",ScrollButtonComponent:O,scrollButtons:_="auto",selectionFollowsFocus:M,slots:B={},slotProps:W={},TabIndicatorProps:J={},TabScrollButtonProps:R={},textColor:re="primary",value:Z,variant:$="standard",visibleScrollbar:N=!1,...de}=u,Y=$==="scrollable",H=k==="vertical",P=H?"scrollTop":"scrollLeft",f=H?"top":"left",b=H?"bottom":"right",X=H?"clientHeight":"clientWidth",D=H?"height":"width",z={...u,component:l,allowScrollButtonsMobile:A,indicatorColor:I,orientation:k,vertical:H,scrollButtons:_,textColor:re,variant:$,visibleScrollbar:N,fixed:!Y,hideScrollbar:Y&&!N,scrollableX:Y&&!H,scrollableY:Y&&H,centered:j&&!Y,scrollButtonsHideMobile:!A},q=Zs(z),ue=Ge({elementType:B.StartScrollButtonIcon,externalSlotProps:W.startScrollButtonIcon,ownerState:z}),Et=Ge({elementType:B.EndScrollButtonIcon,externalSlotProps:W.endScrollButtonIcon,ownerState:z}),[Ie,he]=n.useState(!1),[se,L]=n.useState(Wt),[G,Je]=n.useState(!1),[De,Ze]=n.useState(!1),[Fe,qe]=n.useState(!1),[Ae,Qe]=n.useState({overflow:"hidden",scrollbarWidth:0}),Te=new Map,ee=n.useRef(null),oe=n.useRef(null),le={slots:B,slotProps:{indicator:J,scrollButton:R,...W}},Re=()=>{const a=ee.current;let i;if(a){const s=a.getBoundingClientRect();i={clientWidth:a.clientWidth,scrollLeft:a.scrollLeft,scrollTop:a.scrollTop,scrollWidth:a.scrollWidth,top:s.top,bottom:s.bottom,left:s.left,right:s.right}}let C;if(a&&Z!==!1){const s=oe.current.children;if(s.length>0){const c=s[Te.get(Z)];C=c?c.getBoundingClientRect():null}}return{tabsMeta:i,tabMeta:C}},ge=pt(()=>{const{tabsMeta:a,tabMeta:i}=Re();let C=0,s;H?(s="top",i&&a&&(C=i.top-a.top+a.scrollTop)):(s=h?"right":"left",i&&a&&(C=(h?-1:1)*(i[s]-a[s]+a.scrollLeft)));const c={[s]:C,[D]:i?i[D]:0};if(typeof se[s]!="number"||typeof se[D]!="number")L(c);else{const x=Math.abs(se[s]-c[s]),w=Math.abs(se[D]-c[D]);(x>=1||w>=1)&&L(c)}}),me=(a,{animation:i=!0}={})=>{i?Hs(P,ee.current,a,{duration:d.transitions.duration.standard}):ee.current[P]=a},be=a=>{let i=ee.current[P];H?i+=a:i+=a*(h?-1:1),me(i)},Ce=()=>{const a=ee.current[X];let i=0;const C=Array.from(oe.current.children);for(let s=0;s<C.length;s+=1){const c=C[s];if(i+c[X]>a){s===0&&(i=a);break}i+=c[X]}return i},et=()=>{be(-1*Ce())},ne=()=>{be(Ce())},[tt,{onChange:te,...It}]=je("scrollbar",{className:ce(q.scrollableX,q.hideScrollbar),elementType:so,shouldForwardComponentProp:!0,externalForwardedProps:le,ownerState:z}),st=n.useCallback(a=>{te==null||te(a),Qe({overflow:null,scrollbarWidth:a})},[te]),[We,pe]=je("scrollButtons",{className:ce(q.scrollButtons,R.className),elementType:Ys,externalForwardedProps:le,ownerState:z,additionalProps:{orientation:k,slots:{StartScrollButtonIcon:B.startScrollButtonIcon||B.StartScrollButtonIcon,EndScrollButtonIcon:B.endScrollButtonIcon||B.EndScrollButtonIcon},slotProps:{startScrollButtonIcon:ue,endScrollButtonIcon:Et}}}),ot=()=>{const a={};a.scrollbarSizeListener=Y?e.jsx(tt,{...It,onChange:st}):null;const C=Y&&(_==="auto"&&(G||De)||_===!0);return a.scrollButtonStart=C?e.jsx(We,{direction:h?"right":"left",onClick:et,disabled:!G,...pe}):null,a.scrollButtonEnd=C?e.jsx(We,{direction:h?"left":"right",onClick:ne,disabled:!De,...pe}):null,a},$e=pt(a=>{const{tabsMeta:i,tabMeta:C}=Re();if(!(!C||!i)){if(C[f]<i[f]){const s=i[P]+(C[f]-i[f]);me(s,{animation:a})}else if(C[b]>i[b]){const s=i[P]+(C[b]-i[b]);me(s,{animation:a})}}}),Se=pt(()=>{Y&&_!==!1&&qe(!Fe)});n.useEffect(()=>{const a=Vt(()=>{ee.current&&ge()});let i;const C=x=>{x.forEach(w=>{w.removedNodes.forEach(K=>{i==null||i.unobserve(K)}),w.addedNodes.forEach(K=>{i==null||i.observe(K)})}),a(),Se()},s=Xt(ee.current);s.addEventListener("resize",a);let c;return typeof ResizeObserver<"u"&&(i=new ResizeObserver(a),Array.from(oe.current.children).forEach(x=>{i.observe(x)})),typeof MutationObserver<"u"&&(c=new MutationObserver(C),c.observe(oe.current,{childList:!0})),()=>{a.clear(),s.removeEventListener("resize",a),c==null||c.disconnect(),i==null||i.disconnect()}},[ge,Se]),n.useEffect(()=>{const a=Array.from(oe.current.children),i=a.length;if(typeof IntersectionObserver<"u"&&i>0&&Y&&_!==!1){const C=a[0],s=a[i-1],c={root:ee.current,threshold:.99},x=Me=>{Je(!Me[0].isIntersecting)},w=new IntersectionObserver(x,c);w.observe(C);const K=Me=>{Ze(!Me[0].isIntersecting)},U=new IntersectionObserver(K,c);return U.observe(s),()=>{w.disconnect(),U.disconnect()}}},[Y,_,Fe,v==null?void 0:v.length]),n.useEffect(()=>{he(!0)},[]),n.useEffect(()=>{ge()}),n.useEffect(()=>{$e(Wt!==se)},[$e,se]),n.useImperativeHandle(m,()=>({updateIndicator:ge,updateScrollButtons:Se}),[ge,Se]);const[rt,nt]=je("indicator",{className:ce(q.indicator,J.className),elementType:to,externalForwardedProps:le,ownerState:z,additionalProps:{style:se}}),He=e.jsx(rt,{...nt});let ye=0;const at=n.Children.map(v,a=>{if(!n.isValidElement(a))return null;const i=a.props.value===void 0?ye:a.props.value;Te.set(i,ye);const C=i===Z;return ye+=1,n.cloneElement(a,{fullWidth:$==="fullWidth",indicator:C&&!Ie&&He,selected:C,selectionFollowsFocus:M,onChange:T,textColor:re,value:i,...ye===1&&Z===!1&&!a.props.tabIndex?{tabIndex:0}:{}})}),lt=a=>{if(a.altKey||a.shiftKey||a.ctrlKey||a.metaKey)return;const i=oe.current,C=Qt(es(i));if((C==null?void 0:C.getAttribute("role"))!=="tab")return;let c=k==="horizontal"?"ArrowLeft":"ArrowUp",x=k==="horizontal"?"ArrowRight":"ArrowDown";switch(k==="horizontal"&&h&&(c="ArrowRight",x="ArrowLeft"),a.key){case c:a.preventDefault(),Xe(i,C,Ft);break;case x:a.preventDefault(),Xe(i,C,Dt);break;case"Home":a.preventDefault(),Xe(i,null,Dt);break;case"End":a.preventDefault(),Xe(i,null,Ft);break}},Le=ot(),[Ue,it]=je("root",{ref:r,className:ce(q.root,E),elementType:qs,externalForwardedProps:{...le,...de,component:l},ownerState:z}),[_e,ct]=je("scroller",{ref:ee,className:q.scroller,elementType:Qs,externalForwardedProps:le,ownerState:z,additionalProps:{style:{overflow:Ae.overflow,[H?`margin${h?"Left":"Right"}`:"marginBottom"]:N?void 0:-Ae.scrollbarWidth}}}),[dt,ut]=je("list",{ref:oe,className:ce(q.list,q.flexContainer),elementType:eo,externalForwardedProps:le,ownerState:z,getSlotProps:a=>({...a,onKeyDown:i=>{var C;lt(i),(C=a.onKeyDown)==null||C.call(a,i)}})});return e.jsxs(Ue,{...it,children:[Le.scrollButtonStart,Le.scrollbarSizeListener,e.jsxs(_e,{...ct,children:[e.jsx(dt,{"aria-label":p,"aria-labelledby":g,"aria-orientation":k==="vertical"?"vertical":null,role:"tablist",...ut,children:at}),Ie&&He]}),Le.scrollButtonEnd]})}),ro=Ee([e.jsx("path",{d:"m12 2-5.5 9h11z"},"0"),e.jsx("circle",{cx:"17.5",cy:"17.5",r:"4.5"},"1"),e.jsx("path",{d:"M3 13.5h8v8H3z"},"2")]),no=Ee(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"})),ao=Ee(e.jsx("path",{d:"M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12z"})),lo=Ee(e.jsx("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"})),io=({complaintId:o,open:t,onClose:r,citizenName:u="Citizen",complaintTitle:d="Complaint"})=>{const h=wt(),p=Kt(h.breakpoints.down("sm")),g=n.useRef(null),m=n.useRef(null),[j,v]=n.useState([]),[E,l]=n.useState(!1),[A,I]=n.useState(null),[T,k]=n.useState(""),[O,_]=n.useState(!1),[M,B]=n.useState(null),[W,J]=n.useState(!1),R=n.useCallback(()=>{g.current&&g.current.scrollIntoView({behavior:"smooth"})},[]);n.useEffect(()=>{t&&o&&(re(),Z())},[t,o]),n.useEffect(()=>{R()},[j,R]),n.useEffect(()=>{if(t&&o)return ve.startPolling(o,f=>{v(f)}),()=>{ve.stopPolling(o)}},[t,o]);const re=async()=>{if(o)try{l(!0),I(null);const{messages:f}=await ve.getChatMessages(o);v(f)}catch(f){const b=ze(f);I(b.userMessage)}finally{l(!1)}},Z=async()=>{if(o)try{await ve.markAsRead(o)}catch(f){console.error("Error marking messages as read:",f)}},$=async()=>{if(!(!o||!T.trim()&&!M))try{_(!0);let f;M?f=await ve.sendMessageWithFile(o,T.trim()||"Image",M.file):f=await ve.sendMessage(o,{message:T.trim()}),v(b=>[...b,f]),k(""),B(null),R(),we.success("Message sent successfully",{icon:"âœ…"})}catch(f){const b=ze(f);we.error(b.userMessage,{duration:5e3,icon:"âŒ"})}finally{_(!1)}},N=async f=>{var X;const b=(X=f.target.files)==null?void 0:X[0];if(b){if(!b.type.startsWith("image/")){we.error("Please select an image file",{icon:"âŒ"});return}if(b.size>5*1024*1024){we.error("Image size must be less than 5MB",{icon:"âŒ"});return}try{J(!0);const D=new FileReader;D.onloadend=()=>{B({file:b,preview:D.result})},D.readAsDataURL(b),we.success("Image ready to send",{icon:"âœ…"})}catch(D){const z=ze(D);we.error(z.userMessage,{icon:"âŒ"}),B(null)}finally{J(!1)}}},de=()=>{B(null)},Y=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),$())},H=f=>{const b=new Date(f),X=new Date,D=X.getTime()-b.getTime(),z=Math.floor(D/(1e3*60)),q=Math.floor(D/(1e3*60*60)),ue=Math.floor(D/(1e3*60*60*24));return z<1?"Just now":z<60?`${z}m ago`:q<24?`${q}h ago`:ue<7?`${ue}d ago`:b.toLocaleDateString("en-US",{month:"short",day:"numeric",year:b.getFullYear()!==X.getFullYear()?"numeric":void 0})},P=()=>{v([]),k(""),B(null),I(null),r()};return e.jsxs(ts,{open:t,onClose:P,maxWidth:"sm",fullWidth:!0,fullScreen:p,slotProps:{paper:{sx:{borderRadius:p?0:2,height:p?"100vh":"80vh",maxHeight:p?"100vh":"80vh",display:"flex",flexDirection:"column",animation:p?`${ss} ${ie.normal.duration} ${ie.smooth.timing}`:`${os} ${ie.normal.duration} ${ie.smooth.timing}`,animationFillMode:"both"}},backdrop:{sx:{animation:`${At} ${ie.fast.duration} ${ie.fast.timing}`}}},children:[e.jsxs(rs,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0",flexShrink:0},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ns,{sx:{width:40,height:40,backgroundColor:"#4CAF50"},children:e.jsx(As,{})}),e.jsxs(y,{children:[e.jsx(S,{variant:"subtitle1",sx:{fontWeight:600,lineHeight:1.2},children:u}),e.jsx(S,{variant:"caption",color:"text.secondary",children:d})]})]}),e.jsx(ft,{onClick:P,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(Tt,{})})]}),e.jsxs(as,{ref:m,sx:{flex:1,overflowY:"auto",p:2,display:"flex",flexDirection:"column",gap:2,backgroundColor:"#f8f9fa"},children:[E&&e.jsx(y,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsx(ke,{})}),A&&!E&&e.jsx(ls,{severity:"error",sx:{mb:2},children:A}),!E&&!A&&j.length===0&&e.jsxs(y,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:200,textAlign:"center"},children:[e.jsx(S,{variant:"body1",color:"text.secondary",sx:{mb:1},children:"No messages yet"}),e.jsx(S,{variant:"body2",color:"text.secondary",children:"Start the conversation by sending a message"})]}),!E&&!A&&j.map(f=>{const b=f.senderType==="ADMIN";return e.jsx(y,{sx:{display:"flex",justifyContent:b?"flex-end":"flex-start",animation:`${At} ${ie.fast.duration} ${ie.fast.timing}`},children:e.jsxs(y,{sx:{maxWidth:"70%",display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:.5,px:1,justifyContent:b?"flex-end":"flex-start"},children:[b&&e.jsx(is,{sx:{fontSize:14,color:"#4CAF50"}}),e.jsx(S,{variant:"caption",sx:{fontWeight:600,color:b?"#4CAF50":"#1976d2"},children:f.senderName||(b?"Admin":u)})]}),e.jsxs(y,{sx:{backgroundColor:b?"#4CAF50":"white",color:b?"white":"text.primary",borderRadius:2,p:1.5,boxShadow:1},children:[f.imageUrl&&e.jsx(y,{component:"img",src:f.imageUrl,alt:"Message attachment",sx:{width:"100%",maxWidth:300,borderRadius:1,mb:f.message?1:0}}),f.message&&e.jsx(S,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:f.message})]}),e.jsx(S,{variant:"caption",color:"text.secondary",sx:{px:1,textAlign:b?"right":"left"},children:H(f.createdAt)})]})},f.id)}),e.jsx("div",{ref:g})]}),e.jsxs(y,{sx:{p:2,borderTop:"1px solid #e0e0e0",backgroundColor:"white",flexShrink:0},children:[M&&e.jsxs(y,{sx:{mb:1,position:"relative",display:"inline-block"},children:[e.jsx(y,{component:"img",src:M.preview,alt:"Preview",sx:{maxWidth:200,maxHeight:200,borderRadius:1,border:"1px solid #e0e0e0"}}),e.jsx(ft,{size:"small",onClick:de,sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},children:e.jsx(Tt,{fontSize:"small"})})]}),e.jsxs(y,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx(bt,{fullWidth:!0,multiline:!0,maxRows:4,placeholder:"Type a message...",value:T,onChange:f=>k(f.target.value),onKeyPress:Y,disabled:O,slotProps:{input:{startAdornment:e.jsx(Ne,{position:"start",children:e.jsxs(ft,{component:"label",size:"small",disabled:W||O,children:[e.jsx(Ts,{}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:N})]})})}},sx:{"& .MuiOutlinedInput-root":{borderRadius:3}}}),e.jsx(fe,{variant:"contained",onClick:$,disabled:!T.trim()&&!M||O,sx:{minWidth:56,height:56,borderRadius:"50%",backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},"&:disabled":{backgroundColor:"#e0e0e0"}},children:O?e.jsx(ke,{size:24,sx:{color:"white"}}):e.jsx(Ls,{})})]})]})]})};class co{constructor(){ht(this,"apiClient");this.apiClient=Ke.create({baseURL:Ye.BASE_URL,timeout:Ye.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const r=localStorage.getItem("accessToken");r&&(t.headers.Authorization=`Bearer ${r}`)}catch(r){console.error("Error getting token:",r)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var r;return((r=t.response)==null?void 0:r.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(this.handleError(t))})}handleError(t){var r,u,d,h,p;if(Ke.isAxiosError(t)){const g=((r=t.response)==null?void 0:r.status)||500,m=((d=(u=t.response)==null?void 0:u.data)==null?void 0:d.message)||"An error occurred",j=(p=(h=t.response)==null?void 0:h.data)==null?void 0:p.errors;return{name:"ApiError",statusCode:g,message:m,errors:j}}return{name:"ApiError",statusCode:500,message:t.message||"An unexpected error occurred"}}parseMetadata(t){if(!t)return null;try{return JSON.parse(t)}catch(r){return console.error("Error parsing notification metadata:",r),null}}async getNotifications(t={}){try{const r={page:t.page||1,limit:t.limit||20};t.unreadOnly!==void 0&&(r.unreadOnly=t.unreadOnly);const u=await this.apiClient.get("/api/notifications",{params:r}),d=u.data.data.notifications.map(h=>({...h,metadata:this.parseMetadata(h.metadata)}));return{...u.data.data,notifications:d}}catch(r){throw console.error("Error fetching notifications:",r),r}}async getUnreadCount(){try{return(await this.apiClient.get("/api/notifications/unread-count")).data.data.count}catch(t){throw console.error("Error fetching unread count:",t),t}}async markAsRead(t){try{return(await this.apiClient.patch(`/api/notifications/${t}/read`)).data.data}catch(r){throw console.error("Error marking notification as read:",r),r}}async markAllAsRead(){try{return(await this.apiClient.patch("/api/notifications/read-all")).data.data.updatedCount}catch(t){throw console.error("Error marking all notifications as read:",t),t}}}new co;class uo{constructor(){ht(this,"apiClient");this.apiClient=Ke.create({baseURL:Ye.BASE_URL,timeout:Ye.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const r=localStorage.getItem("accessToken");r&&(t.headers.Authorization=`Bearer ${r}`)}catch(r){console.error("Error getting token:",r)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var r;return((r=t.response)==null?void 0:r.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(this.handleError(t))})}handleError(t){var r,u,d,h,p;if(Ke.isAxiosError(t)){const g=((r=t.response)==null?void 0:r.status)||500,m=((d=(u=t.response)==null?void 0:u.data)==null?void 0:d.message)||"An error occurred",j=(p=(h=t.response)==null?void 0:h.data)==null?void 0:p.errors;return{name:"ApiError",statusCode:g,message:m,errors:j}}return{name:"ApiError",statusCode:500,message:t.message||"An unexpected error occurred"}}async submitReview(t,r){try{return(await this.apiClient.post(`/api/complaints/${t}/review`,r)).data.data}catch(u){throw console.error("Error submitting review:",u),u}}async getComplaintReviews(t){try{return(await this.apiClient.get(`/api/complaints/${t}/reviews`)).data.data}catch(r){throw console.error("Error fetching complaint reviews:",r),r}}async getReviewAnalytics(t={}){try{const r={};return t.cityCorporationCode&&(r.cityCorporationCode=t.cityCorporationCode),t.zoneId!==void 0&&(r.zoneId=t.zoneId),t.wardId!==void 0&&(r.wardId=t.wardId),t.startDate&&(r.startDate=t.startDate),t.endDate&&(r.endDate=t.endDate),(await this.apiClient.get("/api/admin/complaints/analytics/reviews",{params:r})).data.data}catch(r){throw console.error("Error fetching review analytics:",r),r}}}new uo;const ho=({value:o,onChange:t,disabled:r=!1,fullWidth:u=!1})=>{const[d,h]=n.useState([]),[p,g]=n.useState(!0),[m,j]=n.useState(null);n.useEffect(()=>{v()},[]);const v=async()=>{try{g(!0),j(null);const l=await Yt.getAllCategories();h(l)}catch(l){console.error("Error fetching categories:",l),j(l.message||"Failed to load categories")}finally{g(!1)}},E=l=>{t(l.target.value)};return e.jsx(Oe,{sx:{minWidth:u?"100%":{xs:"100%",sm:180}},disabled:r||p,children:e.jsxs(Be,{value:o,onChange:E,displayEmpty:!0,startAdornment:e.jsx(Ne,{position:"start",children:p?e.jsx(ke,{size:20,sx:{mr:1}}):e.jsx(ro,{sx:{color:"text.secondary",mr:1}})}),sx:{backgroundColor:"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},children:[e.jsx(F,{value:"",children:e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:"All Categories"})}),e.jsx(F,{value:"uncategorized",children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Rs,{sx:{fontSize:18,color:"#9e9e9e"}}),e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"#757575"},children:"Uncategorized"})]})}),m?e.jsx(F,{disabled:!0,children:e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"error.main"},children:m})}):d.map(l=>e.jsx(F,{value:l.id,children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:l.color,flexShrink:0}}),e.jsxs(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:[l.english," (",l.bangla,")"]})]})},l.id))]})})},po=({categoryId:o,value:t,onChange:r,disabled:u=!1,fullWidth:d=!1})=>{const[h,p]=n.useState([]),[g,m]=n.useState(!1),[j,v]=n.useState(null);n.useEffect(()=>{o?E():(p([]),t&&r(""))},[o]);const E=async()=>{try{m(!0),v(null);const I=await Yt.getSubcategories(o);p(I)}catch(I){console.error("Error fetching subcategories:",I),v(I.message||"Failed to load subcategories"),p([])}finally{m(!1)}},l=I=>{r(I.target.value)},A=u||g||!o;return e.jsx(Oe,{sx:{minWidth:d?"100%":{xs:"100%",sm:200}},disabled:A,children:e.jsxs(Be,{value:t,onChange:l,displayEmpty:!0,startAdornment:e.jsx(Ne,{position:"start",children:g?e.jsx(ke,{size:20,sx:{mr:1}}):e.jsx(ao,{sx:{color:"text.secondary",mr:1}})}),sx:{backgroundColor:A?"#f5f5f5":"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:A?void 0:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},children:[e.jsx(F,{value:"",children:e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:o?"All Subcategories":"Select category first"})}),j?e.jsx(F,{disabled:!0,children:e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"error.main"},children:j})}):h.map(I=>e.jsx(F,{value:I.id,children:e.jsxs(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:[I.english," (",I.bangla,")"]})},I.id))]})})},$t=["Engineering","Electricity","Health","Property (Eviction)"],Ht=["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"],fo=({value:o,onChange:t,disabled:r=!1,fullWidth:u=!1})=>{const[d,h]=n.useState(!1),[p,g]=n.useState(!1),m=l=>{const A=l.target.value;t(A)},j=()=>o==="ALL"?"All Status":o==="OTHERS_ALL"?"All Others":o==="CORPORATION_INTERNAL"?"Corporation Internal":o==="CORPORATION_EXTERNAL"?"Corporation External":$t.includes(o)?`Internal: ${o}`:Ht.includes(o)?`External: ${o}`:o,v=l=>o===l,E=l=>v(l)?e.jsx(ds,{sx:{fontSize:18,color:"#4CAF50",mr:1}}):e.jsx(no,{sx:{fontSize:18,color:"transparent",mr:1}});return e.jsx(Oe,{sx:{minWidth:u?"100%":{xs:"100%",sm:200}},disabled:r,children:e.jsxs(Be,{value:o,onChange:m,displayEmpty:!0,startAdornment:e.jsx(Ne,{position:"start",children:e.jsx(cs,{sx:{color:"text.secondary",mr:1}})}),renderValue:()=>e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:j()}),sx:{backgroundColor:"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},MenuProps:{PaperProps:{sx:{maxHeight:400,"& .MuiMenuItem-root":{fontSize:{xs:"0.875rem",sm:"0.95rem"}}}}},children:[e.jsx(F,{value:"ALL",children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[E("ALL"),e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:"All Status"})]})}),e.jsx(xt,{sx:{my:.5}}),e.jsx(F,{value:"OTHERS_ALL",children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[E("OTHERS_ALL"),e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:600},children:"All Others"})]})}),e.jsx(xt,{sx:{my:.5}}),e.jsx(F,{value:"CORPORATION_INTERNAL",onClick:l=>{l.stopPropagation(),h(!d)},sx:{backgroundColor:d?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:d?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[E("CORPORATION_INTERNAL"),e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:500,flex:1},children:"Corporation Internal"}),d?e.jsx(Ot,{sx:{fontSize:20,color:"text.secondary"}}):e.jsx(Bt,{sx:{fontSize:20,color:"text.secondary"}})]})}),d&&e.jsx(e.Fragment,{children:$t.map(l=>e.jsx(F,{value:l,sx:{pl:5,backgroundColor:v(l)?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:v(l)?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[E(l),e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:l})]})},l))}),e.jsx(xt,{sx:{my:.5}}),e.jsx(F,{value:"CORPORATION_EXTERNAL",onClick:l=>{l.stopPropagation(),g(!p)},sx:{backgroundColor:p?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:p?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[E("CORPORATION_EXTERNAL"),e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:500,flex:1},children:"Corporation External"}),p?e.jsx(Ot,{sx:{fontSize:20,color:"text.secondary"}}):e.jsx(Bt,{sx:{fontSize:20,color:"text.secondary"}})]})}),p&&e.jsx(e.Fragment,{children:Ht.map(l=>e.jsx(F,{value:l,sx:{pl:5,backgroundColor:v(l)?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:v(l)?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[E(l),e.jsx(S,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:l})]})},l))})]})})},Mo=()=>{const o=us(),[t,r]=hs(),u=wt(),d=Kt(u.breakpoints.down("sm")),[h,p]=n.useState([]),[g,m]=n.useState(!0),[j,v]=n.useState(null),[E,l]=n.useState(null),[A,I]=n.useState(!1),[T,k]=n.useState(t.get("search")||""),[O,_]=n.useState(t.get("status")||"ALL"),[M,B]=n.useState(t.get("category")||""),[W,J]=n.useState(t.get("subcategory")||""),[R,re]=n.useState(t.get("othersFilter")||"ALL"),[Z,$]=n.useState([]),[N,de]=n.useState(t.get("cityCorporation")||"ALL"),[Y,H]=n.useState(null),[P,f]=n.useState(t.get("zone")?Number(t.get("zone")):""),[b,X]=n.useState(t.get("ward")?Number(t.get("ward")):null),[D,z]=n.useState([]),[q,ue]=n.useState(!1),[Et,Ie]=n.useState(!1),[he,se]=n.useState({total:0,pending:0,inProgress:0,resolved:0,rejected:0}),[L,G]=n.useState({page:parseInt(t.get("page")||"1",10),limit:parseInt(t.get("limit")||"20",10),total:0,totalPages:0}),[Je,De]=n.useState(!1),[Ze,Fe]=n.useState(null),[qe,Ae]=n.useState(!1),[Qe,Te]=n.useState(null),[ee,oe]=n.useState(""),[le,Re]=n.useState(""),[ge,me]=n.useState(null),be=ws(T,500),[Ce,et]=n.useState(!0),[ne,tt]=n.useState(""),[te,It]=n.useState("");n.useEffect(()=>{st()},[]),n.useEffect(()=>{if(N!=="ALL"){const s=Z.find(c=>c.code===N);s&&H(s.id)}else H(null),z([]);f(""),X(null)},[N,Z]),n.useEffect(()=>{P?We(P):z([]),X(null)},[P]),n.useEffect(()=>{const s=new URLSearchParams;T&&s.set("search",T),O!=="ALL"&&s.set("status",O),M&&s.set("category",M),W&&s.set("subcategory",W),R!=="ALL"&&s.set("othersFilter",R),N!=="ALL"&&s.set("cityCorporation",N),P&&s.set("zone",P.toString()),b&&s.set("ward",b.toString()),ne&&s.set("startDate",ne),te&&s.set("endDate",te),L.page!==1&&s.set("page",L.page.toString()),L.limit!==20&&s.set("limit",L.limit.toString()),r(s,{replace:!0})},[T,O,M,W,R,N,P,b,ne,te,L.page,L.limit]);const st=async()=>{try{ue(!0),console.log("ðŸ™ï¸ Fetching city corporations...");const s=await ps.getCityCorporations("ACTIVE");console.log("âœ… City corporations fetched:",s),console.log("ðŸ“Š City corporations array:",s.cityCorporations),s.cityCorporations&&Array.isArray(s.cityCorporations)?($(s.cityCorporations),console.log(`âœ… Set ${s.cityCorporations.length} city corporations`)):(console.warn("âš ï¸ City corporations response is not valid:",s),$([]))}catch(s){console.error("âŒ Error fetching city corporations:",s),Ve("Failed to load city corporations"),$([])}finally{ue(!1)}},We=async s=>{try{Ie(!0);const c=await Ms.getWardsByZone(s,"ACTIVE");z(c)}catch(c){console.error("Error fetching wards:",c),Ve("Failed to load wards")}finally{Ie(!1)}},pe=n.useCallback(async()=>{var s,c;try{m(!0),v(null),l(null),I(!1);const x={};O!=="ALL"&&(x.status=O),be&&(x.search=be),M&&(x.category=M),W&&(x.subcategory=W),R!=="ALL"&&(R==="OTHERS_ALL"?x.status="REJECTED":R==="CORPORATION_INTERNAL"?(x.status="REJECTED",x.othersCategory="CORPORATION_INTERNAL"):R==="CORPORATION_EXTERNAL"?(x.status="REJECTED",x.othersCategory="CORPORATION_EXTERNAL"):(x.status="REJECTED",x.othersSubcategory=R)),N!=="ALL"&&(x.cityCorporationCode=N),P&&(x.zoneId=P),b&&(x.wardId=b),ne&&(x.startDate=ne),te&&(x.endDate=te),console.log("Fetching complaints with params:",{page:L.page,limit:L.limit,filters:x});const w=await Nt.getComplaints(L.page,L.limit,x);console.log("Complaints fetched successfully:",w),p(w.complaints),se(w.statusCounts),G({page:w.pagination.page,limit:w.pagination.limit,total:w.pagination.total,totalPages:w.pagination.totalPages})}catch(x){console.error("Error fetching complaints:",x),console.error("Error response:",(s=x.response)==null?void 0:s.data),console.error("Error status:",(c=x.response)==null?void 0:c.status),Rt(x,"fetchComplaints");const w=ze(x);v(w.userMessage),l(w.type),I(w.retryable),w.type===Lt.NETWORK?kt(w.userMessage):Ve(w.userMessage)}finally{m(!1)}},[L.page,L.limit,O,M,W,R,N,P,b,be,ne,te]);n.useEffect(()=>{pe()},[pe]);const ot=(s,c)=>{G(x=>({...x,page:c})),window.scrollTo({top:0,behavior:"smooth"})},$e=s=>{_(s),G(c=>({...c,page:1}))},Se=s=>{k(s.target.value),G(c=>({...c,page:1}))},rt=s=>{B(s),J(""),G(c=>({...c,page:1}))},nt=s=>{J(s),G(c=>({...c,page:1}))},He=s=>{re(s),G(c=>({...c,page:1}))},ye=s=>{de(s),G(c=>({...c,page:1}))},at=s=>{f(s),G(c=>({...c,page:1}))},lt=s=>{X(s),G(c=>({...c,page:1}))},Le=()=>{k(""),_("ALL"),B(""),J(""),re("ALL"),de("ALL"),de("ALL"),f(""),X(null),G(s=>({...s,page:1}))},Ue=n.useCallback(async(s,c)=>{try{me(s);const x=await Nt.updateComplaintStatus(s,{status:c});p(w=>w.map(K=>K.id===s?x:K)),se(w=>{const K=h.find(Me=>Me.id===s);if(!K)return w;const U={...w};return K.status==="PENDING"?U.pending=Math.max(0,U.pending-1):K.status==="IN_PROGRESS"?U.inProgress=Math.max(0,U.inProgress-1):K.status==="RESOLVED"?U.resolved=Math.max(0,U.resolved-1):K.status==="REJECTED"&&(U.rejected=Math.max(0,U.rejected-1)),c==="PENDING"?U.pending+=1:c==="IN_PROGRESS"?U.inProgress+=1:c==="RESOLVED"?U.resolved+=1:c==="REJECTED"&&(U.rejected+=1),U}),vs("Complaint status updated successfully")}catch(x){Rt(x,"handleStatusUpdate");const w=ze(x);w.type===Lt.NETWORK?kt(w.userMessage):Ve(w.userMessage)}finally{me(null)}},[h]),it=s=>{o(`/complaints/${s}`)},_e=()=>{De(!1),Fe(null)},ct=s=>{Te(s.id),oe(`${s.user.firstName} ${s.user.lastName}`),Re(s.category||s.title),Ae(!0)},dt=()=>{Ae(!1),Te(null),oe(""),Re("")},ut=s=>{_e(),o(`/chats/${s}`)},a=n.useCallback(async(s,c)=>{await Ue(s,c),pe()},[Ue,pe]),i=s=>{switch(s){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404",borderColor:"#ffeeba"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460",borderColor:"#bee5eb"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724",borderColor:"#c3e6cb"};case"REJECTED":return{backgroundColor:"#f8d7da",color:"#721c24",borderColor:"#f5c6cb"};default:return{backgroundColor:"#f8f9fa",color:"#6c757d"}}},C=s=>{switch(s){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Solved";case"REJECTED":return"Others";default:return s}};return e.jsxs(fs,{title:"All Complaints",children:[e.jsx(xs,{loading:g}),e.jsxs(y,{sx:{p:{xs:2,md:3},backgroundColor:"#f9fafb",minHeight:"100vh"},children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(S,{variant:"h5",sx:{fontWeight:700,color:"#1e2939"},children:["All Complaints",L.total>0&&e.jsxs(S,{component:"span",variant:"body1",sx:{color:"#6b7280",ml:1.5,fontWeight:500},children:["(Total ",L.total,")"]})]}),e.jsx(fe,{variant:"contained",onClick:()=>et(!Ce),startIcon:e.jsx(Ps,{}),sx:{backgroundColor:"#4CAF50",textTransform:"none","&:hover":{backgroundColor:"#45a049"}},children:Ce?"Hide Filters":"Show Filters"})]}),e.jsx(y,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(oo,{value:O==="ALL"?"ALL":O,onChange:(s,c)=>$e(c),variant:"scrollable",scrollButtons:"auto",sx:{"& .MuiTab-root":{textTransform:"none",minWidth:100,fontWeight:600}},children:[e.jsx(Pe,{label:`All (${he.total})`,value:"ALL"}),e.jsx(Pe,{label:`Pending (${he.pending})`,value:"PENDING"}),e.jsx(Pe,{label:`In Progress (${he.inProgress})`,value:"IN_PROGRESS"}),e.jsx(Pe,{label:`Solved (${he.resolved})`,value:"RESOLVED"}),e.jsx(Pe,{label:`Others (${he.rejected})`,value:"REJECTED"})]})}),e.jsx(zs,{in:Ce,children:e.jsxs(Mt,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e5e7eb",backgroundColor:"white"},children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(S,{variant:"subtitle1",sx:{fontWeight:600,color:"#374151"},children:"Filter Options"}),e.jsx(fe,{size:"small",onClick:Le,startIcon:e.jsx(gs,{}),sx:{textTransform:"none",color:"#ef4444"},children:"Clear Filters"})]}),e.jsxs(ae,{container:!0,spacing:2,children:[e.jsx(ae,{size:{xs:12,sm:6,md:3},children:e.jsx(bt,{fullWidth:!0,type:"date",size:"small",label:"Date",value:ne,onChange:s=>tt(s.target.value),InputLabelProps:{shrink:!0},sx:{backgroundColor:"white"}})}),e.jsx(ae,{size:{xs:12,sm:6,md:3},children:e.jsxs(Oe,{fullWidth:!0,size:"small",children:[e.jsx(Pt,{children:"All City Corporations"}),e.jsxs(Be,{value:N||"",onChange:s=>ye(s.target.value),label:"All City Corporations",children:[e.jsx(F,{value:"ALL",children:"All City Corporations"}),Z.map(s=>e.jsx(F,{value:s.code,children:s.name},s.id))]})]})}),e.jsx(ae,{size:{xs:12,sm:6,md:3},children:e.jsx(ms,{value:P,onChange:at,cityCorporationCode:N!=="ALL"?N:"",hideLabel:!1,label:"All Zones"})}),e.jsx(ae,{size:{xs:12,sm:6,md:3},children:e.jsxs(Oe,{fullWidth:!0,size:"small",children:[e.jsx(Pt,{children:"All Wards"}),e.jsxs(Be,{value:b||"",onChange:s=>lt(s.target.value?Number(s.target.value):null),label:"All Wards",displayEmpty:!0,children:[e.jsx(F,{value:"",children:"All Wards"}),D&&D.map(s=>e.jsxs(F,{value:s.id,children:["Ward ",s.wardNumber||s.id]},s.id))]})]})}),e.jsx(ae,{size:{xs:12,sm:6,md:3},children:e.jsx(ho,{value:M,onChange:rt})}),e.jsx(ae,{size:{xs:12,sm:6,md:3},children:e.jsx(po,{value:W,onChange:nt,categoryId:M,fullWidth:!0})}),e.jsx(ae,{size:{xs:12,sm:6,md:3},children:e.jsx(fo,{value:R,onChange:He,fullWidth:!0})}),e.jsx(ae,{size:{xs:12},children:e.jsx(bt,{fullWidth:!0,placeholder:"Search by ID, citizen name, or phone number...",value:T,onChange:Se,InputProps:{startAdornment:e.jsx(Ne,{position:"start",children:e.jsx(bs,{sx:{color:"text.secondary"}})})},size:"small",sx:{backgroundColor:"white","& .MuiOutlinedInput-root":{fontSize:"0.95rem"}}})})]})]})}),e.jsxs(y,{sx:{display:"flex",justifyContent:"flex-end",mb:2,gap:1},children:[e.jsx(fe,{startIcon:e.jsx(ks,{}),variant:"outlined",size:"small",sx:{color:"#1976d2",borderColor:"#1976d2"},children:"Download"}),e.jsx(fe,{startIcon:e.jsx(lo,{}),variant:"outlined",size:"small",sx:{color:"#9c27b0",borderColor:"#9c27b0"},children:"Print"})]}),!g&&!j&&e.jsx(Cs,{component:Mt,elevation:0,sx:{border:"1px solid #e0e0e0",borderRadius:2},children:e.jsxs(Ss,{sx:{minWidth:800},children:[e.jsx(ys,{sx:{backgroundColor:"#f9fafb"},children:e.jsxs(gt,{children:[e.jsx(V,{sx:{fontWeight:600},children:"Complaint No"}),e.jsx(V,{sx:{fontWeight:600},children:"Citizen Info"}),e.jsx(V,{sx:{fontWeight:600},children:"Location"}),e.jsx(V,{sx:{fontWeight:600},children:"Category"}),e.jsx(V,{sx:{fontWeight:600},children:"Status"}),e.jsx(V,{sx:{fontWeight:600},children:"Date"}),e.jsx(V,{align:"right",sx:{fontWeight:600},children:"Action"})]})}),e.jsx(js,{children:h.length===0?e.jsx(gt,{children:e.jsx(V,{colSpan:7,align:"center",sx:{py:8},children:e.jsx(S,{color:"text.secondary",children:"No complaints found"})})}):h.map(s=>e.jsxs(gt,{hover:!0,children:[e.jsx(V,{children:e.jsx(S,{variant:"body2",sx:{fontWeight:600,color:"#4CAF50"},children:s.trackingNumber||`C${String(s.id).padStart(6,"0")}`})}),e.jsx(V,{children:e.jsxs(y,{children:[e.jsxs(S,{variant:"body2",sx:{fontWeight:600},children:[s.user.firstName," ",s.user.lastName]}),e.jsx(S,{variant:"caption",color:"text.secondary",children:s.user.phone||"N/A"})]})}),e.jsx(V,{children:e.jsxs(y,{children:[e.jsx(S,{variant:"body2",children:s.location}),e.jsxs(S,{variant:"caption",color:"text.secondary",children:["Zone: ",typeof s.user.zone=="object"&&s.user.zone!==null?s.user.zone.name||s.user.zone.zoneNumber:s.user.zone||"N/A"," | Ward: ",typeof s.user.ward=="object"&&s.user.ward!==null?s.user.ward.wardNumber||s.user.ward.number:s.user.ward||"N/A"]})]})}),e.jsx(V,{children:e.jsxs(y,{children:[e.jsx(S,{variant:"body2",children:s.category||"N/A"}),e.jsx(S,{variant:"caption",color:"text.secondary",children:s.subcategory}),s.status==="REJECTED"&&s.othersSubcategory&&e.jsx(zt,{label:s.othersSubcategory,size:"small",sx:{mt:.5,backgroundColor:"#fff3cd",color:"#856404",fontSize:"0.7rem",height:20}})]})}),e.jsx(V,{children:e.jsx(zt,{label:C(s.status),size:"small",sx:{...i(s.status),fontWeight:500,borderRadius:1,height:24}})}),e.jsx(V,{children:e.jsx(S,{variant:"body2",children:new Date(s.createdAt).toLocaleDateString()})}),e.jsxs(V,{align:"right",children:[e.jsx(fe,{variant:"outlined",size:"small",startIcon:e.jsx(Es,{}),onClick:()=>ct(s),sx:{borderColor:"#e0e0e0",color:"text.primary",textTransform:"none",mr:1,"&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Chat"}),e.jsx(fe,{variant:"contained",size:"small",onClick:()=>it(s.id),sx:{backgroundColor:"#4CAF50",color:"white",textTransform:"none",boxShadow:"none","&:hover":{backgroundColor:"#45a049",boxShadow:"none"}},children:"View Details"})]})]},s.id))})]})}),g&&e.jsx(y,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ke,{})}),!g&&!j&&h.length>0&&L.total>0&&e.jsx(y,{sx:{mt:{xs:3,sm:4},mb:2,display:"flex",justifyContent:"center"},children:e.jsx(Os,{count:L.totalPages,page:L.page,onChange:ot,color:"primary",size:d?"small":"large",showFirstButton:!d,showLastButton:!d,siblingCount:d?0:1,boundaryCount:1,sx:{"& .MuiPaginationItem-root":{fontSize:{xs:"0.875rem",sm:"0.95rem"},"&.Mui-selected":{backgroundColor:"#4CAF50 !important",color:"white"}}}})})]}),e.jsx(Is,{complaintId:Ze,open:Je,onClose:_e,onStatusUpdate:a,onChatOpen:ut}),e.jsx(io,{complaintId:Qe,open:qe,onClose:dt,citizenName:ee,complaintTitle:le})]})};export{Mo as default};
