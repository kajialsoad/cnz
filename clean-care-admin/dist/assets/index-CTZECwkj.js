var Ms=Object.defineProperty;var Ls=(s,x,v)=>x in s?Ms(s,x,{enumerable:!0,configurable:!0,writable:!0,value:v}):s[x]=v;var ss=(s,x,v)=>Ls(s,typeof x!="symbol"?x+"":x,v);import{j as e,B as a,a$ as Rs,T as i,b as k,t as We,v as ze,i as ge,w as Le,x as Ee,J as ke,q as pe,D as Fs,h as ns,Q as qe,K as is,M as ls,O as ds,a7 as Os,ag as $s,aa as Zs,y as Re,z as cs,ad as qs,m as Ne,g as E,a2 as y,I as be,V as De,l as Ae,C as we,b0 as Us,b1 as xs,u as Vs,p as _s,az as Bs,A as Js,aB as Hs,e as ts,f as as,H as re,_ as Gs,$ as Ue,aw as Ve,a0 as Te,aH as Ks,aq as Qs,P as Ys,ar as Xs,as as et,at as Ie,au as C,n as rs,av as st,b2 as tt,b3 as at,b4 as rt,b5 as ot}from"./mui-vendor-BGNnUP5W.js";import{a as nt,r as n}from"./react-vendor-D7yrL1sD.js";import{u as Fe,f as it,a as ie,s as hs,b as ms,j as _e,d as Be,e as Je,k as fs,w as Me,A as lt,z as dt,U as ct,m as xt,M as ht,Z as mt}from"./index-BayLrfHP.js";import{f as ft}from"./format-BLLrCH_a.js";import{a as pt}from"./query-vendor-7qIgur5f.js";import{u as ye}from"./userManagementService-BGYBpBHq.js";import"./chart-vendor-DaOx9iI7.js";const gt=({icon:s,title:x,description:v,action:S})=>e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,px:3,textAlign:"center"},children:[e.jsx(a,{sx:{width:80,height:80,borderRadius:"50%",backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",mb:3},children:s||e.jsx(Rs,{sx:{fontSize:40,color:"#9e9e9e"}})}),e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:1},children:x}),v&&e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3,maxWidth:400},children:v}),S&&e.jsx(k,{variant:"contained",onClick:S.onClick,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3},children:S.label})]}),ut=({user:s,recentComplaints:x,open:v,onClose:S,onEdit:o})=>{var $,A,Z,b,L;const{user:r}=Fe();if(!s)return null;const m=P=>{switch(P){case"ACTIVE":return{backgroundColor:"#e8f5e8",color:"#2e7d2e"};case"INACTIVE":return{backgroundColor:"#f5f5f5",color:"#666666"};case"SUSPENDED":return{backgroundColor:"#ffebee",color:"#c62828"};case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},N=P=>{switch(P){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724"};case"REJECTED":return{backgroundColor:"#ffebee",color:"#c62828"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},p=P=>{if(!P)return"Never";try{return ft(new Date(P),"MMM dd, yyyy hh:mm a")}catch{return"Invalid date"}},B=s.statistics.totalComplaints>0?Math.round(s.statistics.resolvedComplaints/s.statistics.totalComplaints*100):0;return e.jsxs(We,{open:v,onClose:S,maxWidth:"md",fullWidth:!0,fullScreen:window.innerWidth<600,slotProps:{paper:{sx:{borderRadius:{xs:0,sm:2},animation:window.innerWidth<600?`${hs} ${ie.normal.duration} ${ie.smooth.timing}`:`${ms} ${ie.normal.duration} ${ie.smooth.timing}`,animationFillMode:"both",maxHeight:{xs:"100vh",sm:"90vh"}}},backdrop:{sx:{animation:`${it} ${ie.fast.duration} ${ie.fast.timing}`}}},children:[e.jsx(ze,{sx:{pb:{xs:1.5,sm:2}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600,fontSize:{xs:"1.25rem",sm:"1.5rem"}},children:"User Details"}),e.jsx(ge,{onClick:S,size:"small",children:e.jsx(Le,{})})]})}),e.jsxs(Ee,{dividers:!0,sx:{px:{xs:2,sm:3},py:{xs:2,sm:2}},children:[e.jsxs(a,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(a,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center",sm:"center"},gap:{xs:2,sm:3},mb:2},children:[e.jsxs(ke,{sx:{width:{xs:64,sm:80},height:{xs:64,sm:80},bgcolor:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2rem"},fontWeight:600},src:s.avatar||void 0,children:[s.firstName[0],s.lastName[0]]}),e.jsxs(a,{sx:{flex:1,textAlign:{xs:"center",sm:"left"},width:{xs:"100%",sm:"auto"}},children:[e.jsxs(i,{variant:"h6",sx:{fontWeight:600,mb:.5,fontSize:{xs:"1rem",sm:"1.25rem"}},children:[s.firstName," ",s.lastName]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{mb:1,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["User ID: #",s.id.toString().padStart(6,"0")]}),e.jsxs(a,{sx:{display:"flex",gap:1,justifyContent:{xs:"center",sm:"flex-start"},flexWrap:"wrap"},children:[e.jsx(pe,{label:s.status,size:"small",sx:{...m(s.status),..._e,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}}),e.jsx(pe,{label:s.role,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",..._e,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}})]})]})]}),e.jsx(Fs,{sx:{my:{xs:1.5,sm:2}}}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(ns,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Email"}),e.jsx(i,{variant:"body2",sx:{wordBreak:"break-word",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.email||"Not provided"})]}),s.emailVerified&&e.jsx(qe,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(is,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{sx:{flex:1},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Phone"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.phone})]}),s.phoneVerified&&e.jsx(qe,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(ls,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20},mt:.5}}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Location"}),s.cityCorporation&&e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:500},children:s.cityCorporation.name}),e.jsxs(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Ward ",(($=s.ward)==null?void 0:$.wardNumber)??"N/A"," â€¢ Zone ",((A=s.zone)==null?void 0:A.zoneNumber)??"N/A"]}),((Z=s.ward)==null?void 0:Z.inspectorName)&&e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Inspector: ",s.ward.inspectorName," ",s.ward.inspectorPhone?`(${s.ward.inspectorPhone})`:""]}),((b=s.zone)==null?void 0:b.officerName)&&e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Zonal Officer: ",s.zone.officerName," ",s.zone.officerPhone?`(${s.zone.officerPhone})`:""]}),s.address&&e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.8rem"},mt:.5,wordBreak:"break-word"},children:s.address})]})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(ds,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Joined"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:p(s.createdAt)})]})]})}),(r==null?void 0:r.role)==="MASTER_ADMIN"&&e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(qe,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Password"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontFamily:"monospace"},children:s.visiblePassword?e.jsx("span",{style:{color:"#2e7d32",fontWeight:"bold"},children:s.visiblePassword}):e.jsxs("span",{style:{color:"#666"},children:["Hash: ",(L=s.passwordHash)==null?void 0:L.substring(0,20),"... (Reset to see actual)"]})})]})]})})]})]}),e.jsxs(a,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Activity Statistics"}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#2196F3",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.totalComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Total Complaints"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.resolvedComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Resolved"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#FF9800",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.unresolvedComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Unresolved"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsxs(i,{variant:"h4",sx:{fontWeight:700,color:"#9C27B0",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:[B,"%"]}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Success Rate"})]})})]}),e.jsx(a,{sx:{mt:{xs:1.5,sm:2}},children:e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Last Login: ",p(s.lastLoginAt)]})})]}),e.jsxs(a,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Recent Complaints"}),x.length>0?e.jsx(Os,{sx:{p:0},children:x.map(P=>e.jsx(nt.Fragment,{children:e.jsx($s,{sx:{px:{xs:1.5,sm:2},py:{xs:1,sm:1.5},backgroundColor:"#f8f9fa",borderRadius:1,mb:1},children:e.jsx(Zs,{primary:e.jsxs(a,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},gap:{xs:.5,sm:1}},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:P.title}),e.jsx(pe,{label:P.status.replace("_"," "),size:"small",sx:{...N(P.status),..._e,height:{xs:18,sm:20},fontSize:{xs:"0.65rem",sm:"0.7rem"}}})]}),secondary:e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:p(P.createdAt)})})})},P.id))}):e.jsx(i,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:{xs:2,sm:3},fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"No complaints yet"})]})]}),e.jsxs(Re,{sx:{px:{xs:2,sm:3},py:{xs:1.5,sm:2},flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[e.jsx(k,{onClick:S,variant:"outlined",sx:{textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Close"}),e.jsx(k,{onClick:o,variant:"contained",startIcon:e.jsx(cs,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Edit User"})]})]})},jt=({open:s,title:x,message:v,confirmText:S="Confirm",cancelText:o="Cancel",onConfirm:r,onCancel:m,severity:N="warning"})=>{const p=()=>{switch(N){case"error":return"#d32f2f";case"warning":return"#ed6c02";case"info":return"#0288d1";default:return"#ed6c02"}};return e.jsxs(We,{open:s,onClose:m,maxWidth:"xs",fullWidth:!0,children:[e.jsx(ze,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"50%",backgroundColor:`${p()}20`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(qs,{sx:{color:p()}})}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:x})]})}),e.jsx(Ee,{children:e.jsx(i,{variant:"body1",color:"text.secondary",children:v})}),e.jsxs(Re,{sx:{px:3,pb:2},children:[e.jsx(k,{onClick:m,sx:{textTransform:"none",color:"text.secondary"},children:o}),e.jsx(k,{onClick:r,variant:"contained",sx:{textTransform:"none",backgroundColor:p(),"&:hover":{backgroundColor:p(),opacity:.9}},children:S})]})]})},Ct=({user:s,open:x,onClose:v,onSave:S})=>{const{user:o}=Fe(),[r,m]=n.useState({firstName:"",lastName:"",email:"",phone:"",address:"",cityCorporationCode:"",zoneId:"",wardId:"",status:"ACTIVE",newPassword:"",confirmPassword:""}),[N,p]=n.useState([]),[B,$]=n.useState([]),[A,Z]=n.useState([]),[b,L]=n.useState(!1),[P,se]=n.useState(!1),[W,X]=n.useState(!1),[T,te]=n.useState(!1),[R,j]=n.useState(!1),[f,ee]=n.useState({}),[I,H]=n.useState(!1),[le,de]=n.useState(null),[q,ue]=n.useState(!1);n.useEffect(()=>{ce()},[]),n.useEffect(()=>{r.cityCorporationCode?je(r.cityCorporationCode):($([]),Z([]),m(c=>({...c,zoneId:"",wardId:""})))},[r.cityCorporationCode]),n.useEffect(()=>{r.zoneId?xe(parseInt(r.zoneId)):(Z([]),m(c=>({...c,wardId:""})))},[r.zoneId]);const ce=async()=>{try{L(!0);const c=await Be.getCityCorporations("ACTIVE");p(c.cityCorporations||[])}catch(c){console.error("Error fetching city corporations:",c),p([])}finally{L(!1)}},je=async c=>{try{if(se(!0),(o==null?void 0:o.role)==="SUPER_ADMIN")try{const K=await Je.getAssignedZones(Number(o.id)),O=N.find(u=>u.code===c),oe=K.filter(u=>u.zone.cityCorporationCode===c).map(u=>({id:u.zone.id,zoneNumber:u.zone.zoneNumber,name:u.zone.name,cityCorporationId:(O==null?void 0:O.id)||0,status:"ACTIVE",createdAt:u.assignedAt,updatedAt:u.assignedAt}));$(oe);return}catch(K){console.error("Error fetching assigned zones:",K),$([]);return}const w=await fs.getZones({cityCorporationCode:c,status:"ACTIVE"});$(w.zones||[])}catch(w){console.error("Error fetching zones:",w),$([])}finally{se(!1)}},xe=async c=>{try{X(!0);const w=await Me.getWards({zoneId:c,status:"ACTIVE"});Z(w.wards||[])}catch(w){console.error("Error fetching wards:",w),Z([])}finally{X(!1)}};n.useEffect(()=>{var c,w,K,O,oe,u,ne;s&&(m({firstName:s.firstName,lastName:s.lastName,email:s.email||"",phone:s.phone,address:s.address||"",cityCorporationCode:((c=s.cityCorporation)==null?void 0:c.code)||"",zoneId:((K=(w=s.zone)==null?void 0:w.id)==null?void 0:K.toString())||"",wardId:((oe=(O=s.ward)==null?void 0:O.id)==null?void 0:oe.toString())||"",status:s.status,newPassword:"",confirmPassword:""}),ee({}),de(null),(u=s.cityCorporation)!=null&&u.code&&je(s.cityCorporation.code),(ne=s.zone)!=null&&ne.id&&xe(s.zone.id))},[s]);const he=c=>c?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c):!0,G=c=>/^01[0-9]{9}$/.test(c.replace(/\s+/g,"")),Ce=()=>{const c={};return r.firstName.trim()||(c.firstName="First name is required"),r.lastName.trim()||(c.lastName="Last name is required"),r.phone.trim()?G(r.phone)||(c.phone="Invalid phone format (must be 11 digits starting with 01)"):c.phone="Phone number is required",r.email&&!he(r.email)&&(c.email="Invalid email format"),r.cityCorporationCode||(c.cityCorporationCode="City Corporation is required"),r.zoneId||(c.zoneId="Zone is required"),r.wardId||(c.wardId="Ward is required"),(r.newPassword||r.confirmPassword)&&(r.newPassword.length<8&&(c.newPassword="Password must be at least 8 characters"),r.newPassword!==r.confirmPassword&&(c.confirmPassword="Passwords do not match")),ee(c),Object.keys(c).length===0},U=c=>w=>{const K=w.target.value;m(O=>({...O,[c]:K})),f[c]&&ee(O=>({...O,[c]:void 0})),le&&de(null)},l=async(c=!1)=>{var O,oe,u,ne,Q,ve,g,Y;if(!Ce())return;const w=r.status!==(s==null?void 0:s.status),K=r.status==="SUSPENDED"||r.status==="INACTIVE";if(w&&K&&!c){ue(!0);return}H(!0),de(null);try{const D={};r.firstName!==(s==null?void 0:s.firstName)&&(D.firstName=r.firstName),r.lastName!==(s==null?void 0:s.lastName)&&(D.lastName=r.lastName),r.email!==((s==null?void 0:s.email)||"")&&(D.email=r.email||void 0),r.phone!==(s==null?void 0:s.phone)&&(D.phone=r.phone),r.address!==((s==null?void 0:s.address)||"")&&(D.address=r.address||void 0),r.cityCorporationCode!==((O=s==null?void 0:s.cityCorporation)==null?void 0:O.code)&&(D.cityCorporationCode=r.cityCorporationCode),r.zoneId!==((u=(oe=s==null?void 0:s.zone)==null?void 0:oe.id)==null?void 0:u.toString())&&(D.zoneId=parseInt(r.zoneId)),r.wardId!==((Q=(ne=s==null?void 0:s.ward)==null?void 0:ne.id)==null?void 0:Q.toString())&&(D.wardId=parseInt(r.wardId)),r.status!==(s==null?void 0:s.status)&&(D.status=r.status),r.newPassword&&(D.password=r.newPassword),await S(D),v()}catch(D){console.error("Error updating user:",D),de(((Y=(g=(ve=D.response)==null?void 0:ve.data)==null?void 0:g.error)==null?void 0:Y.message)||D.message||"Failed to update user. Please try again.")}finally{H(!1)}},F=()=>{ue(!1),l(!0)},J=()=>{ue(!1)},z=()=>{I||v()};return s?e.jsxs(We,{open:x,onClose:z,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(ze,{sx:{pb:2},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Edit User"}),e.jsx(ge,{onClick:z,size:"small",disabled:I,children:e.jsx(Le,{})})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Update user information and account settings"})]}),e.jsxs(Ee,{dividers:!0,children:[le&&e.jsx(Ne,{severity:"error",sx:{mb:3},onClose:()=>de(null),children:le}),e.jsxs(a,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"First Name",value:r.firstName,onChange:U("firstName"),error:!!f.firstName,helperText:f.firstName,disabled:I,required:!0})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Last Name",value:r.lastName,onChange:U("lastName"),error:!!f.lastName,helperText:f.lastName,disabled:I,required:!0})})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Email",type:"email",value:r.email,onChange:U("email"),error:!!f.email,helperText:f.email,disabled:I})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Phone",value:r.phone,onChange:U("phone"),error:!!f.phone,helperText:f.phone,disabled:I,required:!0})})]}),e.jsx(a,{sx:{mb:2},children:e.jsx(E,{fullWidth:!0,label:"Address (à¦ à¦¿à¦•à¦¾à¦¨à¦¾)",value:r.address,onChange:U("address"),disabled:I,multiline:!0,rows:2,placeholder:"Enter full address"})}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(E,{fullWidth:!0,select:!0,label:"City Corporation",value:r.cityCorporationCode,onChange:U("cityCorporationCode"),disabled:I||b||(o==null?void 0:o.role)!=="MASTER_ADMIN",error:!!f.cityCorporationCode,helperText:f.cityCorporationCode,required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),N.map(c=>e.jsx(y,{value:c.code,children:c.name},c.code))]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(E,{fullWidth:!0,select:!0,label:"Zone",value:r.zoneId,onChange:U("zoneId"),disabled:I||P||!r.cityCorporationCode||(o==null?void 0:o.role)!=="MASTER_ADMIN",error:!!f.zoneId,helperText:f.zoneId||(r.cityCorporationCode?P?"Loading zones...":B.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select Zone"})}),B.map(c=>e.jsx(y,{value:c.id.toString(),children:c.name||`Zone ${c.zoneNumber}`},c.id))]})})]}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(E,{fullWidth:!0,select:!0,label:"Ward",value:r.wardId,onChange:U("wardId"),disabled:I||W||!r.zoneId||(o==null?void 0:o.role)!=="MASTER_ADMIN",error:!!f.wardId,helperText:f.wardId||(r.zoneId?W?"Loading wards...":A.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select Ward"})}),A.map(c=>e.jsxs(y,{value:c.id.toString(),children:["Ward ",typeof c.wardNumber=="object"?JSON.stringify(c.wardNumber):c.wardNumber]},c.id))]})})}),(o==null?void 0:o.role)==="MASTER_ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Change Password (Optional)"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"New Password",type:T?"text":"password",value:r.newPassword,onChange:U("newPassword"),error:!!f.newPassword,helperText:f.newPassword||"Leave blank to keep current password",disabled:I,slotProps:{input:{endAdornment:e.jsx(be,{position:"end",children:e.jsx(ge,{onClick:()=>te(!T),edge:"end",size:"small",children:T?e.jsx(De,{}):e.jsx(Ae,{})})})}}})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Confirm New Password",type:R?"text":"password",value:r.confirmPassword,onChange:U("confirmPassword"),error:!!f.confirmPassword,helperText:f.confirmPassword,disabled:I,slotProps:{input:{endAdornment:e.jsx(be,{position:"end",children:e.jsx(ge,{onClick:()=>j(!R),edge:"end",size:"small",children:R?e.jsx(De,{}):e.jsx(Ae,{})})})}}})})]})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Settings"}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(E,{fullWidth:!0,select:!0,label:"Status",value:r.status,onChange:U("status"),disabled:I,children:[e.jsx(y,{value:"ACTIVE",children:"Active"}),e.jsx(y,{value:"INACTIVE",children:"Inactive"}),e.jsx(y,{value:"SUSPENDED",children:"Suspended"}),e.jsx(y,{value:"PENDING",children:"Pending"})]})})})]})]}),e.jsxs(Re,{sx:{px:3,py:2},children:[e.jsx(k,{onClick:z,variant:"outlined",disabled:I,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(k,{onClick:()=>l(),variant:"contained",disabled:I,startIcon:I?e.jsx(we,{size:20}):e.jsx(Us,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:I?"Saving...":"Save Changes"})]}),e.jsx(jt,{open:q,title:r.status==="SUSPENDED"?"Suspend User":"Deactivate User",message:r.status==="SUSPENDED"?`Are you sure you want to suspend ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}? This will immediately block their access to the system.`:`Are you sure you want to deactivate ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}? They will not be able to access the system.`,confirmText:"Confirm",cancelText:"Cancel",severity:"warning",onConfirm:F,onCancel:J})]}):null},yt=({open:s,onClose:x,onSave:v})=>{const{user:S}=Fe(),[o,r]=n.useState({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),[m,N]=n.useState({}),[p,B]=n.useState(!1),[$,A]=n.useState(null),[Z,b]=n.useState(!1),[L,P]=n.useState(!1),[se,W]=n.useState([]),[X,T]=n.useState([]),[te,R]=n.useState([]),[j,f]=n.useState(!1),[ee,I]=n.useState(!1),[H,le]=n.useState(!1);n.useEffect(()=>{de()},[]),n.useEffect(()=>{o.cityCorporationCode?q(o.cityCorporationCode):(T([]),R([]),r(l=>({...l,zoneId:"",wardId:""})))},[o.cityCorporationCode]),n.useEffect(()=>{o.zoneId?ue(parseInt(o.zoneId)):(R([]),r(l=>({...l,wardId:""})))},[o.zoneId]);const de=async()=>{try{f(!0);const l=await Be.getCityCorporations("ACTIVE");W(l.cityCorporations||[])}catch(l){console.error("Error fetching city corporations:",l),W([]),A("Failed to load city corporations. Please try again.")}finally{f(!1)}},q=async l=>{try{if(I(!0),(S==null?void 0:S.role)==="SUPER_ADMIN")try{const J=await Je.getAssignedZones(Number(S.id)),z=se.find(w=>w.code===l),c=J.filter(w=>w.zone.cityCorporationCode===l).map(w=>({id:w.zone.id,zoneNumber:w.zone.zoneNumber,name:w.zone.name,cityCorporationId:(z==null?void 0:z.id)||0,status:"ACTIVE",createdAt:w.assignedAt,updatedAt:w.assignedAt}));T(c);return}catch(J){console.error("Error fetching assigned zones:",J),T([]);return}const F=await fs.getZones({cityCorporationCode:l,status:"ACTIVE"});T(F.zones||[])}catch(F){console.error("Error fetching zones:",F),T([])}finally{I(!1)}},ue=async l=>{try{le(!0);const F=await Me.getWards({zoneId:l,status:"ACTIVE"});R(F.wards||[])}catch(F){console.error("Error fetching wards:",F),R([])}finally{le(!1)}},ce=l=>l?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l):!0,je=l=>/^01[0-9]{9}$/.test(l.replace(/\s+/g,"")),xe=l=>l.length>=8,he=()=>{const l={};return o.firstName.trim()||(l.firstName="First name is required"),o.lastName.trim()||(l.lastName="Last name is required"),o.phone.trim()?je(o.phone)||(l.phone="Invalid phone format (must be 11 digits starting with 01)"):l.phone="Phone number is required",o.password?xe(o.password)||(l.password="Password must be at least 8 characters"):l.password="Password is required",o.confirmPassword?o.password!==o.confirmPassword&&(l.confirmPassword="Passwords do not match"):l.confirmPassword="Please confirm your password",o.cityCorporationCode||(l.cityCorporationCode="City Corporation is required"),o.zoneId||(l.zoneId="Zone is required"),o.wardId||(l.wardId="Ward is required"),o.email&&!ce(o.email)&&(l.email="Invalid email format"),N(l),Object.keys(l).length===0},G=l=>F=>{const J=F.target.value;r(z=>({...z,[l]:J})),m[l]&&N(z=>({...z,[l]:void 0})),$&&A(null)},Ce=async()=>{var l,F,J;if(he()){B(!0),A(null);try{const z={firstName:o.firstName,lastName:o.lastName,phone:o.phone,password:o.password,role:o.role};o.email&&(z.email=o.email),o.cityCorporationCode&&(z.cityCorporationCode=o.cityCorporationCode),o.zoneId&&(z.zoneId=parseInt(o.zoneId)),o.wardId&&(z.wardId=parseInt(o.wardId)),await v(z),r({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),x()}catch(z){console.error("Error creating user:",z),A(((J=(F=(l=z.response)==null?void 0:l.data)==null?void 0:F.error)==null?void 0:J.message)||z.message||"Failed to create user. Please try again.")}finally{B(!1)}}},U=()=>{p||(r({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),N({}),A(null),x())};return e.jsxs(We,{open:s,onClose:U,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(ze,{sx:{pb:2},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Add New User"}),e.jsx(ge,{onClick:U,size:"small",disabled:p,children:e.jsx(Le,{})})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create a new user account"})]}),e.jsxs(Ee,{dividers:!0,children:[$&&e.jsx(Ne,{severity:"error",sx:{mb:3},onClose:()=>A(null),children:$}),e.jsxs(a,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"First Name",value:o.firstName,onChange:G("firstName"),error:!!m.firstName,helperText:m.firstName,disabled:p,required:!0})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Last Name",value:o.lastName,onChange:G("lastName"),error:!!m.lastName,helperText:m.lastName,disabled:p,required:!0})})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Email",type:"email",value:o.email,onChange:G("email"),error:!!m.email,helperText:m.email||"Optional",disabled:p})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Phone",value:o.phone,onChange:G("phone"),error:!!m.phone,helperText:m.phone,disabled:p,required:!0})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Credentials"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Password",type:Z?"text":"password",value:o.password,onChange:G("password"),error:!!m.password,helperText:m.password||"Minimum 8 characters",disabled:p,required:!0,slotProps:{input:{endAdornment:e.jsx(be,{position:"end",children:e.jsx(ge,{onClick:()=>b(!Z),edge:"end",size:"small",children:Z?e.jsx(De,{}):e.jsx(Ae,{})})})}}})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(E,{fullWidth:!0,label:"Confirm Password",type:L?"text":"password",value:o.confirmPassword,onChange:G("confirmPassword"),error:!!m.confirmPassword,helperText:m.confirmPassword,disabled:p,required:!0,slotProps:{input:{endAdornment:e.jsx(be,{position:"end",children:e.jsx(ge,{onClick:()=>P(!L),edge:"end",size:"small",children:L?e.jsx(De,{}):e.jsx(Ae,{})})})}}})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(E,{fullWidth:!0,select:!0,label:"City Corporation",value:o.cityCorporationCode,onChange:G("cityCorporationCode"),disabled:p||j,error:!!m.cityCorporationCode,helperText:m.cityCorporationCode||"Required",required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),se.map(l=>e.jsx(y,{value:l.code,children:l.name},l.code))]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(E,{fullWidth:!0,select:!0,label:"Zone",value:o.zoneId,onChange:G("zoneId"),disabled:p||ee||!o.cityCorporationCode,error:!!m.zoneId,helperText:m.zoneId||(o.cityCorporationCode?ee?"Loading zones...":X.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select Zone"})}),X.map(l=>e.jsx(y,{value:l.id.toString(),children:l.name||`Zone ${l.zoneNumber}`},l.id))]})})]}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(E,{fullWidth:!0,select:!0,label:"Ward",value:o.wardId,onChange:G("wardId"),disabled:p||H||!o.zoneId,error:!!m.wardId,helperText:m.wardId||(o.zoneId?H?"Loading wards...":te.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select Ward"})}),te.map(l=>e.jsxs(y,{value:l.id.toString(),children:["Ward ",typeof l.wardNumber=="object"?JSON.stringify(l.wardNumber):l.wardNumber]},l.id))]})})})]})]}),e.jsxs(Re,{sx:{px:3,py:2},children:[e.jsx(k,{onClick:U,variant:"outlined",disabled:p,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(k,{onClick:Ce,variant:"contained",disabled:p,startIcon:p?e.jsx(we,{size:20}):e.jsx(xs,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:p?"Creating...":"Create User"})]})]})};class bt{constructor(){ss(this,"apiClient");this.apiClient=pt.create({baseURL:lt.BASE_URL,headers:{"Content-Type":"application/json"}}),this.apiClient.interceptors.request.use(x=>{const v=localStorage.getItem("accessToken");return v&&(x.headers.Authorization=`Bearer ${v}`),x})}async getConversation(x,v=1,S=50){try{return(await this.apiClient.get(`/api/admin/direct-chat/${x}`,{params:{page:v,limit:S}})).data.data}catch(o){throw o}}async sendMessage(x,v,S){try{return(await this.apiClient.post(`/api/admin/direct-chat/${x}`,{content:v,fileUrl:S})).data.data}catch(o){throw o}}}const os=new bt,wt=({userId:s,open:x,onClose:v,userName:S="User"})=>{const o=Vs(),r=_s(o.breakpoints.down("sm")),m=n.useRef(null),[N,p]=n.useState([]),[B,$]=n.useState(!1),[A,Z]=n.useState(null),[b,L]=n.useState(""),[P,se]=n.useState(!1),W=n.useCallback(()=>{m.current&&m.current.scrollIntoView({behavior:"smooth"})},[]);n.useEffect(()=>{x&&s&&X()},[x,s]),n.useEffect(()=>{W()},[N,W]);const X=async()=>{if(s)try{$(!0),Z(null);const j=await os.getConversation(s);p(j.messages||[])}catch(j){console.error(j),Z("Failed to load conversation")}finally{$(!1)}},T=async()=>{if(!(!s||!b.trim()))try{se(!0);const j=await os.sendMessage(s,b.trim());p(f=>[...f,j]),L(""),W()}catch(j){console.error(j),dt.error("Failed to send message")}finally{se(!1)}},te=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),T())},R=()=>{p([]),L(""),Z(null),v()};return e.jsxs(We,{open:x,onClose:R,maxWidth:"sm",fullWidth:!0,fullScreen:r,PaperProps:{sx:{borderRadius:r?0:2,height:r?"100vh":"80vh",maxHeight:r?"100vh":"80vh",display:"flex",flexDirection:"column",animation:r?`${hs} ${ie.normal.duration} ${ie.smooth.timing}`:`${ms} ${ie.normal.duration} ${ie.smooth.timing}`,animationFillMode:"both"}},children:[e.jsxs(ze,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ke,{sx:{width:40,height:40,bgcolor:"#2196F3"},children:e.jsx(Bs,{})}),e.jsxs(a,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:S}),e.jsx(i,{variant:"caption",color:"text.secondary",children:"Direct Message"})]})]}),e.jsx(ge,{onClick:R,size:"small",children:e.jsx(Le,{})})]}),e.jsxs(Ee,{sx:{flex:1,overflowY:"auto",p:2,bgcolor:"#f8f9fa",display:"flex",flexDirection:"column",gap:2},children:[B&&e.jsx(a,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(we,{})}),A&&e.jsx(Ne,{severity:"error",children:A}),!B&&!A&&N.length===0&&e.jsxs(a,{sx:{textAlign:"center",pt:4,opacity:.7},children:[e.jsx(i,{children:"No messages yet."}),e.jsx(i,{variant:"caption",children:"Start a conversation!"})]}),!B&&N.map(j=>{var ee,I,H;const f=((I=(ee=j.sender)==null?void 0:ee.role)==null?void 0:I.includes("ADMIN"))||j.senderType==="ADMIN";return e.jsx(a,{sx:{display:"flex",justifyContent:f?"flex-end":"flex-start"},children:e.jsxs(a,{sx:{maxWidth:"75%"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5,justifyContent:f?"flex-end":"flex-start"},children:[f&&e.jsx(Js,{sx:{fontSize:12,color:"success.main"}}),e.jsx(i,{variant:"caption",color:"text.secondary",children:f?"You":((H=j.sender)==null?void 0:H.firstName)||S})]}),e.jsx(a,{sx:{p:1.5,bgcolor:f?"primary.main":"white",color:f?"white":"text.primary",borderRadius:2,boxShadow:1},children:e.jsx(i,{variant:"body2",children:j.content||j.message})})]})},j.id)}),e.jsx("div",{ref:m})]}),e.jsx(a,{sx:{p:2,borderTop:"1px solid #e0e0e0",bgcolor:"white"},children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(E,{fullWidth:!0,size:"small",placeholder:"Type a message...",value:b,onChange:j=>L(j.target.value),onKeyPress:te,disabled:P,sx:{"& .MuiOutlinedInput-root":{borderRadius:3}}}),e.jsx(k,{variant:"contained",onClick:T,disabled:!b.trim()||P,sx:{minWidth:50,height:40,borderRadius:"50%"},children:P?e.jsx(we,{size:20,color:"inherit"}):e.jsx(Hs,{fontSize:"small"})})]})})]})},Pt=()=>{var Ye,Xe;const{user:s}=Fe(),[x,v]=n.useState([]),[S,o]=n.useState(!0),[r,m]=n.useState(null),[N,p]=n.useState(""),[B,$]=n.useState(""),[A,Z]=n.useState([]),[b,L]=n.useState(""),[P,se]=n.useState(null),[W,X]=n.useState(""),[T,te]=n.useState(null),[R,j]=n.useState([]),[f,ee]=n.useState(!1),[I,H]=n.useState(!1),[le,de]=n.useState([]),[q,ue]=n.useState(null),[ce,je]=n.useState(!0),[xe,he]=n.useState(null),[G,Ce]=n.useState([]),[U,l]=n.useState(!1),[F,J]=n.useState(!1),[z,c]=n.useState(!1),[w,K]=n.useState(!1),[O,oe]=n.useState(null),[u,ne]=n.useState([]),[Q,ve]=n.useState(ct.ACTIVE),[g,Y]=n.useState({page:1,limit:20,total:0}),[D,He]=n.useState({open:!1,message:"",severity:"success"}),[Oe,Ge]=n.useState({viewUser:null,statusChange:null});n.useEffect(()=>{const t=setTimeout(()=>{$(N)},500);return()=>clearTimeout(t)},[N]),n.useEffect(()=>{s&&(async()=>{var h,M;console.log("ðŸ”„ UserManagement: Starting data fetch for user:",s==null?void 0:s.id,s==null?void 0:s.role);const d=[Be.getCityCorporations("ACTIVE").catch(fe=>(console.error("âŒ Error fetching city corporations:",fe),{cityCorporations:[]}))];(s==null?void 0:s.role)==="SUPER_ADMIN"&&s.id&&(console.log("ðŸ‘¤ Fetching assigned zones for Super Admin:",s.id),d.push(Je.getAssignedZones(Number(s.id)).catch(fe=>(console.error("âŒ Error fetching assigned zones:",fe),[])))),ee(!0);try{const fe=await Promise.all(d),ks=fe[0],$e=fe[1];let Ze=ks.cityCorporations||[];if(console.log("ðŸ™ï¸ Fetched City Corps:",Ze.length),Z(Ze),s&&s.role!=="MASTER_ADMIN"){const V=s.cityCorporationCode||((h=s.cityCorporation)==null?void 0:h.code);V&&(console.log("ðŸŽ¯ Auto-selecting City Corp for assigned code:",V),Ze.some(ae=>ae.code===V)&&b!==V&&L(V))}if($e){console.log("ðŸ›¡ï¸ Raw Assigned Zones:",$e);const V=$e.map(_=>{const ae=_.zone||_;return!ae||!ae.id?null:{id:ae.id,zoneNumber:ae.zoneNumber,name:ae.name,cityCorporationId:ae.cityCorporationId||0,status:"ACTIVE",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}).filter(_=>_!==null);console.log("âœ… Formatted Assigned Zones:",V),de(V),V.length===1&&(console.log("ðŸ‘Œ Auto-selecting single zone:",V[0].id),X(V[0].id))}if((s==null?void 0:s.role)==="ADMIN"){console.log("ðŸ‘¤ Loading assigned wards for Admin");let V=[];if(s.permissions)try{const _=JSON.parse(s.permissions);_.wards&&Array.isArray(_.wards)&&(V=_.wards)}catch(_){console.error("Error parsing admin permissions:",_)}if(console.log(`ðŸ”’ ADMIN assigned ward IDs: [${V.join(", ")}]`),V.length>0)try{H(!0);const _=s.cityCorporationCode||((M=s.cityCorporation)==null?void 0:M.code);if(_){const ae=await Me.getWards({cityCorporationCode:_,status:"ACTIVE"});console.log("ðŸ“‹ All wards from API:",ae.wards);const es=ae.wards.filter(Ds=>V.includes(Ds.id));console.log("âœ… Filtered assigned wards:",es),j(es)}}catch(_){console.error("âŒ Error fetching assigned wards:",_),j([])}finally{H(!1)}else console.log("âš ï¸ ADMIN has no assigned wards"),j([])}}catch(fe){console.error("âŒ Error in UserManagement fetchData:",fe)}finally{ee(!1)}})()},[s]),n.useEffect(()=>{if(b!=="ALL"){const t=A.find(d=>d.code===b);t&&se(t.id)}else se(null),j([]);X(""),te(null)},[b,A]),n.useEffect(()=>{(s==null?void 0:s.role)!=="ADMIN"&&(W?ps(W):j([]),te(null))},[W,s]),n.useEffect(()=>{Pe()},[B,Q,b,W,T,g.page]),n.useEffect(()=>{Se()},[b,W,T]),n.useEffect(()=>{const t=setInterval(()=>{Se()},3e4);return()=>clearInterval(t)},[b,W,T]);const ps=async t=>{try{H(!0);const d=await Me.getWardsByZone(t,"ACTIVE");j(d)}catch(d){console.error("Error fetching wards:",d),me("Failed to load wards","error")}finally{H(!1)}},Pe=n.useCallback(async()=>{var t,d;try{o(!0),m(null);const h=await ye.getUsers({page:g.page,limit:g.limit,search:B||void 0,status:Q!=="ALL"?Q:void 0,role:"CUSTOMER",cityCorporationCode:b!=="ALL"?b:void 0,zoneId:W||void 0,wardId:T||void 0});v(h.users),Y(M=>({...M,total:h.pagination.total}))}catch(h){console.error("Error fetching users:",h),m(((d=(t=h.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to load users. Please try again."),me("Failed to load users","error")}finally{o(!1)}},[B,Q,b,W,T,g.page,g.limit]),Se=async()=>{try{je(!0);const t=await ye.getUserStatistics(b!=="ALL"?b:void 0,"CUSTOMER",W?Number(W):void 0,T?Number(T):void 0);ue(t)}catch(t){console.error("Error fetching statistics:",t)}finally{je(!1)}},gs=t=>{p(t),Y(d=>({...d,page:1}))},us=t=>{ve(t),Y(d=>({...d,page:1}))},Ke=()=>{p(""),ve("ALL"),L("ALL"),L("ALL"),X(""),te(null),Y(t=>({...t,page:1}))},js=async t=>{try{Ge(h=>({...h,viewUser:t}));const d=await ye.getUserById(t);he(d.user),Ce(d.recentComplaints||[]),l(!0)}catch(d){console.error("Error fetching user details:",d),me("Failed to load user details","error")}finally{Ge(d=>({...d,viewUser:null}))}},Cs=t=>{he(t),J(!0)},ys=()=>{c(!0)},bs=async t=>{var d,h;if(xe)try{await ye.updateUser(xe.id,t),me("User updated successfully","success"),J(!1),he(null),await Pe(),await Se()}catch(M){throw console.error("Error updating user:",M),me(((h=(d=M.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to update user","error"),M}},ws=async t=>{var d,h;try{await ye.createUser(t),me("User created successfully","success"),c(!1),await Pe(),await Se()}catch(M){throw console.error("Error creating user:",M),me(((h=(d=M.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to create user","error"),M}},vs=t=>{oe(t),K(!0)},Ss=()=>{K(!1),oe(null)},Is=async()=>{if(u.length!==0&&window.confirm(`Are you sure you want to delete ${u.length} users?`))try{await ye.bulkDeleteUsers(u),me("Users deleted successfully","success"),ne([]),Pe(),Se()}catch(t){me(t.message||"Failed to delete users","error")}},Ns=t=>{if(t.target.checked){const d=x.map(h=>h.id);ne(d);return}ne([])},As=t=>{const d=u.indexOf(t);let h=[];d===-1?h=h.concat(u,t):d===0?h=h.concat(u.slice(1)):d===u.length-1?h=h.concat(u.slice(0,-1)):d>0&&(h=h.concat(u.slice(0,d),u.slice(d+1))),ne(h)},me=(t,d)=>{He({open:!0,message:t,severity:d})},Qe=()=>{He(t=>({...t,open:!1}))},Ws=t=>t?t.startsWith("+")?t:t.length===11&&t.startsWith("0")?`+880 ${t.substring(1,5)}-${t.substring(5)}`:t:"N/A",zs=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Es=(t,d)=>{const h=typeof t=="string"?t:String(t||""),M=typeof d=="string"?d:String(d||"");return`${h.charAt(0)}${M.charAt(0)}`.toUpperCase()},Ps=()=>!q||q.totalComplaints===0?"0":(q.resolvedComplaints/q.totalComplaints*100).toFixed(0),Ts=[{title:"Total Citizens",value:ce?"...":String((q==null?void 0:q.totalCitizens)||0),color:"#2196F3"},{title:"Total Complaints",value:ce?"...":String((q==null?void 0:q.totalComplaints)||0),color:"#FF9800"},{title:"Resolved",value:ce?"...":String((q==null?void 0:q.resolvedComplaints)||0),color:"#4CAF50"},{title:"Success Rate",value:ce?"...":`${Ps()}%`,color:"#9C27B0"}];return e.jsx(xt,{children:e.jsxs(ht,{title:"User Management",children:[e.jsxs(a,{sx:{width:"100%",maxWidth:"100%",px:1.5,mx:0},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"h4",sx:{fontWeight:600,mb:.5,color:"text.primary"},children:"User Management"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Manage citizen accounts and information"})]}),((s==null?void 0:s.role)==="MASTER_ADMIN"||(s==null?void 0:s.role)==="SUPER_ADMIN"&&!((Xe=(Ye=s==null?void 0:s.permissions)==null?void 0:Ye.features)!=null&&Xe.viewOnlyMode))&&e.jsx(k,{variant:"contained",startIcon:e.jsx(xs,{}),onClick:ys,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3,py:1.5,borderRadius:2},children:"Add New User"})]}),e.jsx(a,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"repeat(4, 1fr)"},gap:2,mb:4},children:Ts.map((t,d)=>e.jsx(ts,{sx:{borderRadius:2,border:"1px solid #e0e0e0","&:hover":{boxShadow:2}},children:e.jsx(as,{sx:{p:3,textAlign:"center"},children:ce?e.jsxs(e.Fragment,{children:[e.jsx(re,{variant:"rectangular",width:"60%",height:48,sx:{mx:"auto",mb:1,borderRadius:1}}),e.jsx(re,{variant:"text",width:"80%",height:20,sx:{mx:"auto"}})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:t.color,mb:1},children:t.value}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:t.title})]})})},d))}),e.jsx(ts,{sx:{borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(as,{sx:{p:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,gap:2},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Citizen Directory"}),e.jsxs(a,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(E,{placeholder:"Search by name, email, or ward...",value:N,onChange:t=>gs(t.target.value),InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(Gs,{sx:{color:"text.secondary"}})})},sx:{width:300,"& .MuiOutlinedInput-root":{height:40,backgroundColor:"#f8f9fa"}}}),u.length>0&&e.jsxs(k,{variant:"outlined",color:"error",onClick:Is,sx:{ml:2,height:40},children:["Delete Selected (",u.length,")"]})]})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(Ue,{sx:{minWidth:200},children:[e.jsx(Ve,{id:"city-corporation-filter-label",sx:{top:-8},children:"City Corporation"}),e.jsxs(Te,{labelId:"city-corporation-filter-label",value:f?"":b,onChange:t=>L(t.target.value),label:"City Corporation",disabled:(s==null?void 0:s.role)==="ADMIN"||f||(s==null?void 0:s.role)!=="MASTER_ADMIN"&&A.length<=1,sx:{height:40,backgroundColor:"#f8f9fa"},displayEmpty:!0,renderValue:t=>{if(f)return e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{size:16}),e.jsx(i,{variant:"body2",children:"Loading..."})]});if(!t)return"Select City Corporation";if(t==="ALL")return"All City Corporations";const d=A.find(h=>h.code===t);return d?typeof d.name=="object"?JSON.stringify(d.name):d.name:t},children:[(s==null?void 0:s.role)==="MASTER_ADMIN"&&e.jsx(y,{value:"ALL",children:"All City Corporations"}),A&&A.map(t=>e.jsx(y,{value:t.code,children:typeof t.name=="object"?JSON.stringify(t.name):t.name},t.code))]})]}),(s==null?void 0:s.role)!=="ADMIN"&&e.jsx(a,{sx:{minWidth:200},children:e.jsx(mt,{value:W,onChange:t=>X(t),cityCorporationCode:b!=="ALL"?b:"",disabled:!1,zones:le.length>0?le:void 0})}),e.jsxs(Ue,{sx:{minWidth:200},children:[e.jsx(Ve,{id:"ward-filter-label",sx:{top:-8},children:"Ward"}),e.jsxs(Te,{labelId:"ward-filter-label",value:T||"",onChange:t=>te(t.target.value?Number(t.target.value):null),label:"Ward",disabled:(s==null?void 0:s.role)==="ADMIN"?I||!R||R.length===0:!W||I||!R||R.length===0,sx:{height:40,backgroundColor:"#f8f9fa"},children:[(s==null?void 0:s.role)!=="ADMIN"&&e.jsx(y,{value:"",children:"All Wards"}),R&&R.map(t=>e.jsxs(y,{value:t.id,children:["Ward ",typeof t.wardNumber=="object"?JSON.stringify(t.wardNumber):t.wardNumber]},t.id))]})]}),e.jsxs(Ue,{sx:{minWidth:150},children:[e.jsx(Ve,{id:"status-filter-label",sx:{top:-8},children:"Status"}),e.jsxs(Te,{labelId:"status-filter-label",value:Q,onChange:t=>us(t.target.value),label:"Status",startAdornment:e.jsx(be,{position:"start",children:e.jsx(Ks,{sx:{fontSize:18,color:"text.secondary"}})}),sx:{height:40,backgroundColor:"#f8f9fa"},children:[e.jsx(y,{value:"ALL",children:"All Status"}),e.jsx(y,{value:"ACTIVE",children:"Active"}),e.jsx(y,{value:"INACTIVE",children:"Inactive"}),e.jsx(y,{value:"SUSPENDED",children:"Suspended"}),e.jsx(y,{value:"PENDING",children:"Pending"})]})]}),(N||Q!=="ALL"||b!=="ALL"||W||T)&&e.jsx(k,{variant:"outlined",onClick:Ke,sx:{height:40,textTransform:"none",borderColor:"#e0e0e0",color:"text.secondary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Clear Filters"})]}),e.jsx(Qs,{component:Ys,elevation:0,children:e.jsxs(Xs,{sx:{minWidth:650},children:[e.jsx(et,{children:e.jsxs(Ie,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(C,{padding:"checkbox",children:e.jsx(rs,{indeterminate:u.length>0&&u.length<x.length,checked:x.length>0&&u.length===x.length,onChange:Ns})}),e.jsx(C,{sx:{fontWeight:600},children:"Citizen"}),e.jsx(C,{sx:{fontWeight:600},children:"Contact"}),e.jsx(C,{sx:{fontWeight:600},children:"City Corporation"}),e.jsx(C,{sx:{fontWeight:600},children:"Location"}),e.jsx(C,{sx:{fontWeight:600},children:"Complaints"}),e.jsx(C,{sx:{fontWeight:600},children:"Resolved"}),e.jsx(C,{sx:{fontWeight:600},children:"Unresolved"}),e.jsx(C,{sx:{fontWeight:600},children:"Join Date"}),e.jsx(C,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(st,{children:S?Array.from({length:5}).map((t,d)=>e.jsxs(Ie,{children:[e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})})]},d)):r?e.jsx(Ie,{children:e.jsx(C,{colSpan:9,children:e.jsx(Ne,{severity:"error",sx:{my:2},children:r})})}):x.length===0?e.jsx(Ie,{children:e.jsx(C,{colSpan:9,children:e.jsx(gt,{icon:N||Q!=="ALL"?e.jsx(tt,{sx:{fontSize:40,color:"#9e9e9e"}}):e.jsx(at,{sx:{fontSize:40,color:"#9e9e9e"}}),title:N||Q!=="ALL"?"No users found":"No users registered yet",description:N||Q!=="ALL"?"Try adjusting your search or filters to find what you're looking for.":"Users who register through the mobile app will appear here.",action:N||Q!=="ALL"?{label:"Clear Filters",onClick:Ke}:void 0})})}):x.map(t=>{var h,M;const d=u.indexOf(t.id)!==-1;return typeof t.ward=="object"&&t.ward!==null&&!("wardNumber"in t.ward)&&console.error("Suspicious Ward object found:",t.ward),typeof t.zone=="object"&&t.zone!==null&&!("zoneNumber"in t.zone)&&console.error("Suspicious Zone object found:",t.zone),e.jsxs(Ie,{hover:!0,selected:d,sx:{"&:hover":{backgroundColor:"#f8f9fa"}},children:[e.jsx(C,{padding:"checkbox",children:e.jsx(rs,{checked:d,onChange:()=>As(t.id)})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.avatar?e.jsx(ke,{src:t.avatar,sx:{width:40,height:40}}):e.jsx(ke,{sx:{width:40,height:40,bgcolor:"#4CAF50"},children:Es(t.firstName,t.lastName)}),e.jsxs(a,{children:[e.jsx(i,{variant:"body1",sx:{fontWeight:500},children:`${typeof t.firstName=="object"?JSON.stringify(t.firstName):t.firstName} ${typeof t.lastName=="object"?JSON.stringify(t.lastName):t.lastName}`}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["#",String(t.id).padStart(6,"0")]})]})]})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ns,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:typeof t.email=="object"?JSON.stringify(t.email):t.email||"N/A"})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(is,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:typeof t.phone=="object"?JSON.stringify(t.phone):Ws(t.phone)})]})]})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:typeof((h=t.cityCorporation)==null?void 0:h.name)=="object"?JSON.stringify(t.cityCorporation.name):((M=t.cityCorporation)==null?void 0:M.name)||"N/A"}),t.cityCorporation&&e.jsx(i,{variant:"caption",color:"text.secondary",children:typeof t.cityCorporation.code=="object"?JSON.stringify(t.cityCorporation.code):t.cityCorporation.code})]})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[t.zone?e.jsx(pe,{label:`Zone ${typeof t.zone.zoneNumber=="object"?JSON.stringify(t.zone.zoneNumber):t.zone.zoneNumber}${t.zone.name?` - ${typeof t.zone.name=="object"?JSON.stringify(t.zone.name):t.zone.name}`:""}`,size:"small",variant:"outlined",color:"primary",sx:{height:24,justifyContent:"flex-start"}}):null,t.ward?e.jsx(pe,{label:`Ward ${typeof t.ward.wardNumber=="object"?JSON.stringify(t.ward.wardNumber):t.ward.wardNumber}`,size:"small",variant:"outlined",sx:{height:24,justifyContent:"flex-start"}}):null,!t.zone&&!t.ward&&e.jsx(i,{variant:"caption",color:"text.secondary",children:"N/A"}),t.address&&e.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:.5,mt:.5},children:[e.jsx(ls,{sx:{fontSize:14,color:"text.secondary",mt:.2}}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem",lineHeight:1.3,maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:typeof t.address=="object"?JSON.stringify(t.address):t.address})]})]})}),e.jsx(C,{children:e.jsx(pe,{label:String(t.statistics.totalComplaints),sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}})}),e.jsx(C,{children:e.jsx(pe,{label:String(t.statistics.resolvedComplaints),sx:{backgroundColor:"#e8f5e8",color:"#2e7d2e",fontWeight:500}})}),e.jsx(C,{children:e.jsx(pe,{label:String(t.statistics.unresolvedComplaints),sx:{backgroundColor:"#ffebee",color:"#c62828",fontWeight:500}})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ds,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:zs(t.createdAt)})]})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[["MASTER_ADMIN","SUPER_ADMIN","ADMIN"].includes((s==null?void 0:s.role)||"")&&e.jsx(k,{variant:"outlined",size:"small",startIcon:Oe.viewUser===t.id?e.jsx(we,{size:16}):e.jsx(Ae,{}),onClick:()=>js(t.id),disabled:Oe.viewUser===t.id,sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:Oe.viewUser===t.id?"Loading...":"View"}),e.jsx(k,{variant:"outlined",size:"small",color:"primary",onClick:()=>vs(t),sx:{textTransform:"none",borderColor:"#e0e0e0",minWidth:"40px",color:"text.primary","&:hover":{borderColor:"#2196F3",color:"#2196F3"}},children:e.jsx(rt,{fontSize:"small"})}),e.jsx(k,{variant:"outlined",size:"small",startIcon:e.jsx(cs,{}),onClick:()=>Cs(t),sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Edit"})]})})]},t.id)})})]})}),!S&&!r&&x.length>0&&e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderTop:"1px solid #e0e0e0",flexWrap:"wrap",gap:2},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Showing ",(g.page-1)*g.limit+1," to"," ",Math.min(g.page*g.limit,g.total)," of"," ",g.total.toLocaleString()," users"]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Rows per page:"}),e.jsxs(Te,{value:g.limit,onChange:t=>Y(d=>({...d,limit:Number(t.target.value),page:1})),size:"small",sx:{minWidth:80},children:[e.jsx(y,{value:20,children:"20"}),e.jsx(y,{value:50,children:"50"}),e.jsx(y,{value:100,children:"100"}),e.jsx(y,{value:200,children:"200"})]})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(k,{size:"small",onClick:()=>Y(t=>({...t,page:1})),disabled:g.page===1,sx:{minWidth:"auto",px:1},children:"First"}),e.jsx(k,{size:"small",onClick:()=>Y(t=>({...t,page:t.page-1})),disabled:g.page===1,sx:{minWidth:"auto",px:1},children:"Previous"}),e.jsxs(i,{variant:"body2",sx:{mx:2},children:["Page ",g.page," of ",Math.ceil(g.total/g.limit)]}),e.jsx(k,{size:"small",onClick:()=>Y(t=>({...t,page:t.page+1})),disabled:g.page>=Math.ceil(g.total/g.limit),sx:{minWidth:"auto",px:1},children:"Next"}),e.jsx(k,{size:"small",onClick:()=>Y(t=>({...t,page:Math.ceil(g.total/g.limit)})),disabled:g.page>=Math.ceil(g.total/g.limit),sx:{minWidth:"auto",px:1},children:"Last"})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Go to:"}),e.jsx(E,{type:"number",size:"small",value:g.page,onChange:t=>{const d=parseInt(t.target.value),h=Math.ceil(g.total/g.limit);d>=1&&d<=h&&Y(M=>({...M,page:d}))},inputProps:{min:1,max:Math.ceil(g.total/g.limit),style:{textAlign:"center"}},sx:{width:80}})]})]})]})]})})]}),e.jsx(ut,{user:xe,recentComplaints:G,open:U,onClose:()=>{l(!1),he(null),Ce([])},onEdit:()=>{l(!1),J(!0)}}),e.jsx(Ct,{user:xe,open:F,onClose:()=>{J(!1),he(null)},onSave:bs}),e.jsx(yt,{open:z,onClose:()=>c(!1),onSave:ws}),O&&e.jsx(wt,{userId:O.id,userName:`${O.firstName} ${O.lastName}`,open:w,onClose:Ss}),e.jsx(ot,{open:D.open,autoHideDuration:6e3,onClose:Qe,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ne,{onClose:Qe,severity:D.severity,sx:{width:"100%"},children:D.message})})]})})};export{Pt as default};
