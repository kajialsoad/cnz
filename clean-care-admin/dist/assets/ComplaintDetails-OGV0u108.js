import{a as Rs,g as Ns,r as n,u as Es,j as e,s as ae,c as Ps,b as T,d as Ws,m as de,P as B,z as Qe,F as r,ah as zs,K as se,ai as As,ag as me,l as je,v as ds,D as ye,E as xs,T as o,I as M,H as re,J as hs,U as es,a7 as ss,V as rs,W as os,aj as ts,N as ve,ak as fs,al as Ts,L as ps,am as k,an as Ds,G as E,ao as Os,ap as Ls,aq as Ms,_ as Bs,w as K,a3 as xe,ar as Us,as as $s,Z as oe,M as as,at as le,au as Fs,X as is,Q,x as ns}from"./index-obvkHq0E.js";import{H as Gs,c as he,b as us,d as gs,I as bs,a as fe,A as _s,Z as Hs}from"./categoryService-CWluqlj-.js";import{A as ls,f as Vs}from"./dateUtils-DsEJrnF4.js";import{s as pe,b as ue}from"./toastUtils-D_6nG-GK.js";import{G as h}from"./Grid-DM8D4Ubi.js";import{C as Zs}from"./CloudUpload-Cwgg-NVo.js";import{D as qs}from"./Delete-wb0hXLnd.js";import{P as ge}from"./Person-B5nnbIPf.js";import{S as cs}from"./Send-ClfKfqo9.js";import"./styled-CPgIAkea.js";import"./useThemeProps-DyvIigua.js";function Js(a){return Rs("MuiImageListItemBar",a)}Ns("MuiImageListItemBar",["root","positionBottom","positionTop","positionBelow","actionPositionLeft","actionPositionRight","titleWrap","titleWrapBottom","titleWrapTop","titleWrapBelow","titleWrapActionPosLeft","titleWrapActionPosRight","title","subtitle","actionIcon","actionIconActionPosLeft","actionIconActionPosRight"]);const Xs=a=>{const{classes:i,position:s,actionIcon:f,actionPosition:y}=a,p={root:["root",`position${T(s)}`,`actionPosition${T(y)}`],titleWrap:["titleWrap",`titleWrap${T(s)}`,f&&`titleWrapActionPos${T(y)}`],title:["title"],subtitle:["subtitle"],actionIcon:["actionIcon",`actionIconActionPos${T(y)}`]};return Ws(p,Js,i)},Ys=ae("div",{name:"MuiImageListItemBar",slot:"Root",overridesResolver:(a,i)=>{const{ownerState:s}=a;return[i.root,i[`position${T(s.position)}`]]}})(de(({theme:a})=>({position:"absolute",left:0,right:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",fontFamily:a.typography.fontFamily,variants:[{props:{position:"bottom"},style:{bottom:0}},{props:{position:"top"},style:{top:0}},{props:{position:"below"},style:{position:"relative",background:"transparent",alignItems:"normal"}}]}))),Ks=ae("div",{name:"MuiImageListItemBar",slot:"TitleWrap",overridesResolver:(a,i)=>{const{ownerState:s}=a;return[i.titleWrap,i[`titleWrap${T(s.position)}`],s.actionIcon&&i[`titleWrapActionPos${T(s.actionPosition)}`]]}})(de(({theme:a})=>({flexGrow:1,padding:"12px 16px",color:(a.vars||a).palette.common.white,overflow:"hidden",variants:[{props:{position:"below"},style:{padding:"6px 0 12px",color:"inherit"}},{props:({ownerState:i})=>i.actionIcon&&i.actionPosition==="left",style:{paddingLeft:0}},{props:({ownerState:i})=>i.actionIcon&&i.actionPosition==="right",style:{paddingRight:0}}]}))),Qs=ae("div",{name:"MuiImageListItemBar",slot:"Title"})(de(({theme:a})=>({fontSize:a.typography.pxToRem(16),lineHeight:"24px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),er=ae("div",{name:"MuiImageListItemBar",slot:"Subtitle"})(de(({theme:a})=>({fontSize:a.typography.pxToRem(12),lineHeight:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),sr=ae("div",{name:"MuiImageListItemBar",slot:"ActionIcon",overridesResolver:(a,i)=>{const{ownerState:s}=a;return[i.actionIcon,i[`actionIconActionPos${T(s.actionPosition)}`]]}})({variants:[{props:{actionPosition:"left"},style:{order:-1}}]}),rr=n.forwardRef(function(i,s){const f=Es({props:i,name:"MuiImageListItemBar"}),{actionIcon:y,actionPosition:p="right",className:x,subtitle:v,title:c,position:C="bottom",...u}=f,m={...f,position:C,actionPosition:p},d=Xs(m);return e.jsxs(Ys,{ownerState:m,className:Ps(d.root,x),ref:s,...u,children:[e.jsxs(Ks,{ownerState:m,className:d.titleWrap,children:[e.jsx(Qs,{className:d.title,children:c}),v?e.jsx(er,{className:d.subtitle,children:v}):null]}),y?e.jsx(sr,{ownerState:m,className:d.actionIcon,children:y}):null]})}),L=({loading:a=!1,loadingText:i,children:s,disabled:f,startIcon:y,...p})=>e.jsx(B,{...p,disabled:f||a,startIcon:a?e.jsx(r,{sx:{display:"flex",alignItems:"center",animation:`${zs} 1s linear infinite`},children:e.jsx(se,{size:16,color:"inherit"})}):y,sx:{...p.sx,transition:`all ${Qe.fast.duration} ${Qe.fast.timing}`,"&:not(:disabled):hover":{transform:"translateY(-1px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},"&:not(:disabled):active":{transform:"translateY(0)"}},children:a&&i?i:s}),or=({categoryId:a,subcategoryId:i,size:s="small",showSubcategory:f=!0})=>{const[y,p]=n.useState(""),[x,v]=n.useState(""),[c,C]=n.useState("#808080"),[u,m]=n.useState(!0);if(n.useEffect(()=>{(async()=>{try{if(m(!0),!a||!i){p("Not Categorized"),v(""),C("#f5f5f5"),m(!1);return}try{const[I,R,W]=await Promise.all([he.getCategoryName(a,"en").catch(()=>"Unknown Category"),he.getSubcategoryName(a,i,"en").catch(()=>"Unknown"),he.getCategoryColor(a).catch(()=>"#808080")]);p(I),v(R),C(W)}catch(I){console.error("Error fetching category details:",I),p("Unknown"),v("Unknown"),C("#808080")}}catch(I){console.error("Error fetching category info:",I),p("Unknown"),v("Unknown"),C("#808080")}finally{m(!1)}})()},[a,i]),u)return e.jsx(As,{variant:"rectangular",width:120,height:s==="small"?24:32,sx:{borderRadius:2}});const d=f&&x?`${y} - ${x}`:y,j=!a||!i;return e.jsx(me,{label:d,size:s,icon:j?e.jsx(Gs,{sx:{fontSize:16}}):void 0,sx:{backgroundColor:j?"#f5f5f5":c,color:j?"#757575":"#fff",border:j?"1px dashed #bdbdbd":"none",fontWeight:500,fontSize:s==="small"?"0.75rem":"0.875rem",height:s==="small"?24:32,"& .MuiChip-label":{px:1.5},"& .MuiChip-icon":{color:j?"#757575":"inherit",marginLeft:1},boxShadow:j?"none":"0 1px 3px rgba(0,0,0,0.12)"}})},be={CORPORATION_INTERNAL:{label:"Corporation Internal",description:"Issues within city corporation jurisdiction handled by specific departments"},CORPORATION_EXTERNAL:{label:"Corporation External",description:"Issues outside city corporation jurisdiction handled by external agencies"}},tr={CORPORATION_INTERNAL:["Engineering","Electricity","Health","Property (Eviction)"],CORPORATION_EXTERNAL:["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"]},ar=({open:a,onClose:i,onConfirm:s,loading:f=!1})=>{const y=je(),p=ds(y.breakpoints.down("sm")),[x,v]=n.useState(""),[c,C]=n.useState(""),[u,m]=n.useState(""),[d,j]=n.useState({category:!1,subCategory:!1}),U=g=>{v(g),C(""),j({...d,category:!0,subCategory:!1})},I=()=>{if(!x){j({...d,category:!0});return}if(!c){j({...d,subCategory:!0});return}s(x,c,u||void 0)},R=()=>{f||(v(""),C(""),m(""),j({category:!1,subCategory:!1}),i())},W=x?tr[x]||[]:[];return e.jsxs(ye,{open:a,onClose:R,maxWidth:"sm",fullWidth:!0,fullScreen:p,PaperProps:{sx:{borderRadius:p?0:2}},children:[e.jsxs(xs,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:"Mark as Others"}),e.jsx(M,{onClick:R,disabled:f,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(re,{})})]}),e.jsx(hs,{sx:{pt:3,pb:2},children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,children:e.jsxs(es,{fullWidth:!0,error:d.category&&!x,required:!0,children:[e.jsx(ss,{children:"Select Category"}),e.jsx(rs,{value:x,label:"Select Category",onChange:g=>U(g.target.value),disabled:f,children:Object.keys(be).map(g=>e.jsx(os,{value:g,children:e.jsxs(r,{children:[e.jsx(o,{variant:"body1",children:be[g].label}),e.jsx(o,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:be[g].description})]})},g))}),d.category&&!x&&e.jsx(ts,{children:"Please select a category"})]})}),x&&W.length>0&&e.jsx(h,{item:!0,xs:12,children:e.jsxs(es,{fullWidth:!0,error:d.subCategory&&!c,required:!0,children:[e.jsx(ss,{children:"Select Department/Agency"}),e.jsx(rs,{value:c,label:"Select Department/Agency",onChange:g=>{C(g.target.value),j({...d,subCategory:!0})},disabled:f,children:W.map(g=>e.jsx(os,{value:g,children:g},g))}),d.subCategory&&!c&&e.jsx(ts,{children:"Please select a department/agency"})]})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(ve,{fullWidth:!0,label:"Note (Optional)",multiline:!0,rows:3,value:u,onChange:g=>m(g.target.value),disabled:f,placeholder:"Add any additional notes about this categorization...",helperText:`${u.length}/500 characters`,inputProps:{maxLength:500}})}),x&&e.jsx(h,{item:!0,xs:12,children:e.jsx(r,{sx:{p:2,bgcolor:"info.lighter",borderRadius:1,border:"1px solid",borderColor:"info.light"},children:e.jsxs(o,{variant:"body2",color:"info.dark",children:[e.jsx("strong",{children:"Note:"}),' This complaint will be marked as "Others" and categorized under'," ",e.jsx("strong",{children:x==="CORPORATION_INTERNAL"?"Corporation Internal":"Corporation External"}),c&&e.jsxs(e.Fragment,{children:[" - ",e.jsx("strong",{children:c})]}),". The user will be notified of this status change."]})})})]})}),e.jsxs(fs,{sx:{borderTop:"1px solid #e0e0e0",px:3,py:2,gap:1.5,flexDirection:{xs:"column-reverse",sm:"row"},"& > button":{width:{xs:"100%",sm:"auto"},minHeight:{xs:48,sm:36}}},children:[e.jsx(B,{onClick:R,disabled:f,color:"inherit",variant:"outlined",children:"Cancel"}),e.jsx(B,{onClick:I,variant:"contained",color:"primary",disabled:f||!x||!c,children:f?"Marking...":"Mark as Others"})]})]})},ee=5,ir=5*1024*1024,nr=["image/jpeg","image/jpg","image/png","image/webp"],ce=20,te=500,lr=({open:a,complaintId:i,status:s,onClose:f,onSuccess:y})=>{const p=je(),x=ds(p.breakpoints.down("sm")),v=n.useRef(null),[c,C]=n.useState(""),[u,m]=n.useState([]),[d,j]=n.useState(!1),[U,I]=n.useState(""),[R,W]=n.useState({note:!1,images:!1}),[g,H]=n.useState(!1),P=s==="RESOLVED",D=P,O=P,V=R.note&&D&&c.length<ce?`Resolution note must be at least ${ce} characters`:R.note&&c.length>te?`Resolution note must not exceed ${te} characters`:"",$=R.images&&O&&u.length===0?"At least one image is required for resolved status":u.length>ee?`Maximum ${ee} images allowed`:"",Z=()=>!(D&&(c.length<ce||c.length>te)||O&&u.length===0||u.length>ee),q=n.useCallback(l=>{if(!l)return;const S=[],w=[];Array.from(l).forEach(N=>{if(!nr.includes(N.type)){w.push(`${N.name}: Invalid file type. Only JPEG, PNG, and WebP are allowed.`);return}if(N.size>ir){w.push(`${N.name}: File size exceeds 5MB limit.`);return}if(u.length+S.length>=ee){w.push(`Maximum ${ee} images allowed.`);return}const X=URL.createObjectURL(N);S.push({file:N,preview:X})}),w.length>0&&(I(w.join(" ")),setTimeout(()=>I(""),5e3)),S.length>0&&(m(N=>[...N,...S]),W({...R,images:!0}))},[u.length,R]),F=l=>{q(l.target.files),v.current&&(v.current.value="")},J=n.useCallback(l=>{l.preventDefault(),l.stopPropagation(),l.type==="dragenter"||l.type==="dragover"?H(!0):l.type==="dragleave"&&H(!1)},[]),G=n.useCallback(l=>{l.preventDefault(),l.stopPropagation(),H(!1),l.dataTransfer.files&&l.dataTransfer.files.length>0&&q(l.dataTransfer.files)},[q]),ie=l=>{m(S=>{const w=[...S];return URL.revokeObjectURL(w[l].preview),w.splice(l,1),w})},_=async()=>{if(W({note:!0,images:!0}),!!Z()){j(!0),I("");try{const l=new FormData;l.append("status",s),c.trim()&&l.append("resolutionNote",c.trim()),u.forEach(X=>{l.append("resolutionImages",X.file)});const S=localStorage.getItem("accessToken");if(!S)throw new Error("Authentication token not found");const w=await fetch(`https://munna-production.up.railway.app/api/admin/complaints/${i}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${S}`},body:l}),N=await w.json();if(!w.ok)throw new Error(N.message||"Failed to update complaint status");y(),z()}catch(l){console.error("Error updating status:",l),I(l.message||"Failed to update complaint status")}finally{j(!1)}}},z=()=>{d||(u.forEach(l=>{URL.revokeObjectURL(l.preview)}),C(""),m([]),I(""),W({note:!1,images:!1}),H(!1),f())};return e.jsxs(ye,{open:a,onClose:z,maxWidth:"md",fullWidth:!0,fullScreen:x,PaperProps:{sx:{borderRadius:x?0:2}},children:[e.jsxs(xs,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(o,{variant:"h6",sx:{fontWeight:600},children:["Mark as ",s==="RESOLVED"?"Resolved":"In Progress"]}),e.jsx(M,{onClick:z,disabled:d,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(re,{})})]}),e.jsxs(hs,{sx:{pt:3,pb:2},children:[d&&e.jsx(Ts,{sx:{mb:2}}),U&&e.jsx(ps,{severity:"error",sx:{mb:2},onClose:()=>I(""),children:U}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsxs(h,{item:!0,xs:12,children:[e.jsxs(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:["Upload Images ",O&&e.jsx("span",{style:{color:p.palette.error.main},children:"*"})]}),e.jsx(o,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:2},children:O?"At least 1 image required, maximum 5 images, 5MB each":"Optional: Maximum 5 images, 5MB each"}),e.jsxs(r,{onDragEnter:J,onDragLeave:J,onDragOver:J,onDrop:G,sx:{border:"2px dashed",borderColor:g?"primary.main":$?"error.main":"#ccc",borderRadius:2,p:3,textAlign:"center",bgcolor:g?"action.hover":"background.paper",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:"primary.main",bgcolor:"action.hover"}},onClick:()=>{var l;return(l=v.current)==null?void 0:l.click()},children:[e.jsx("input",{ref:v,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:F,style:{display:"none"},disabled:d}),e.jsx(Zs,{sx:{fontSize:48,color:"text.secondary",mb:1}}),e.jsx(o,{variant:"body1",color:"text.secondary",children:"Drag & drop images here, or click to select"}),e.jsx(o,{variant:"caption",color:"text.secondary",children:"JPEG, PNG, WebP (max 5MB each)"})]}),$&&e.jsx(o,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:$}),u.length>0&&e.jsxs(r,{sx:{mt:2},children:[e.jsx(us,{sx:{width:"100%",height:"auto"},cols:x?2:3,gap:8,children:u.map((l,S)=>e.jsxs(gs,{children:[e.jsx("img",{src:l.preview,alt:`Preview ${S+1}`,loading:"lazy",style:{height:150,objectFit:"cover",borderRadius:8}}),e.jsx(rr,{sx:{background:"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0) 100%)",borderRadius:"8px 8px 0 0"},position:"top",actionIcon:e.jsx(M,{sx:{color:"white"},onClick:w=>{w.stopPropagation(),ie(S)},disabled:d,children:e.jsx(qs,{})}),actionPosition:"right"})]},S))}),e.jsxs(o,{variant:"caption",color:"text.secondary",sx:{mt:1},children:[u.length," / ",ee," images selected"]})]})]}),e.jsx(h,{item:!0,xs:12,children:e.jsx(ve,{fullWidth:!0,label:`Resolution Note ${D?"*":"(Optional)"}`,multiline:!0,rows:4,value:c,onChange:l=>{C(l.target.value),W({...R,note:!0})},disabled:d,placeholder:P?"Describe how the complaint was resolved...":"Add any notes about the progress...",error:!!V,helperText:V||`${c.length}/${te} characters${D?` (minimum ${ce})`:""}`,inputProps:{maxLength:te},required:D})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(r,{sx:{p:2,bgcolor:P?"success.lighter":"info.lighter",borderRadius:1,border:"1px solid",borderColor:P?"success.light":"info.light"},children:e.jsxs(o,{variant:"body2",color:P?"success.dark":"info.dark",children:[e.jsx("strong",{children:"Note:"})," ",P?e.jsxs(e.Fragment,{children:["This complaint will be marked as ",e.jsx("strong",{children:"Resolved"}),". The user will receive a notification with your resolution images and notes. They will be able to submit a review after viewing the resolution."]}):e.jsxs(e.Fragment,{children:["This complaint will be marked as ",e.jsx("strong",{children:"In Progress"}),". The user will receive a notification that their complaint is being processed."]})]})})})]})]}),e.jsxs(fs,{sx:{borderTop:"1px solid #e0e0e0",px:3,py:2,gap:1.5,flexDirection:{xs:"column-reverse",sm:"row"},"& > button":{width:{xs:"100%",sm:"auto"},minHeight:{xs:48,sm:36}}},children:[e.jsx(B,{onClick:z,disabled:d,color:"inherit",variant:"outlined",children:"Cancel"}),e.jsx(B,{onClick:_,variant:"contained",color:P?"success":"primary",disabled:d||!Z(),startIcon:d?void 0:e.jsx(bs,{}),children:d?"Updating...":P?"Mark as Resolved":"Mark as In Progress"})]})]})},cr=({review:a})=>{const i=je(),s=`${a.user.firstName} ${a.user.lastName}`,f=(p,x)=>`${p.charAt(0)}${x.charAt(0)}`.toUpperCase(),y=p=>{try{const x=new Date(p);return Ls(x,{addSuffix:!0})}catch{return"Recently"}};return e.jsx(k,{sx:{mb:2,boxShadow:i.shadows[1],transition:"box-shadow 0.3s ease","&:hover":{boxShadow:i.shadows[3]},borderRadius:2},children:e.jsx(Ds,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(E,{src:a.user.avatar||void 0,alt:s,sx:{width:48,height:48,bgcolor:i.palette.primary.main,fontSize:"1rem",fontWeight:600},children:f(a.user.firstName,a.user.lastName)}),e.jsxs(r,{sx:{flex:1,minWidth:0},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:i.palette.text.primary,mb:.5},children:s}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Os,{value:a.rating,readOnly:!0,precision:1,size:"small",sx:{color:i.palette.warning.main}}),e.jsxs(o,{variant:"body2",sx:{color:i.palette.text.secondary,fontWeight:500},children:["(",a.rating," ",a.rating===1?"star":"stars",")"]})]}),a.comment&&e.jsxs(o,{variant:"body2",sx:{color:i.palette.text.secondary,mb:1,lineHeight:1.6,fontStyle:"italic",wordBreak:"break-word"},children:['"',a.comment,'"']}),e.jsx(o,{variant:"caption",sx:{color:i.palette.text.disabled,display:"block"},children:y(a.createdAt)})]})]})})})},vr=()=>{var Ie,we,Se,ke,Re,Ne,Ee,Pe,We,ze,Ae,Te,De,Oe,Le,Me,Be,Ue,$e,Fe,Ge,_e,He,Ve,Ze,qe,Je,Xe,Ye,Ke;const{id:a}=Ms(),i=Bs();n.useRef(null);const[s,f]=n.useState(null),[y,p]=n.useState(!0),[x,v]=n.useState(null),[c,C]=n.useState(!1),[u,m]=n.useState(null),[d,j]=n.useState(!1),[U,I]=n.useState(!1),[R,W]=n.useState("IN_PROGRESS"),[g,H]=n.useState([]),[P,D]=n.useState(!1),O=n.useRef(null),[V,$]=n.useState([]),[Z,q]=n.useState(!1),[F,J]=n.useState(""),[G,ie]=n.useState(!1),[_,z]=n.useState(null),[l,S]=n.useState(!1),w=()=>{const t=[];return t.push({id:1,action:"Complaint Submitted",date:new Date((s==null?void 0:s.createdAt)||"").toLocaleString("en-US"),description:"The complaint has been successfully submitted"}),s!=null&&s.status&&s.status!=="PENDING"&&t.push({id:2,action:s.status==="IN_PROGRESS"?"In Progress":s.status==="RESOLVED"?"Resolved":"Rejected",date:new Date((s==null?void 0:s.updatedAt)||"").toLocaleString("en-US"),description:s.status==="IN_PROGRESS"?"The complaint is now in progress":s.status==="RESOLVED"?"The complaint has been resolved":"The complaint has been rejected"}),t},N=n.useCallback(()=>{O.current&&O.current.scrollIntoView({behavior:"smooth"})},[]);n.useEffect(()=>{a&&(X(),vs(),ms())},[a]);const X=async()=>{try{p(!0),v(null);const t=await fe.getComplaintById(Number(a));f(t)}catch(t){console.error("Error fetching complaint details:",t),v("Failed to load complaint details"),pe("Failed to load complaint details")}finally{p(!1)}},ms=async()=>{if(a)try{D(!0);const t=await fetch(`/api/complaints/${a}/reviews`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const b=await t.json();H(b.data||[])}}catch(t){console.error("Error fetching reviews:",t)}finally{D(!1)}},js=async(t,b,ne)=>{if(s)try{C(!0);const A=await fe.markComplaintAsOthers(s.id,{othersCategory:t,othersSubcategory:b,note:ne});f(A),j(!1),ue("Marked as others successfully")}catch(A){console.error("Error updating status:",A),pe("Failed to update status")}finally{C(!1)}},ys=async()=>{await X(),I(!1),ue("Status updated successfully")},Y=async t=>{if(s){if(t==="RESOLVED"||t==="IN_PROGRESS"){W(t),I(!0);return}try{C(!0);const b=await fe.updateComplaintStatus(s.id,{status:t});f(b),ue("Status updated successfully")}catch(b){console.error("Error updating status:",b),pe("Failed to update status")}finally{C(!1)}}},vs=async()=>{if(a)try{q(!0);const{messages:t}=await K.getChatMessages(Number(a));$(t),await K.markAsRead(Number(a))}catch(t){console.error("Error fetching chat messages:",t)}finally{q(!1)}};n.useEffect(()=>{N()},[V,N]),n.useEffect(()=>{if(a)return K.startPolling(Number(a),t=>{$(t)}),()=>{K.stopPolling(Number(a))}},[a]);const Ce=async()=>{if(!(!a||!F.trim()&&!_))try{ie(!0);let t;_?t=await K.sendMessageWithFile(Number(a),F.trim()||"Image",_.file):t=await K.sendMessage(Number(a),{message:F.trim()}),$(b=>[...b,t]),J(""),z(null),N(),Q.success("Message sent successfully",{icon:"âœ…"})}catch(t){const b=ns(t);Q.error(b.userMessage,{duration:5e3,icon:"âŒ"})}finally{ie(!1)}},Cs=async t=>{var ne;const b=(ne=t.target.files)==null?void 0:ne[0];if(b){if(!b.type.startsWith("image/")){Q.error("Please select an image file",{icon:"âŒ"});return}if(b.size>5*1024*1024){Q.error("Image size must be less than 5MB",{icon:"âŒ"});return}try{S(!0);const A=new FileReader;A.onloadend=()=>{z({file:b,preview:A.result})},A.readAsDataURL(b),Q.success("Image ready to send",{icon:"âœ…"})}catch(A){const ks=ns(A);Q.error(ks.userMessage,{icon:"âŒ"}),z(null)}finally{S(!1)}}},Is=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),Ce())},ws=t=>{switch(t){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724"};case"REJECTED":return{backgroundColor:"#f8d7da",color:"#721c24"};default:return{backgroundColor:"#f8f9fa",color:"#6c757d"}}},Ss=t=>{switch(t){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Solved";case"REJECTED":return"Others";default:return t}};return y?e.jsx(xe,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(se,{size:60,sx:{color:"#4CAF50"}})})}):x||!s?e.jsx(xe,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:e.jsxs(r,{sx:{p:3},children:[e.jsx(ps,{severity:"error",sx:{mb:2},children:x||"Complaint not found"}),e.jsx(B,{variant:"outlined",startIcon:e.jsx(ls,{}),onClick:()=>i("/complaints"),children:"Back to Complaints"})]})}):e.jsxs(xe,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:[e.jsxs(r,{sx:{p:{xs:2,md:3},maxWidth:1400,mx:"auto",backgroundColor:"#f9fafb",minHeight:"100vh"},children:[e.jsx(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:e.jsxs(r,{sx:{p:{xs:2,md:2.5}},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(M,{onClick:()=>i("/complaints"),sx:{color:"#3fa564",backgroundColor:"#f0fdf4","&:hover":{backgroundColor:"#dcfce7"},width:40,height:40},children:e.jsx(ls,{})}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(o,{variant:"h5",sx:{fontWeight:700,color:"#1e2939",fontSize:{xs:"1.25rem",md:"1.5rem"},mb:.5},children:["à¦…à¦­à¦¿à¦¯à§‹à¦— #",s.trackingNumber||`CC-${String(s.id).padStart(7,"0")}`]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Us,{sx:{fontSize:16,color:"#6b7280"}}),e.jsx(o,{variant:"body2",sx:{color:"#6b7280",fontSize:"0.875rem"},children:new Date(s.createdAt).toLocaleDateString("bn-BD")})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_s,{sx:{fontSize:16,color:"#6b7280"}}),e.jsx(o,{variant:"body2",sx:{color:"#6b7280",fontSize:"0.875rem"},children:Vs(s.createdAt)})]})]})]}),e.jsx(me,{label:Ss(s.status),sx:{...ws(s.status),fontWeight:600,fontSize:"0.875rem",height:32,px:2,borderRadius:2}})]}),s.category&&e.jsx(r,{sx:{mt:2},children:e.jsx(or,{categoryId:s.category,subcategoryId:s.subcategory})})]})}),e.jsxs(h,{container:!0,spacing:2.5,children:[e.jsxs(h,{size:{xs:12,md:7},children:[e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¸à§à¦¤à¦¾à¦°à¦¿à¦¤"})}),e.jsxs(r,{sx:{p:3},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:2,color:"#1e2939"},children:s.title}),e.jsx(h,{container:!0,spacing:2,sx:{mb:3},children:e.jsx(h,{size:{xs:12},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(E,{sx:{width:32,height:32,bgcolor:"#f0fdf4",color:"#3fa564"},children:e.jsx($s,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦²à§‹à¦•à§‡à¦¶à¦¨"}),e.jsx(o,{variant:"body1",sx:{color:"#1e2939"},children:s.location})]})]})})}),e.jsxs(r,{sx:{backgroundColor:"#f9fafb",p:2.5,borderRadius:2,border:"1px solid #f3f4f6"},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,mb:1,color:"#374151"},children:"à¦¬à¦¿à¦¬à¦°à¦£:"}),e.jsx(o,{variant:"body2",sx:{whiteSpace:"pre-wrap",color:"#4b5563",lineHeight:1.6},children:s.description||"à¦•à§‹à¦¨ à¦¬à¦¿à¦¬à¦°à¦£ à¦ªà§à¦°à¦¦à¦¾à¦¨ à¦•à¦°à¦¾ à¦¹à¦¯à¦¼à¦¨à¦¿"})]})]})]}),(s.status==="RESOLVED"||s.resolutionNote||s.resolutionImages)&&e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f0fdf4"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{sx:{color:"#15803d"}}),e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#14532d"},children:"à¦¸à¦®à¦¾à¦§à¦¾à¦¨à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£ (Resolution Details)"})]})}),e.jsxs(r,{sx:{p:3},children:[s.resolutionNote&&e.jsxs(r,{sx:{mb:3},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,mb:1,color:"#374151"},children:"à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦®à¦¨à§à¦¤à¦¬à§à¦¯ (Admin Note):"}),e.jsx(o,{variant:"body1",sx:{color:"#1f2937",whiteSpace:"pre-wrap",backgroundColor:"#ffffff",p:2,borderRadius:1,border:"1px solid #e5e7eb"},children:s.resolutionNote})]}),s.resolutionImages&&e.jsxs(r,{children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,mb:1.5,color:"#374151"},children:"à¦•à¦¾à¦œà§‡à¦° à¦ªà§à¦°à¦®à¦¾à¦£ (Proof of Work):"}),e.jsx(r,{component:"img",src:s.resolutionImages,alt:"Resolution Proof",sx:{maxWidth:"100%",maxHeight:400,borderRadius:2,border:"1px solid #e5e7eb",cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}},onClick:()=>m(s.resolutionImages||null)})]})]})]}),s.status==="RESOLVED"&&e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:["User Reviews (",g.length,")"]}),P&&e.jsx(se,{size:20,sx:{color:"#3fa564"}})]})}),e.jsx(r,{sx:{p:3},children:P?e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(se,{size:30,sx:{color:"#3fa564"}})}):g.length===0?e.jsx(r,{sx:{textAlign:"center",py:4},children:e.jsx(o,{variant:"body2",sx:{color:"#6b7280"},children:"No reviews yet. User can submit a review after complaint is resolved."})}):e.jsx(r,{children:g.map(t=>e.jsx(cr,{review:t},t.id))})})]}),(((Ie=s.wards)==null?void 0:Ie.inspectorName)||((we=s.zone)==null?void 0:we.officerName))&&e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦¦à¦¾à¦¯à¦¼à¦¿à¦¤à§à¦¬à¦ªà§à¦°à¦¾à¦ªà§à¦¤ à¦•à¦°à§à¦®à¦•à¦°à§à¦¤à¦¾à¦—à¦£"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(h,{container:!0,spacing:2,children:[((Se=s.wards)==null?void 0:Se.inspectorName)&&e.jsx(h,{size:{xs:12},children:e.jsx(r,{sx:{p:2,border:"1px solid #bfdbfe",borderRadius:2,backgroundColor:"#eff6ff"},children:e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(E,{sx:{bgcolor:"#fff",color:"#2563eb",width:48,height:48,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e.jsx(as,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"Ward Inspector / à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦‡à¦¨à§à¦¸à¦ªà§‡à¦•à§à¦Ÿà¦°"}),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:700,color:"#1e2939"},children:s.wards.inspectorName}),s.wards.inspectorPhone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(le,{sx:{fontSize:16,color:"#2563eb"}}),e.jsx(o,{variant:"body2",sx:{color:"#4b5563",fontWeight:500},children:s.wards.inspectorPhone})]})]})]})})}),((ke=s.zone)==null?void 0:ke.officerName)&&e.jsx(h,{size:{xs:12},children:e.jsx(r,{sx:{p:2,border:"1px solid #fed7aa",borderRadius:2,backgroundColor:"#fff7ed"},children:e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(E,{sx:{bgcolor:"#fff",color:"#f97316",width:48,height:48,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e.jsx(ge,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"Zone Officer / à¦œà§‹à¦¨ à¦…à¦«à¦¿à¦¸à¦¾à¦°"}),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:700,color:"#1e2939"},children:s.zone.officerName}),s.zone.officerPhone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(le,{sx:{fontSize:16,color:"#f97316"}}),e.jsx(o,{variant:"body2",sx:{color:"#4b5563",fontWeight:500},children:s.zone.officerPhone})]})]})]})})})]})})]}),e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦²à§‹à¦•à§‡à¦¶à§‹ à¦“ à¦•à§à¦¯à¦¾à¦Ÿà¦¾à¦—à¦°à¦¿"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨"}),e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#3fa564"},children:((Re=s.cityCorporation)==null?void 0:Re.name)||((Ne=s.cityCorporation)==null?void 0:Ne.nameBangla)||(typeof((Ee=s.user)==null?void 0:Ee.cityCorporation)=="object"?(Pe=s.user.cityCorporation)==null?void 0:Pe.name:null)||(typeof((We=s.user)==null?void 0:We.cityCorporation)=="string"?s.user.cityCorporation:"à¦¢à¦¾à¦•à¦¾ à¦‰à¦¤à§à¦¤à¦° à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨")})]})}),e.jsx(h,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡"}),e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:((ze=s.wards)==null?void 0:ze.displayName)||((Ae=s.wards)!=null&&Ae.wardNumber?`Ward ${s.wards.wardNumber}`:null)||((Te=s.wards)!=null&&Te.number?`Ward ${s.wards.number}`:null)||(typeof((De=s.user)==null?void 0:De.ward)=="object"?((Oe=s.user.ward)==null?void 0:Oe.wardNumber)||((Le=s.user.ward)==null?void 0:Le.number):(Me=s.user)==null?void 0:Me.ward)||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"})]})}),e.jsx(h,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦œà§‹à¦¨"}),e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:((Be=s.zone)==null?void 0:Be.displayName)||((Ue=s.zone)==null?void 0:Ue.name)||(($e=s.zone)!=null&&$e.zoneNumber?`Zone ${s.zone.zoneNumber}`:null)||(typeof((Fe=s.user)==null?void 0:Fe.zone)=="object"?((Ge=s.user.zone)==null?void 0:Ge.name)||((_e=s.user.zone)==null?void 0:_e.zoneNumber):(He=s.user)==null?void 0:He.zone)||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"})]})}),e.jsx(h,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¥à¦¾à¦¨à¦¾"}),e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:((Ve=s.user.thana)==null?void 0:Ve.name)||"à¦®à¦¿à¦°à¦ªà§à¦°"})]})})]})})]}),s.imageUrls&&s.imageUrls.length>0&&e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.01)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsxs(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:["ðŸ“· à¦¸à¦‚à¦¯à§à¦•à§à¦¤ à¦›à¦¬à¦¿ (",s.imageUrls.length,")"]})}),e.jsx(r,{sx:{p:2},children:e.jsx(us,{cols:2,gap:12,children:s.imageUrls.map((t,b)=>e.jsxs(gs,{sx:{cursor:"pointer",borderRadius:2,overflow:"hidden",position:"relative",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover .zoom-icon":{opacity:1},"&:hover img":{transform:"scale(1.05)"}},onClick:()=>m(t),children:[e.jsx("img",{src:t,alt:`Complaint image ${b+1}`,loading:"lazy",style:{width:"100%",height:160,objectFit:"cover",transition:"transform 0.3s ease"}}),e.jsx(r,{className:"zoom-icon",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.4)",opacity:0,transition:"opacity 0.3s"},children:e.jsx(Hs,{sx:{color:"white",fontSize:32}})})]},b))})})]}),e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦Ÿà¦¾à¦‡à¦®à¦²à¦¾à¦‡à¦¨"})}),e.jsx(r,{sx:{p:3},children:e.jsx(r,{sx:{display:"flex",flexDirection:"column"},children:w().map((t,b)=>e.jsxs(r,{sx:{display:"flex",gap:2,position:"relative"},children:[b<w().length-1&&e.jsx(r,{sx:{position:"absolute",left:11,top:24,bottom:-24,width:2,backgroundColor:"#e5e7eb",zIndex:0}}),e.jsx(r,{sx:{zIndex:1,mt:.5},children:e.jsx(r,{sx:{width:24,height:24,borderRadius:"50%",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid #fff",boxShadow:"0 0 0 2px #dcfce7"},children:e.jsx(oe,{sx:{color:"#3fa564",fontSize:16}})})}),e.jsxs(r,{sx:{flex:1,pb:3},children:[e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:t.action}),e.jsx(o,{variant:"caption",sx:{display:"block",mb:.5,color:"#6b7280"},children:t.date}),e.jsx(o,{variant:"body2",sx:{color:"#4b5563",fontSize:"0.875rem"},children:t.description})]})]},t.id))})})]}),e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦¨à¦¾à¦—à¦°à¦¿à¦•à§‡à¦° à¦¤à¦¥à§à¦¯"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(E,{src:s.user.avatar||void 0,sx:{bgcolor:"#eff6ff",color:"#1d4ed8"},children:!s.user.avatar&&e.jsx(ge,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦¨à¦¾à¦®"}),e.jsxs(o,{variant:"body1",sx:{fontWeight:600,color:"#1f2937"},children:[s.user.firstName," ",s.user.lastName]})]})]})}),e.jsx(h,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(E,{sx:{bgcolor:"#f0fdf4",color:"#15803d"},children:e.jsx(le,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦«à§‹à¦¨"}),e.jsx(o,{variant:"body1",component:"a",href:`tel:${s.user.phone}`,sx:{fontWeight:600,color:"#1f2937",textDecoration:"none","&:hover":{color:"#3fa564"}},children:s.user.phone||"N/A"})]})]})}),e.jsx(h,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(E,{sx:{bgcolor:"#fff7ed",color:"#c2410c"},children:e.jsx(Fs,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦‡à¦®à§‡à¦‡à¦²"}),e.jsx(o,{variant:"body1",component:"a",href:`mailto:${s.user.email}`,sx:{fontWeight:600,color:"#1f2937",textDecoration:"none","&:hover":{color:"#3fa564"},wordBreak:"break-all"},children:s.user.email||"N/A"})]})]})}),e.jsx(h,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(E,{sx:{bgcolor:"#f3f4f6",color:"#374151",fontSize:"0.8rem",fontWeight:700},children:"ID"}),e.jsxs(r,{children:[e.jsx(o,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦‡à¦‰à¦œà¦¾à¦° à¦†à¦‡à¦¡à¦¿"}),e.jsxs(o,{variant:"body1",sx:{fontWeight:600,color:"#1f2937"},children:["CC-USER-",s.user.id]})]})]})})]})})]}),((Ze=s.wards)==null?void 0:Ze.inspectorName)&&e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦‡à¦¨à§à¦¸à¦ªà§‡à¦•à§à¦Ÿà¦°"})}),e.jsxs(r,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{sx:{width:48,height:48,bgcolor:"#eff6ff",color:"#2563eb",fontWeight:600},children:((qe=s.wards.inspectorName)==null?void 0:qe.charAt(0))||"WI"}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.wards.inspectorName||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"}),e.jsxs(o,{variant:"caption",sx:{display:"block",color:"#6b7280",mt:.5},children:["Ward ",s.wards.wardNumber||s.wards.number||s.wards.id]}),s.wards.inspectorPhone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[e.jsx(le,{sx:{fontSize:14,color:"#6b7280"}}),e.jsx(o,{variant:"body2",component:"a",href:`tel:${s.wards.inspectorPhone}`,sx:{color:"#6b7280",textDecoration:"none","&:hover":{color:"#3fa564"}},children:s.wards.inspectorPhone})]})]}),s.wards.inspectorPhone&&e.jsx(B,{variant:"outlined",size:"small",component:"a",href:`tel:${s.wards.inspectorPhone}`,sx:{borderColor:"#e5e7eb",color:"#374151"},children:"à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦—"})]})]}),((Je=s.zone)==null?void 0:Je.officerName)&&e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Zone Officer"})}),e.jsxs(r,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{sx:{width:48,height:48,bgcolor:"#fff7ed",color:"#f97316",fontWeight:600},children:((Xe=s.zone.officerName)==null?void 0:Xe.charAt(0))||"ZO"}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.zone.officerName||"No Info"}),e.jsx(o,{variant:"caption",sx:{color:"#6b7280"},children:"Zone Officer"})]})]})]}),e.jsxs(k,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Admin Report"})}),e.jsxs(r,{sx:{p:3},children:[e.jsx(o,{variant:"body2",sx:{color:"#6b7280",mb:2},children:"This complaint is managed by"}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(E,{sx:{width:40,height:40,bgcolor:"#fff7ed",color:"#f97316"},children:((Ke=(Ye=s.assignedAdmin)==null?void 0:Ye.firstName)==null?void 0:Ke.charAt(0))||e.jsx(ge,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.assignedAdmin?`${s.assignedAdmin.firstName} ${s.assignedAdmin.lastName}`:"Not Assigned Yet"}),e.jsx(o,{variant:"body2",sx:{color:"#6b7280"},children:s.assignedAdmin?"Ward Admin":"Pending"})]})]}),e.jsx(B,{variant:"outlined",fullWidth:!0,sx:{borderColor:"#3fa564",color:"#3fa564",textTransform:"none","&:hover":{backgroundColor:"#f0fdf4",borderColor:"#3fa564"}},children:"Assign New Admin"})]})]}),e.jsxs(k,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(o,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Action"})}),e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"contained",onClick:()=>Y("IN_PROGRESS"),loading:c,startIcon:e.jsx(oe,{}),sx:{backgroundColor:"#3fa564","&:hover":{backgroundColor:"#15803d"},textTransform:"none",px:3,flex:1},children:"Mark In Progress"}),e.jsx(L,{variant:"contained",onClick:()=>Y("RESOLVED"),loading:c,startIcon:e.jsx(oe,{}),sx:{backgroundColor:"#15803d","&:hover":{backgroundColor:"#166534"},textTransform:"none",px:3,flex:1},children:"Mark Solved"})]}),s.status==="IN_PROGRESS"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"contained",onClick:()=>Y("RESOLVED"),loading:c,startIcon:e.jsx(oe,{}),sx:{backgroundColor:"#3fa564","&:hover":{backgroundColor:"#15803d"},textTransform:"none",px:3,flex:1},children:"Mark Solved"}),e.jsx(L,{variant:"outlined",onClick:()=>Y("PENDING"),loading:c,sx:{borderColor:"#f59e0b",color:"#d97706",textTransform:"none",px:3,"&:hover":{backgroundColor:"#fffbeb",borderColor:"#f59e0b"}},children:"Mark Pending"})]}),s.status==="RESOLVED"&&e.jsx(L,{variant:"outlined",onClick:()=>Y("IN_PROGRESS"),loading:c,sx:{borderColor:"#3b82f6",color:"#2563eb",textTransform:"none",px:3,flex:1,"&:hover":{backgroundColor:"#eff6ff",borderColor:"#3b82f6"}},children:"Reopen (In Progress)"}),s.status==="REJECTED"&&e.jsx(L,{variant:"outlined",onClick:()=>Y("PENDING"),loading:c,sx:{borderColor:"#f59e0b",color:"#d97706",textTransform:"none",px:3,flex:1,"&:hover":{backgroundColor:"#fffbeb",borderColor:"#f59e0b"}},children:"Reopen (Pending)"})]}),(s.status==="PENDING"||s.status==="IN_PROGRESS")&&e.jsxs(e.Fragment,{children:[e.jsx(is,{sx:{my:2},children:e.jsx(o,{variant:"caption",color:"text.secondary",children:"Other Actions"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"center",flexDirection:"column",gap:2},children:e.jsx(L,{variant:"outlined",onClick:()=>j(!0),loading:c,startIcon:e.jsx(re,{}),sx:{borderColor:"#ef4444",color:"#ef4444",textTransform:"none",width:"100%","&:hover":{backgroundColor:"#fef2f2",borderColor:"#ef4444"}},children:"Mark as Others"})})]}),s.status==="REJECTED"&&e.jsxs(e.Fragment,{children:[e.jsx(is,{sx:{my:2},children:e.jsx(o,{variant:"caption",color:"text.secondary",children:"Other Actions"})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"center",flexDirection:"column",gap:2},children:[e.jsx(L,{variant:"outlined",onClick:()=>j(!0),loading:c,startIcon:e.jsx(re,{}),sx:{borderColor:"#ef4444",color:"#ef4444",textTransform:"none",width:"100%","&:hover":{backgroundColor:"#fef2f2",borderColor:"#ef4444"}},children:"Update Others Category"}),s.category&&e.jsxs(r,{sx:{p:2,bgcolor:"#fef2f2",borderRadius:1,border:"1px solid #fee2e2"},children:[e.jsx(o,{variant:"subtitle2",color:"error.main",gutterBottom:!0,children:"Marked as Others"}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Category:"})," ",s.category]}),s.subcategory&&e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Sub-category:"})," ",s.subcategory]})]})]})]})]})]})]}),e.jsx(h,{size:{xs:12,md:5},children:e.jsxs(k,{sx:{borderRadius:1.5,position:"sticky",top:16,boxShadow:"0 1px 4px rgba(0,0,0,0.08)",height:"calc(100vh - 48px)",maxHeight:"calc(100vh - 48px)",display:"flex",flexDirection:"column",overflow:"hidden",bgcolor:"#fff"},children:[e.jsxs(r,{sx:{p:1.5,borderBottom:"1px solid #e0e0e0",backgroundColor:"#fff",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(E,{sx:{width:40,height:40,bgcolor:"#f0fdf4",color:"#3fa564"},children:e.jsx(as,{})}),e.jsxs(r,{children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:700,color:"#1e2939",lineHeight:1.2},children:"Messages & Discussion"}),e.jsx(o,{variant:"caption",sx:{color:"#6b7280"},children:"Direct communication with citizen"})]})]}),e.jsx(me,{label:Z?"Connecting...":"Active Now",size:"small",color:Z?"default":"success",variant:"outlined",sx:{height:24,borderRadius:1,fontSize:"0.7rem"}})]}),e.jsxs(r,{sx:{flex:1,overflowY:"auto",p:2,bgcolor:"#f9fafb",display:"flex",flexDirection:"column",gap:2},children:[Z?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(se,{size:30,sx:{color:"#3fa564"}})}):V.length===0?e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",opacity:.6},children:[e.jsx(cs,{sx:{fontSize:48,color:"#cbd5e1",mb:2}}),e.jsx(o,{variant:"body2",sx:{color:"#6b7280"},children:"No messages yet"})]}):V.map(t=>e.jsx(r,{sx:{display:"flex",flexDirection:"column",alignItems:t.senderId===0?"flex-end":"flex-start",maxWidth:"85%",alignSelf:t.senderId===0?"flex-end":"flex-start"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"end",gap:1,flexDirection:t.senderId===0?"row-reverse":"row"},children:[t.senderId!==0&&e.jsx(E,{sx:{width:24,height:24,bgcolor:"#eff6ff",color:"#3b82f6",fontSize:"0.7rem"},children:"N"}),e.jsxs(r,{sx:{p:1.5,bgcolor:t.senderId===0?"#3fa564":"#fff",color:t.senderId===0?"#fff":"#1f2937",borderRadius:2,borderTopLeftRadius:t.senderId===0?8:0,borderTopRightRadius:t.senderId===0?0:8,boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative"},children:[t.imageUrl&&e.jsx(r,{sx:{mb:1,borderRadius:1,overflow:"hidden"},children:e.jsx("img",{src:t.imageUrl,alt:"Attachment",style:{maxWidth:"100%",maxHeight:150,objectFit:"cover",cursor:"pointer"},onClick:()=>m(t.imageUrl||null)})}),e.jsx(o,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"0.9rem"},children:t.message}),e.jsx(o,{variant:"caption",sx:{display:"block",mt:.5,fontSize:"0.7rem",opacity:.8,textAlign:"right"},children:new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},t.id)),e.jsx("div",{ref:O})]}),e.jsxs(r,{sx:{p:2,bgcolor:"#fff",borderTop:"1px solid #e0e0e0"},children:[_&&e.jsxs(r,{sx:{mb:1,p:1,bgcolor:"#f0fdf4",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(o,{variant:"caption",sx:{color:"#166534"},children:"Image attached"}),e.jsx(M,{size:"small",onClick:()=>z(null),children:e.jsx(re,{fontSize:"small"})})]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx("input",{accept:"image/*",style:{display:"none"},id:"icon-button-file",type:"file",onChange:Cs,disabled:G}),e.jsx("label",{htmlFor:"icon-button-file",children:e.jsx(M,{color:"primary","aria-label":"upload picture",component:"span",disabled:G,sx:{color:"#6b7280","&:hover":{color:"#3fa564",bgcolor:"#f0fdf4"}},children:e.jsx(bs,{})})}),e.jsx(ve,{fullWidth:!0,multiline:!0,maxRows:4,placeholder:"Type your message...",value:F,onChange:t=>J(t.target.value),onKeyPress:Is,disabled:G,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:3,bgcolor:"#f9fafb","& fieldset":{borderColor:"#e5e7eb"},"&:hover fieldset":{borderColor:"#d1d5db"},"&.Mui-focused fieldset":{borderColor:"#3fa564",borderWidth:1}}}}),e.jsx(M,{onClick:Ce,disabled:G||!F.trim()&&!_,sx:{bgcolor:"#3fa564",color:"white",width:40,height:40,"&:hover":{bgcolor:"#15803d"},"&.Mui-disabled":{bgcolor:"#e5e7eb",color:"#9ca3af"}},children:G?e.jsx(se,{size:20,color:"inherit"}):e.jsx(cs,{})})]})]})]})})]})]}),e.jsx(ar,{open:d,onClose:()=>j(!1),onConfirm:js,loading:c}),e.jsx(lr,{open:U,complaintId:(s==null?void 0:s.id)||0,status:R,onClose:()=>I(!1),onSuccess:ys}),e.jsx(ye,{open:!!u,onClose:()=>m(null),maxWidth:"lg",fullWidth:!0,children:e.jsxs(r,{sx:{position:"relative",backgroundColor:"#000",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh"},children:[e.jsx(M,{onClick:()=>m(null),sx:{position:"absolute",top:16,right:16,color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"},zIndex:1},children:e.jsx(re,{})}),u&&e.jsx("img",{src:u,alt:"Full size",style:{maxWidth:"100%",maxHeight:"90vh",objectFit:"contain"}})]})})]})};export{vr as default};
