var m=Object.defineProperty;var f=(p,e,r)=>e in p?m(p,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):p[e]=r;var w=(p,e,r)=>f(p,typeof e!="symbol"?e+"":e,r);import{a as i}from"./query-vendor-CyFhwaPb.js";import{A as g}from"./index-CEqbPxQ7.js";class y{constructor(){w(this,"apiClient");this.apiClient=i.create({baseURL:g.BASE_URL,timeout:g.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(e=>{try{const r=localStorage.getItem("accessToken");r&&(e.headers.Authorization=`Bearer ${r}`)}catch(r){console.error("Error getting token:",r)}return e},e=>Promise.reject(e)),this.apiClient.interceptors.response.use(e=>e,e=>{var r;return((r=e.response)==null?void 0:r.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(e)})}async getUsers(e){var r,t,s,o,c,n,d,u,l,h;try{console.log("ðŸ” Fetching users with query:",e);const a=await this.apiClient.get("/api/admin/users",{params:e});if(console.log("âœ… Full response:",a),console.log("âœ… Response data:",a.data),console.log("âœ… Response data type:",typeof a.data),console.log("âœ… Response data keys:",Object.keys(a.data||{})),(r=a.data)!=null&&r.success&&((t=a.data)!=null&&t.data))return console.log("âœ… Using response.data.data structure"),a.data.data;if((s=a.data)!=null&&s.users&&((o=a.data)!=null&&o.pagination))return console.log("âœ… Using direct structure"),a.data;throw console.error("âŒ Unexpected response structure:",a.data),new Error("Unexpected response structure from server")}catch(a){throw console.error("âŒ Error fetching users:",a),i.isAxiosError(a)?(console.error("Response data:",(c=a.response)==null?void 0:c.data),console.error("Response status:",(n=a.response)==null?void 0:n.status),console.error("Request URL:",(d=a.config)==null?void 0:d.url),console.error("Request params:",(u=a.config)==null?void 0:u.params),new Error(((h=(l=a.response)==null?void 0:l.data)==null?void 0:h.message)||"Failed to fetch users")):a}}async getUserById(e){var r,t;try{return(await this.apiClient.get(`/api/admin/users/${e}?t=${Date.now()}`)).data.data}catch(s){throw i.isAxiosError(s)?new Error(((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to fetch user details"):s}}async getUserStatistics(e,r,t,s){var o,c;try{const n={};return e&&(n.cityCorporationCode=e),r&&(n.role=r),t&&(n.zoneId=t),s&&(n.wardId=s),(await this.apiClient.get("/api/admin/users/statistics",{params:Object.keys(n).length>0?n:void 0})).data.data}catch(n){throw i.isAxiosError(n)?new Error(((c=(o=n.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to fetch statistics"):n}}async createUser(e){var r,t;try{return(await this.apiClient.post("/api/admin/users",e)).data}catch(s){throw i.isAxiosError(s)?new Error(((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to create user"):s}}async updateUser(e,r){var t,s;try{return(await this.apiClient.put(`/api/admin/users/${e}`,r)).data}catch(o){throw i.isAxiosError(o)?new Error(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to update user"):o}}async updateUserStatus(e,r){var t,s;try{return(await this.apiClient.patch(`/api/admin/users/${e}/status`,r)).data}catch(o){throw i.isAxiosError(o)?new Error(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to update user status"):o}}async uploadAvatar(e){var r,t;try{const s=new FormData;return s.append("image",e),(await this.apiClient.post("/api/uploads/avatar",s,{headers:{"Content-Type":"multipart/form-data"}})).data.data.url}catch(s){throw i.isAxiosError(s)?new Error(((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to upload avatar"):s}}async bulkDeleteUsers(e){var r,t;try{await this.apiClient.post("/api/admin/users/bulk-delete",{userIds:e})}catch(s){throw i.isAxiosError(s)?new Error(((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to bulk delete users"):s}}}const A=new y;export{A as u};
