var fe=Object.defineProperty;var je=(a,s,r)=>s in a?fe(a,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[s]=r;var E=(a,s,r)=>je(a,typeof s!="symbol"?s+"":s,r);import{j as e,B as o,C as N,T as l,cJ as ye,b,bk as Ce,az as m,c1 as C,bX as T,ch as i,cK as G,cL as ve,cs as Ue,cM as q,A as Y,aK as Se,aL as K,aD as we,p as Pe,y as Re,cN as Ie,cO as ke,aX as V,f as Te,be as X,b4 as We,s as J,t as Z,w as Q,g as ee,aY as Ae,i as oe,_ as De,av as Ee,$ as Fe,a1 as te,x as se,P as ie,e as Le}from"./mui-vendor-Y6GvQTLC.js";import{r as c}from"./react-vendor-D7yrL1sD.js";import{A as ae,M as re}from"./index-B_PiLh6w.js";import{a as $e}from"./query-vendor-D4yC0Jq7.js";import"./chart-vendor-BgnY-Lfo.js";class ze{constructor(){E(this,"apiClient");E(this,"baseUrl","/api/waste-management");this.apiClient=$e.create({baseURL:ae.BASE_URL,timeout:ae.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(s=>{try{const r=localStorage.getItem("accessToken");r&&(s.headers.Authorization=`Bearer ${r}`)}catch(r){console.error("Error getting token:",r)}return s},s=>Promise.reject(s)),this.apiClient.interceptors.response.use(s=>s,s=>{var r;return((r=s.response)==null?void 0:r.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(s)})}async getAllPostsForAdmin(){return(await this.apiClient.get(`${this.baseUrl}/admin/posts`)).data}async createPost(s){return(await this.apiClient.post(`${this.baseUrl}/admin/posts`,s)).data}async updatePost(s,r){return(await this.apiClient.put(`${this.baseUrl}/admin/posts/${s}`,r)).data}async publishPost(s){return(await this.apiClient.post(`${this.baseUrl}/admin/posts/${s}/publish`)).data}async unpublishPost(s){return(await this.apiClient.post(`${this.baseUrl}/admin/posts/${s}/unpublish`)).data}async deletePost(s){await this.apiClient.delete(`${this.baseUrl}/admin/posts/${s}`)}async getPublishedPosts(){return(await this.apiClient.get(`${this.baseUrl}/posts`)).data}async getPostById(s){return(await this.apiClient.get(`${this.baseUrl}/posts/${s}`)).data}async getPostsByCategory(s){return(await this.apiClient.get(`${this.baseUrl}/posts/category/${s}`)).data}async toggleReaction(s,r){return(await this.apiClient.post(`${this.baseUrl}/posts/${s}/reaction`,{reactionType:r})).data}async uploadImage(s){try{const r=new FormData;r.append("images",s);const h=await this.apiClient.post("/api/uploads",r,{headers:{"Content-Type":"multipart/form-data"}});if(h.data.success&&h.data.data.fileUrls.length>0)return h.data.data.fileUrls[0];throw new Error("Failed to upload image")}catch(r){throw console.error("Error uploading image:",r),r}}}const f=new ze,Be=T(Le)(({theme:a})=>({height:"100%",display:"flex",flexDirection:"column",position:"relative",borderRadius:"20px",transition:"all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",border:"1px solid",borderColor:i(a.palette.divider,.1),background:i(a.palette.background.paper,.8),backdropFilter:"blur(10px)",boxShadow:`0 10px 30px -10px ${i(a.palette.common.black,.1)}`,"&:hover":{transform:"translateY(-10px) scale(1.02)",boxShadow:`0 20px 40px -15px ${i(a.palette.common.black,.2)}`,borderColor:i(a.palette.primary.main,.3)}})),Me=T(ie)(({theme:a})=>({padding:a.spacing(3),borderRadius:"24px",background:i(a.palette.background.paper,.6),backdropFilter:"blur(20px)",border:"1px solid",borderColor:i(a.palette.common.white,.2),boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.07)",marginBottom:a.spacing(4)})),k=T(ie)(({theme:a})=>({padding:a.spacing(2.5),borderRadius:"20px",display:"flex",alignItems:"center",gap:a.spacing(2),transition:"transform 0.3s ease",border:"1px solid",borderColor:i(a.palette.divider,.05),boxShadow:"0 4px 20px 0 rgba(0,0,0,0.05)","&:hover":{transform:"scale(1.05)"}})),F=T(oe)(({theme:a})=>({backgroundColor:i(a.palette.background.paper,.8),backdropFilter:"blur(4px)",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",backgroundColor:a.palette.background.paper}})),Ye=()=>{const[a,s]=c.useState([]),[r,h]=c.useState(!0),[ne,L]=c.useState(!1),[v,W]=c.useState(null),[le,U]=c.useState(!1),[$,z]=c.useState(null),[B,u]=c.useState(null),[M,x]=c.useState(null),[S,ce]=c.useState(0),[d,g]=c.useState({title:"",content:"",imageUrl:"",category:"CURRENT_WASTE"}),[A,y]=c.useState(null),[p,j]=c.useState(null),[w,P]=c.useState(!1);c.useEffect(()=>{R()},[]);const R=async()=>{try{h(!0);const t=await f.getAllPostsForAdmin();s(t)}catch(t){u("Failed to fetch posts"),console.error(t)}finally{h(!1)}},I=c.useMemo(()=>({total:a.length,published:a.filter(t=>t.status==="PUBLISHED").length,drafts:a.filter(t=>t.status==="DRAFT").length,likes:a.reduce((t,n)=>t+n.likeCount,0),loves:a.reduce((t,n)=>t+(n.loveCount||0),0)}),[a]),O=c.useMemo(()=>{const t=S===0?"CURRENT_WASTE":"FUTURE_WASTE";return a.filter(n=>n.category===t)},[a,S]),_=t=>{t?(W(t),g({title:t.title,content:t.content,imageUrl:t.imageUrl||"",category:t.category}),j(t.imageUrl||null)):(W(null),g({title:"",content:"",imageUrl:"",category:S===0?"CURRENT_WASTE":"FUTURE_WASTE"}),j(null)),y(null),L(!0)},D=()=>{L(!1),W(null),g({title:"",content:"",imageUrl:"",category:"CURRENT_WASTE"}),y(null),p&&!p.startsWith("http")&&URL.revokeObjectURL(p),j(null)},de=async()=>{try{P(!0),u(null),v?(await f.updatePost(v.id,d),x("পোস্ট সফলভাবে আপডেট হয়েছে")):(await f.createPost(d),x("পোস্ট সফলভাবে তৈরি হয়েছে")),D(),R(),setTimeout(()=>x(null),3e3)}catch(t){u("পোস্ট সেভ করতে ব্যর্থ হয়েছে"),console.error(t)}finally{P(!1)}},xe=async t=>{try{u(null),t.status==="PUBLISHED"?(await f.unpublishPost(t.id),x("Post unpublished successfully")):(await f.publishPost(t.id),x("Post published successfully")),R(),setTimeout(()=>x(null),3e3)}catch(n){u("Failed to update post status"),console.error(n)}},pe=t=>{z(t),U(!0)},ue=async()=>{if($)try{u(null),await f.deletePost($),x("Post deleted successfully"),R(),setTimeout(()=>x(null),3e3)}catch(t){u("Failed to delete post"),console.error(t)}U(!1),z(null)},he=t=>{var H;const n=(H=t.target.files)==null?void 0:H[0];if(n){y(n),p&&!p.startsWith("http")&&URL.revokeObjectURL(p);const be=URL.createObjectURL(n);j(be)}},ge=async()=>{if(A)try{P(!0),u(null);const t=await f.uploadImage(A);g(n=>({...n,imageUrl:t})),j(t),x("ছবি সফলভাবে আপলোড হয়েছে"),setTimeout(()=>x(null),3e3),y(null)}catch(t){u("ছবি আপলোড ব্যর্থ হয়েছে"),console.error(t)}finally{P(!1)}},me=()=>{y(null),p&&!p.startsWith("http")&&URL.revokeObjectURL(p),j(null),g(t=>({...t,imageUrl:""}))};return r?e.jsx(re,{children:e.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:e.jsx(N,{thickness:5,size:60,sx:{color:"#3FA564"}})})}):e.jsx(re,{children:e.jsxs(o,{sx:{p:{xs:2,md:4},maxWidth:"1600px",mx:"auto"},children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",mb:4,flexWrap:"wrap",gap:2,children:[e.jsxs(o,{children:[e.jsx(l,{variant:"h3",fontWeight:"800",sx:{color:"#1a3321",letterSpacing:"-0.5px"},children:"বর্জ্য ব্যবস্থাপনা"}),e.jsx(l,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"শহর পরিষ্কার রাখতে আপনার পোস্টগুলো পরিচালনা করুন"})]}),e.jsx(ye,{in:!0,children:e.jsx(b,{variant:"contained",size:"large",startIcon:e.jsx(Ce,{}),onClick:()=>_(),sx:{borderRadius:"16px",px:4,py:1.5,textTransform:"none",fontSize:"1.1rem",fontWeight:"600",bgcolor:"#3FA564",boxShadow:"0 8px 20px -4px rgba(63, 165, 100, 0.4)","&:hover":{bgcolor:"#2D7A4A",transform:"translateY(-2px)",boxShadow:"0 12px 25px -5px rgba(63, 165, 100, 0.5)"},transition:"all 0.3s ease"},children:"নতুন পোস্ট তৈরি করুন"})})]}),e.jsxs(m,{container:!0,spacing:3,mb:5,children:[e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{in:!0,style:{transitionDelay:"100ms"},children:e.jsxs(k,{children:[e.jsx(o,{sx:{p:1.5,borderRadius:"14px",bgcolor:i("#3FA564",.1),color:"#3FA564"},children:e.jsx(G,{})}),e.jsxs(o,{children:[e.jsx(l,{variant:"h5",fontWeight:"700",children:I.total}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"মোট পোস্ট"})]})]})})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{in:!0,style:{transitionDelay:"200ms"},children:e.jsxs(k,{children:[e.jsx(o,{sx:{p:1.5,borderRadius:"14px",bgcolor:i("#4caf50",.1),color:"#4caf50"},children:e.jsx(ve,{})}),e.jsxs(o,{children:[e.jsx(l,{variant:"h5",fontWeight:"700",children:I.published}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"প্রকাশিত"})]})]})})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{in:!0,style:{transitionDelay:"300ms"},children:e.jsxs(k,{children:[e.jsx(o,{sx:{p:1.5,borderRadius:"14px",bgcolor:i("#ff9800",.1),color:"#ff9800"},children:e.jsx(Ue,{})}),e.jsxs(o,{children:[e.jsx(l,{variant:"h5",fontWeight:"700",children:I.drafts}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"খসড়া"})]})]})})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{in:!0,style:{transitionDelay:"400ms"},children:e.jsxs(k,{children:[e.jsx(o,{sx:{p:1.5,borderRadius:"14px",bgcolor:i("#e91e63",.1),color:"#e91e63"},children:e.jsx(q,{})}),e.jsxs(o,{children:[e.jsx(l,{variant:"h5",fontWeight:"700",children:I.loves}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"মোট লাভ"})]})]})})})]}),B&&e.jsx(Y,{severity:"error",sx:{mb:3,borderRadius:"12px"},onClose:()=>u(null),children:B}),M&&e.jsx(Y,{severity:"success",sx:{mb:3,borderRadius:"12px"},onClose:()=>x(null),children:M}),e.jsxs(Me,{children:[e.jsxs(Se,{value:S,onChange:(t,n)=>ce(n),sx:{mb:4,"& .MuiTabs-indicator":{height:4,borderRadius:"4px",bgcolor:"#3FA564"},"& .MuiTab-root":{fontSize:"1rem",fontWeight:"600",textTransform:"none",minWidth:160}},children:[e.jsx(K,{label:"বর্তমান বর্জ্য ব্যবস্থাপনা"}),e.jsx(K,{label:"ভবিষ্যত পরিকল্পনা"})]}),e.jsxs(m,{container:!0,spacing:4,children:[O.map((t,n)=>e.jsx(m,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(C,{in:!0,style:{transitionDelay:`${n*50}ms`},children:e.jsxs(Be,{children:[e.jsxs(o,{sx:{position:"relative"},children:[e.jsx(we,{component:"img",height:"220",image:t.imageUrl||"https://via.placeholder.com/400x220?text=No+Image",alt:t.title,sx:{objectFit:"cover",filter:t.status==="DRAFT"?"grayscale(0.4)":"none"}}),e.jsx(o,{sx:{position:"absolute",top:12,right:12,display:"flex",gap:1},children:e.jsx(Pe,{label:t.status==="PUBLISHED"?"প্রকাশিত":"খসড়া",size:"small",sx:{bgcolor:t.status==="PUBLISHED"?i("#4caf50",.9):i("#000",.6),color:"#fff",fontWeight:"700",backdropFilter:"blur(4px)",border:"none"}})}),e.jsxs(o,{sx:{position:"absolute",bottom:0,left:0,right:0,p:1.5,background:"linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 100%)",display:"flex",justifyContent:"flex-end",gap:1,opacity:0,transition:"opacity 0.3s ease",".MuiCard-root:hover &":{opacity:1}},children:[e.jsx(F,{size:"small",onClick:()=>_(t),color:"primary",children:e.jsx(Re,{fontSize:"small"})}),e.jsx(F,{size:"small",onClick:()=>xe(t),sx:{color:t.status==="PUBLISHED"?"#ff9800":"#4caf50"},children:t.status==="PUBLISHED"?e.jsx(Ie,{fontSize:"small"}):e.jsx(ke,{fontSize:"small"})}),e.jsx(F,{size:"small",onClick:()=>pe(t.id),color:"error",children:e.jsx(V,{fontSize:"small"})})]})]}),e.jsxs(Te,{sx:{flexGrow:1,pt:2.5},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,fontWeight:"800",sx:{lineHeight:1.3,height:"3.9em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:t.title}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2,height:"4.5em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:t.content}),e.jsxs(X,{direction:"row",spacing:2,sx:{mt:"auto",pt:2,borderTop:`1px solid ${i("#000",.05)}`},children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:.8,children:[e.jsx(We,{fontSize:"small",sx:{color:i("#2196f3",.8)}}),e.jsx(l,{variant:"body2",fontWeight:"700",children:t.likeCount})]}),e.jsxs(o,{display:"flex",alignItems:"center",gap:.8,children:[e.jsx(q,{fontSize:"small",sx:{color:i("#e91e63",.8)}}),e.jsx(l,{variant:"body2",fontWeight:"700",children:t.loveCount})]})]})]})]})})},t.id)),O.length===0&&e.jsx(m,{item:!0,xs:12,children:e.jsxs(o,{textAlign:"center",py:8,children:[e.jsx(G,{sx:{fontSize:80,color:i("#000",.1),mb:2}}),e.jsx(l,{variant:"h6",color:"text.secondary",children:"এই বিভাগে কোনো পোস্ট নেই"})]})})]})]}),e.jsxs(J,{open:ne,onClose:D,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"24px",p:1}},children:[e.jsx(Z,{sx:{fontWeight:"800",fontSize:"1.5rem"},children:v?"পোস্ট সম্পাদনা করুন":"নতুন পোস্ট তৈরি করুন"}),e.jsx(Q,{children:e.jsxs(o,{sx:{pt:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsx(ee,{label:"শিরোনাম",fullWidth:!0,variant:"filled",value:d.title,onChange:t=>g({...d,title:t.target.value}),required:!0,InputProps:{sx:{borderRadius:"12px"}}}),e.jsx(ee,{label:"বিষয়বস্তু",fullWidth:!0,multiline:!0,rows:5,variant:"filled",value:d.content,onChange:t=>g({...d,content:t.target.value}),required:!0,InputProps:{sx:{borderRadius:"12px"}}}),e.jsxs(o,{children:[e.jsx(l,{variant:"subtitle2",fontWeight:"700",gutterBottom:!0,children:"ছবি আপলোড"}),e.jsxs(X,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(b,{variant:"outlined",component:"label",startIcon:e.jsx(Ae,{}),disabled:w,sx:{borderRadius:"12px",textTransform:"none"},children:["ছবি নির্বাচন",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:he})]}),A&&e.jsx(b,{variant:"contained",onClick:ge,disabled:w,sx:{borderRadius:"12px",bgcolor:"#3FA564","&:hover":{bgcolor:"#2D7A4A"}},children:w?e.jsx(N,{size:20,color:"inherit"}):"আপলোড"})]}),(p||d.imageUrl)&&e.jsxs(o,{sx:{mt:2,position:"relative",borderRadius:"16px",overflow:"hidden"},children:[e.jsx("img",{src:p||d.imageUrl,alt:"Preview",style:{width:"100%",maxHeight:"250px",objectFit:"cover"}}),e.jsx(oe,{size:"small",onClick:me,sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(255,255,255,0.8)"},children:e.jsx(V,{color:"error"})})]})]}),e.jsxs(De,{fullWidth:!0,variant:"filled",children:[e.jsx(Ee,{children:"বিভাগ"}),e.jsxs(Fe,{value:d.category,onChange:t=>g({...d,category:t.target.value}),sx:{borderRadius:"12px"},children:[e.jsx(te,{value:"CURRENT_WASTE",children:"বর্তমান বর্জ্য ব্যবস্থাপনা"}),e.jsx(te,{value:"FUTURE_WASTE",children:"ভবিষ্যত পরিকল্পনা"})]})]})]})}),e.jsxs(se,{sx:{p:3},children:[e.jsx(b,{onClick:D,sx:{color:"text.secondary",fontWeight:"600"},children:"বাতিল"}),e.jsx(b,{onClick:de,variant:"contained",disabled:!d.title||!d.content||w,sx:{borderRadius:"12px",px:4,bgcolor:"#3FA564","&:hover":{bgcolor:"#2D7A4A"}},children:v?"আপডেট করুন":"তৈরি করুন"})]})]}),e.jsxs(J,{open:le,onClose:()=>U(!1),PaperProps:{sx:{borderRadius:"20px"}},children:[e.jsx(Z,{sx:{fontWeight:"800"},children:"নিশ্চিত করুন"}),e.jsx(Q,{children:e.jsx(l,{children:"আপনি কি নিশ্চিত যে আপনি এই পোস্টটি মুছে ফেলতে চান?"})}),e.jsxs(se,{sx:{p:3},children:[e.jsx(b,{onClick:()=>U(!1),children:"বাতিল"}),e.jsx(b,{onClick:ue,color:"error",variant:"contained",sx:{borderRadius:"10px"},children:"মুছে ফেলুন"})]})]})]})})};export{Ye as default};
