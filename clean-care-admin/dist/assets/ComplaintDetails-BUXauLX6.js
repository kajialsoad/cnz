import{a as Qs,g as er,r as n,u as sr,j as e,s as me,c as rr,b as q,d as or,m as Ie,e as tr,P as F,z as Is,F as r,ap as ir,K as xe,aq as ar,aj as he,l as Os,v as nr,D as we,E as Ps,I as D,H as Y,J as Ms,ar as lr,L as Ls,T as t,N as We,am as Us,S as cr,as as z,at as dr,G as R,al as xr,au as hr,U as Re,aa as Ee,V as Ne,W as te,av as fr,$ as pr,a1 as ur,w as ie,a5 as ke,aw as gr,ax as Cs,Z as ue,ay as Rs,M as Es,az as ge,aA as Ns,ak as ks,X as Ae,Q as ae,x as As}from"./index-CpMFUl0-.js";import{H as br,c as ze,b as De,d as Te,I as Bs,a as ne,A as mr,Z as jr,M as yr}from"./categoryService-CLCJf9LD.js";import{f as vr}from"./dateUtils-Bfw52zU5.js";import{s as le,b as ce}from"./toastUtils-D0pTWm9R.js";import{G as f}from"./Grid-CXliHFNi.js";import{C as $s}from"./CloudUpload-D1bX8LzE.js";import{D as fe}from"./Delete-B8MvPCz9.js";import{A as zs}from"./ArrowBack-LyevcktP.js";import{P as ve}from"./Person-Cga43oxl.js";import{S as Ds}from"./Send-Dj4BuzPp.js";import"./styled-C0WY_1v_.js";import"./useThemeProps-DQBRHprK.js";function Sr(i){return Qs("MuiImageListItemBar",i)}er("MuiImageListItemBar",["root","positionBottom","positionTop","positionBelow","actionPositionLeft","actionPositionRight","titleWrap","titleWrapBottom","titleWrapTop","titleWrapBelow","titleWrapActionPosLeft","titleWrapActionPosRight","title","subtitle","actionIcon","actionIconActionPosLeft","actionIconActionPosRight"]);const wr=i=>{const{classes:c,position:x,actionIcon:s,actionPosition:S}=i,y={root:["root",`position${q(x)}`,`actionPosition${q(S)}`],titleWrap:["titleWrap",`titleWrap${q(x)}`,s&&`titleWrapActionPos${q(S)}`],title:["title"],subtitle:["subtitle"],actionIcon:["actionIcon",`actionIconActionPos${q(S)}`]};return or(y,Sr,c)},Ir=me("div",{name:"MuiImageListItemBar",slot:"Root",overridesResolver:(i,c)=>{const{ownerState:x}=i;return[c.root,c[`position${q(x.position)}`]]}})(Ie(({theme:i})=>({position:"absolute",left:0,right:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",fontFamily:i.typography.fontFamily,variants:[{props:{position:"bottom"},style:{bottom:0}},{props:{position:"top"},style:{top:0}},{props:{position:"below"},style:{position:"relative",background:"transparent",alignItems:"normal"}}]}))),Cr=me("div",{name:"MuiImageListItemBar",slot:"TitleWrap",overridesResolver:(i,c)=>{const{ownerState:x}=i;return[c.titleWrap,c[`titleWrap${q(x.position)}`],x.actionIcon&&c[`titleWrapActionPos${q(x.actionPosition)}`]]}})(Ie(({theme:i})=>({flexGrow:1,padding:"12px 16px",color:(i.vars||i).palette.common.white,overflow:"hidden",variants:[{props:{position:"below"},style:{padding:"6px 0 12px",color:"inherit"}},{props:({ownerState:c})=>c.actionIcon&&c.actionPosition==="left",style:{paddingLeft:0}},{props:({ownerState:c})=>c.actionIcon&&c.actionPosition==="right",style:{paddingRight:0}}]}))),Rr=me("div",{name:"MuiImageListItemBar",slot:"Title"})(Ie(({theme:i})=>({fontSize:i.typography.pxToRem(16),lineHeight:"24px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),Er=me("div",{name:"MuiImageListItemBar",slot:"Subtitle"})(Ie(({theme:i})=>({fontSize:i.typography.pxToRem(12),lineHeight:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}))),Nr=me("div",{name:"MuiImageListItemBar",slot:"ActionIcon",overridesResolver:(i,c)=>{const{ownerState:x}=i;return[c.actionIcon,c[`actionIconActionPos${q(x.actionPosition)}`]]}})({variants:[{props:{actionPosition:"left"},style:{order:-1}}]}),Ts=n.forwardRef(function(c,x){const s=sr({props:c,name:"MuiImageListItemBar"}),{actionIcon:S,actionPosition:y="right",className:u,subtitle:w,title:m,position:h="bottom",...E}=s,p={...s,position:h,actionPosition:y},b=wr(p);return e.jsxs(Ir,{ownerState:p,className:rr(b.root,u),ref:x,...E,children:[e.jsxs(Cr,{ownerState:p,className:b.titleWrap,children:[e.jsx(Rr,{className:b.title,children:m}),w?e.jsx(Er,{className:b.subtitle,children:w}):null]}),S?e.jsx(Nr,{ownerState:p,className:b.actionIcon,children:S}):null]})}),Ws=tr(e.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"})),J=({loading:i=!1,loadingText:c,children:x,disabled:s,startIcon:S,...y})=>e.jsx(F,{...y,disabled:s||i,startIcon:i?e.jsx(r,{sx:{display:"flex",alignItems:"center",animation:`${ir} 1s linear infinite`},children:e.jsx(xe,{size:16,color:"inherit"})}):S,sx:{...y.sx,transition:`all ${Is.fast.duration} ${Is.fast.timing}`,"&:not(:disabled):hover":{transform:"translateY(-1px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},"&:not(:disabled):active":{transform:"translateY(0)"}},children:i&&c?c:x}),kr=({categoryId:i,subcategoryId:c,size:x="small",showSubcategory:s=!0})=>{const[S,y]=n.useState(""),[u,w]=n.useState(""),[m,h]=n.useState("#808080"),[E,p]=n.useState(!0);if(n.useEffect(()=>{(async()=>{try{if(p(!0),!i||!c){y("Not Categorized"),w(""),h("#f5f5f5"),p(!1);return}try{const[j,T,G]=await Promise.all([ze.getCategoryName(i,"en").catch(()=>"Unknown Category"),ze.getSubcategoryName(i,c,"en").catch(()=>"Unknown"),ze.getCategoryColor(i).catch(()=>"#808080")]);y(j),w(T),h(G)}catch(j){console.error("Error fetching category details:",j),y("Unknown"),w("Unknown"),h("#808080")}}catch(j){console.error("Error fetching category info:",j),y("Unknown"),w("Unknown"),h("#808080")}finally{p(!1)}})()},[i,c]),E)return e.jsx(ar,{variant:"rectangular",width:120,height:x==="small"?24:32,sx:{borderRadius:2}});const b=s&&u?`${S} - ${u}`:S,v=!i||!c;return e.jsx(he,{label:b,size:x,icon:v?e.jsx(br,{sx:{fontSize:16}}):void 0,sx:{backgroundColor:v?"#f5f5f5":m,color:v?"#757575":"#fff",border:v?"1px dashed #bdbdbd":"none",fontWeight:500,fontSize:x==="small"?"0.75rem":"0.875rem",height:x==="small"?24:32,"& .MuiChip-label":{px:1.5},"& .MuiChip-icon":{color:v?"#757575":"inherit",marginLeft:1},boxShadow:v?"none":"0 1px 3px rgba(0,0,0,0.12)"}})},de=5,Ar=5*1024*1024,zr=["image/jpeg","image/jpg","image/png","image/webp"],Se=20,be=500,Dr=({open:i,complaintId:c,status:x,existingImages:s="",onClose:S,onSuccess:y})=>{const u=Os(),w=nr(u.breakpoints.down("sm")),m=n.useRef(null),[h,E]=n.useState(""),[p,b]=n.useState([]),[v,M]=n.useState(s?s.split(",").filter(l=>l.trim()):[]),[j,T]=n.useState(!1),[G,L]=n.useState(""),[P,H]=n.useState({note:!1,images:!1}),[K,V]=n.useState(!1),W=x==="RESOLVED",U=W,B=W,d=P.note&&U&&h.length<Se?`Resolution note must be at least ${Se} characters`:P.note&&h.length>be?`Resolution note must not exceed ${be} characters`:"",I=p.length+v.length,N=P.images&&B&&I===0?"At least one image is required for resolved status":I>de?`Maximum ${de} images allowed`:"",Q=()=>!(U&&(h.length<Se||h.length>be)||B&&p.length+v.length===0||p.length+v.length>de),$=n.useCallback(l=>{if(!l)return;const C=[],g=[];Array.from(l).forEach(O=>{if(!zr.includes(O.type)){g.push(`${O.name}: Invalid file type. Only JPEG, PNG, and WebP are allowed.`);return}if(O.size>Ar){g.push(`${O.name}: File size exceeds 5MB limit.`);return}if(p.length+v.length+C.length>=de){g.push(`Maximum ${de} images allowed.`);return}const oe=URL.createObjectURL(O);C.push({file:O,preview:oe})}),g.length>0&&(L(g.join(" ")),setTimeout(()=>L(""),5e3)),C.length>0&&(b(O=>[...O,...C]),H({...P,images:!0}))},[p.length,P]),je=l=>{$(l.target.files),m.current&&(m.current.value="")},Z=n.useCallback(l=>{l.preventDefault(),l.stopPropagation(),l.type==="dragenter"||l.type==="dragover"?V(!0):l.type==="dragleave"&&V(!1)},[]),re=n.useCallback(l=>{l.preventDefault(),l.stopPropagation(),V(!1),l.dataTransfer.files&&l.dataTransfer.files.length>0&&$(l.dataTransfer.files)},[$]),Oe=l=>{b(C=>{const g=[...C];return URL.revokeObjectURL(g[l].preview),g.splice(l,1),g})},ye=l=>{M(C=>{const g=[...C];return g.splice(l,1),g})},Ce=async()=>{if(H({note:!0,images:!0}),!!Q()){T(!0),L("");try{const l=new FormData;l.append("status",x),h.trim()&&l.append("resolutionNote",h.trim()),v.length>0&&l.append("resolutionImages",v.join(",")),p.forEach(ee=>{l.append("resolutionImages",ee.file)});const C=localStorage.getItem("accessToken");if(!C)throw new Error("Authentication token not found");const g=await fetch(`${cr.BASE_URL}/api/admin/complaints/${c}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${C}`},body:l}),O=g.headers.get("content-type");if(!O||!O.includes("application/json")){const ee=await g.text();throw console.error("Non-JSON response received:",ee.substring(0,200)),new Error("Server returned an invalid response. Please check if the backend server is running.")}const oe=await g.json();if(!g.ok)throw new Error(oe.message||"Failed to update complaint status");y(),X()}catch(l){console.error("Error updating status:",l),L(l.message||"Failed to update complaint status")}finally{T(!1)}}},X=()=>{j||(p.forEach(l=>{URL.revokeObjectURL(l.preview)}),E(""),b([]),M(s?s.split(",").filter(l=>l.trim()):[]),L(""),H({note:!1,images:!1}),V(!1),S())};return e.jsxs(we,{open:i,onClose:X,maxWidth:"md",fullWidth:!0,fullScreen:w,PaperProps:{sx:{borderRadius:w?0:2}},children:[e.jsxs(Ps,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:["Mark as ",x==="RESOLVED"?"Resolved":"In Progress",e.jsx(D,{onClick:X,disabled:j,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(Y,{})})]}),e.jsxs(Ms,{sx:{pt:3,pb:2},children:[j&&e.jsx(lr,{sx:{mb:2}}),G&&e.jsx(Ls,{severity:"error",sx:{mb:2},onClose:()=>L(""),children:G}),e.jsxs(f,{container:!0,spacing:3,children:[e.jsxs(f,{size:12,children:[e.jsxs(t,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:["Upload Images ",B&&e.jsx("span",{style:{color:u.palette.error.main},children:"*"})]}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:2},children:B?"At least 1 image required, maximum 5 images, 5MB each":"Optional: Maximum 5 images, 5MB each"}),e.jsxs(r,{onDragEnter:Z,onDragLeave:Z,onDragOver:Z,onDrop:re,sx:{border:"2px dashed",borderColor:K?"primary.main":N?"error.main":"#ccc",borderRadius:2,p:3,textAlign:"center",bgcolor:K?"action.hover":"background.paper",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:"primary.main",bgcolor:"action.hover"}},onClick:()=>{var l;return(l=m.current)==null?void 0:l.click()},children:[e.jsx("input",{ref:m,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:je,style:{display:"none"},disabled:j}),e.jsx($s,{sx:{fontSize:48,color:"text.secondary",mb:1}}),e.jsx(t,{variant:"body1",color:"text.secondary",children:"Drag & drop images here, or click to select"}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"JPEG, PNG, WebP (max 5MB each)"})]}),N&&e.jsx(t,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:N}),v.length>0&&e.jsxs(r,{sx:{mt:2},children:[e.jsx(t,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Existing Images:"}),e.jsx(De,{sx:{width:"100%",height:"auto"},cols:w?3:4,rowHeight:100,gap:8,children:v.map((l,C)=>e.jsxs(Te,{children:[e.jsx("img",{src:l,alt:`Existing ${C+1}`,loading:"lazy",style:{height:100,objectFit:"cover",borderRadius:8}}),e.jsx(Ts,{sx:{background:"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%)",borderRadius:"8px 8px 0 0"},position:"top",actionIcon:e.jsx(D,{sx:{color:"white"},onClick:g=>{g.stopPropagation(),ye(C)},size:"small",disabled:j,children:e.jsx(fe,{fontSize:"small"})}),actionPosition:"right"})]},`existing-${C}`))})]}),p.length>0&&e.jsx(r,{sx:{mt:2},children:e.jsx(De,{sx:{width:"100%",height:"auto"},cols:w?2:3,gap:8,children:p.map((l,C)=>e.jsxs(Te,{children:[e.jsx("img",{src:l.preview,alt:`Preview ${C+1}`,loading:"lazy",style:{height:150,objectFit:"cover",borderRadius:8}}),e.jsx(Ts,{sx:{background:"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0) 100%)",borderRadius:"8px 8px 0 0"},position:"top",actionIcon:e.jsx(D,{sx:{color:"white"},onClick:g=>{g.stopPropagation(),Oe(C)},disabled:j,children:e.jsx(fe,{})}),actionPosition:"right"})]},C))})}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[p.length+v.length," / ",de," images selected"]})]}),e.jsx(f,{size:12,children:e.jsx(We,{fullWidth:!0,label:`Resolution Note ${U?"*":"(Optional)"}`,multiline:!0,rows:4,value:h,onChange:l=>{E(l.target.value),H({...P,note:!0})},disabled:j,placeholder:W?"Describe how the complaint was resolved...":"Add any notes about the progress...",error:!!d,helperText:d||`${h.length}/${be} characters${U?` (minimum ${Se})`:""}`,inputProps:{maxLength:be},required:U})}),e.jsx(f,{size:12,children:e.jsx(r,{sx:{p:2,bgcolor:W?"success.lighter":"info.lighter",borderRadius:1,border:"1px solid",borderColor:W?"success.light":"info.light"},children:e.jsxs(t,{variant:"body2",color:W?"success.dark":"info.dark",children:[e.jsx("strong",{children:"Note:"})," ",W?e.jsxs(e.Fragment,{children:["This complaint will be marked as ",e.jsx("strong",{children:"Resolved"}),". The user will receive a notification with your resolution images and notes. They will be able to submit a review after viewing the resolution."]}):e.jsxs(e.Fragment,{children:["This complaint will be marked as ",e.jsx("strong",{children:"In Progress"}),". The user will receive a notification that their complaint is being processed."]})]})})})]})]}),e.jsxs(Us,{sx:{borderTop:"1px solid #e0e0e0",px:3,py:2,gap:1.5,flexDirection:{xs:"column-reverse",sm:"row"},"& > button":{width:{xs:"100%",sm:"auto"},minHeight:{xs:48,sm:36}}},children:[e.jsx(F,{onClick:X,disabled:j,color:"inherit",variant:"outlined",children:"Cancel"}),e.jsx(F,{onClick:Ce,variant:"contained",color:W?"success":"primary",disabled:j||!Q(),startIcon:j?void 0:e.jsx(Bs,{}),children:j?"Updating...":W?"Mark as Resolved":"Mark as In Progress"})]})]})},Tr=({review:i})=>{var y,u,w;const c=Os(),x=i.user?`${i.user.firstName} ${i.user.lastName}`:"Anonymous User",s=(m,h)=>!m||!h?"AU":`${m.charAt(0)}${h.charAt(0)}`.toUpperCase(),S=m=>{try{const h=new Date(m);return hr(h,{addSuffix:!0})}catch{return"Recently"}};return e.jsx(z,{sx:{mb:2,boxShadow:c.shadows[1],transition:"box-shadow 0.3s ease","&:hover":{boxShadow:c.shadows[3]},borderRadius:2},children:e.jsx(dr,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(R,{src:((y=i.user)==null?void 0:y.avatar)||void 0,alt:x,sx:{width:48,height:48,bgcolor:c.palette.primary.main,fontSize:"1rem",fontWeight:600},children:s((u=i.user)==null?void 0:u.firstName,(w=i.user)==null?void 0:w.lastName)}),e.jsxs(r,{sx:{flex:1,minWidth:0},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,color:c.palette.text.primary,mb:.5},children:x}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(xr,{value:i.rating,readOnly:!0,precision:1,size:"small",sx:{color:c.palette.warning.main}}),e.jsxs(t,{variant:"body2",sx:{color:c.palette.text.secondary,fontWeight:500},children:["(",i.rating," ",i.rating===1?"star":"stars",")"]})]}),i.comment&&e.jsxs(t,{variant:"body2",sx:{color:c.palette.text.secondary,mb:1,lineHeight:1.6,fontStyle:"italic",wordBreak:"break-word"},children:['"',i.comment,'"']}),e.jsx(t,{variant:"caption",sx:{color:c.palette.text.disabled,display:"block"},children:S(i.createdAt)})]})]})})})},Wr={CORPORATION_INTERNAL:{label:"Corporation Internal",description:"Issues within city corporation jurisdiction handled by specific departments"},CORPORATION_EXTERNAL:{label:"Corporation External",description:"Issues outside city corporation jurisdiction handled by external agencies"}},Or={CORPORATION_INTERNAL:["Engineering","Electricity","Health","Property (Eviction)"],CORPORATION_EXTERNAL:["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"]},Pr=({open:i,onClose:c,onSave:x,complaint:s,type:S,loading:y=!1})=>{var B;const[u,w]=n.useState(s.status),[m,h]=n.useState(s.resolutionNote||""),[E,p]=n.useState([]),[b,v]=n.useState([]),[M,j]=n.useState([]),[T,G]=n.useState(""),[L,P]=n.useState("");n.useEffect(()=>{i&&(w(s.status),h(s.resolutionNote||""),G(s.category||""),P(s.subcategory||""),s.resolutionImages?p(s.resolutionImages.split(",").filter(d=>d.trim())):p([]),v([]),j([]))},[i,s]);const H=d=>{G(d),P("")},K=d=>{if(d.target.files){const I=Array.from(d.target.files),N=[...b,...I];v(N);const Q=I.map($=>URL.createObjectURL($));j([...M,...Q])}},V=d=>{p(E.filter((I,N)=>N!==d))},W=d=>{v(b.filter((I,N)=>N!==d)),URL.revokeObjectURL(M[d]),j(M.filter((I,N)=>N!==d))},U=async()=>{try{await x({status:u,note:m,existingImages:E,newImages:b,category:u==="OTHERS"?T:void 0,subcategory:u==="OTHERS"?L:void 0}),c()}catch(d){console.error("Failed to save resolution changes:",d)}};return e.jsxs(we,{open:i,onClose:c,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Ps,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Edit ",S==="RESOLVED"?"Resolution":"Others"," Details",e.jsx(D,{onClick:c,size:"small",children:e.jsx(Y,{})})]}),e.jsx(Ms,{dividers:!0,children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(Re,{fullWidth:!0,children:[e.jsx(Ee,{children:"Status"}),e.jsxs(Ne,{value:u,label:"Status",onChange:d=>w(d.target.value),children:[e.jsx(te,{value:"RESOLVED",children:"RESOLVED"}),e.jsx(te,{value:"OTHERS",children:"OTHERS"}),e.jsx(te,{value:"IN_PROGRESS",children:"IN PROGRESS"}),e.jsx(te,{value:"PENDING",children:"PENDING"})]})]}),u==="OTHERS"&&e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{size:{xs:12},children:e.jsxs(Re,{fullWidth:!0,required:!0,children:[e.jsx(Ee,{children:"Category"}),e.jsx(Ne,{value:T,label:"Category",onChange:d=>H(d.target.value),children:Object.entries(Wr).map(([d,I])=>e.jsx(te,{value:d,children:I.label},d))})]})}),e.jsx(f,{size:{xs:12},children:e.jsxs(Re,{fullWidth:!0,required:!0,disabled:!T,children:[e.jsx(Ee,{children:"Sub Category"}),e.jsx(Ne,{value:L,label:"Sub Category",onChange:d=>P(d.target.value),children:T&&((B=Or[T])==null?void 0:B.map(d=>e.jsx(te,{value:d,children:d},d)))})]})})]}),e.jsx(We,{label:u==="RESOLVED"?"Resolution Note":"Admin Note",multiline:!0,rows:4,value:m,onChange:d=>h(d.target.value),placeholder:u==="RESOLVED"?"Enter resolution details (min 20 chars)...":"Enter note here...",fullWidth:!0,error:u==="RESOLVED"&&m.length<20,helperText:u==="RESOLVED"&&m.length<20?`Note must be at least 20 characters (${m.length}/20)`:""}),e.jsxs(r,{children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1},children:"Images"}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[E.map((d,I)=>e.jsxs(r,{sx:{position:"relative",width:80,height:80},children:[e.jsx("img",{src:d,alt:`Existing ${I}`,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4}}),e.jsx(D,{size:"small",sx:{position:"absolute",top:-8,right:-8,bgcolor:"background.paper","&:hover":{bgcolor:"error.light",color:"white"}},onClick:()=>V(I),children:e.jsx(Y,{fontSize:"small"})})]},`existing-${I}`)),M.map((d,I)=>e.jsxs(r,{sx:{position:"relative",width:80,height:80},children:[e.jsx("img",{src:d,alt:`New ${I}`,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4,opacity:.8}}),e.jsx(D,{size:"small",sx:{position:"absolute",top:-8,right:-8,bgcolor:"background.paper","&:hover":{bgcolor:"error.light",color:"white"}},onClick:()=>W(I),children:e.jsx(Y,{fontSize:"small"})})]},`new-${I}`)),e.jsxs(F,{variant:"outlined",component:"label",sx:{width:80,height:80,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:1,borderStyle:"dashed"},children:[e.jsx($s,{}),e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:K})]})]}),u==="RESOLVED"&&E.length===0&&b.length===0&&e.jsx(t,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:"At least one image is required for RESOLVED status."})]})]})}),e.jsxs(Us,{children:[e.jsx(F,{onClick:c,disabled:y,children:"Cancel"}),e.jsx(F,{onClick:U,variant:"contained",disabled:y||u==="RESOLVED"&&(m.length<20||E.length===0&&b.length===0)||u==="OTHERS"&&(!T||!L),children:y?"Saving...":"Save Changes"})]})]})},qr=()=>{var Be,$e,Fe,_e,Ge,He,Ve,Ze,Je,qe,Xe,Ye,Ke,Qe,es,ss,rs,os,ts,is,as,ns,ls,cs,ds,xs,hs,fs,ps,us,gs,bs,ms,js,ys,vs,Ss,ws;const{id:i}=fr(),c=pr(),{user:x}=ur();n.useRef(null);const[s,S]=n.useState(null),[y,u]=n.useState(!0),[w,m]=n.useState(null),[h,E]=n.useState(!1),[p,b]=n.useState(null),[v,M]=n.useState(!1),[j,T]=n.useState(!1),[G,L]=n.useState("IN_PROGRESS"),[P,H]=n.useState([]),[K,V]=n.useState(!1),W=n.useRef(null),[U,B]=n.useState([]),[d,I]=n.useState(!1),[N,Q]=n.useState(""),[$,je]=n.useState(!1),[Z,re]=n.useState(null),[Oe,ye]=n.useState(!1),[Ce,X]=n.useState(!1),[l,C]=n.useState("RESOLVED"),[g,O]=n.useState({open:!1,audioUrl:null,index:0}),oe=()=>{const o=[];return o.push({id:1,action:"Complaint Submitted",date:new Date((s==null?void 0:s.createdAt)||"").toLocaleString("en-US"),description:"The complaint has been successfully submitted"}),s!=null&&s.status&&s.status!=="PENDING"&&o.push({id:2,action:s.status==="IN_PROGRESS"?"In Progress":s.status==="RESOLVED"?"Resolved":"Rejected",date:new Date((s==null?void 0:s.updatedAt)||"").toLocaleString("en-US"),description:s.status==="IN_PROGRESS"?"The complaint is now in progress":s.status==="RESOLVED"?"The complaint has been resolved":"The complaint has been rejected"}),o},ee=n.useCallback(()=>{W.current&&W.current.scrollIntoView({behavior:"smooth"})},[]);n.useEffect(()=>{i&&(pe(),Js(),Hs())},[i]);const Pe=o=>{C(o),X(!0)},Me=async()=>{if(!(!s||!window.confirm("Are you sure you want to delete this resolution/report? This will revert the status to IN PROGRESS.")))try{await ne.updateComplaintStatus(s.id,{status:"IN_PROGRESS",note:"Resolution deleted by admin",resolutionNote:"",resolutionImages:""}),pe(),ce("Resolution deleted successfully. Status reverted to In Progress.")}catch(o){console.error("Failed to delete resolution:",o),le("Failed to delete resolution.")}},Fs=async(o,a)=>{s&&O({open:!0,audioUrl:o,index:a})},_s=async()=>{if(!(!s||!g.audioUrl))try{const o=s.audioUrls.filter(k=>k!==g.audioUrl),a=await ne.updateComplaintAudioUrls(s.id,o);S(a),O({open:!1,audioUrl:null,index:0}),ce("Voice recording deleted successfully.")}catch(o){console.error("Failed to delete audio recording:",o),le("Failed to delete audio recording.")}},Le=()=>{O({open:!1,audioUrl:null,index:0})},Gs=async o=>{var a,k;if(s)try{await ne.updateComplaintStatus(s.id,{status:o.status,resolutionNote:o.note,resolutionImages:o.existingImages.join(","),resolutionImageFiles:o.newImages,category:o.category,subcategory:o.subcategory}),X(!1),pe(),ce("Resolution updated successfully.")}catch(A){console.error("Failed to save resolution changes:",A);const _=((k=(a=A.response)==null?void 0:a.data)==null?void 0:k.message)||A.message||"Failed to save resolution changes.";le(_)}},pe=async()=>{try{u(!0),m(null);const o=await ne.getComplaintById(Number(i));S(o),o.reviews&&H(o.reviews)}catch(o){console.error("Error fetching complaint details:",o),m("Failed to load complaint details"),le("Failed to load complaint details")}finally{u(!1)}},Hs=async()=>{var o;if(i)try{V(!0);const a=await fetch(`/api/complaints/${i}/reviews`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const k=await a.json();H(((o=k.data)==null?void 0:o.reviews)||[])}}catch(a){console.error("Error fetching reviews:",a)}finally{V(!1)}},Vs=async(o,a,k,A)=>{if(s)try{E(!0),await ne.markComplaintAsOthers(s.id,{othersCategory:o,othersSubcategory:a,note:k,images:A}),M(!1),await pe(),ce("Complaint marked as Others successfully")}catch(_){console.error("Error marking as others:",_),le("Failed to mark as others")}finally{E(!1)}},Zs=async()=>{await pe(),T(!1),ce("Status updated successfully")},se=async o=>{if(s){if(o==="RESOLVED"||o==="IN_PROGRESS"){L(o),T(!0);return}try{E(!0);const a=await ne.updateComplaintStatus(s.id,{status:o});S(a),ce("Status updated successfully")}catch(a){console.error("Error updating status:",a),le("Failed to update status")}finally{E(!1)}}},Js=async()=>{if(i)try{I(!0);const{messages:o}=await ie.getChatMessages(Number(i));B(o),await ie.markAsRead(Number(i))}catch(o){console.error("Error fetching chat messages:",o)}finally{I(!1)}};n.useEffect(()=>{ee()},[U,ee]),n.useEffect(()=>{if(i)return ie.startPolling(Number(i),o=>{B(o)}),()=>{ie.stopPolling(Number(i))}},[i]);const Ue=async()=>{if(!(!i||!N.trim()&&!Z))try{je(!0);let o;Z?o=await ie.sendMessageWithFile(Number(i),N.trim()||"Image",Z.file):o=await ie.sendMessage(Number(i),{message:N.trim()}),B(a=>[...a,o]),Q(""),re(null),ee(),ae.success("Message sent successfully",{icon:"âœ…"})}catch(o){const a=As(o);ae.error(a.userMessage,{duration:5e3,icon:"âŒ"})}finally{je(!1)}},qs=async o=>{var k;const a=(k=o.target.files)==null?void 0:k[0];if(a){if(!a.type.startsWith("image/")){ae.error("Please select an image file",{icon:"âŒ"});return}if(a.size>5*1024*1024){ae.error("Image size must be less than 5MB",{icon:"âŒ"});return}try{ye(!0);const A=new FileReader;A.onloadend=()=>{re({file:a,preview:A.result})},A.readAsDataURL(a),ae.success("Image ready to send",{icon:"âœ…"})}catch(A){const _=As(A);ae.error(_.userMessage,{icon:"âŒ"}),re(null)}finally{ye(!1)}}},Xs=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),Ue())},Ys=o=>{switch(o){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724"};case"REJECTED":return{backgroundColor:"#f8d7da",color:"#721c24"};default:return{backgroundColor:"#f8f9fa",color:"#6c757d"}}},Ks=o=>{switch(o){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Solved";case"REJECTED":return"Others";default:return o}};return y?e.jsx(ke,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(xe,{size:60,sx:{color:"#4CAF50"}})})}):w||!s?e.jsx(ke,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:e.jsxs(r,{sx:{p:3},children:[e.jsx(Ls,{severity:"error",sx:{mb:2},children:w||"Complaint not found"}),e.jsx(F,{variant:"outlined",startIcon:e.jsx(zs,{}),onClick:()=>c("/complaints"),children:"Back to Complaints"})]})}):e.jsxs(ke,{title:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",children:[e.jsxs(r,{sx:{p:{xs:2,md:3},maxWidth:1400,mx:"auto",backgroundColor:"#f9fafb",minHeight:"100vh"},children:[e.jsx(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:e.jsxs(r,{sx:{p:{xs:2,md:2.5}},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(D,{onClick:()=>c("/complaints"),sx:{color:"#3fa564",backgroundColor:"#f0fdf4","&:hover":{backgroundColor:"#dcfce7"},width:40,height:40},children:e.jsx(zs,{})}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(t,{variant:"h5",sx:{fontWeight:700,color:"#1e2939",fontSize:{xs:"1.25rem",md:"1.5rem"},mb:.5},children:["à¦…à¦­à¦¿à¦¯à§‹à¦— #",s.trackingNumber||`CC-${String(s.id).padStart(7,"0")}`]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(gr,{sx:{fontSize:16,color:"#6b7280"}}),e.jsx(t,{variant:"body2",sx:{color:"#6b7280",fontSize:"0.875rem"},children:new Date(s.createdAt).toLocaleDateString("bn-BD")})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(mr,{sx:{fontSize:16,color:"#6b7280"}}),e.jsx(t,{variant:"body2",sx:{color:"#6b7280",fontSize:"0.875rem"},children:vr(s.createdAt)})]})]})]}),e.jsx(he,{label:Ks(s.status),sx:{...Ys(s.status),fontWeight:600,fontSize:"0.875rem",height:32,px:2,borderRadius:2}})]}),s.category&&e.jsx(r,{sx:{mt:2},children:e.jsx(kr,{categoryId:s.category,subcategoryId:s.subcategory})})]})}),e.jsxs(f,{container:!0,spacing:2.5,children:[e.jsxs(f,{size:{xs:12,md:7},children:[e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦…à¦­à¦¿à¦¯à§‹à¦—à§‡à¦° à¦¬à¦¿à¦¸à§à¦¤à¦¾à¦°à¦¿à¦¤"})}),e.jsxs(r,{sx:{p:3},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:2,color:"#1e2939"},children:s.title}),e.jsx(f,{container:!0,spacing:2,sx:{mb:3},children:e.jsx(f,{size:{xs:12},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(R,{sx:{width:32,height:32,bgcolor:"#f0fdf4",color:"#3fa564"},children:e.jsx(Cs,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦²à§‹à¦•à§‡à¦¶à¦¨"}),e.jsx(t,{variant:"body1",sx:{color:"#1e2939"},children:s.location}),e.jsxs(r,{sx:{display:"flex",gap:2,mt:1,flexWrap:"wrap"},children:[(s.zone||((Be=s.user)==null?void 0:Be.zone))&&e.jsx(he,{label:`Zone: ${(($e=s.zone)==null?void 0:$e.name)||((_e=(Fe=s.user)==null?void 0:Fe.zone)==null?void 0:_e.name)||"N/A"}`,size:"small",sx:{bgcolor:"#eff6ff",color:"#1d4ed8",border:"1px solid #dbeafe",fontSize:"0.75rem"}}),(s.wards||((Ge=s.user)==null?void 0:Ge.ward))&&e.jsx(he,{label:`Ward: ${((He=s.wards)==null?void 0:He.wardNumber)||((Ze=(Ve=s.user)==null?void 0:Ve.ward)==null?void 0:Ze.wardNumber)||"N/A"}`,size:"small",sx:{bgcolor:"#fdf2f8",color:"#be185d",border:"1px solid #fce7f3",fontSize:"0.75rem"}})]})]})]})})}),e.jsxs(r,{sx:{backgroundColor:"#f9fafb",p:2.5,borderRadius:2,border:"1px solid #f3f4f6"},children:[e.jsx(t,{variant:"subtitle2",sx:{fontWeight:700,mb:1,color:"#374151"},children:"à¦¬à¦¿à¦¬à¦°à¦£:"}),e.jsx(t,{variant:"body2",sx:{whiteSpace:"pre-wrap",color:"#4b5563",lineHeight:1.6},children:s.description||"à¦•à§‹à¦¨ à¦¬à¦¿à¦¬à¦°à¦£ à¦ªà§à¦°à¦¦à¦¾à¦¨ à¦•à¦°à¦¾ à¦¹à¦¯à¦¼à¦¨à¦¿"})]})]})]}),(s.status==="RESOLVED"||s.resolutionNote||s.resolutionImages)&&e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f0fdf4"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ue,{sx:{color:"#15803d"}}),e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#14532d"},children:"à¦¸à¦®à¦¾à¦§à¦¾à¦¨à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£ (Resolution Details)"})]})}),e.jsxs(r,{sx:{p:3},children:[s.status==="OTHERS"&&e.jsxs(r,{sx:{mb:3,p:2,bgcolor:"#fff7ed",borderRadius:1,border:"1px solid #ffedd5"},children:[e.jsx(t,{variant:"subtitle2",sx:{fontWeight:700,color:"#c2410c",mb:1},children:"à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯ à¦•à§à¦¯à¦¾à¦Ÿà¦¾à¦—à¦°à¦¿ à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦šà¦¿à¦¹à§à¦¨à¦¿à¦¤ (Marked as Others):"}),e.jsxs(t,{variant:"body2",sx:{color:"#9a3412",display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Category:"})," ",s.othersCategory==="CORPORATION_INTERNAL"?"Corp. Internal":s.othersCategory==="CORPORATION_EXTERNAL"?"Corp. External":s.othersCategory]}),s.othersSubcategory&&e.jsxs("span",{children:[e.jsx("strong",{children:"Sub-category:"})," ",s.othersSubcategory]})]})]}),s.resolutionNote&&e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(t,{variant:"subtitle2",sx:{fontWeight:700,color:"#374151"},children:(()=>{var k,A;const o=(k=s.statusHistory)==null?void 0:k.find(_=>_.newStatus==="RESOLVED"||_.newStatus==="OTHERS"),a=(A=o==null?void 0:o.changer)==null?void 0:A.role;return a==="MASTER_ADMIN"?"à¦®à¦¾à¦¸à§à¦Ÿà¦¾à¦° à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦®à¦¨à§à¦¤à¦¬à§à¦¯ (Master Admin Note):":a==="SUPER_ADMIN"?"à¦¸à§à¦ªà¦¾à¦° à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦®à¦¨à§à¦¤à¦¬à§à¦¯ (Super Admin Note):":"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦®à¦¨à§à¦¤à¦¬à§à¦¯ (Ward Admin Note):"})()}),e.jsxs(r,{children:[e.jsx(D,{size:"small",onClick:()=>Pe("RESOLVED"),color:"primary",children:e.jsx(Rs,{fontSize:"small"})}),e.jsx(D,{size:"small",onClick:Me,color:"error",children:e.jsx(fe,{fontSize:"small"})})]})]}),e.jsx(t,{variant:"body1",sx:{color:"#1f2937",whiteSpace:"pre-wrap",backgroundColor:"#ffffff",p:2,borderRadius:1,border:"1px solid #e5e7eb"},children:s.resolutionNote})]}),s.resolutionImages&&e.jsxs(r,{children:[e.jsx(t,{variant:"subtitle2",sx:{fontWeight:700,mb:1.5,color:"#374151"},children:"à¦•à¦¾à¦œà§‡à¦° à¦ªà§à¦°à¦®à¦¾à¦£ (Proof of Work):"}),e.jsx(r,{sx:{display:"flex",gap:1.5,flexWrap:"wrap"},children:s.resolutionImages.split(",").filter(o=>o.trim()).map((o,a)=>e.jsx(r,{component:"img",src:o.trim(),alt:`Resolution Proof ${a+1}`,sx:{width:{xs:"100%",sm:"calc(50% - 12px)",md:"calc(33.333% - 12px)"},maxWidth:300,height:200,objectFit:"cover",borderRadius:2,border:"1px solid #e5e7eb",cursor:"pointer",transition:"all 0.2s","&:hover":{transform:"scale(1.02)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},onClick:()=>b(o.trim())},a))})]})]})]}),(s.status==="RESOLVED"||s.status==="OTHERS")&&e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:["User Reviews (",P.length,")"]}),K&&e.jsx(xe,{size:20,sx:{color:"#3fa564"}})]})}),e.jsx(r,{sx:{p:3},children:K?e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(xe,{size:30,sx:{color:"#3fa564"}})}):P.length===0?e.jsx(r,{sx:{textAlign:"center",py:4},children:e.jsx(t,{variant:"body2",sx:{color:"#6b7280"},children:"No reviews yet. User can submit a review after complaint is resolved or marked as others."})}):e.jsx(r,{children:P.map(o=>e.jsx(Tr,{review:o},o.id))})})]}),(((Je=s.wards)==null?void 0:Je.inspectorName)||((qe=s.zone)==null?void 0:qe.officerName))&&e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦¦à¦¾à¦¯à¦¼à¦¿à¦¤à§à¦¬à¦ªà§à¦°à¦¾à¦ªà§à¦¤ à¦•à¦°à§à¦®à¦•à¦°à§à¦¤à¦¾à¦—à¦£"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(f,{container:!0,spacing:2,children:[((Xe=s.wards)==null?void 0:Xe.inspectorName)&&e.jsx(f,{size:{xs:12},children:e.jsx(r,{sx:{p:2,border:"1px solid #bfdbfe",borderRadius:2,backgroundColor:"#eff6ff"},children:e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(R,{sx:{bgcolor:"#fff",color:"#2563eb",width:48,height:48,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e.jsx(Es,{})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"Ward Inspector / à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦‡à¦¨à§à¦¸à¦ªà§‡à¦•à§à¦Ÿà¦°"}),e.jsx(t,{variant:"subtitle1",sx:{fontWeight:700,color:"#1e2939"},children:s.wards.inspectorName}),s.wards.inspectorPhone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(ge,{sx:{fontSize:16,color:"#2563eb"}}),e.jsx(t,{variant:"body2",sx:{color:"#4b5563",fontWeight:500},children:s.wards.inspectorPhone})]})]})]})})}),((Ye=s.zone)==null?void 0:Ye.officerName)&&e.jsx(f,{size:{xs:12},children:e.jsx(r,{sx:{p:2,border:"1px solid #fed7aa",borderRadius:2,backgroundColor:"#fff7ed"},children:e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(R,{sx:{bgcolor:"#fff",color:"#f97316",width:48,height:48,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e.jsx(ve,{})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"Zone Officer / à¦œà§‹à¦¨ à¦…à¦«à¦¿à¦¸à¦¾à¦°"}),e.jsx(t,{variant:"subtitle1",sx:{fontWeight:700,color:"#1e2939"},children:s.zone.officerName}),s.zone.officerPhone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(ge,{sx:{fontSize:16,color:"#f97316"}}),e.jsx(t,{variant:"body2",sx:{color:"#4b5563",fontWeight:500},children:s.zone.officerPhone})]})]})]})})})]})})]}),e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦…à¦­à¦¿à¦¯à§‹à¦—à¦•à¦¾à¦°à§€à¦° à¦¤à¦¥à§à¦¯ (Complainant Info)"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(R,{sx:{width:36,height:36,bgcolor:"#f0fdf4",color:"#3fa564"},children:e.jsx(ve,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¨à¦¾à¦®"}),e.jsxs(t,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:[s.user.firstName," ",s.user.lastName]})]})]})}),e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(R,{sx:{width:36,height:36,bgcolor:"#eff6ff",color:"#2563eb"},children:e.jsx(ge,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦«à§‹à¦¨ à¦¨à¦®à§à¦¬à¦°"}),e.jsx(t,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:s.user.phone||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"})]})]})}),s.user.email&&e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(R,{sx:{width:36,height:36,bgcolor:"#fef3c7",color:"#d97706"},children:e.jsx(Ns,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦‡à¦®à§‡à¦‡à¦²"}),e.jsx(t,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:s.user.email})]})]})}),s.user.address&&e.jsx(f,{size:{xs:12},children:e.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(R,{sx:{width:36,height:36,bgcolor:"#f3e8ff",color:"#7c3aed"},children:e.jsx(Cs,{fontSize:"small"})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦ à¦¿à¦•à¦¾à¦¨à¦¾"}),e.jsx(t,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:s.user.address})]})]})})]})})]}),e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦²à§‹à¦•à§‡à¦¶à§‹ à¦“ à¦•à§à¦¯à¦¾à¦Ÿà¦¾à¦—à¦°à¦¿"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨"}),e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"#3fa564"},children:((Ke=s.cityCorporation)==null?void 0:Ke.name)||((Qe=s.cityCorporation)==null?void 0:Qe.nameBangla)||(typeof((es=s.user)==null?void 0:es.cityCorporation)=="object"?(ss=s.user.cityCorporation)==null?void 0:ss.name:null)||(typeof((rs=s.user)==null?void 0:rs.cityCorporation)=="string"?s.user.cityCorporation:"à¦¢à¦¾à¦•à¦¾ à¦‰à¦¤à§à¦¤à¦° à¦¸à¦¿à¦Ÿà¦¿ à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨")})]})}),e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡"}),e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:((os=s.wards)==null?void 0:os.displayName)||((ts=s.wards)!=null&&ts.wardNumber?`Ward ${s.wards.wardNumber}`:null)||((is=s.wards)!=null&&is.number?`Ward ${s.wards.number}`:null)||(typeof((as=s.user)==null?void 0:as.ward)=="object"?((ns=s.user.ward)==null?void 0:ns.wardNumber)||((ls=s.user.ward)==null?void 0:ls.number):(cs=s.user)==null?void 0:cs.ward)||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"})]})}),e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦œà§‹à¦¨"}),e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:((ds=s.zone)==null?void 0:ds.displayName)||((xs=s.zone)==null?void 0:xs.name)||((hs=s.zone)!=null&&hs.zoneNumber?`Zone ${s.zone.zoneNumber}`:null)||(typeof((fs=s.user)==null?void 0:fs.zone)=="object"?((ps=s.user.zone)==null?void 0:ps.name)||((us=s.user.zone)==null?void 0:us.zoneNumber):(gs=s.user)==null?void 0:gs.zone)||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"})]})}),e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2,height:"100%"},children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block",mb:.5},children:"à¦¥à¦¾à¦¨à¦¾"}),e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"#1e2939"},children:((bs=s.user.thana)==null?void 0:bs.name)||"à¦®à¦¿à¦°à¦ªà§à¦°"})]})})]})})]}),s.imageUrls&&s.imageUrls.length>0&&e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.01)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsxs(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:["ðŸ“· à¦¸à¦‚à¦¯à§à¦•à§à¦¤ à¦›à¦¬à¦¿ (",s.imageUrls.length,")"]})}),e.jsx(r,{sx:{p:2},children:e.jsx(De,{cols:2,gap:12,children:s.imageUrls.map((o,a)=>e.jsxs(Te,{sx:{cursor:"pointer",borderRadius:2,overflow:"hidden",position:"relative",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover .zoom-icon":{opacity:1},"&:hover img":{transform:"scale(1.05)"}},onClick:()=>b(o),children:[e.jsx("img",{src:o,alt:`Complaint image ${a+1}`,loading:"lazy",style:{width:"100%",height:160,objectFit:"cover",transition:"transform 0.3s ease"}}),e.jsx(r,{className:"zoom-icon",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.4)",opacity:0,transition:"opacity 0.3s"},children:e.jsx(jr,{sx:{color:"white",fontSize:32}})})]},a))})})]}),s.audioUrls&&s.audioUrls.length>0&&e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f0fdf4"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ws,{sx:{color:"#15803d"}}),e.jsxs(t,{variant:"h6",sx:{fontWeight:700,color:"#14532d"},children:["ðŸŽ¤ à¦­à¦¯à¦¼à§‡à¦¸ à¦°à§‡à¦•à¦°à§à¦¡à¦¿à¦‚ (",s.audioUrls.length,")"]})]}),(x==null?void 0:x.role)==="MASTER_ADMIN"&&e.jsx(ks,{title:"Master Admin can delete audio recordings",children:e.jsx(he,{label:"Deletable",size:"small",sx:{bgcolor:"#fef3c7",color:"#92400e",fontSize:"0.75rem",fontWeight:600}})})]})}),e.jsx(r,{sx:{p:3},children:s.audioUrls.map((o,a)=>e.jsxs(r,{sx:{mb:a<s.audioUrls.length-1?2:0,p:2,backgroundColor:"#f9fafb",borderRadius:2,border:"1px solid #e5e7eb",position:"relative"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.5},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(R,{sx:{bgcolor:"#dcfce7",color:"#15803d",width:32,height:32},children:e.jsx(Ws,{fontSize:"small"})}),e.jsxs(t,{variant:"subtitle2",sx:{fontWeight:600,color:"#1e2939"},children:["Voice Recording ",a+1]})]}),(x==null?void 0:x.role)==="MASTER_ADMIN"&&e.jsx(ks,{title:"Delete this audio recording",children:e.jsx(D,{size:"small",onClick:()=>Fs(o,a),sx:{color:"#dc2626","&:hover":{backgroundColor:"#fee2e2"}},children:e.jsx(fe,{fontSize:"small"})})})]}),e.jsxs("audio",{controls:!0,style:{width:"100%",height:40,borderRadius:8,outline:"none"},preload:"metadata",children:[e.jsx("source",{src:o,type:"audio/mpeg"}),e.jsx("source",{src:o,type:"audio/wav"}),e.jsx("source",{src:o,type:"audio/ogg"}),"Your browser does not support the audio element."]})]},a))})]}),e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦Ÿà¦¾à¦‡à¦®à¦²à¦¾à¦‡à¦¨"})}),e.jsx(r,{sx:{p:3},children:e.jsx(r,{sx:{display:"flex",flexDirection:"column"},children:oe().map((o,a)=>e.jsxs(r,{sx:{display:"flex",gap:2,position:"relative"},children:[a<oe().length-1&&e.jsx(r,{sx:{position:"absolute",left:11,top:24,bottom:-24,width:2,backgroundColor:"#e5e7eb",zIndex:0}}),e.jsx(r,{sx:{zIndex:1,mt:.5},children:e.jsx(r,{sx:{width:24,height:24,borderRadius:"50%",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid #fff",boxShadow:"0 0 0 2px #dcfce7"},children:e.jsx(ue,{sx:{color:"#3fa564",fontSize:16}})})}),e.jsxs(r,{sx:{flex:1,pb:3},children:[e.jsx(t,{variant:"body1",sx:{fontWeight:600,color:"#1e2939"},children:o.action}),e.jsx(t,{variant:"caption",sx:{display:"block",mb:.5,color:"#6b7280"},children:o.date}),e.jsx(t,{variant:"body2",sx:{color:"#4b5563",fontSize:"0.875rem"},children:o.description})]})]},o.id))})})]}),e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦¨à¦¾à¦—à¦°à¦¿à¦•à§‡à¦° à¦¤à¦¥à§à¦¯"})}),e.jsx(r,{sx:{p:3},children:e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(R,{src:s.user.avatar||void 0,sx:{bgcolor:"#eff6ff",color:"#1d4ed8"},children:!s.user.avatar&&e.jsx(ve,{})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦¨à¦¾à¦®"}),e.jsxs(t,{variant:"body1",sx:{fontWeight:600,color:"#1f2937"},children:[s.user.firstName," ",s.user.lastName]})]})]})}),e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(R,{sx:{bgcolor:"#f0fdf4",color:"#15803d"},children:e.jsx(ge,{})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦«à§‹à¦¨"}),e.jsx(t,{variant:"body1",component:"a",href:`tel:${s.user.phone}`,sx:{fontWeight:600,color:"#1f2937",textDecoration:"none","&:hover":{color:"#3fa564"}},children:s.user.phone||"N/A"})]})]})}),e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(R,{sx:{bgcolor:"#fff7ed",color:"#c2410c"},children:e.jsx(Ns,{})}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦‡à¦®à§‡à¦‡à¦²"}),e.jsx(t,{variant:"body1",component:"a",href:`mailto:${s.user.email}`,sx:{fontWeight:600,color:"#1f2937",textDecoration:"none","&:hover":{color:"#3fa564"},wordBreak:"break-all"},children:s.user.email||"N/A"})]})]})}),e.jsx(f,{size:{xs:12,sm:6},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(R,{sx:{bgcolor:"#f3f4f6",color:"#374151",fontSize:"0.8rem",fontWeight:700},children:"ID"}),e.jsxs(r,{children:[e.jsx(t,{variant:"caption",sx:{color:"#6b7280",display:"block"},children:"à¦‡à¦‰à¦œà¦¾à¦° à¦†à¦‡à¦¡à¦¿"}),e.jsxs(t,{variant:"body1",sx:{fontWeight:600,color:"#1f2937"},children:["CC-USER-",s.user.id]})]})]})})]})})]}),((ms=s.wards)==null?void 0:ms.inspectorName)&&e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦‡à¦¨à§à¦¸à¦ªà§‡à¦•à§à¦Ÿà¦°"})}),e.jsxs(r,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(R,{sx:{width:48,height:48,bgcolor:"#eff6ff",color:"#2563eb",fontWeight:600},children:((js=s.wards.inspectorName)==null?void 0:js.charAt(0))||"WI"}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.wards.inspectorName||"à¦¤à¦¥à§à¦¯ à¦¨à§‡à¦‡"}),e.jsxs(t,{variant:"caption",sx:{display:"block",color:"#6b7280",mt:.5},children:["Ward ",s.wards.wardNumber||s.wards.number||s.wards.id]}),s.wards.inspectorPhone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[e.jsx(ge,{sx:{fontSize:14,color:"#6b7280"}}),e.jsx(t,{variant:"body2",component:"a",href:`tel:${s.wards.inspectorPhone}`,sx:{color:"#6b7280",textDecoration:"none","&:hover":{color:"#3fa564"}},children:s.wards.inspectorPhone})]})]}),s.wards.inspectorPhone&&e.jsx(F,{variant:"outlined",size:"small",component:"a",href:`tel:${s.wards.inspectorPhone}`,sx:{borderColor:"#e5e7eb",color:"#374151"},children:"à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦—"})]})]}),((ys=s.zone)==null?void 0:ys.officerName)&&e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Zone Officer"})}),e.jsxs(r,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(R,{sx:{width:48,height:48,bgcolor:"#fff7ed",color:"#f97316",fontWeight:600},children:((vs=s.zone.officerName)==null?void 0:vs.charAt(0))||"ZO"}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.zone.officerName||"No Info"}),e.jsx(t,{variant:"caption",sx:{color:"#6b7280"},children:"Zone Officer"})]})]})]}),e.jsxs(z,{sx:{mb:3,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Admin Report"})}),e.jsxs(r,{sx:{p:3},children:[e.jsx(t,{variant:"body2",sx:{color:"#6b7280",mb:2},children:"This complaint is managed by"}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(R,{sx:{width:40,height:40,bgcolor:"#fff7ed",color:"#f97316"},children:((ws=(Ss=s.assignedAdmin)==null?void 0:Ss.firstName)==null?void 0:ws.charAt(0))||e.jsx(ve,{})}),e.jsxs(r,{children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,color:"#1f2937"},children:s.assignedAdmin?`${s.assignedAdmin.firstName} ${s.assignedAdmin.lastName}`:"Not Assigned Yet"}),e.jsx(t,{variant:"body2",sx:{color:"#6b7280"},children:s.assignedAdmin?"Ward Admin":"Pending"})]})]}),e.jsx(F,{variant:"outlined",fullWidth:!0,sx:{borderColor:"#3fa564",color:"#3fa564",textTransform:"none","&:hover":{backgroundColor:"#f0fdf4",borderColor:"#3fa564"}},children:"Assign New Admin"})]})]}),e.jsxs(z,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb"},children:[e.jsx(r,{sx:{p:2,borderBottom:"1px solid #f3f4f6",backgroundColor:"#f9fafb"},children:e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"#1e2939"},children:"Action"})}),e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{variant:"contained",onClick:()=>se("IN_PROGRESS"),loading:h,startIcon:e.jsx(ue,{}),sx:{backgroundColor:"#3fa564","&:hover":{backgroundColor:"#15803d"},textTransform:"none",px:3,flex:1},children:"Mark In Progress"}),e.jsx(J,{variant:"contained",onClick:()=>se("RESOLVED"),loading:h,startIcon:e.jsx(ue,{}),sx:{backgroundColor:"#15803d","&:hover":{backgroundColor:"#166534"},textTransform:"none",px:3,flex:1},children:"Mark Solved"})]}),s.status==="IN_PROGRESS"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{variant:"contained",onClick:()=>se("RESOLVED"),loading:h,startIcon:e.jsx(ue,{}),sx:{backgroundColor:"#3fa564","&:hover":{backgroundColor:"#15803d"},textTransform:"none",px:3,flex:1},children:"Mark Solved"}),e.jsx(J,{variant:"outlined",onClick:()=>se("PENDING"),loading:h,sx:{borderColor:"#f59e0b",color:"#d97706",textTransform:"none",px:3,"&:hover":{backgroundColor:"#fffbeb",borderColor:"#f59e0b"}},children:"Mark Pending"})]}),s.status==="RESOLVED"&&e.jsx(J,{variant:"outlined",onClick:()=>se("IN_PROGRESS"),loading:h,sx:{borderColor:"#3b82f6",color:"#2563eb",textTransform:"none",px:3,flex:1,"&:hover":{backgroundColor:"#eff6ff",borderColor:"#3b82f6"}},children:"Reopen (In Progress)"}),s.status==="REJECTED"&&e.jsx(J,{variant:"outlined",onClick:()=>se("PENDING"),loading:h,sx:{borderColor:"#f59e0b",color:"#d97706",textTransform:"none",px:3,flex:1,"&:hover":{backgroundColor:"#fffbeb",borderColor:"#f59e0b"}},children:"Reopen (Pending)"}),s.status==="OTHERS"&&e.jsx(J,{variant:"outlined",onClick:()=>se("PENDING"),loading:h,sx:{borderColor:"#f59e0b",color:"#d97706",textTransform:"none",px:3,flex:1,"&:hover":{backgroundColor:"#fffbeb",borderColor:"#f59e0b"}},children:"Reopen (Pending)"})]}),(s.status==="PENDING"||s.status==="IN_PROGRESS")&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{sx:{my:2},children:e.jsx(t,{variant:"caption",color:"text.secondary",children:"Other Actions"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"center",flexDirection:"column",gap:2},children:e.jsx(J,{variant:"outlined",onClick:()=>M(!0),loading:h,startIcon:e.jsx(Y,{}),sx:{borderColor:"#ef4444",color:"#ef4444",textTransform:"none",width:"100%","&:hover":{backgroundColor:"#fef2f2",borderColor:"#ef4444"}},children:"Mark as Others"})})]}),(s.status==="REJECTED"||s.status==="OTHERS")&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{sx:{my:2},children:e.jsx(t,{variant:"caption",color:"text.secondary",children:"Other Actions"})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"center",flexDirection:"column",gap:2},children:[e.jsx(J,{variant:"outlined",onClick:()=>M(!0),loading:h,startIcon:e.jsx(Y,{}),sx:{borderColor:"#ef4444",color:"#ef4444",textTransform:"none",width:"100%","&:hover":{backgroundColor:"#fef2f2",borderColor:"#ef4444"}},children:"Update Others Category"}),(s.othersCategory||s.category)&&e.jsxs(r,{sx:{p:2,bgcolor:"#fef2f2",borderRadius:1,border:"1px solid #fee2e2"},children:[e.jsx(t,{variant:"subtitle2",color:"error.main",gutterBottom:!0,children:"Marked as Others"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Category:"})," ",s.othersCategory||s.category]}),(s.othersSubcategory||s.subcategory)&&e.jsxs(t,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Sub-category:"})," ",s.othersSubcategory||s.subcategory]}),s.resolutionNote&&e.jsxs(r,{sx:{mt:1.5},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(t,{variant:"caption",sx:{fontWeight:600,color:"#ef4444"},children:(()=>{var k,A;const o=(k=s.statusHistory)==null?void 0:k.find(_=>_.newStatus==="OTHERS"),a=(A=o==null?void 0:o.changer)==null?void 0:A.role;return a==="SUPER_ADMIN"||a==="MASTER_ADMIN"?"Super Admin Note:":"Ward Admin Note:"})()}),e.jsxs(r,{children:[e.jsx(D,{size:"small",onClick:()=>Pe("OTHERS"),sx:{color:"#ef4444"},children:e.jsx(Rs,{fontSize:"small"})}),e.jsx(D,{size:"small",onClick:Me,sx:{color:"#ef4444"},children:e.jsx(fe,{fontSize:"small"})})]})]}),e.jsx(t,{variant:"body2",sx:{color:"#374151",bgcolor:"#fff",p:1,borderRadius:1,border:"1px solid #fee2e2",mt:.5,whiteSpace:"pre-wrap"},children:s.resolutionNote})]}),s.resolutionImages&&e.jsxs(r,{sx:{mt:1.5},children:[e.jsx(t,{variant:"caption",sx:{fontWeight:600,color:"#ef4444",display:"block",mb:.5},children:"Attached Images:"}),e.jsx(r,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:s.resolutionImages.split(",").filter(o=>o.trim()).map((o,a)=>e.jsx(r,{component:"img",src:o.trim(),alt:`Admin report ${a+1}`,sx:{width:60,height:60,objectFit:"cover",borderRadius:1,cursor:"pointer",border:"1px solid #fee2e2"},onClick:()=>b(o.trim())},a))})]}),s.status==="REJECTED"&&e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1,fontStyle:"italic"},children:"Note: This complaint is marked as REJECTED but contains Others/External categorization."})]})]})]})]})]})]}),e.jsx(f,{size:{xs:12,md:5},children:e.jsxs(z,{sx:{borderRadius:1.5,position:"sticky",top:16,boxShadow:"0 1px 4px rgba(0,0,0,0.08)",height:"calc(100vh - 48px)",maxHeight:"calc(100vh - 48px)",display:"flex",flexDirection:"column",overflow:"hidden",bgcolor:"#fff"},children:[e.jsxs(r,{sx:{p:1.5,borderBottom:"1px solid #e0e0e0",backgroundColor:"#fff",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(R,{sx:{width:40,height:40,bgcolor:"#f0fdf4",color:"#3fa564"},children:e.jsx(Es,{})}),e.jsxs(r,{children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:700,color:"#1e2939",lineHeight:1.2},children:"Messages & Discussion"}),e.jsx(t,{variant:"caption",sx:{color:"#6b7280"},children:"Direct communication with citizen"})]})]}),e.jsx(he,{label:d?"Connecting...":"Active Now",size:"small",color:d?"default":"success",variant:"outlined",sx:{height:24,borderRadius:1,fontSize:"0.7rem"}})]}),e.jsxs(r,{sx:{flex:1,overflowY:"auto",p:2,bgcolor:"#f9fafb",display:"flex",flexDirection:"column",gap:2},children:[d?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(xe,{size:30,sx:{color:"#3fa564"}})}):U.length===0?e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",opacity:.6},children:[e.jsx(Ds,{sx:{fontSize:48,color:"#cbd5e1",mb:2}}),e.jsx(t,{variant:"body2",sx:{color:"#6b7280"},children:"No messages yet"})]}):U.map(o=>{var a;return e.jsx(r,{sx:{display:"flex",flexDirection:"column",alignItems:o.senderType==="ADMIN"?"flex-end":"flex-start",maxWidth:"85%",alignSelf:o.senderType==="ADMIN"?"flex-end":"flex-start"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"end",gap:1,flexDirection:o.senderType==="ADMIN"?"row-reverse":"row"},children:[o.senderType==="CITIZEN"&&e.jsx(R,{sx:{width:24,height:24,bgcolor:"#eff6ff",color:"#3b82f6",fontSize:"0.7rem"},children:o.senderName?o.senderName.charAt(0):((a=s.user.firstName)==null?void 0:a.charAt(0))||"U"}),e.jsxs(r,{sx:{p:1.5,bgcolor:o.senderType==="ADMIN"?"#3fa564":"#fff",color:o.senderType==="ADMIN"?"#fff":"#1f2937",borderRadius:2,borderTopLeftRadius:o.senderType==="ADMIN"?8:0,borderTopRightRadius:o.senderType==="ADMIN"?0:8,boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative"},children:[o.senderType==="CITIZEN"?e.jsx(t,{variant:"caption",sx:{display:"block",mb:.5,fontSize:"0.65rem",fontWeight:700,color:"#3b82f6"},children:o.senderName||`${s.user.firstName} ${s.user.lastName}`}):o.senderRole&&e.jsx(t,{variant:"caption",sx:{display:"block",mb:.5,fontSize:"0.65rem",fontWeight:700,opacity:.9,color:o.senderType==="ADMIN"?"#e0f2fe":"inherit"},children:o.senderRole==="MASTER_ADMIN"?"Master Admin":o.senderRole==="SUPER_ADMIN"?"Super Admin":o.senderRole==="ADMIN"?"Ward Admin":o.senderRole}),o.imageUrl&&e.jsx(r,{sx:{mb:1,borderRadius:1,overflow:"hidden"},children:e.jsx("img",{src:o.imageUrl,alt:"Attachment",style:{maxWidth:"100%",maxHeight:150,objectFit:"cover",cursor:"pointer"},onClick:()=>b(o.imageUrl||null)})}),e.jsx(t,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"0.9rem"},children:o.message}),e.jsx(t,{variant:"caption",sx:{display:"block",mt:.5,fontSize:"0.7rem",opacity:.8,textAlign:"right"},children:new Date(o.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},o.id)}),e.jsx("div",{ref:W})]}),e.jsxs(r,{sx:{p:2,bgcolor:"#fff",borderTop:"1px solid #e0e0e0"},children:[Z&&e.jsxs(r,{sx:{mb:1,p:1,bgcolor:"#f0fdf4",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(t,{variant:"caption",sx:{color:"#166534"},children:"Image attached"}),e.jsx(D,{size:"small",onClick:()=>re(null),children:e.jsx(Y,{fontSize:"small"})})]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx("input",{accept:"image/*",style:{display:"none"},id:"icon-button-file",type:"file",onChange:qs,disabled:$}),e.jsx("label",{htmlFor:"icon-button-file",children:e.jsx(D,{color:"primary","aria-label":"upload picture",component:"span",disabled:$,sx:{color:"#6b7280","&:hover":{color:"#3fa564",bgcolor:"#f0fdf4"}},children:e.jsx(Bs,{})})}),e.jsx(We,{fullWidth:!0,multiline:!0,maxRows:4,placeholder:"Type your message...",value:N,onChange:o=>Q(o.target.value),onKeyPress:Xs,disabled:$,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:3,bgcolor:"#f9fafb","& fieldset":{borderColor:"#e5e7eb"},"&:hover fieldset":{borderColor:"#d1d5db"},"&.Mui-focused fieldset":{borderColor:"#3fa564",borderWidth:1}}}}),e.jsx(D,{onClick:Ue,disabled:$||!N.trim()&&!Z,sx:{bgcolor:"#3fa564",color:"white",width:40,height:40,"&:hover":{bgcolor:"#15803d"},"&.Mui-disabled":{bgcolor:"#e5e7eb",color:"#9ca3af"}},children:$?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Ds,{})})]})]})]})})]})]}),e.jsx(yr,{open:v,onClose:()=>M(!1),onConfirm:Vs,loading:h}),e.jsx(Dr,{open:j,complaintId:(s==null?void 0:s.id)||0,status:G,existingImages:(s==null?void 0:s.resolutionImages)||"",onClose:()=>T(!1),onSuccess:Zs}),p&&e.jsx(we,{open:!!p,onClose:()=>b(null),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{bgcolor:"transparent",boxShadow:"none",overflow:"hidden"}},children:e.jsxs(r,{sx:{position:"relative",bgcolor:"transparent",display:"flex",justifyContent:"center"},children:[e.jsx(D,{onClick:()=>b(null),sx:{position:"absolute",right:0,top:0,color:"white",bgcolor:"rgba(0,0,0,0.5)","&:hover":{bgcolor:"rgba(0,0,0,0.7)"},m:1},children:e.jsx(Y,{})}),e.jsx("img",{src:p,alt:"Full size",style:{maxWidth:"100%",maxHeight:"90vh",objectFit:"contain",borderRadius:8}})]})}),s&&e.jsx(Pr,{open:Ce,onClose:()=>X(!1),onSave:Gs,complaint:s,type:l}),e.jsx(we,{open:g.open,onClose:Le,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(r,{sx:{width:48,height:48,borderRadius:"50%",bgcolor:"error.light",display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:e.jsx(fe,{sx:{color:"error.main",fontSize:24}})}),e.jsxs(r,{children:[e.jsxs(t,{variant:"h6",fontWeight:600,color:"text.primary",children:["Delete Voice Recording ",g.index+1,"?"]}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"This action cannot be undone"})]})]}),e.jsx(Ae,{sx:{my:2}}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Are you sure you want to permanently delete this voice recording? Once deleted, it cannot be recovered."}),e.jsxs(r,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(F,{onClick:Le,variant:"outlined",color:"inherit",sx:{minWidth:100,textTransform:"none",fontWeight:500},children:"Cancel"}),e.jsx(F,{onClick:_s,variant:"contained",color:"error",sx:{minWidth:100,textTransform:"none",fontWeight:500,boxShadow:"none","&:hover":{boxShadow:"0 4px 12px rgba(211, 47, 47, 0.3)"}},children:"Delete"})]})]})})]})};export{qr as default};
