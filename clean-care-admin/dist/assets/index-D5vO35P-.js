const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/userManagementService-BZHXGcnY.js","assets/query-vendor-CZVuOxbJ.js","assets/react-vendor-D7yrL1sD.js","assets/mui-vendor-Brc-2iiC.js","assets/index-DBuvollO.js","assets/chart-vendor-CrjdDA16.js","assets/index-B1NrG30Q.css"])))=>i.map(i=>d[i]);
import{j as e,B as a,b6 as Dt,T as n,b as w,s as $e,t as He,i as Ie,v as Ge,w as Ke,H as Fe,p as ge,D as Ft,h as ft,O as Ve,J as pt,K as gt,N as nt,a6 as et,af as tt,a9 as st,C as Ne,b7 as ct,b8 as Ot,x as Qe,y as ut,ac as $t,A as _e,g as I,a1 as C,I as Te,V as Be,l as Oe,b9 as Ut,ba as yt,u as Zt,o as Vt,e as xt,f as ht,G as le,Z as qt,_ as at,av as rt,$ as qe,aN as _t,ap as Bt,P as Jt,aq as Ht,ar as Gt,as as De,at as j,m as mt,au as Kt,bb as Qt,bc as Xt,bd as Yt,be as es}from"./mui-vendor-Brc-2iiC.js";import{r as l,a as ts}from"./react-vendor-D7yrL1sD.js";import{u as Xe,f as jt,a as se,s as Ct,b as bt,j as ot,d as it,e as lt,k as vt,w as Je,_ as wt,U as ss,m as as,M as rs,Z as os}from"./index-DBuvollO.js";import{userManagementService as Se}from"./userManagementService-BZHXGcnY.js";import{f as ns}from"./format-DAszCIR7.js";import{L as is}from"./LiveChatConversationPanel-CqcdxjBE.js";import"./query-vendor-CZVuOxbJ.js";import"./chart-vendor-CrjdDA16.js";import"./ErrorDisplay-MT5puO9e.js";const ls=({icon:t,title:N,description:M,action:E})=>e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,px:3,textAlign:"center"},children:[e.jsx(a,{sx:{width:80,height:80,borderRadius:"50%",backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",mb:3},children:t||e.jsx(Dt,{sx:{fontSize:40,color:"#9e9e9e"}})}),e.jsx(n,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:1},children:N}),M&&e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:3,maxWidth:400},children:M}),E&&e.jsx(w,{variant:"contained",onClick:E.onClick,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3},children:E.label})]}),ds=({user:t,recentComplaints:N,open:M,onClose:E,onEdit:r})=>{var te,D,K,y,V;const{user:i}=Xe(),[m,b]=l.useState([]),[u,H]=l.useState([]),[G,P]=l.useState(!1),[ee,v]=l.useState(!1);l.useEffect(()=>{M&&t?(_(),Ae()):(b([]),H([]))},[M,t]);const _=async()=>{if(t)try{P(!0);const c=await Se.getUserReactions(t.id);b(c)}catch(c){console.error("Error fetching reactions:",c)}finally{P(!1)}},Ae=async()=>{if(t)try{v(!0);const c=await Se.getUserNoticeInteractions(t.id);H(c)}catch(c){console.error("Error fetching notice interactions:",c)}finally{v(!1)}};if(!t)return null;const de=c=>{switch(c){case"ACTIVE":return{backgroundColor:"#e8f5e8",color:"#2e7d2e"};case"INACTIVE":return{backgroundColor:"#f5f5f5",color:"#666666"};case"SUSPENDED":return{backgroundColor:"#ffebee",color:"#c62828"};case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},A=c=>{switch(c){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724"};case"REJECTED":return{backgroundColor:"#ffebee",color:"#c62828"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},$=c=>{if(!c)return"Never";try{return ns(new Date(c),"MMM dd, yyyy hh:mm a")}catch{return"Invalid date"}},z=t.statistics.totalComplaints>0?Math.round(t.statistics.resolvedComplaints/t.statistics.totalComplaints*100):0;return e.jsxs($e,{open:M,onClose:E,maxWidth:"md",fullWidth:!0,fullScreen:window.innerWidth<600,slotProps:{paper:{sx:{borderRadius:{xs:0,sm:2},animation:window.innerWidth<600?`${Ct} ${se.normal.duration} ${se.smooth.timing}`:`${bt} ${se.normal.duration} ${se.smooth.timing}`,animationFillMode:"both",maxHeight:{xs:"100vh",sm:"90vh"}}},backdrop:{sx:{animation:`${jt} ${se.fast.duration} ${se.fast.timing}`}}},children:[e.jsx(He,{component:"div",sx:{pb:{xs:1.5,sm:2}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"h5",sx:{fontWeight:600,fontSize:{xs:"1.25rem",sm:"1.5rem"}},children:"User Details"}),e.jsx(Ie,{onClick:E,size:"small",children:e.jsx(Ge,{})})]})}),e.jsxs(Ke,{dividers:!0,sx:{px:{xs:2,sm:3},py:{xs:2,sm:2}},children:[e.jsxs(a,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(a,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center",sm:"center"},gap:{xs:2,sm:3},mb:2},children:[e.jsxs(Fe,{sx:{width:{xs:64,sm:80},height:{xs:64,sm:80},bgcolor:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2rem"},fontWeight:600},src:t.avatar||void 0,children:[t.firstName[0],t.lastName[0]]}),e.jsxs(a,{sx:{flex:1,textAlign:{xs:"center",sm:"left"},width:{xs:"100%",sm:"auto"}},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:600,mb:.5,fontSize:{xs:"1rem",sm:"1.25rem"}},children:[t.firstName," ",t.lastName]}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:1,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["User ID: #",t.id.toString().padStart(6,"0")]}),e.jsxs(a,{sx:{display:"flex",gap:1,justifyContent:{xs:"center",sm:"flex-start"},flexWrap:"wrap"},children:[e.jsx(ge,{label:t.status,size:"small",sx:{...de(t.status),...ot,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}}),e.jsx(ge,{label:t.role,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",...ot,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}})]})]})]}),e.jsx(Ft,{sx:{my:{xs:1.5,sm:2}}}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(ft,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Email"}),e.jsx(n,{variant:"body2",sx:{wordBreak:"break-word",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:t.email||"Not provided"})]}),t.emailVerified&&e.jsx(Ve,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(pt,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{sx:{flex:1},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Phone"}),e.jsx(n,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:t.phone})]}),t.phoneVerified&&e.jsx(Ve,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(gt,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20},mt:.5}}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Location"}),t.cityCorporation&&e.jsx(n,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:500},children:t.cityCorporation.name}),e.jsxs(n,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Ward ",((te=t.ward)==null?void 0:te.wardNumber)??"N/A"," â€¢ Zone ",((D=t.zone)==null?void 0:D.zoneNumber)??"N/A"]}),((K=t.ward)==null?void 0:K.inspectorName)&&e.jsxs(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Inspector: ",t.ward.inspectorName," ",t.ward.inspectorPhone?`(${t.ward.inspectorPhone})`:""]}),((y=t.zone)==null?void 0:y.officerName)&&e.jsxs(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Zonal Officer: ",t.zone.officerName," ",t.zone.officerPhone?`(${t.zone.officerPhone})`:""]}),t.address&&e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.8rem"},mt:.5,wordBreak:"break-word"},children:t.address})]})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(nt,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Joined"}),e.jsx(n,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:$(t.createdAt)})]})]})}),(i==null?void 0:i.role)==="MASTER_ADMIN"&&e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(Ve,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Password"}),e.jsx(n,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontFamily:"monospace"},children:t.visiblePassword?e.jsx("span",{style:{color:"#2e7d32",fontWeight:"bold"},children:t.visiblePassword}):e.jsxs("span",{style:{color:"#666"},children:["Hash: ",(V=t.passwordHash)==null?void 0:V.substring(0,20),"... (Reset to see actual)"]})})]})]})})]})]}),e.jsxs(a,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Activity Statistics"}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,color:"#2196F3",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:t.statistics.totalComplaints}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Total Complaints"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,color:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:t.statistics.resolvedComplaints}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Resolved"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,color:"#FF9800",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:t.statistics.unresolvedComplaints}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Unresolved"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsxs(n,{variant:"h4",sx:{fontWeight:700,color:"#9C27B0",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:[z,"%"]}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Success Rate"})]})})]}),e.jsx(a,{sx:{mt:{xs:1.5,sm:2}},children:e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Last Login: ",$(t.lastLoginAt)]})})]}),e.jsxs(a,{children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Recent Complaints"}),N.length>0?e.jsx(et,{sx:{p:0},children:N.map(c=>e.jsx(ts.Fragment,{children:e.jsx(tt,{sx:{px:{xs:1.5,sm:2},py:{xs:1,sm:1.5},backgroundColor:"#f8f9fa",borderRadius:1,mb:1},children:e.jsx(st,{primary:e.jsxs(a,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},gap:{xs:.5,sm:1}},children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:c.title}),e.jsx(ge,{label:c.status.replace("_"," "),size:"small",sx:{...A(c.status),...ot,height:{xs:18,sm:20},fontSize:{xs:"0.65rem",sm:"0.7rem"}}})]}),secondary:e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:$(c.createdAt)}),primaryTypographyProps:{component:"div"},secondaryTypographyProps:{component:"div"}})})},c.id))}):e.jsx(n,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:{xs:2,sm:3},fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"No complaints yet"})]}),e.jsxs(a,{sx:{mt:{xs:2,sm:3}},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Waste Management Interactions"}),G?e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(Ne,{size:24})}):m.length>0?e.jsx(et,{sx:{p:0},children:m.map(c=>e.jsx(tt,{sx:{px:{xs:1.5,sm:2},py:{xs:1,sm:1.5},backgroundColor:"#f8f9fa",borderRadius:1,mb:1},children:e.jsx(st,{primary:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[c.reactionType==="LIKE"?e.jsx(ct,{sx:{fontSize:18,color:"#4CAF50"}}):e.jsx(Ot,{sx:{fontSize:18,color:"#F44336"}}),e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:c.post.title})]}),secondary:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsxs(n,{variant:"caption",color:"text.secondary",children:["Category: ",c.post.category.replace("_"," ")]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:$(c.createdAt)})]}),primaryTypographyProps:{component:"div"},secondaryTypographyProps:{component:"div"}})},c.id))}):e.jsx(n,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:{xs:2,sm:3},fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"No interactions yet"})]}),e.jsxs(a,{sx:{mt:{xs:2,sm:3}},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Notice Board Interactions"}),ee?e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(Ne,{size:24})}):u.length>0?e.jsx(et,{sx:{p:0},children:u.map(c=>e.jsx(tt,{sx:{px:{xs:1.5,sm:2},py:{xs:1,sm:1.5},backgroundColor:"#f8f9fa",borderRadius:1,mb:1},children:e.jsx(st,{primary:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[c.type==="LIKE"&&e.jsx(ct,{sx:{fontSize:18,color:"#2196F3"}}),c.type==="LOVE"&&e.jsx(FavoriteIcon,{sx:{fontSize:18,color:"#E91E63"}}),c.type==="VIEW"&&e.jsx(VisibilityIcon,{sx:{fontSize:18,color:"#9E9E9E"}}),c.type==="READ"&&e.jsx(Ve,{sx:{fontSize:18,color:"#4CAF50"}}),c.type.startsWith("RSVP")&&e.jsx(nt,{sx:{fontSize:18,color:"#FF9800"}}),e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:c.notice.title}),e.jsx(ge,{label:c.type.replace("_"," "),size:"small",sx:{height:20,fontSize:"0.65rem",ml:1,backgroundColor:c.type==="READ"?"#e8f5e8":"#f5f5f5",color:c.type==="READ"?"#2e7d2e":"#666"}})]}),secondary:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsxs(n,{variant:"caption",color:"text.secondary",children:["Category: ",c.notice.category.name]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:$(c.createdAt)})]}),primaryTypographyProps:{component:"div"},secondaryTypographyProps:{component:"div"}})},c.id))}):e.jsx(n,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:{xs:2,sm:3},fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"No notice interactions yet"})]})]}),e.jsxs(Qe,{sx:{px:{xs:2,sm:3},py:{xs:1.5,sm:2},flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[e.jsx(w,{onClick:E,variant:"outlined",sx:{textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Close"}),e.jsx(w,{onClick:r,variant:"contained",startIcon:e.jsx(ut,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Edit User"})]})]})},cs=({open:t,title:N,message:M,confirmText:E="Confirm",cancelText:r="Cancel",onConfirm:i,onCancel:m,severity:b="warning"})=>{const u=()=>{switch(b){case"error":return"#d32f2f";case"warning":return"#ed6c02";case"info":return"#0288d1";default:return"#ed6c02"}};return e.jsxs($e,{open:t,onClose:m,maxWidth:"xs",fullWidth:!0,children:[e.jsx(He,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"50%",backgroundColor:`${u()}20`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx($t,{sx:{color:u()}})}),e.jsx(n,{variant:"h6",sx:{fontWeight:600},children:N})]})}),e.jsx(Ke,{children:e.jsx(n,{variant:"body1",color:"text.secondary",children:M})}),e.jsxs(Qe,{sx:{px:3,pb:2},children:[e.jsx(w,{onClick:m,sx:{textTransform:"none",color:"text.secondary"},children:r}),e.jsx(w,{onClick:i,variant:"contained",sx:{textTransform:"none",backgroundColor:u(),"&:hover":{backgroundColor:u(),opacity:.9}},children:E})]})]})},xs=({user:t,open:N,onClose:M,onSave:E})=>{var F,h;const{user:r}=Xe(),[i,m]=l.useState({firstName:"",lastName:"",email:"",phone:"",address:"",cityCorporationCode:"",zoneId:"",wardId:"",status:"ACTIVE",newPassword:"",confirmPassword:"",avatar:""}),[b,u]=l.useState([]),[H,G]=l.useState([]),[P,ee]=l.useState([]),[v,_]=l.useState(!1),[Ae,de]=l.useState(!1),[A,$]=l.useState(!1),[z,te]=l.useState(!1),[D,K]=l.useState(!1),[y,V]=l.useState({}),[c,ae]=l.useState(!1),[he,re]=l.useState(null),[T,ce]=l.useState(!1),[Q,oe]=l.useState(null),[X,ne]=l.useState(null),[ue,ye]=l.useState(!1);l.useEffect(()=>{ke()},[]),l.useEffect(()=>{i.cityCorporationCode?je(i.cityCorporationCode):(G([]),ee([]),m(o=>({...o,zoneId:"",wardId:""})))},[i.cityCorporationCode]),l.useEffect(()=>{i.zoneId?We(parseInt(i.zoneId)):(ee([]),m(o=>({...o,wardId:""})))},[i.zoneId]);const ke=async()=>{try{_(!0);const o=await it.getCityCorporations("ACTIVE");u(o.cityCorporations||[])}catch(o){console.error("Error fetching city corporations:",o),u([])}finally{_(!1)}},je=async o=>{try{if(de(!0),(r==null?void 0:r.role)==="SUPER_ADMIN")try{const L=await lt.getAssignedZones(Number(r.id)),k=b.find(O=>O.code===o),U=L.filter(O=>O.zone.cityCorporationCode===o).map(O=>({id:O.zone.id,zoneNumber:O.zone.zoneNumber,name:O.zone.name,cityCorporationId:(k==null?void 0:k.id)||0,status:"ACTIVE",createdAt:O.assignedAt,updatedAt:O.assignedAt}));G(U);return}catch(L){console.error("Error fetching assigned zones:",L),G([]);return}const f=await vt.getZones({cityCorporationCode:o,status:"ACTIVE"});G(f.zones||[])}catch(f){console.error("Error fetching zones:",f),G([])}finally{de(!1)}},We=async o=>{try{$(!0);const f=await Je.getWards({zoneId:o,status:"ACTIVE"});ee(f.wards||[])}catch(f){console.error("Error fetching wards:",f),ee([])}finally{$(!1)}};l.useEffect(()=>{var o,f,L,k,U,O,xe;t&&(m({firstName:t.firstName,lastName:t.lastName,email:t.email||"",phone:t.phone,address:t.address||"",cityCorporationCode:((o=t.cityCorporation)==null?void 0:o.code)||"",zoneId:((L=(f=t.zone)==null?void 0:f.id)==null?void 0:L.toString())||"",wardId:((U=(k=t.ward)==null?void 0:k.id)==null?void 0:U.toString())||"",status:t.status,newPassword:"",confirmPassword:"",avatar:t.avatar||""}),V({}),re(null),oe(null),ne(t.avatar||null),(O=t.cityCorporation)!=null&&O.code&&je(t.cityCorporation.code),(xe=t.zone)!=null&&xe.id&&We(t.zone.id))},[t]);const Ce=o=>o?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o):!0,Y=o=>/^01[0-9]{9}$/.test(o.replace(/\s+/g,"")),ze=()=>{const o={};return i.firstName.trim()||(o.firstName="First name is required"),i.lastName.trim()||(o.lastName="Last name is required"),i.phone.trim()?Y(i.phone)||(o.phone="Invalid phone format (must be 11 digits starting with 01)"):o.phone="Phone number is required",i.email&&!Ce(i.email)&&(o.email="Invalid email format"),i.cityCorporationCode||(o.cityCorporationCode="City Corporation is required"),i.zoneId||(o.zoneId="Zone is required"),i.wardId||(o.wardId="Ward is required"),(i.newPassword||i.confirmPassword)&&(i.newPassword.length<8&&(o.newPassword="Password must be at least 8 characters"),i.newPassword!==i.confirmPassword&&(o.confirmPassword="Passwords do not match")),V(o),Object.keys(o).length===0},q=o=>f=>{const L=f.target.value;m(k=>({...k,[o]:L})),y[o]&&V(k=>({...k,[o]:void 0})),he&&re(null)},Ee=async o=>{var k;const f=(k=o.target.files)==null?void 0:k[0];if(!f)return;if(!f.type.startsWith("image/")){V(U=>({...U,avatar:"Please select an image file"}));return}if(f.size>5*1024*1024){V(U=>({...U,avatar:"Image size must be less than 5MB"}));return}oe(f);const L=new FileReader;L.onloadend=()=>{ne(L.result)},L.readAsDataURL(f),V(U=>({...U,avatar:void 0}))},ie=()=>{oe(null),ne(null),m(o=>({...o,avatar:""}))},be=async(o=!1)=>{var k,U,O,xe,ve,Ue,Ze,Le;if(!ze())return;const f=i.status!==(t==null?void 0:t.status),L=i.status==="SUSPENDED"||i.status==="INACTIVE";if(f&&L&&!o){ce(!0);return}ae(!0),re(null);try{let me=i.avatar;if(Q){ye(!0);try{const{userManagementService:Re}=await wt(async()=>{const{userManagementService:Ye}=await import("./userManagementService-BZHXGcnY.js");return{userManagementService:Ye}},__vite__mapDeps([0,1,2,3,4,5,6]));me=await Re.uploadAvatar(Q)}catch(Re){console.error("Error uploading avatar:",Re),re("Failed to upload avatar. Please try again."),ae(!1),ye(!1);return}finally{ye(!1)}}const B={};i.firstName!==(t==null?void 0:t.firstName)&&(B.firstName=i.firstName),i.lastName!==(t==null?void 0:t.lastName)&&(B.lastName=i.lastName),i.email!==((t==null?void 0:t.email)||"")&&(B.email=i.email||void 0),i.phone!==(t==null?void 0:t.phone)&&(B.phone=i.phone),i.address!==((t==null?void 0:t.address)||"")&&(B.address=i.address||void 0),i.cityCorporationCode!==((k=t==null?void 0:t.cityCorporation)==null?void 0:k.code)&&(B.cityCorporationCode=i.cityCorporationCode),i.zoneId!==((O=(U=t==null?void 0:t.zone)==null?void 0:U.id)==null?void 0:O.toString())&&(B.zoneId=parseInt(i.zoneId)),i.wardId!==((ve=(xe=t==null?void 0:t.ward)==null?void 0:xe.id)==null?void 0:ve.toString())&&(B.wardId=parseInt(i.wardId)),i.status!==(t==null?void 0:t.status)&&(B.status=i.status),i.newPassword&&(B.password=i.newPassword),me!==(t==null?void 0:t.avatar)&&(B.avatar=me),await E(B),M()}catch(me){console.error("Error updating user:",me),re(((Le=(Ze=(Ue=me.response)==null?void 0:Ue.data)==null?void 0:Ze.error)==null?void 0:Le.message)||me.message||"Failed to update user. Please try again.")}finally{ae(!1)}},W=()=>{ce(!1),be(!0)},d=()=>{ce(!1)},g=()=>{c||M()};return t?e.jsxs($e,{open:N,onClose:g,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(He,{sx:{pb:2},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"h5",sx:{fontWeight:600},children:"Edit User"}),e.jsx(Ie,{onClick:g,size:"small",disabled:c,children:e.jsx(Ge,{})})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Update user information and account settings"})]}),e.jsxs(Ke,{dividers:!0,children:[he&&e.jsx(_e,{severity:"error",sx:{mb:3},onClose:()=>re(null),children:he}),e.jsxs(a,{children:[e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Profile Picture"}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:3,mb:3},children:[e.jsxs(a,{sx:{position:"relative"},children:[e.jsxs(Fe,{src:X||void 0,sx:{width:100,height:100,bgcolor:"#4CAF50",fontSize:36,fontWeight:"bold"},children:[!X&&((F=t==null?void 0:t.firstName)==null?void 0:F[0]),!X&&((h=t==null?void 0:t.lastName)==null?void 0:h[0])]}),ue&&e.jsx(a,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0,0,0,0.5)",borderRadius:"50%"},children:e.jsx(Ne,{size:40,sx:{color:"white"}})})]}),e.jsxs(a,{sx:{flex:1},children:[e.jsx("input",{accept:"image/*",style:{display:"none"},id:"avatar-upload",type:"file",onChange:Ee,disabled:c||ue}),e.jsx("label",{htmlFor:"avatar-upload",children:e.jsx(w,{variant:"outlined",component:"span",disabled:c||ue,sx:{mr:1},children:"Upload Photo"})}),X&&e.jsx(w,{variant:"text",color:"error",onClick:ie,disabled:c||ue,children:"Remove"}),e.jsx(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"Recommended: Square image, max 5MB"}),y.avatar&&e.jsx(n,{variant:"caption",color:"error",display:"block",sx:{mt:.5},children:y.avatar})]})]}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"First Name",value:i.firstName,onChange:q("firstName"),error:!!y.firstName,helperText:y.firstName,disabled:c,required:!0})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Last Name",value:i.lastName,onChange:q("lastName"),error:!!y.lastName,helperText:y.lastName,disabled:c,required:!0})})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Email",type:"email",value:i.email,onChange:q("email"),error:!!y.email,helperText:y.email,disabled:c})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Phone",value:i.phone,onChange:q("phone"),error:!!y.phone,helperText:y.phone,disabled:c,required:!0})})]}),e.jsx(a,{sx:{mb:2},children:e.jsx(I,{fullWidth:!0,label:"Address (à¦ à¦¿à¦•à¦¾à¦¨à¦¾)",value:i.address,onChange:q("address"),disabled:c,multiline:!0,rows:2,placeholder:"Enter full address"})}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(I,{fullWidth:!0,select:!0,label:"City Corporation",value:i.cityCorporationCode,onChange:q("cityCorporationCode"),disabled:c||v||(r==null?void 0:r.role)!=="MASTER_ADMIN",error:!!y.cityCorporationCode,helperText:y.cityCorporationCode,required:!0,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),b.map(o=>e.jsx(C,{value:o.code,children:o.name},o.code))]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(I,{fullWidth:!0,select:!0,label:"Zone",value:i.zoneId,onChange:q("zoneId"),disabled:c||Ae||!i.cityCorporationCode||(r==null?void 0:r.role)!=="MASTER_ADMIN",error:!!y.zoneId,helperText:y.zoneId||(i.cityCorporationCode?Ae?"Loading zones...":H.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select Zone"})}),H.map(o=>e.jsx(C,{value:o.id.toString(),children:o.name||`Zone ${o.zoneNumber}`},o.id))]})})]}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(I,{fullWidth:!0,select:!0,label:"Ward",value:i.wardId,onChange:q("wardId"),disabled:c||A||!i.zoneId||(r==null?void 0:r.role)!=="MASTER_ADMIN",error:!!y.wardId,helperText:y.wardId||(i.zoneId?A?"Loading wards...":P.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select Ward"})}),P.map(o=>e.jsxs(C,{value:o.id.toString(),children:["Ward ",typeof o.wardNumber=="object"?JSON.stringify(o.wardNumber):o.wardNumber]},o.id))]})})}),(r==null?void 0:r.role)==="MASTER_ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Change Password (Optional)"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"New Password",type:z?"text":"password",value:i.newPassword,onChange:q("newPassword"),error:!!y.newPassword,helperText:y.newPassword||"Leave blank to keep current password",disabled:c,slotProps:{input:{endAdornment:e.jsx(Te,{position:"end",children:e.jsx(Ie,{onClick:()=>te(!z),edge:"end",size:"small",children:z?e.jsx(Be,{}):e.jsx(Oe,{})})})}}})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Confirm New Password",type:D?"text":"password",value:i.confirmPassword,onChange:q("confirmPassword"),error:!!y.confirmPassword,helperText:y.confirmPassword,disabled:c,slotProps:{input:{endAdornment:e.jsx(Te,{position:"end",children:e.jsx(Ie,{onClick:()=>K(!D),edge:"end",size:"small",children:D?e.jsx(Be,{}):e.jsx(Oe,{})})})}}})})]})]}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Settings"}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(I,{fullWidth:!0,select:!0,label:"Status",value:i.status,onChange:q("status"),disabled:c,children:[e.jsx(C,{value:"ACTIVE",children:"Active"}),e.jsx(C,{value:"INACTIVE",children:"Inactive"}),e.jsx(C,{value:"SUSPENDED",children:"Suspended"}),e.jsx(C,{value:"PENDING",children:"Pending"})]})})})]})]}),e.jsxs(Qe,{sx:{px:3,py:2},children:[e.jsx(w,{onClick:g,variant:"outlined",disabled:c,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(w,{onClick:()=>be(),variant:"contained",disabled:c,startIcon:c?e.jsx(Ne,{size:20}):e.jsx(Ut,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:c?"Saving...":"Save Changes"})]}),e.jsx(cs,{open:T,title:i.status==="SUSPENDED"?"Suspend User":"Deactivate User",message:i.status==="SUSPENDED"?`Are you sure you want to suspend ${t==null?void 0:t.firstName} ${t==null?void 0:t.lastName}? This will immediately block their access to the system.`:`Are you sure you want to deactivate ${t==null?void 0:t.firstName} ${t==null?void 0:t.lastName}? They will not be able to access the system.`,confirmText:"Confirm",cancelText:"Cancel",severity:"warning",onConfirm:W,onCancel:d})]}):null},hs=({open:t,onClose:N,onSave:M})=>{var be,W;const{user:E}=Xe(),[r,i]=l.useState({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER",avatar:""}),[m,b]=l.useState({}),[u,H]=l.useState(!1),[G,P]=l.useState(null),[ee,v]=l.useState(!1),[_,Ae]=l.useState(!1),[de,A]=l.useState([]),[$,z]=l.useState([]),[te,D]=l.useState([]),[K,y]=l.useState(!1),[V,c]=l.useState(!1),[ae,he]=l.useState(!1),[re,T]=l.useState(null),[ce,Q]=l.useState(null),[oe,X]=l.useState(!1);l.useEffect(()=>{ne()},[]),l.useEffect(()=>{r.cityCorporationCode?ue(r.cityCorporationCode):(z([]),D([]),i(d=>({...d,zoneId:"",wardId:""})))},[r.cityCorporationCode]),l.useEffect(()=>{r.zoneId?ye(parseInt(r.zoneId)):(D([]),i(d=>({...d,wardId:""})))},[r.zoneId]);const ne=async()=>{try{y(!0);const d=await it.getCityCorporations("ACTIVE");A(d.cityCorporations||[])}catch(d){console.error("Error fetching city corporations:",d),A([]),P("Failed to load city corporations. Please try again.")}finally{y(!1)}},ue=async d=>{try{if(c(!0),(E==null?void 0:E.role)==="SUPER_ADMIN")try{const F=await lt.getAssignedZones(Number(E.id)),h=de.find(f=>f.code===d),o=F.filter(f=>f.zone.cityCorporationCode===d).map(f=>({id:f.zone.id,zoneNumber:f.zone.zoneNumber,name:f.zone.name,cityCorporationId:(h==null?void 0:h.id)||0,status:"ACTIVE",createdAt:f.assignedAt,updatedAt:f.assignedAt}));z(o);return}catch(F){console.error("Error fetching assigned zones:",F),z([]);return}const g=await vt.getZones({cityCorporationCode:d,status:"ACTIVE"});z(g.zones||[])}catch(g){console.error("Error fetching zones:",g),z([])}finally{c(!1)}},ye=async d=>{try{he(!0);const g=await Je.getWards({zoneId:d,status:"ACTIVE"});D(g.wards||[])}catch(g){console.error("Error fetching wards:",g),D([])}finally{he(!1)}},ke=d=>d?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d):!0,je=d=>/^01[0-9]{9}$/.test(d.replace(/\s+/g,"")),We=d=>d.length>=8,Ce=()=>{const d={};return r.firstName.trim()||(d.firstName="First name is required"),r.lastName.trim()||(d.lastName="Last name is required"),r.phone.trim()?je(r.phone)||(d.phone="Invalid phone format (must be 11 digits starting with 01)"):d.phone="Phone number is required",r.password?We(r.password)||(d.password="Password must be at least 8 characters"):d.password="Password is required",r.confirmPassword?r.password!==r.confirmPassword&&(d.confirmPassword="Passwords do not match"):d.confirmPassword="Please confirm your password",r.cityCorporationCode||(d.cityCorporationCode="City Corporation is required"),r.zoneId||(d.zoneId="Zone is required"),r.wardId||(d.wardId="Ward is required"),r.email&&!ke(r.email)&&(d.email="Invalid email format"),b(d),Object.keys(d).length===0},Y=d=>g=>{const F=g.target.value;i(h=>({...h,[d]:F})),m[d]&&b(h=>({...h,[d]:void 0})),G&&P(null)},ze=async d=>{var h;const g=(h=d.target.files)==null?void 0:h[0];if(!g)return;if(!g.type.startsWith("image/")){b(o=>({...o,avatar:"Please select an image file"}));return}if(g.size>5*1024*1024){b(o=>({...o,avatar:"Image size must be less than 5MB"}));return}T(g);const F=new FileReader;F.onloadend=()=>{Q(F.result)},F.readAsDataURL(g),b(o=>({...o,avatar:void 0}))},q=()=>{T(null),Q(null),i(d=>({...d,avatar:""}))},Ee=async()=>{var d,g,F;if(Ce()){H(!0),P(null);try{let h="";if(re){X(!0);try{const{userManagementService:f}=await wt(async()=>{const{userManagementService:L}=await import("./userManagementService-BZHXGcnY.js");return{userManagementService:L}},__vite__mapDeps([0,1,2,3,4,5,6]));h=await f.uploadAvatar(re)}catch(f){console.error("Error uploading avatar:",f),P("Failed to upload avatar. Please try again."),H(!1),X(!1);return}finally{X(!1)}}const o={firstName:r.firstName,lastName:r.lastName,phone:r.phone,password:r.password,role:r.role};r.email&&(o.email=r.email),r.cityCorporationCode&&(o.cityCorporationCode=r.cityCorporationCode),h&&(o.avatar=h),r.zoneId&&(o.zoneId=parseInt(r.zoneId)),r.wardId&&(o.wardId=parseInt(r.wardId)),await M(o),i({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER",avatar:""}),T(null),Q(null),N()}catch(h){console.error("Error creating user:",h),P(((F=(g=(d=h.response)==null?void 0:d.data)==null?void 0:g.error)==null?void 0:F.message)||h.message||"Failed to create user. Please try again.")}finally{H(!1)}}},ie=()=>{u||(i({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER",avatar:""}),b({}),P(null),T(null),Q(null),N())};return e.jsxs($e,{open:t,onClose:ie,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(He,{sx:{pb:2},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"h5",sx:{fontWeight:600},children:"Add New User"}),e.jsx(Ie,{onClick:ie,size:"small",disabled:u,children:e.jsx(Ge,{})})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create a new user account"})]}),e.jsxs(Ke,{dividers:!0,children:[G&&e.jsx(_e,{severity:"error",sx:{mb:3},onClose:()=>P(null),children:G}),e.jsxs(a,{children:[e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Profile Picture (Optional)"}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:3,mb:3},children:[e.jsxs(a,{sx:{position:"relative"},children:[e.jsxs(Fe,{src:ce||void 0,sx:{width:100,height:100,bgcolor:"#4CAF50",fontSize:36,fontWeight:"bold"},children:[!ce&&((be=r.firstName)==null?void 0:be[0]),!ce&&((W=r.lastName)==null?void 0:W[0])]}),oe&&e.jsx(a,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0,0,0,0.5)",borderRadius:"50%"},children:e.jsx(Ne,{size:40,sx:{color:"white"}})})]}),e.jsxs(a,{sx:{flex:1},children:[e.jsx("input",{accept:"image/*",style:{display:"none"},id:"avatar-upload-add",type:"file",onChange:ze,disabled:u||oe}),e.jsx("label",{htmlFor:"avatar-upload-add",children:e.jsx(w,{variant:"outlined",component:"span",disabled:u||oe,sx:{mr:1},children:"Upload Photo"})}),ce&&e.jsx(w,{variant:"text",color:"error",onClick:q,disabled:u||oe,children:"Remove"}),e.jsx(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"Recommended: Square image, max 5MB"}),m.avatar&&e.jsx(n,{variant:"caption",color:"error",display:"block",sx:{mt:.5},children:m.avatar})]})]}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"First Name",value:r.firstName,onChange:Y("firstName"),error:!!m.firstName,helperText:m.firstName,disabled:u,required:!0})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Last Name",value:r.lastName,onChange:Y("lastName"),error:!!m.lastName,helperText:m.lastName,disabled:u,required:!0})})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Email",type:"email",value:r.email,onChange:Y("email"),error:!!m.email,helperText:m.email||"Optional",disabled:u})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Phone",value:r.phone,onChange:Y("phone"),error:!!m.phone,helperText:m.phone,disabled:u,required:!0})})]}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Credentials"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Password",type:ee?"text":"password",value:r.password,onChange:Y("password"),error:!!m.password,helperText:m.password||"Minimum 8 characters",disabled:u,required:!0,slotProps:{input:{endAdornment:e.jsx(Te,{position:"end",children:e.jsx(Ie,{onClick:()=>v(!ee),edge:"end",size:"small",children:ee?e.jsx(Be,{}):e.jsx(Oe,{})})})}}})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(I,{fullWidth:!0,label:"Confirm Password",type:_?"text":"password",value:r.confirmPassword,onChange:Y("confirmPassword"),error:!!m.confirmPassword,helperText:m.confirmPassword,disabled:u,required:!0,slotProps:{input:{endAdornment:e.jsx(Te,{position:"end",children:e.jsx(Ie,{onClick:()=>Ae(!_),edge:"end",size:"small",children:_?e.jsx(Be,{}):e.jsx(Oe,{})})})}}})})]}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(I,{fullWidth:!0,select:!0,label:"City Corporation",value:r.cityCorporationCode,onChange:Y("cityCorporationCode"),disabled:u||K,error:!!m.cityCorporationCode,helperText:m.cityCorporationCode||"Required",required:!0,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),de.map(d=>e.jsx(C,{value:d.code,children:d.name},d.code))]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(I,{fullWidth:!0,select:!0,label:"Zone",value:r.zoneId,onChange:Y("zoneId"),disabled:u||V||!r.cityCorporationCode,error:!!m.zoneId,helperText:m.zoneId||(r.cityCorporationCode?V?"Loading zones...":$.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select Zone"})}),$.map(d=>e.jsx(C,{value:d.id.toString(),children:d.name||`Zone ${d.zoneNumber}`},d.id))]})})]}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(I,{fullWidth:!0,select:!0,label:"Ward",value:r.wardId,onChange:Y("wardId"),disabled:u||ae||!r.zoneId,error:!!m.wardId,helperText:m.wardId||(r.zoneId?ae?"Loading wards...":te.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select Ward"})}),te.map(d=>e.jsxs(C,{value:d.id.toString(),children:["Ward ",typeof d.wardNumber=="object"?JSON.stringify(d.wardNumber):d.wardNumber]},d.id))]})})})]})]}),e.jsxs(Qe,{sx:{px:3,py:2},children:[e.jsx(w,{onClick:ie,variant:"outlined",disabled:u,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(w,{onClick:Ee,variant:"contained",disabled:u,startIcon:u?e.jsx(Ne,{size:20}):e.jsx(yt,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:u?"Creating...":"Create User"})]})]})},ms=({userId:t,open:N,onClose:M,userName:E="User",userDetails:r})=>{const i=Zt(),m=Vt(i.breakpoints.down("sm")),b=l.useMemo(()=>!r||!t?null:{id:r.id,firstName:r.firstName,lastName:r.lastName,avatar:r.avatar||null,phone:r.phone||null,cityCorporationCode:r.cityCorporationCode||null,wardId:r.wardId||null,zoneId:r.zoneId||null,ward:r.ward?{id:r.ward.id,number:r.ward.wardNumber,wardNumber:r.ward.wardNumber}:null,zone:r.zone?{id:r.zone.id,number:r.zone.zoneNumber,name:r.zone.name||null}:null},[r,t]);return e.jsxs($e,{open:N,onClose:M,maxWidth:"sm",fullWidth:!0,fullScreen:m,slotProps:{paper:{sx:{borderRadius:m?0:2,height:m?"100vh":"80vh",maxHeight:m?"100vh":"80vh",display:"flex",flexDirection:"column",animation:m?`${Ct} ${se.normal.duration} ${se.smooth.timing}`:`${bt} ${se.normal.duration} ${se.smooth.timing}`,animationFillMode:"both",overflow:"hidden"}},backdrop:{sx:{animation:`${jt} ${se.fast.duration} ${se.fast.timing}`}}},children:[e.jsx(a,{sx:{position:"absolute",right:8,top:8,zIndex:10},children:e.jsx(Ie,{onClick:M,size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 1)"},boxShadow:1},children:e.jsx(Ge,{})})}),e.jsx(a,{sx:{flex:1,height:"100%",overflow:"hidden"},children:e.jsx(is,{userId:t,userInfo:b,onMessagesRead:()=>{}})})]})},ws=()=>{const{user:t}=Xe(),[N,M]=l.useState([]),[E,r]=l.useState(!0),[i,m]=l.useState(null),[b,u]=l.useState(""),[H,G]=l.useState(""),[P,ee]=l.useState([]),[v,_]=l.useState(""),[Ae,de]=l.useState(null),[A,$]=l.useState(""),[z,te]=l.useState(null),[D,K]=l.useState([]),[y,V]=l.useState(!1),[c,ae]=l.useState(!1),[he,re]=l.useState([]),[T,ce]=l.useState(null),[Q,oe]=l.useState(!0),[X,ne]=l.useState(null),[ue,ye]=l.useState([]),[ke,je]=l.useState(!1),[We,Ce]=l.useState(!1),[Y,ze]=l.useState(!1),[q,Ee]=l.useState(!1),[ie,be]=l.useState(null),[W,d]=l.useState([]),[g,F]=l.useState(ss.ACTIVE),[h,o]=l.useState({page:1,limit:20,total:0}),[f,L]=l.useState({open:!1,message:"",severity:"success"}),[k,U]=l.useState({viewUser:null,statusChange:null});l.useEffect(()=>{const s=setTimeout(()=>{G(b)},500);return()=>clearTimeout(s)},[b]),l.useEffect(()=>{t&&(async()=>{var p,R;console.log("ðŸ”„ UserManagement: Starting data fetch for user:",t==null?void 0:t.id,t==null?void 0:t.role);const x=[it.getCityCorporations("ACTIVE").catch(we=>(console.error("âŒ Error fetching city corporations:",we),{cityCorporations:[]}))];(t==null?void 0:t.role)==="SUPER_ADMIN"&&t.id&&(console.log("ðŸ‘¤ Fetching assigned zones for Super Admin:",t.id),x.push(lt.getAssignedZones(Number(t.id)).catch(we=>(console.error("âŒ Error fetching assigned zones:",we),[])))),V(!0);try{const we=await Promise.all(x),Rt=we[0],Pe=we[1];let pe=Rt.cityCorporations||[];if(console.log("ðŸ™ï¸ Fetched City Corps:",pe.length),t&&t.role!=="MASTER_ADMIN"){const Z=t.cityCorporationCode||((p=t.cityCorporation)==null?void 0:p.code);if(Z)console.log("ðŸŽ¯ Filtering City Corp for assigned code:",Z),pe=pe.filter(S=>S.code===Z),pe.length>0&&v!==Z&&_(Z);else if(t.role==="SUPER_ADMIN"&&Pe){const S=new Set;Array.isArray(Pe)&&Pe.forEach(J=>{const Me=J.zone||J;Me.cityCorporationId&&S.add(Me.cityCorporationId)}),S.size>0&&(console.log("ðŸŽ¯ Filtering City Corps for Super Admin assigned zones:",Array.from(S)),pe=pe.filter(J=>S.has(J.id)),pe.length===1&&_(pe[0].code))}}if(ee(pe),Pe){console.log("ðŸ›¡ï¸ Raw Assigned Zones:",Pe);const Z=Pe.map(S=>{const J=S.zone||S;return!J||!J.id?null:{id:J.id,zoneNumber:J.zoneNumber,name:J.name,cityCorporationId:J.cityCorporationId||0,status:"ACTIVE",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}).filter(S=>S!==null);console.log("âœ… Formatted Assigned Zones:",Z),re(Z),Z.length===1&&(console.log("ðŸ‘Œ Auto-selecting single zone:",Z[0].id),$(Z[0].id))}if((t==null?void 0:t.role)==="ADMIN"){console.log("ðŸ‘¤ Loading assigned wards for Admin");let Z=[];if(t.permissions)try{const S=JSON.parse(t.permissions);S.wards&&Array.isArray(S.wards)&&(Z=S.wards)}catch(S){console.error("Error parsing admin permissions:",S)}if(console.log(`ðŸ”’ ADMIN assigned ward IDs: [${Z.join(", ")}]`),Z.length>0)try{ae(!0);const S=t.cityCorporationCode||((R=t.cityCorporation)==null?void 0:R.code);if(S){const J=await Je.getWards({cityCorporationCode:S,status:"ACTIVE"});console.log("ðŸ“‹ All wards from API:",J.wards);const Me=J.wards.filter(Mt=>Z.includes(Mt.id));console.log("âœ… Filtered assigned wards:",Me),K(Me)}}catch(S){console.error("âŒ Error fetching assigned wards:",S),K([])}finally{ae(!1)}else console.log("âš ï¸ ADMIN has no assigned wards"),K([])}}catch(we){console.error("âŒ Error in UserManagement fetchData:",we)}finally{V(!1)}})()},[t]),l.useEffect(()=>{if(v!=="ALL"){const s=P.find(x=>x.code===v);s&&de(s.id)}else de(null),K([]);$(""),te(null)},[v,P]),l.useEffect(()=>{(t==null?void 0:t.role)!=="ADMIN"&&(A?O(A):K([]),te(null))},[A,t]),l.useEffect(()=>{xe()},[H,g,v,A,z,h.page]),l.useEffect(()=>{ve()},[v,A,z]),l.useEffect(()=>{const s=setInterval(()=>{ve()},3e4);return()=>clearInterval(s)},[v,A,z]);const O=async s=>{try{ae(!0);const x=await Je.getWardsByZone(s,"ACTIVE");K(x)}catch(x){console.error("Error fetching wards:",x),fe("Failed to load wards","error")}finally{ae(!1)}},xe=l.useCallback(async()=>{var s,x;try{r(!0),m(null);const p=await Se.getUsers({page:h.page,limit:h.limit,search:H||void 0,status:g!=="ALL"?g:void 0,role:"CUSTOMER",cityCorporationCode:v!=="ALL"?v:void 0,zoneId:A||void 0,wardId:z||void 0});M(p.users),o(R=>({...R,total:p.pagination.total}))}catch(p){console.error("Error fetching users:",p),m(((x=(s=p.response)==null?void 0:s.data)==null?void 0:x.message)||"Failed to load users. Please try again."),fe("Failed to load users","error")}finally{r(!1)}},[H,g,v,A,z,h.page,h.limit]),ve=async()=>{try{oe(!0);const s=await Se.getUserStatistics(v!=="ALL"?v:void 0,"CUSTOMER",A?Number(A):void 0,z?Number(z):void 0);ce(s)}catch(s){console.error("Error fetching statistics:",s)}finally{oe(!1)}},Ue=s=>{u(s),o(x=>({...x,page:1}))},Ze=s=>{F(s),o(x=>({...x,page:1}))},Le=()=>{u(""),F("ALL"),_("ALL"),_("ALL"),$(""),te(null),o(s=>({...s,page:1}))},me=async s=>{try{U(p=>({...p,viewUser:s}));const x=await Se.getUserById(s);ne(x.user),ye(x.recentComplaints||[]),je(!0)}catch(x){console.error("Error fetching user details:",x),fe("Failed to load user details","error")}finally{U(x=>({...x,viewUser:null}))}},B=s=>{ne(s),Ce(!0)},Re=()=>{ze(!0)},Ye=async s=>{var x,p;if(X)try{await Se.updateUser(X.id,s),fe("User updated successfully","success"),Ce(!1),ne(null),await xe(),await ve()}catch(R){throw console.error("Error updating user:",R),fe(((p=(x=R.response)==null?void 0:x.data)==null?void 0:p.message)||"Failed to update user","error"),R}},St=async s=>{var x,p;try{await Se.createUser(s),fe("User created successfully","success"),ze(!1),await xe(),await ve()}catch(R){throw console.error("Error creating user:",R),fe(((p=(x=R.response)==null?void 0:x.data)==null?void 0:p.message)||"Failed to create user","error"),R}},It=s=>{be(s),Ee(!0)},Nt=()=>{Ee(!1),be(null)},At=async()=>{if(W.length!==0&&window.confirm(`Are you sure you want to delete ${W.length} users?`))try{await Se.bulkDeleteUsers(W),fe("Users deleted successfully","success"),d([]),xe(),ve()}catch(s){fe(s.message||"Failed to delete users","error")}},zt=s=>{if(s.target.checked){const x=N.map(p=>p.id);d(x);return}d([])},Wt=s=>{const x=W.indexOf(s);let p=[];x===-1?p=p.concat(W,s):x===0?p=p.concat(W.slice(1)):x===W.length-1?p=p.concat(W.slice(0,-1)):x>0&&(p=p.concat(W.slice(0,x),W.slice(x+1))),d(p)},fe=(s,x)=>{L({open:!0,message:s,severity:x})},dt=()=>{L(s=>({...s,open:!1}))},Et=s=>s?s.startsWith("+")?s:s.length===11&&s.startsWith("0")?`+880 ${s.substring(1,5)}-${s.substring(5)}`:s:"N/A",Pt=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Tt=(s,x)=>{const p=typeof s=="string"?s:String(s||""),R=typeof x=="string"?x:String(x||"");return`${p.charAt(0)}${R.charAt(0)}`.toUpperCase()},kt=()=>!T||T.totalComplaints===0?"0":(T.resolvedComplaints/T.totalComplaints*100).toFixed(0),Lt=[{title:"Total Citizens",value:Q?"...":String((T==null?void 0:T.totalCitizens)||0),color:"#2196F3"},{title:"Total Complaints",value:Q?"...":String((T==null?void 0:T.totalComplaints)||0),color:"#FF9800"},{title:"Resolved",value:Q?"...":String((T==null?void 0:T.resolvedComplaints)||0),color:"#4CAF50"},{title:"Success Rate",value:Q?"...":`${kt()}%`,color:"#9C27B0"}];return e.jsx(as,{children:e.jsxs(rs,{title:"User Management",children:[e.jsxs(a,{sx:{width:"100%",maxWidth:"100%",px:1.5,mx:0},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(a,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:600,mb:.5,color:"text.primary"},children:"User Management"}),e.jsx(n,{variant:"body1",color:"text.secondary",children:"Manage citizen accounts and information"})]}),(t==null?void 0:t.role)==="MASTER_ADMIN"&&e.jsx(w,{variant:"contained",startIcon:e.jsx(yt,{}),onClick:Re,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3,py:1.5,borderRadius:2},children:"Add New User"})]}),e.jsx(a,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"repeat(4, 1fr)"},gap:2,mb:4},children:Lt.map((s,x)=>e.jsx(xt,{sx:{borderRadius:2,border:"1px solid #e0e0e0","&:hover":{boxShadow:2}},children:e.jsx(ht,{sx:{p:3,textAlign:"center"},children:Q?e.jsxs(e.Fragment,{children:[e.jsx(le,{variant:"rectangular",width:"60%",height:48,sx:{mx:"auto",mb:1,borderRadius:1}}),e.jsx(le,{variant:"text",width:"80%",height:20,sx:{mx:"auto"}})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700,color:s.color,mb:1},children:s.value}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:s.title})]})})},x))}),e.jsx(xt,{sx:{borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(ht,{sx:{p:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,gap:2},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600},children:"Citizen Directory"}),e.jsxs(a,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(I,{placeholder:"Search by name, email, or ward...",value:b,onChange:s=>Ue(s.target.value),InputProps:{startAdornment:e.jsx(Te,{position:"start",children:e.jsx(qt,{sx:{color:"text.secondary"}})})},sx:{width:300,"& .MuiOutlinedInput-root":{height:40,backgroundColor:"#f8f9fa"}}}),W.length>0&&e.jsxs(w,{variant:"outlined",color:"error",onClick:At,sx:{ml:2,height:40},children:["Delete Selected (",W.length,")"]})]})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(at,{sx:{minWidth:200},children:[e.jsx(rt,{id:"city-corporation-filter-label",sx:{top:-8},children:"City Corporation"}),e.jsxs(qe,{labelId:"city-corporation-filter-label",value:y?"":v,onChange:s=>_(s.target.value),label:"City Corporation",disabled:(t==null?void 0:t.role)==="ADMIN"||y||(t==null?void 0:t.role)!=="MASTER_ADMIN"&&P.length<=1,sx:{height:40,backgroundColor:"#f8f9fa"},displayEmpty:!0,renderValue:s=>{if(y)return e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ne,{size:16}),e.jsx(n,{variant:"body2",children:"Loading..."})]});if(!s)return"Select City Corporation";if(s==="ALL")return"All City Corporations";const x=P.find(p=>p.code===s);return x?typeof x.name=="object"?JSON.stringify(x.name):x.name:s},children:[(t==null?void 0:t.role)==="MASTER_ADMIN"&&e.jsx(C,{value:"ALL",children:"All City Corporations"}),P&&P.map(s=>e.jsx(C,{value:s.code,children:typeof s.name=="object"?JSON.stringify(s.name):s.name},s.code))]})]}),(t==null?void 0:t.role)!=="ADMIN"&&e.jsx(a,{sx:{minWidth:200},children:e.jsx(os,{value:A,onChange:s=>$(s),cityCorporationCode:v!=="ALL"?v:"",disabled:!1,zones:he.length>0?he:void 0})}),e.jsxs(at,{sx:{minWidth:200},children:[e.jsx(rt,{id:"ward-filter-label",sx:{top:-8},children:"Ward"}),e.jsxs(qe,{labelId:"ward-filter-label",value:z||"",onChange:s=>te(s.target.value?Number(s.target.value):null),label:"Ward",disabled:(t==null?void 0:t.role)==="ADMIN"?c||!D||D.length===0:!A||c||!D||D.length===0,sx:{height:40,backgroundColor:"#f8f9fa"},children:[(t==null?void 0:t.role)!=="ADMIN"&&e.jsx(C,{value:"",children:"All Wards"}),D&&D.map(s=>e.jsxs(C,{value:s.id,children:["Ward ",typeof s.wardNumber=="object"?JSON.stringify(s.wardNumber):s.wardNumber]},s.id))]})]}),e.jsxs(at,{sx:{minWidth:150},children:[e.jsx(rt,{id:"status-filter-label",sx:{top:-8},children:"Status"}),e.jsxs(qe,{labelId:"status-filter-label",value:g,onChange:s=>Ze(s.target.value),label:"Status",startAdornment:e.jsx(Te,{position:"start",children:e.jsx(_t,{sx:{fontSize:18,color:"text.secondary"}})}),sx:{height:40,backgroundColor:"#f8f9fa"},children:[e.jsx(C,{value:"ALL",children:"All Status"}),e.jsx(C,{value:"ACTIVE",children:"Active"}),e.jsx(C,{value:"INACTIVE",children:"Inactive"}),e.jsx(C,{value:"SUSPENDED",children:"Suspended"}),e.jsx(C,{value:"PENDING",children:"Pending"})]})]}),(b||g!=="ALL"||v!=="ALL"||A||z)&&e.jsx(w,{variant:"outlined",onClick:Le,sx:{height:40,textTransform:"none",borderColor:"#e0e0e0",color:"text.secondary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Clear Filters"})]}),e.jsx(Bt,{component:Jt,elevation:0,children:e.jsxs(Ht,{sx:{minWidth:650},children:[e.jsx(Gt,{children:e.jsxs(De,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(j,{padding:"checkbox",children:e.jsx(mt,{indeterminate:W.length>0&&W.length<N.length,checked:N.length>0&&W.length===N.length,onChange:zt})}),e.jsx(j,{sx:{fontWeight:600},children:"Citizen"}),e.jsx(j,{sx:{fontWeight:600},children:"Contact"}),e.jsx(j,{sx:{fontWeight:600},children:"City Corporation"}),e.jsx(j,{sx:{fontWeight:600},children:"Location"}),e.jsx(j,{sx:{fontWeight:600},children:"Complaints"}),e.jsx(j,{sx:{fontWeight:600},children:"Resolved"}),e.jsx(j,{sx:{fontWeight:600},children:"Unresolved"}),e.jsx(j,{sx:{fontWeight:600},children:"Join Date"}),e.jsx(j,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Kt,{children:E?Array.from({length:5}).map((s,x)=>e.jsxs(De,{children:[e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})}),e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})}),e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})}),e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})}),e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})}),e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})}),e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})}),e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})}),e.jsx(j,{children:e.jsx(le,{variant:"rectangular",height:40})})]},x)):i?e.jsx(De,{children:e.jsx(j,{colSpan:9,children:e.jsx(_e,{severity:"error",sx:{my:2},children:i})})}):N.length===0?e.jsx(De,{children:e.jsx(j,{colSpan:9,children:e.jsx(ls,{icon:b||g!=="ALL"?e.jsx(Qt,{sx:{fontSize:40,color:"#9e9e9e"}}):e.jsx(Xt,{sx:{fontSize:40,color:"#9e9e9e"}}),title:b||g!=="ALL"?"No users found":"No users registered yet",description:b||g!=="ALL"?"Try adjusting your search or filters to find what you're looking for.":"Users who register through the mobile app will appear here.",action:b||g!=="ALL"?{label:"Clear Filters",onClick:Le}:void 0})})}):N.map(s=>{var p,R;const x=W.indexOf(s.id)!==-1;return typeof s.ward=="object"&&s.ward!==null&&!("wardNumber"in s.ward)&&console.error("Suspicious Ward object found:",s.ward),typeof s.zone=="object"&&s.zone!==null&&!("zoneNumber"in s.zone)&&console.error("Suspicious Zone object found:",s.zone),e.jsxs(De,{hover:!0,selected:x,sx:{"&:hover":{backgroundColor:"#f8f9fa"}},children:[e.jsx(j,{padding:"checkbox",children:e.jsx(mt,{checked:x,onChange:()=>Wt(s.id)})}),e.jsx(j,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.avatar?e.jsx(Fe,{src:s.avatar,sx:{width:40,height:40}}):e.jsx(Fe,{sx:{width:40,height:40,bgcolor:"#4CAF50"},children:Tt(s.firstName,s.lastName)}),e.jsxs(a,{children:[e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:`${typeof s.firstName=="object"?JSON.stringify(s.firstName):s.firstName} ${typeof s.lastName=="object"?JSON.stringify(s.lastName):s.lastName}`}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["#",String(s.id).padStart(6,"0")]})]})]})}),e.jsx(j,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ft,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(n,{variant:"body2",children:typeof s.email=="object"?JSON.stringify(s.email):s.email||"N/A"})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(pt,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(n,{variant:"body2",children:typeof s.phone=="object"?JSON.stringify(s.phone):Et(s.phone)})]})]})}),e.jsx(j,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:typeof((p=s.cityCorporation)==null?void 0:p.name)=="object"?JSON.stringify(s.cityCorporation.name):((R=s.cityCorporation)==null?void 0:R.name)||"N/A"}),s.cityCorporation&&e.jsx(n,{variant:"caption",color:"text.secondary",children:typeof s.cityCorporation.code=="object"?JSON.stringify(s.cityCorporation.code):s.cityCorporation.code})]})}),e.jsx(j,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[s.zone?e.jsx(ge,{label:`Zone ${typeof s.zone.zoneNumber=="object"?JSON.stringify(s.zone.zoneNumber):s.zone.zoneNumber}${s.zone.name?` - ${typeof s.zone.name=="object"?JSON.stringify(s.zone.name):s.zone.name}`:""}`,size:"small",variant:"outlined",color:"primary",sx:{height:24,justifyContent:"flex-start"}}):null,s.ward?e.jsx(ge,{label:`Ward ${typeof s.ward.wardNumber=="object"?JSON.stringify(s.ward.wardNumber):s.ward.wardNumber}`,size:"small",variant:"outlined",sx:{height:24,justifyContent:"flex-start"}}):null,!s.zone&&!s.ward&&e.jsx(n,{variant:"caption",color:"text.secondary",children:"N/A"}),s.address&&e.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:.5,mt:.5},children:[e.jsx(gt,{sx:{fontSize:14,color:"text.secondary",mt:.2}}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem",lineHeight:1.3,maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:typeof s.address=="object"?JSON.stringify(s.address):s.address})]})]})}),e.jsx(j,{children:e.jsx(ge,{label:String(s.statistics.totalComplaints),sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}})}),e.jsx(j,{children:e.jsx(ge,{label:String(s.statistics.resolvedComplaints),sx:{backgroundColor:"#e8f5e8",color:"#2e7d2e",fontWeight:500}})}),e.jsx(j,{children:e.jsx(ge,{label:String(s.statistics.unresolvedComplaints),sx:{backgroundColor:"#ffebee",color:"#c62828",fontWeight:500}})}),e.jsx(j,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(nt,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(n,{variant:"body2",children:Pt(s.createdAt)})]})}),e.jsx(j,{children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[["MASTER_ADMIN","SUPER_ADMIN","ADMIN"].includes((t==null?void 0:t.role)||"")&&e.jsx(w,{variant:"outlined",size:"small",startIcon:k.viewUser===s.id?e.jsx(Ne,{size:16}):e.jsx(Oe,{}),onClick:()=>me(s.id),disabled:k.viewUser===s.id,sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:k.viewUser===s.id?"Loading...":"View"}),e.jsx(w,{variant:"outlined",size:"small",color:"primary",onClick:()=>It(s),sx:{textTransform:"none",borderColor:"#e0e0e0",minWidth:"40px",color:"text.primary","&:hover":{borderColor:"#2196F3",color:"#2196F3"}},children:e.jsx(Yt,{fontSize:"small"})}),e.jsx(w,{variant:"outlined",size:"small",startIcon:e.jsx(ut,{}),onClick:()=>B(s),sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Edit"})]})})]},s.id)})})]})}),!E&&!i&&N.length>0&&e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderTop:"1px solid #e0e0e0",flexWrap:"wrap",gap:2},children:[e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Showing ",(h.page-1)*h.limit+1," to"," ",Math.min(h.page*h.limit,h.total)," of"," ",h.total.toLocaleString()," users"]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Rows per page:"}),e.jsxs(qe,{value:h.limit,onChange:s=>o(x=>({...x,limit:Number(s.target.value),page:1})),size:"small",sx:{minWidth:80},children:[e.jsx(C,{value:20,children:"20"}),e.jsx(C,{value:50,children:"50"}),e.jsx(C,{value:100,children:"100"}),e.jsx(C,{value:200,children:"200"})]})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(w,{size:"small",onClick:()=>o(s=>({...s,page:1})),disabled:h.page===1,sx:{minWidth:"auto",px:1},children:"First"}),e.jsx(w,{size:"small",onClick:()=>o(s=>({...s,page:s.page-1})),disabled:h.page===1,sx:{minWidth:"auto",px:1},children:"Previous"}),e.jsxs(n,{variant:"body2",sx:{mx:2},children:["Page ",h.page," of ",Math.ceil(h.total/h.limit)]}),e.jsx(w,{size:"small",onClick:()=>o(s=>({...s,page:s.page+1})),disabled:h.page>=Math.ceil(h.total/h.limit),sx:{minWidth:"auto",px:1},children:"Next"}),e.jsx(w,{size:"small",onClick:()=>o(s=>({...s,page:Math.ceil(h.total/h.limit)})),disabled:h.page>=Math.ceil(h.total/h.limit),sx:{minWidth:"auto",px:1},children:"Last"})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Go to:"}),e.jsx(I,{type:"number",size:"small",value:h.page,onChange:s=>{const x=parseInt(s.target.value),p=Math.ceil(h.total/h.limit);x>=1&&x<=p&&o(R=>({...R,page:x}))},inputProps:{min:1,max:Math.ceil(h.total/h.limit),style:{textAlign:"center"}},sx:{width:80}})]})]})]})]})})]}),e.jsx(ds,{user:X,recentComplaints:ue,open:ke,onClose:()=>{je(!1),ne(null),ye([])},onEdit:()=>{je(!1),Ce(!0)}}),e.jsx(xs,{user:X,open:We,onClose:()=>{Ce(!1),ne(null)},onSave:Ye}),e.jsx(hs,{open:Y,onClose:()=>ze(!1),onSave:St}),ie&&e.jsx(ms,{userId:ie.id,userName:`${ie.firstName} ${ie.lastName}`,userDetails:ie,open:q,onClose:Nt}),e.jsx(es,{open:f.open,autoHideDuration:6e3,onClose:dt,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(_e,{onClose:dt,severity:f.severity,sx:{width:"100%"},children:f.message})})]})})};export{ws as default};
