var F=Object.defineProperty;var Y=(r,i,s)=>i in r?F(r,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[i]=s;var I=(r,i,s)=>Y(r,typeof i!="symbol"?i+"":i,s);import{j as t,B as f,T as v,aN as H,p as R,_ as E,av as z,$ as D,a1 as u,C as K,b as P,bS as Q,G as b}from"./mui-vendor-Brc-2iiC.js";import{r as p}from"./react-vendor-D7yrL1sD.js";import{u as X,Z as U,d as ee,e as oe,w as G}from"./index-DBuvollO.js";const ae=({filters:r,onFilterChange:i,statistics:s,showStatusFilter:g=!0,statusOptions:L})=>{const{user:e}=X(),[d,M]=p.useState([]),[A,O]=p.useState(!1),[S,C]=p.useState([]),[k,j]=p.useState(!1),[T,Z]=p.useState([]);p.useEffect(()=>{if(!A&&e&&e.role!=="MASTER_ADMIN"&&d.length===1){const o=d[0].code;r.cityCorporationCode!==o&&i({cityCorporationCode:o})}},[d,e,A,r.cityCorporationCode]),p.useEffect(()=>{e&&(async()=>{var n;try{O(!0);let a=(await ee.getCityCorporations("ACTIVE")).cityCorporations||[];if(e&&e.role!=="MASTER_ADMIN"){const x=e.cityCorporationCode||((n=e.cityCorporation)==null?void 0:n.code);if(x)a=a.filter(c=>c.code===x);else if(e.role==="SUPER_ADMIN")try{const c=await oe.getAssignedZones(Number(e.id));if(c&&c.length>0){const w=new Set;c.forEach(h=>{const y=h.zone||h;y.cityCorporationId&&w.add(y.cityCorporationId)}),w.size>0&&(a=a.filter(h=>w.has(h.id)));const N=c.map(h=>{const y=h.zone||h;return{id:y.id,zoneNumber:y.zoneNumber,name:y.name,cityCorporationId:y.cityCorporationId||0,status:"ACTIVE",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}).filter(h=>h.id);Z(N),N.length===1&&!r.zone&&i({zone:N[0].id.toString()})}}catch(c){console.error("Error fetching assigned zones:",c)}}M(a)}catch(l){console.error("Error fetching city corporations:",l),M([])}finally{O(!1)}})()},[e]),p.useEffect(()=>{(async()=>{if((e==null?void 0:e.role)!=="ADMIN")if(r.zone)try{j(!0);const n=await G.getWardsByZone(Number(r.zone),"ACTIVE");C(n),r.ward&&(n.some(a=>a.id.toString()===r.ward)||i({ward:void 0}))}catch(n){console.error("Error fetching wards:",n),C([]),r.ward&&i({ward:void 0})}finally{j(!1)}else C([]),r.ward&&i({ward:void 0})})()},[r.zone,e==null?void 0:e.role]),p.useEffect(()=>{(async()=>{var n;if((e==null?void 0:e.role)==="ADMIN"){let l=[];if(e.permissions)try{const a=typeof e.permissions=="string"?JSON.parse(e.permissions):e.permissions;a.wards&&Array.isArray(a.wards)&&(l=a.wards)}catch(a){console.error("Error parsing admin permissions:",a)}if(l.length>0)try{j(!0);const a=e.cityCorporationCode||((n=e.cityCorporation)==null?void 0:n.code);if(a){const x=await G.getWards({cityCorporationCode:a,status:"ACTIVE"});console.log("ðŸ“‹ All wards from API:",x.wards);const c=x.wards.filter(w=>l.includes(w.id));console.log("âœ… Filtered assigned wards:",c),C(c)}}catch(a){console.error("âŒ Error fetching assigned wards:",a),C([])}finally{j(!1)}else console.log("âš ï¸ ADMIN has no assigned wards"),C([])}})()},[e]);const V=o=>{i({cityCorporationCode:o==="ALL"?void 0:o,thanaId:void 0,zone:void 0,ward:void 0})},q=o=>{i({ward:o==="ALL"?void 0:o})},J=o=>{i({zone:o===""?void 0:o.toString(),ward:void 0})},_=o=>{i({status:o==="ALL"?void 0:o})},$=()=>{i({unreadOnly:!r.unreadOnly})},B=()=>{var n;let o;(e==null?void 0:e.role)!=="MASTER_ADMIN"&&(o=e.cityCorporationCode||((n=e.cityCorporation)==null?void 0:n.code)),i({cityCorporationCode:o,ward:void 0,zone:void 0,status:void 0,unreadOnly:!1})};return t.jsxs(f,{sx:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[t.jsxs(f,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider"},children:[t.jsxs(v,{variant:"h6",sx:{fontWeight:600,mb:1.5,display:"flex",alignItems:"center",gap:1},children:[t.jsx(H,{}),"Filters"]}),t.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx(R,{label:`${s.totalChats} Total`,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}}),t.jsx(R,{label:`${s.unreadCount} Unread`,size:"small",sx:{backgroundColor:"#4CAF50",color:"white",fontWeight:500}})]})]}),t.jsxs(f,{sx:{flex:1,overflowY:"auto",p:2,display:"flex",flexDirection:"column",gap:2},children:[t.jsxs(E,{fullWidth:!0,size:"small",children:[t.jsx(z,{id:"city-filter-label",children:"City Corporation"}),t.jsxs(D,{labelId:"city-filter-label",label:"City Corporation",value:r.cityCorporationCode||((e==null?void 0:e.role)!=="MASTER_ADMIN"&&d.length===1?d[0].code:"")||((e==null?void 0:e.role)==="MASTER_ADMIN"?"ALL":""),onChange:o=>V(o.target.value),disabled:A||(e==null?void 0:e.role)!=="MASTER_ADMIN"&&d.length<=1,sx:{backgroundColor:"background.default",fontSize:"0.875rem"},displayEmpty:!0,renderValue:o=>{if(A)return t.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(K,{size:16}),t.jsx(v,{variant:"body2",children:"Loading..."})]});if(!o)return"Select City Corporation";if(o==="ALL")return"All City Corporations";const n=d.find(l=>l.code===o);return n?typeof n.name=="object"?JSON.stringify(n.name):n.name:o},children:[(e==null?void 0:e.role)==="MASTER_ADMIN"&&t.jsx(u,{value:"ALL",children:"All City Corporations"}),d.map(o=>t.jsx(u,{value:o.code,children:typeof o.name=="object"?JSON.stringify(o.name):o.name},o.code))]})]}),(e==null?void 0:e.role)!=="ADMIN"&&t.jsxs(f,{children:[t.jsx(v,{variant:"caption",sx:{mb:.5,fontWeight:500,display:"block"},children:"Zone"}),t.jsx(U,{value:r.zone?Number(r.zone):"",onChange:J,cityCorporationCode:r.cityCorporationCode||"",disabled:!1,zones:T.length>0?T:void 0})]}),t.jsxs(E,{fullWidth:!0,size:"small",children:[t.jsx(z,{id:"ward-filter-label",shrink:!0,children:"Ward"}),t.jsxs(D,{labelId:"ward-filter-label",label:"Ward",value:r.ward||"",onChange:o=>q(o.target.value),disabled:(e==null?void 0:e.role)==="ADMIN"?k||S.length===0:!r.zone||k||S.length===0,sx:{backgroundColor:"background.default",fontSize:"0.875rem"},displayEmpty:!0,renderValue:o=>{if(!o&&(e==null?void 0:e.role)==="ADMIN")return"Select Ward";if(!o||o==="ALL")return"All Wards";const n=S.find(l=>l.id.toString()===o);return n?`Ward ${typeof n.wardNumber=="object"?JSON.stringify(n.wardNumber):n.wardNumber}`:o},children:[(e==null?void 0:e.role)!=="ADMIN"&&t.jsx(u,{value:"ALL",children:"All Wards"}),S.map(o=>t.jsxs(u,{value:o.id.toString(),children:["Ward ",typeof o.wardNumber=="object"?JSON.stringify(o.wardNumber):o.wardNumber]},o.id))]})]}),g&&t.jsxs(E,{fullWidth:!0,size:"small",children:[t.jsx(z,{id:"status-filter-label",children:"Status"}),t.jsxs(D,{labelId:"status-filter-label",label:"Status",value:r.status||"ALL",onChange:o=>_(o.target.value),sx:{backgroundColor:"background.default",fontSize:"0.875rem"},children:[t.jsx(u,{value:"ALL",children:"All Status"}),t.jsx(u,{value:"PENDING",children:"Pending"}),t.jsx(u,{value:"IN_PROGRESS",children:"In Progress"}),t.jsx(u,{value:"RESOLVED",children:"Solved"}),t.jsx(u,{value:"REJECTED",children:"Rejected"})]})]}),t.jsx(P,{fullWidth:!0,variant:r.unreadOnly?"contained":"outlined",size:"small",onClick:$,sx:{textTransform:"none",fontSize:"0.875rem",backgroundColor:r.unreadOnly?"#4CAF50":"transparent",borderColor:r.unreadOnly?"#4CAF50":"divider",color:r.unreadOnly?"white":"text.primary","&:hover":{backgroundColor:r.unreadOnly?"#45a049":"action.hover",borderColor:r.unreadOnly?"#45a049":"#4CAF50"}},children:r.unreadOnly?"âœ“ Unread Only":"Show Unread Only"}),t.jsx(P,{fullWidth:!0,variant:"text",size:"small",startIcon:t.jsx(Q,{}),onClick:B,sx:{textTransform:"none",fontSize:"0.875rem",color:"text.secondary","&:hover":{color:"error.main"}},children:"Clear All Filters"})]})]})},se=({count:r=5})=>t.jsx(f,{sx:{p:2},children:Array.from({length:r}).map((i,s)=>t.jsx(f,{sx:{mb:2},children:t.jsxs(f,{sx:{display:"flex",gap:1.5,mb:1},children:[t.jsx(b,{variant:"circular",width:48,height:48}),t.jsxs(f,{sx:{flex:1},children:[t.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[t.jsx(b,{variant:"text",width:"60%",height:20}),t.jsx(b,{variant:"text",width:"20%",height:16})]}),t.jsx(b,{variant:"text",width:"40%",height:16,sx:{mb:.5}}),t.jsx(b,{variant:"text",width:"80%",height:16})]})]})},s))}),m=class m{constructor(){I(this,"permissionGranted",!1);this.checkPermission()}static getInstance(){return m.instance||(m.instance=new m),m.instance}isSupported(){return"Notification"in window}checkPermission(){this.isSupported()&&(this.permissionGranted=Notification.permission==="granted")}async requestPermission(){if(!this.isSupported())return console.warn("Browser notifications are not supported"),!1;if(Notification.permission==="granted")return this.permissionGranted=!0,!0;if(Notification.permission==="denied")return console.warn("Notification permission was denied"),!1;try{const i=await Notification.requestPermission();return this.permissionGranted=i==="granted",this.permissionGranted}catch(i){return console.error("Error requesting notification permission:",i),!1}}showNotification(i,s){if(!this.isSupported()||!this.permissionGranted)return null;try{return new Notification(i,{...s,icon:s.icon||"/favicon.png",badge:s.badge||"/favicon.png",requireInteraction:s.requireInteraction??!1})}catch(g){return console.error("Error showing notification:",g),null}}showNewMessageNotification(i,s,g,L,e){const d=this.showNotification(`New message from ${i}`,{body:s,tag:`chat-${g}`,data:{complaintId:g,trackingNumber:L,type:"new-message"},requireInteraction:!1});return d&&e&&(d.onclick=()=>{window.focus(),e(),d.close()}),d}getPermissionStatus(){return this.isSupported()?Notification.permission:"denied"}hasPermission(){return this.permissionGranted}};I(m,"instance");let W=m;const de=W.getInstance();export{ae as C,se as a,de as b};
