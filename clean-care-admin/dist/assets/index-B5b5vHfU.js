import{j as e,B as o,b3 as Rs,T as i,b as L,s as Ee,t as De,i as ue,v as Re,w as Fe,H as _e,p as ge,D as Fs,h as is,O as Ue,J as ls,K as ds,N as cs,a6 as ss,af as ts,a9 as os,C as Ae,b4 as Os,b5 as $s,x as Oe,y as xs,ac as Zs,A as ke,g as A,a1 as u,I as ve,V as Le,l as We,b6 as Us,b7 as hs,u as qs,o as Vs,e as rs,f as as,G as se,Z as Js,_ as qe,av as Ve,$ as Te,aJ as _s,ap as Bs,P as Hs,aq as Gs,ar as Ks,as as ze,at as g,m as ns,au as Qs,b8 as Xs,b9 as Ys,ba as et,bb as st}from"./mui-vendor-Y6GvQTLC.js";import{r as n,a as tt}from"./react-vendor-D7yrL1sD.js";import{u as $e,f as ms,a as Y,s as fs,b as ps,j as Je,d as Be,e as He,k as gs,w as Me,U as ot,m as rt,M as at,Z as nt}from"./index-B_PiLh6w.js";import{u as Ce}from"./userManagementService-CLlXA1yC.js";import{f as it}from"./format-B_T1Ok2z.js";import{L as lt}from"./LiveChatConversationPanel-DOdL0Tkx.js";import"./query-vendor-D4yC0Jq7.js";import"./chart-vendor-BgnY-Lfo.js";import"./ErrorDisplay-BztN8unE.js";const dt=({icon:s,title:W,description:M,action:E})=>e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,px:3,textAlign:"center"},children:[e.jsx(o,{sx:{width:80,height:80,borderRadius:"50%",backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",mb:3},children:s||e.jsx(Rs,{sx:{fontSize:40,color:"#9e9e9e"}})}),e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:1},children:W}),M&&e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3,maxWidth:400},children:M}),E&&e.jsx(L,{variant:"contained",onClick:E.onClick,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3},children:E.label})]}),ct=({user:s,recentComplaints:W,open:M,onClose:E,onEdit:r})=>{var fe,ee,I,_,N;const{user:a}=$e(),[x,S]=n.useState([]),[j,Q]=n.useState(!1);n.useEffect(()=>{M&&s?J():S([])},[M,s]);const J=async()=>{if(s)try{Q(!0);const f=await Ce.getUserReactions(s.id);S(f)}catch(f){console.error("Error fetching reactions:",f)}finally{Q(!1)}};if(!s)return null;const D=f=>{switch(f){case"ACTIVE":return{backgroundColor:"#e8f5e8",color:"#2e7d2e"};case"INACTIVE":return{backgroundColor:"#f5f5f5",color:"#666666"};case"SUSPENDED":return{backgroundColor:"#ffebee",color:"#c62828"};case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},X=f=>{switch(f){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724"};case"REJECTED":return{backgroundColor:"#ffebee",color:"#c62828"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},b=f=>{if(!f)return"Never";try{return it(new Date(f),"MMM dd, yyyy hh:mm a")}catch{return"Invalid date"}},q=s.statistics.totalComplaints>0?Math.round(s.statistics.resolvedComplaints/s.statistics.totalComplaints*100):0;return e.jsxs(Ee,{open:M,onClose:E,maxWidth:"md",fullWidth:!0,fullScreen:window.innerWidth<600,slotProps:{paper:{sx:{borderRadius:{xs:0,sm:2},animation:window.innerWidth<600?`${fs} ${Y.normal.duration} ${Y.smooth.timing}`:`${ps} ${Y.normal.duration} ${Y.smooth.timing}`,animationFillMode:"both",maxHeight:{xs:"100vh",sm:"90vh"}}},backdrop:{sx:{animation:`${ms} ${Y.fast.duration} ${Y.fast.timing}`}}},children:[e.jsx(De,{sx:{pb:{xs:1.5,sm:2}},children:e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600,fontSize:{xs:"1.25rem",sm:"1.5rem"}},children:"User Details"}),e.jsx(ue,{onClick:E,size:"small",children:e.jsx(Re,{})})]})}),e.jsxs(Fe,{dividers:!0,sx:{px:{xs:2,sm:3},py:{xs:2,sm:2}},children:[e.jsxs(o,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(o,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center",sm:"center"},gap:{xs:2,sm:3},mb:2},children:[e.jsxs(_e,{sx:{width:{xs:64,sm:80},height:{xs:64,sm:80},bgcolor:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2rem"},fontWeight:600},src:s.avatar||void 0,children:[s.firstName[0],s.lastName[0]]}),e.jsxs(o,{sx:{flex:1,textAlign:{xs:"center",sm:"left"},width:{xs:"100%",sm:"auto"}},children:[e.jsxs(i,{variant:"h6",sx:{fontWeight:600,mb:.5,fontSize:{xs:"1rem",sm:"1.25rem"}},children:[s.firstName," ",s.lastName]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{mb:1,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["User ID: #",s.id.toString().padStart(6,"0")]}),e.jsxs(o,{sx:{display:"flex",gap:1,justifyContent:{xs:"center",sm:"flex-start"},flexWrap:"wrap"},children:[e.jsx(ge,{label:s.status,size:"small",sx:{...D(s.status),...Je,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}}),e.jsx(ge,{label:s.role,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",...Je,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}})]})]})]}),e.jsx(Fs,{sx:{my:{xs:1.5,sm:2}}}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(o,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(is,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(o,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Email"}),e.jsx(i,{variant:"body2",sx:{wordBreak:"break-word",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.email||"Not provided"})]}),s.emailVerified&&e.jsx(Ue,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(o,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(ls,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(o,{sx:{flex:1},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Phone"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.phone})]}),s.phoneVerified&&e.jsx(Ue,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(o,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(ds,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20},mt:.5}}),e.jsxs(o,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Location"}),s.cityCorporation&&e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:500},children:s.cityCorporation.name}),e.jsxs(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Ward ",((fe=s.ward)==null?void 0:fe.wardNumber)??"N/A"," â€¢ Zone ",((ee=s.zone)==null?void 0:ee.zoneNumber)??"N/A"]}),((I=s.ward)==null?void 0:I.inspectorName)&&e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Inspector: ",s.ward.inspectorName," ",s.ward.inspectorPhone?`(${s.ward.inspectorPhone})`:""]}),((_=s.zone)==null?void 0:_.officerName)&&e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Zonal Officer: ",s.zone.officerName," ",s.zone.officerPhone?`(${s.zone.officerPhone})`:""]}),s.address&&e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.8rem"},mt:.5,wordBreak:"break-word"},children:s.address})]})]})}),e.jsx(o,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(cs,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(o,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Joined"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:b(s.createdAt)})]})]})}),(a==null?void 0:a.role)==="MASTER_ADMIN"&&e.jsx(o,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(Ue,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(o,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Password"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontFamily:"monospace"},children:s.visiblePassword?e.jsx("span",{style:{color:"#2e7d32",fontWeight:"bold"},children:s.visiblePassword}):e.jsxs("span",{style:{color:"#666"},children:["Hash: ",(N=s.passwordHash)==null?void 0:N.substring(0,20),"... (Reset to see actual)"]})})]})]})})]})]}),e.jsxs(o,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Activity Statistics"}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(o,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#2196F3",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.totalComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Total Complaints"})]})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(o,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.resolvedComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Resolved"})]})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(o,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#FF9800",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.unresolvedComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Unresolved"})]})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(o,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsxs(i,{variant:"h4",sx:{fontWeight:700,color:"#9C27B0",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:[q,"%"]}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Success Rate"})]})})]}),e.jsx(o,{sx:{mt:{xs:1.5,sm:2}},children:e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Last Login: ",b(s.lastLoginAt)]})})]}),e.jsxs(o,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Recent Complaints"}),W.length>0?e.jsx(ss,{sx:{p:0},children:W.map(f=>e.jsx(tt.Fragment,{children:e.jsx(ts,{sx:{px:{xs:1.5,sm:2},py:{xs:1,sm:1.5},backgroundColor:"#f8f9fa",borderRadius:1,mb:1},children:e.jsx(os,{primary:e.jsxs(o,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},gap:{xs:.5,sm:1}},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:f.title}),e.jsx(ge,{label:f.status.replace("_"," "),size:"small",sx:{...X(f.status),...Je,height:{xs:18,sm:20},fontSize:{xs:"0.65rem",sm:"0.7rem"}}})]}),secondary:e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:b(f.createdAt)}),primaryTypographyProps:{component:"div"},secondaryTypographyProps:{component:"div"}})})},f.id))}):e.jsx(i,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:{xs:2,sm:3},fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"No complaints yet"})]}),e.jsxs(o,{sx:{mt:{xs:2,sm:3}},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Waste Management Interactions"}),j?e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(Ae,{size:24})}):x.length>0?e.jsx(ss,{sx:{p:0},children:x.map(f=>e.jsx(ts,{sx:{px:{xs:1.5,sm:2},py:{xs:1,sm:1.5},backgroundColor:"#f8f9fa",borderRadius:1,mb:1},children:e.jsx(os,{primary:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[f.reactionType==="LIKE"?e.jsx(Os,{sx:{fontSize:18,color:"#4CAF50"}}):e.jsx($s,{sx:{fontSize:18,color:"#F44336"}}),e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:f.post.title})]}),secondary:e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Category: ",f.post.category.replace("_"," ")]}),e.jsx(i,{variant:"caption",color:"text.secondary",children:b(f.createdAt)})]}),primaryTypographyProps:{component:"div"},secondaryTypographyProps:{component:"div"}})},f.id))}):e.jsx(i,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:{xs:2,sm:3},fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"No interactions yet"})]})]}),e.jsxs(Oe,{sx:{px:{xs:2,sm:3},py:{xs:1.5,sm:2},flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[e.jsx(L,{onClick:E,variant:"outlined",sx:{textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Close"}),e.jsx(L,{onClick:r,variant:"contained",startIcon:e.jsx(xs,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Edit User"})]})]})},xt=({open:s,title:W,message:M,confirmText:E="Confirm",cancelText:r="Cancel",onConfirm:a,onCancel:x,severity:S="warning"})=>{const j=()=>{switch(S){case"error":return"#d32f2f";case"warning":return"#ed6c02";case"info":return"#0288d1";default:return"#ed6c02"}};return e.jsxs(Ee,{open:s,onClose:x,maxWidth:"xs",fullWidth:!0,children:[e.jsx(De,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{sx:{width:40,height:40,borderRadius:"50%",backgroundColor:`${j()}20`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Zs,{sx:{color:j()}})}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:W})]})}),e.jsx(Fe,{children:e.jsx(i,{variant:"body1",color:"text.secondary",children:M})}),e.jsxs(Oe,{sx:{px:3,pb:2},children:[e.jsx(L,{onClick:x,sx:{textTransform:"none",color:"text.secondary"},children:r}),e.jsx(L,{onClick:a,variant:"contained",sx:{textTransform:"none",backgroundColor:j(),"&:hover":{backgroundColor:j(),opacity:.9}},children:E})]})]})},ht=({user:s,open:W,onClose:M,onSave:E})=>{const{user:r}=$e(),[a,x]=n.useState({firstName:"",lastName:"",email:"",phone:"",address:"",cityCorporationCode:"",zoneId:"",wardId:"",status:"ACTIVE",newPassword:"",confirmPassword:""}),[S,j]=n.useState([]),[Q,J]=n.useState([]),[D,X]=n.useState([]),[b,q]=n.useState(!1),[fe,ee]=n.useState(!1),[I,_]=n.useState(!1),[N,f]=n.useState(!1),[Z,te]=n.useState(!1),[C,ne]=n.useState({}),[w,oe]=n.useState(!1),[ie,le]=n.useState(null),[F,je]=n.useState(!1);n.useEffect(()=>{de()},[]),n.useEffect(()=>{a.cityCorporationCode?ye(a.cityCorporationCode):(J([]),X([]),x(c=>({...c,zoneId:"",wardId:""})))},[a.cityCorporationCode]),n.useEffect(()=>{a.zoneId?ce(parseInt(a.zoneId)):(X([]),x(c=>({...c,wardId:""})))},[a.zoneId]);const de=async()=>{try{q(!0);const c=await Be.getCityCorporations("ACTIVE");j(c.cityCorporations||[])}catch(c){console.error("Error fetching city corporations:",c),j([])}finally{q(!1)}},ye=async c=>{try{if(ee(!0),(r==null?void 0:r.role)==="SUPER_ADMIN")try{const H=await He.getAssignedZones(Number(r.id)),P=S.find(p=>p.code===c),re=H.filter(p=>p.zone.cityCorporationCode===c).map(p=>({id:p.zone.id,zoneNumber:p.zone.zoneNumber,name:p.zone.name,cityCorporationId:(P==null?void 0:P.id)||0,status:"ACTIVE",createdAt:p.assignedAt,updatedAt:p.assignedAt}));J(re);return}catch(H){console.error("Error fetching assigned zones:",H),J([]);return}const y=await gs.getZones({cityCorporationCode:c,status:"ACTIVE"});J(y.zones||[])}catch(y){console.error("Error fetching zones:",y),J([])}finally{ee(!1)}},ce=async c=>{try{_(!0);const y=await Me.getWards({zoneId:c,status:"ACTIVE"});X(y.wards||[])}catch(y){console.error("Error fetching wards:",y),X([])}finally{_(!1)}};n.useEffect(()=>{var c,y,H,P,re,p,ae;s&&(x({firstName:s.firstName,lastName:s.lastName,email:s.email||"",phone:s.phone,address:s.address||"",cityCorporationCode:((c=s.cityCorporation)==null?void 0:c.code)||"",zoneId:((H=(y=s.zone)==null?void 0:y.id)==null?void 0:H.toString())||"",wardId:((re=(P=s.ward)==null?void 0:P.id)==null?void 0:re.toString())||"",status:s.status,newPassword:"",confirmPassword:""}),ne({}),le(null),(p=s.cityCorporation)!=null&&p.code&&ye(s.cityCorporation.code),(ae=s.zone)!=null&&ae.id&&ce(s.zone.id))},[s]);const xe=c=>c?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c):!0,B=c=>/^01[0-9]{9}$/.test(c.replace(/\s+/g,"")),be=()=>{const c={};return a.firstName.trim()||(c.firstName="First name is required"),a.lastName.trim()||(c.lastName="Last name is required"),a.phone.trim()?B(a.phone)||(c.phone="Invalid phone format (must be 11 digits starting with 01)"):c.phone="Phone number is required",a.email&&!xe(a.email)&&(c.email="Invalid email format"),a.cityCorporationCode||(c.cityCorporationCode="City Corporation is required"),a.zoneId||(c.zoneId="Zone is required"),a.wardId||(c.wardId="Ward is required"),(a.newPassword||a.confirmPassword)&&(a.newPassword.length<8&&(c.newPassword="Password must be at least 8 characters"),a.newPassword!==a.confirmPassword&&(c.confirmPassword="Passwords do not match")),ne(c),Object.keys(c).length===0},O=c=>y=>{const H=y.target.value;x(P=>({...P,[c]:H})),C[c]&&ne(P=>({...P,[c]:void 0})),ie&&le(null)},l=async(c=!1)=>{var P,re,p,ae,G,Se,m,K;if(!be())return;const y=a.status!==(s==null?void 0:s.status),H=a.status==="SUSPENDED"||a.status==="INACTIVE";if(y&&H&&!c){je(!0);return}oe(!0),le(null);try{const T={};a.firstName!==(s==null?void 0:s.firstName)&&(T.firstName=a.firstName),a.lastName!==(s==null?void 0:s.lastName)&&(T.lastName=a.lastName),a.email!==((s==null?void 0:s.email)||"")&&(T.email=a.email||void 0),a.phone!==(s==null?void 0:s.phone)&&(T.phone=a.phone),a.address!==((s==null?void 0:s.address)||"")&&(T.address=a.address||void 0),a.cityCorporationCode!==((P=s==null?void 0:s.cityCorporation)==null?void 0:P.code)&&(T.cityCorporationCode=a.cityCorporationCode),a.zoneId!==((p=(re=s==null?void 0:s.zone)==null?void 0:re.id)==null?void 0:p.toString())&&(T.zoneId=parseInt(a.zoneId)),a.wardId!==((G=(ae=s==null?void 0:s.ward)==null?void 0:ae.id)==null?void 0:G.toString())&&(T.wardId=parseInt(a.wardId)),a.status!==(s==null?void 0:s.status)&&(T.status=a.status),a.newPassword&&(T.password=a.newPassword),await E(T),M()}catch(T){console.error("Error updating user:",T),le(((K=(m=(Se=T.response)==null?void 0:Se.data)==null?void 0:m.error)==null?void 0:K.message)||T.message||"Failed to update user. Please try again.")}finally{oe(!1)}},R=()=>{je(!1),l(!0)},U=()=>{je(!1)},v=()=>{w||M()};return s?e.jsxs(Ee,{open:W,onClose:v,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(De,{sx:{pb:2},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Edit User"}),e.jsx(ue,{onClick:v,size:"small",disabled:w,children:e.jsx(Re,{})})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Update user information and account settings"})]}),e.jsxs(Fe,{dividers:!0,children:[ie&&e.jsx(ke,{severity:"error",sx:{mb:3},onClose:()=>le(null),children:ie}),e.jsxs(o,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"First Name",value:a.firstName,onChange:O("firstName"),error:!!C.firstName,helperText:C.firstName,disabled:w,required:!0})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Last Name",value:a.lastName,onChange:O("lastName"),error:!!C.lastName,helperText:C.lastName,disabled:w,required:!0})})]}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Email",type:"email",value:a.email,onChange:O("email"),error:!!C.email,helperText:C.email,disabled:w})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Phone",value:a.phone,onChange:O("phone"),error:!!C.phone,helperText:C.phone,disabled:w,required:!0})})]}),e.jsx(o,{sx:{mb:2},children:e.jsx(A,{fullWidth:!0,label:"Address (à¦ à¦¿à¦•à¦¾à¦¨à¦¾)",value:a.address,onChange:O("address"),disabled:w,multiline:!0,rows:2,placeholder:"Enter full address"})}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(A,{fullWidth:!0,select:!0,label:"City Corporation",value:a.cityCorporationCode,onChange:O("cityCorporationCode"),disabled:w||b||(r==null?void 0:r.role)!=="MASTER_ADMIN",error:!!C.cityCorporationCode,helperText:C.cityCorporationCode,required:!0,children:[e.jsx(u,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),S.map(c=>e.jsx(u,{value:c.code,children:c.name},c.code))]})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(A,{fullWidth:!0,select:!0,label:"Zone",value:a.zoneId,onChange:O("zoneId"),disabled:w||fe||!a.cityCorporationCode||(r==null?void 0:r.role)!=="MASTER_ADMIN",error:!!C.zoneId,helperText:C.zoneId||(a.cityCorporationCode?fe?"Loading zones...":Q.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(u,{value:"",children:e.jsx("em",{children:"Select Zone"})}),Q.map(c=>e.jsx(u,{value:c.id.toString(),children:c.name||`Zone ${c.zoneNumber}`},c.id))]})})]}),e.jsx(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(A,{fullWidth:!0,select:!0,label:"Ward",value:a.wardId,onChange:O("wardId"),disabled:w||I||!a.zoneId||(r==null?void 0:r.role)!=="MASTER_ADMIN",error:!!C.wardId,helperText:C.wardId||(a.zoneId?I?"Loading wards...":D.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(u,{value:"",children:e.jsx("em",{children:"Select Ward"})}),D.map(c=>e.jsxs(u,{value:c.id.toString(),children:["Ward ",typeof c.wardNumber=="object"?JSON.stringify(c.wardNumber):c.wardNumber]},c.id))]})})}),(r==null?void 0:r.role)==="MASTER_ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Change Password (Optional)"}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"New Password",type:N?"text":"password",value:a.newPassword,onChange:O("newPassword"),error:!!C.newPassword,helperText:C.newPassword||"Leave blank to keep current password",disabled:w,slotProps:{input:{endAdornment:e.jsx(ve,{position:"end",children:e.jsx(ue,{onClick:()=>f(!N),edge:"end",size:"small",children:N?e.jsx(Le,{}):e.jsx(We,{})})})}}})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Confirm New Password",type:Z?"text":"password",value:a.confirmPassword,onChange:O("confirmPassword"),error:!!C.confirmPassword,helperText:C.confirmPassword,disabled:w,slotProps:{input:{endAdornment:e.jsx(ve,{position:"end",children:e.jsx(ue,{onClick:()=>te(!Z),edge:"end",size:"small",children:Z?e.jsx(Le,{}):e.jsx(We,{})})})}}})})]})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Settings"}),e.jsx(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(A,{fullWidth:!0,select:!0,label:"Status",value:a.status,onChange:O("status"),disabled:w,children:[e.jsx(u,{value:"ACTIVE",children:"Active"}),e.jsx(u,{value:"INACTIVE",children:"Inactive"}),e.jsx(u,{value:"SUSPENDED",children:"Suspended"}),e.jsx(u,{value:"PENDING",children:"Pending"})]})})})]})]}),e.jsxs(Oe,{sx:{px:3,py:2},children:[e.jsx(L,{onClick:v,variant:"outlined",disabled:w,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(L,{onClick:()=>l(),variant:"contained",disabled:w,startIcon:w?e.jsx(Ae,{size:20}):e.jsx(Us,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:w?"Saving...":"Save Changes"})]}),e.jsx(xt,{open:F,title:a.status==="SUSPENDED"?"Suspend User":"Deactivate User",message:a.status==="SUSPENDED"?`Are you sure you want to suspend ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}? This will immediately block their access to the system.`:`Are you sure you want to deactivate ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}? They will not be able to access the system.`,confirmText:"Confirm",cancelText:"Cancel",severity:"warning",onConfirm:R,onCancel:U})]}):null},mt=({open:s,onClose:W,onSave:M})=>{const{user:E}=$e(),[r,a]=n.useState({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),[x,S]=n.useState({}),[j,Q]=n.useState(!1),[J,D]=n.useState(null),[X,b]=n.useState(!1),[q,fe]=n.useState(!1),[ee,I]=n.useState([]),[_,N]=n.useState([]),[f,Z]=n.useState([]),[te,C]=n.useState(!1),[ne,w]=n.useState(!1),[oe,ie]=n.useState(!1);n.useEffect(()=>{le()},[]),n.useEffect(()=>{r.cityCorporationCode?F(r.cityCorporationCode):(N([]),Z([]),a(l=>({...l,zoneId:"",wardId:""})))},[r.cityCorporationCode]),n.useEffect(()=>{r.zoneId?je(parseInt(r.zoneId)):(Z([]),a(l=>({...l,wardId:""})))},[r.zoneId]);const le=async()=>{try{C(!0);const l=await Be.getCityCorporations("ACTIVE");I(l.cityCorporations||[])}catch(l){console.error("Error fetching city corporations:",l),I([]),D("Failed to load city corporations. Please try again.")}finally{C(!1)}},F=async l=>{try{if(w(!0),(E==null?void 0:E.role)==="SUPER_ADMIN")try{const U=await He.getAssignedZones(Number(E.id)),v=ee.find(y=>y.code===l),c=U.filter(y=>y.zone.cityCorporationCode===l).map(y=>({id:y.zone.id,zoneNumber:y.zone.zoneNumber,name:y.zone.name,cityCorporationId:(v==null?void 0:v.id)||0,status:"ACTIVE",createdAt:y.assignedAt,updatedAt:y.assignedAt}));N(c);return}catch(U){console.error("Error fetching assigned zones:",U),N([]);return}const R=await gs.getZones({cityCorporationCode:l,status:"ACTIVE"});N(R.zones||[])}catch(R){console.error("Error fetching zones:",R),N([])}finally{w(!1)}},je=async l=>{try{ie(!0);const R=await Me.getWards({zoneId:l,status:"ACTIVE"});Z(R.wards||[])}catch(R){console.error("Error fetching wards:",R),Z([])}finally{ie(!1)}},de=l=>l?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l):!0,ye=l=>/^01[0-9]{9}$/.test(l.replace(/\s+/g,"")),ce=l=>l.length>=8,xe=()=>{const l={};return r.firstName.trim()||(l.firstName="First name is required"),r.lastName.trim()||(l.lastName="Last name is required"),r.phone.trim()?ye(r.phone)||(l.phone="Invalid phone format (must be 11 digits starting with 01)"):l.phone="Phone number is required",r.password?ce(r.password)||(l.password="Password must be at least 8 characters"):l.password="Password is required",r.confirmPassword?r.password!==r.confirmPassword&&(l.confirmPassword="Passwords do not match"):l.confirmPassword="Please confirm your password",r.cityCorporationCode||(l.cityCorporationCode="City Corporation is required"),r.zoneId||(l.zoneId="Zone is required"),r.wardId||(l.wardId="Ward is required"),r.email&&!de(r.email)&&(l.email="Invalid email format"),S(l),Object.keys(l).length===0},B=l=>R=>{const U=R.target.value;a(v=>({...v,[l]:U})),x[l]&&S(v=>({...v,[l]:void 0})),J&&D(null)},be=async()=>{var l,R,U;if(xe()){Q(!0),D(null);try{const v={firstName:r.firstName,lastName:r.lastName,phone:r.phone,password:r.password,role:r.role};r.email&&(v.email=r.email),r.cityCorporationCode&&(v.cityCorporationCode=r.cityCorporationCode),r.zoneId&&(v.zoneId=parseInt(r.zoneId)),r.wardId&&(v.wardId=parseInt(r.wardId)),await M(v),a({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),W()}catch(v){console.error("Error creating user:",v),D(((U=(R=(l=v.response)==null?void 0:l.data)==null?void 0:R.error)==null?void 0:U.message)||v.message||"Failed to create user. Please try again.")}finally{Q(!1)}}},O=()=>{j||(a({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),S({}),D(null),W())};return e.jsxs(Ee,{open:s,onClose:O,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(De,{sx:{pb:2},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Add New User"}),e.jsx(ue,{onClick:O,size:"small",disabled:j,children:e.jsx(Re,{})})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create a new user account"})]}),e.jsxs(Fe,{dividers:!0,children:[J&&e.jsx(ke,{severity:"error",sx:{mb:3},onClose:()=>D(null),children:J}),e.jsxs(o,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"First Name",value:r.firstName,onChange:B("firstName"),error:!!x.firstName,helperText:x.firstName,disabled:j,required:!0})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Last Name",value:r.lastName,onChange:B("lastName"),error:!!x.lastName,helperText:x.lastName,disabled:j,required:!0})})]}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Email",type:"email",value:r.email,onChange:B("email"),error:!!x.email,helperText:x.email||"Optional",disabled:j})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Phone",value:r.phone,onChange:B("phone"),error:!!x.phone,helperText:x.phone,disabled:j,required:!0})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Credentials"}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Password",type:X?"text":"password",value:r.password,onChange:B("password"),error:!!x.password,helperText:x.password||"Minimum 8 characters",disabled:j,required:!0,slotProps:{input:{endAdornment:e.jsx(ve,{position:"end",children:e.jsx(ue,{onClick:()=>b(!X),edge:"end",size:"small",children:X?e.jsx(Le,{}):e.jsx(We,{})})})}}})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(A,{fullWidth:!0,label:"Confirm Password",type:q?"text":"password",value:r.confirmPassword,onChange:B("confirmPassword"),error:!!x.confirmPassword,helperText:x.confirmPassword,disabled:j,required:!0,slotProps:{input:{endAdornment:e.jsx(ve,{position:"end",children:e.jsx(ue,{onClick:()=>fe(!q),edge:"end",size:"small",children:q?e.jsx(Le,{}):e.jsx(We,{})})})}}})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(A,{fullWidth:!0,select:!0,label:"City Corporation",value:r.cityCorporationCode,onChange:B("cityCorporationCode"),disabled:j||te,error:!!x.cityCorporationCode,helperText:x.cityCorporationCode||"Required",required:!0,children:[e.jsx(u,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),ee.map(l=>e.jsx(u,{value:l.code,children:l.name},l.code))]})}),e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(A,{fullWidth:!0,select:!0,label:"Zone",value:r.zoneId,onChange:B("zoneId"),disabled:j||ne||!r.cityCorporationCode,error:!!x.zoneId,helperText:x.zoneId||(r.cityCorporationCode?ne?"Loading zones...":_.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(u,{value:"",children:e.jsx("em",{children:"Select Zone"})}),_.map(l=>e.jsx(u,{value:l.id.toString(),children:l.name||`Zone ${l.zoneNumber}`},l.id))]})})]}),e.jsx(o,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(o,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(A,{fullWidth:!0,select:!0,label:"Ward",value:r.wardId,onChange:B("wardId"),disabled:j||oe||!r.zoneId,error:!!x.wardId,helperText:x.wardId||(r.zoneId?oe?"Loading wards...":f.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(u,{value:"",children:e.jsx("em",{children:"Select Ward"})}),f.map(l=>e.jsxs(u,{value:l.id.toString(),children:["Ward ",typeof l.wardNumber=="object"?JSON.stringify(l.wardNumber):l.wardNumber]},l.id))]})})})]})]}),e.jsxs(Oe,{sx:{px:3,py:2},children:[e.jsx(L,{onClick:O,variant:"outlined",disabled:j,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(L,{onClick:be,variant:"contained",disabled:j,startIcon:j?e.jsx(Ae,{size:20}):e.jsx(hs,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:j?"Creating...":"Create User"})]})]})},ft=({userId:s,open:W,onClose:M,userName:E="User",userDetails:r})=>{const a=qs(),x=Vs(a.breakpoints.down("sm")),S=n.useMemo(()=>!r||!s?null:{id:r.id,firstName:r.firstName,lastName:r.lastName,avatar:r.avatar||null,phone:r.phone||null,cityCorporationCode:r.cityCorporationCode||null,wardId:r.wardId||null,zoneId:r.zoneId||null,ward:r.ward?{id:r.ward.id,number:r.ward.wardNumber,wardNumber:r.ward.wardNumber}:null,zone:r.zone?{id:r.zone.id,number:r.zone.zoneNumber,name:r.zone.name||null}:null},[r,s]);return e.jsxs(Ee,{open:W,onClose:M,maxWidth:"sm",fullWidth:!0,fullScreen:x,slotProps:{paper:{sx:{borderRadius:x?0:2,height:x?"100vh":"80vh",maxHeight:x?"100vh":"80vh",display:"flex",flexDirection:"column",animation:x?`${fs} ${Y.normal.duration} ${Y.smooth.timing}`:`${ps} ${Y.normal.duration} ${Y.smooth.timing}`,animationFillMode:"both",overflow:"hidden"}},backdrop:{sx:{animation:`${ms} ${Y.fast.duration} ${Y.fast.timing}`}}},children:[e.jsx(o,{sx:{position:"absolute",right:8,top:8,zIndex:10},children:e.jsx(ue,{onClick:M,size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 1)"},boxShadow:1},children:e.jsx(Re,{})})}),e.jsx(o,{sx:{flex:1,height:"100%",overflow:"hidden"},children:e.jsx(lt,{userId:s,userInfo:S,onMessagesRead:()=>{}})})]})},St=()=>{var Ye,es;const{user:s}=$e(),[W,M]=n.useState([]),[E,r]=n.useState(!0),[a,x]=n.useState(null),[S,j]=n.useState(""),[Q,J]=n.useState(""),[D,X]=n.useState([]),[b,q]=n.useState(""),[fe,ee]=n.useState(null),[I,_]=n.useState(""),[N,f]=n.useState(null),[Z,te]=n.useState([]),[C,ne]=n.useState(!1),[w,oe]=n.useState(!1),[ie,le]=n.useState([]),[F,je]=n.useState(null),[de,ye]=n.useState(!0),[ce,xe]=n.useState(null),[B,be]=n.useState([]),[O,l]=n.useState(!1),[R,U]=n.useState(!1),[v,c]=n.useState(!1),[y,H]=n.useState(!1),[P,re]=n.useState(null),[p,ae]=n.useState([]),[G,Se]=n.useState(ot.ACTIVE),[m,K]=n.useState({page:1,limit:20,total:0}),[T,Ge]=n.useState({open:!1,message:"",severity:"success"}),[Ze,Ke]=n.useState({viewUser:null,statusChange:null});n.useEffect(()=>{const t=setTimeout(()=>{J(S)},500);return()=>clearTimeout(t)},[S]),n.useEffect(()=>{s&&(async()=>{var h,k;console.log("ðŸ”„ UserManagement: Starting data fetch for user:",s==null?void 0:s.id,s==null?void 0:s.role);const d=[Be.getCityCorporations("ACTIVE").catch(pe=>(console.error("âŒ Error fetching city corporations:",pe),{cityCorporations:[]}))];(s==null?void 0:s.role)==="SUPER_ADMIN"&&s.id&&(console.log("ðŸ‘¤ Fetching assigned zones for Super Admin:",s.id),d.push(He.getAssignedZones(Number(s.id)).catch(pe=>(console.error("âŒ Error fetching assigned zones:",pe),[])))),ne(!0);try{const pe=await Promise.all(d),Ms=pe[0],we=pe[1];let me=Ms.cityCorporations||[];if(console.log("ðŸ™ï¸ Fetched City Corps:",me.length),s&&s.role!=="MASTER_ADMIN"){const $=s.cityCorporationCode||((h=s.cityCorporation)==null?void 0:h.code);if($)console.log("ðŸŽ¯ Filtering City Corp for assigned code:",$),me=me.filter(z=>z.code===$),me.length>0&&b!==$&&q($);else if(s.role==="SUPER_ADMIN"&&we){const z=new Set;Array.isArray(we)&&we.forEach(V=>{const Ne=V.zone||V;Ne.cityCorporationId&&z.add(Ne.cityCorporationId)}),z.size>0&&(console.log("ðŸŽ¯ Filtering City Corps for Super Admin assigned zones:",Array.from(z)),me=me.filter(V=>z.has(V.id)),me.length===1&&q(me[0].code))}}if(X(me),we){console.log("ðŸ›¡ï¸ Raw Assigned Zones:",we);const $=we.map(z=>{const V=z.zone||z;return!V||!V.id?null:{id:V.id,zoneNumber:V.zoneNumber,name:V.name,cityCorporationId:V.cityCorporationId||0,status:"ACTIVE",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}).filter(z=>z!==null);console.log("âœ… Formatted Assigned Zones:",$),le($),$.length===1&&(console.log("ðŸ‘Œ Auto-selecting single zone:",$[0].id),_($[0].id))}if((s==null?void 0:s.role)==="ADMIN"){console.log("ðŸ‘¤ Loading assigned wards for Admin");let $=[];if(s.permissions)try{const z=JSON.parse(s.permissions);z.wards&&Array.isArray(z.wards)&&($=z.wards)}catch(z){console.error("Error parsing admin permissions:",z)}if(console.log(`ðŸ”’ ADMIN assigned ward IDs: [${$.join(", ")}]`),$.length>0)try{oe(!0);const z=s.cityCorporationCode||((k=s.cityCorporation)==null?void 0:k.code);if(z){const V=await Me.getWards({cityCorporationCode:z,status:"ACTIVE"});console.log("ðŸ“‹ All wards from API:",V.wards);const Ne=V.wards.filter(Ds=>$.includes(Ds.id));console.log("âœ… Filtered assigned wards:",Ne),te(Ne)}}catch(z){console.error("âŒ Error fetching assigned wards:",z),te([])}finally{oe(!1)}else console.log("âš ï¸ ADMIN has no assigned wards"),te([])}}catch(pe){console.error("âŒ Error in UserManagement fetchData:",pe)}finally{ne(!1)}})()},[s]),n.useEffect(()=>{if(b!=="ALL"){const t=D.find(d=>d.code===b);t&&ee(t.id)}else ee(null),te([]);_(""),f(null)},[b,D]),n.useEffect(()=>{(s==null?void 0:s.role)!=="ADMIN"&&(I?us(I):te([]),f(null))},[I,s]),n.useEffect(()=>{Pe()},[Q,G,b,I,N,m.page]),n.useEffect(()=>{Ie()},[b,I,N]),n.useEffect(()=>{const t=setInterval(()=>{Ie()},3e4);return()=>clearInterval(t)},[b,I,N]);const us=async t=>{try{oe(!0);const d=await Me.getWardsByZone(t,"ACTIVE");te(d)}catch(d){console.error("Error fetching wards:",d),he("Failed to load wards","error")}finally{oe(!1)}},Pe=n.useCallback(async()=>{var t,d;try{r(!0),x(null);const h=await Ce.getUsers({page:m.page,limit:m.limit,search:Q||void 0,status:G!=="ALL"?G:void 0,role:"CUSTOMER",cityCorporationCode:b!=="ALL"?b:void 0,zoneId:I||void 0,wardId:N||void 0});M(h.users),K(k=>({...k,total:h.pagination.total}))}catch(h){console.error("Error fetching users:",h),x(((d=(t=h.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to load users. Please try again."),he("Failed to load users","error")}finally{r(!1)}},[Q,G,b,I,N,m.page,m.limit]),Ie=async()=>{try{ye(!0);const t=await Ce.getUserStatistics(b!=="ALL"?b:void 0,"CUSTOMER",I?Number(I):void 0,N?Number(N):void 0);je(t)}catch(t){console.error("Error fetching statistics:",t)}finally{ye(!1)}},js=t=>{j(t),K(d=>({...d,page:1}))},ys=t=>{Se(t),K(d=>({...d,page:1}))},Qe=()=>{j(""),Se("ALL"),q("ALL"),q("ALL"),_(""),f(null),K(t=>({...t,page:1}))},Cs=async t=>{try{Ke(h=>({...h,viewUser:t}));const d=await Ce.getUserById(t);xe(d.user),be(d.recentComplaints||[]),l(!0)}catch(d){console.error("Error fetching user details:",d),he("Failed to load user details","error")}finally{Ke(d=>({...d,viewUser:null}))}},bs=t=>{xe(t),U(!0)},ws=()=>{c(!0)},vs=async t=>{var d,h;if(ce)try{await Ce.updateUser(ce.id,t),he("User updated successfully","success"),U(!1),xe(null),await Pe(),await Ie()}catch(k){throw console.error("Error updating user:",k),he(((h=(d=k.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to update user","error"),k}},Ss=async t=>{var d,h;try{await Ce.createUser(t),he("User created successfully","success"),c(!1),await Pe(),await Ie()}catch(k){throw console.error("Error creating user:",k),he(((h=(d=k.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to create user","error"),k}},Is=t=>{re(t),H(!0)},Ns=()=>{H(!1),re(null)},zs=async()=>{if(p.length!==0&&window.confirm(`Are you sure you want to delete ${p.length} users?`))try{await Ce.bulkDeleteUsers(p),he("Users deleted successfully","success"),ae([]),Pe(),Ie()}catch(t){he(t.message||"Failed to delete users","error")}},As=t=>{if(t.target.checked){const d=W.map(h=>h.id);ae(d);return}ae([])},Ws=t=>{const d=p.indexOf(t);let h=[];d===-1?h=h.concat(p,t):d===0?h=h.concat(p.slice(1)):d===p.length-1?h=h.concat(p.slice(0,-1)):d>0&&(h=h.concat(p.slice(0,d),p.slice(d+1))),ae(h)},he=(t,d)=>{Ge({open:!0,message:t,severity:d})},Xe=()=>{Ge(t=>({...t,open:!1}))},Es=t=>t?t.startsWith("+")?t:t.length===11&&t.startsWith("0")?`+880 ${t.substring(1,5)}-${t.substring(5)}`:t:"N/A",Ps=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Ts=(t,d)=>{const h=typeof t=="string"?t:String(t||""),k=typeof d=="string"?d:String(d||"");return`${h.charAt(0)}${k.charAt(0)}`.toUpperCase()},ks=()=>!F||F.totalComplaints===0?"0":(F.resolvedComplaints/F.totalComplaints*100).toFixed(0),Ls=[{title:"Total Citizens",value:de?"...":String((F==null?void 0:F.totalCitizens)||0),color:"#2196F3"},{title:"Total Complaints",value:de?"...":String((F==null?void 0:F.totalComplaints)||0),color:"#FF9800"},{title:"Resolved",value:de?"...":String((F==null?void 0:F.resolvedComplaints)||0),color:"#4CAF50"},{title:"Success Rate",value:de?"...":`${ks()}%`,color:"#9C27B0"}];return e.jsx(rt,{children:e.jsxs(at,{title:"User Management",children:[e.jsxs(o,{sx:{width:"100%",maxWidth:"100%",px:1.5,mx:0},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(o,{children:[e.jsx(i,{variant:"h4",sx:{fontWeight:600,mb:.5,color:"text.primary"},children:"User Management"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Manage citizen accounts and information"})]}),((s==null?void 0:s.role)==="MASTER_ADMIN"||(s==null?void 0:s.role)==="SUPER_ADMIN"&&!((es=(Ye=s==null?void 0:s.permissions)==null?void 0:Ye.features)!=null&&es.viewOnlyMode))&&e.jsx(L,{variant:"contained",startIcon:e.jsx(hs,{}),onClick:ws,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3,py:1.5,borderRadius:2},children:"Add New User"})]}),e.jsx(o,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"repeat(4, 1fr)"},gap:2,mb:4},children:Ls.map((t,d)=>e.jsx(rs,{sx:{borderRadius:2,border:"1px solid #e0e0e0","&:hover":{boxShadow:2}},children:e.jsx(as,{sx:{p:3,textAlign:"center"},children:de?e.jsxs(e.Fragment,{children:[e.jsx(se,{variant:"rectangular",width:"60%",height:48,sx:{mx:"auto",mb:1,borderRadius:1}}),e.jsx(se,{variant:"text",width:"80%",height:20,sx:{mx:"auto"}})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:t.color,mb:1},children:t.value}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:t.title})]})})},d))}),e.jsx(rs,{sx:{borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(as,{sx:{p:3},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,gap:2},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Citizen Directory"}),e.jsxs(o,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(A,{placeholder:"Search by name, email, or ward...",value:S,onChange:t=>js(t.target.value),InputProps:{startAdornment:e.jsx(ve,{position:"start",children:e.jsx(Js,{sx:{color:"text.secondary"}})})},sx:{width:300,"& .MuiOutlinedInput-root":{height:40,backgroundColor:"#f8f9fa"}}}),p.length>0&&e.jsxs(L,{variant:"outlined",color:"error",onClick:zs,sx:{ml:2,height:40},children:["Delete Selected (",p.length,")"]})]})]}),e.jsxs(o,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(qe,{sx:{minWidth:200},children:[e.jsx(Ve,{id:"city-corporation-filter-label",sx:{top:-8},children:"City Corporation"}),e.jsxs(Te,{labelId:"city-corporation-filter-label",value:C?"":b,onChange:t=>q(t.target.value),label:"City Corporation",disabled:(s==null?void 0:s.role)==="ADMIN"||C||(s==null?void 0:s.role)!=="MASTER_ADMIN"&&D.length<=1,sx:{height:40,backgroundColor:"#f8f9fa"},displayEmpty:!0,renderValue:t=>{if(C)return e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{size:16}),e.jsx(i,{variant:"body2",children:"Loading..."})]});if(!t)return"Select City Corporation";if(t==="ALL")return"All City Corporations";const d=D.find(h=>h.code===t);return d?typeof d.name=="object"?JSON.stringify(d.name):d.name:t},children:[(s==null?void 0:s.role)==="MASTER_ADMIN"&&e.jsx(u,{value:"ALL",children:"All City Corporations"}),D&&D.map(t=>e.jsx(u,{value:t.code,children:typeof t.name=="object"?JSON.stringify(t.name):t.name},t.code))]})]}),(s==null?void 0:s.role)!=="ADMIN"&&e.jsx(o,{sx:{minWidth:200},children:e.jsx(nt,{value:I,onChange:t=>_(t),cityCorporationCode:b!=="ALL"?b:"",disabled:!1,zones:ie.length>0?ie:void 0})}),e.jsxs(qe,{sx:{minWidth:200},children:[e.jsx(Ve,{id:"ward-filter-label",sx:{top:-8},children:"Ward"}),e.jsxs(Te,{labelId:"ward-filter-label",value:N||"",onChange:t=>f(t.target.value?Number(t.target.value):null),label:"Ward",disabled:(s==null?void 0:s.role)==="ADMIN"?w||!Z||Z.length===0:!I||w||!Z||Z.length===0,sx:{height:40,backgroundColor:"#f8f9fa"},children:[(s==null?void 0:s.role)!=="ADMIN"&&e.jsx(u,{value:"",children:"All Wards"}),Z&&Z.map(t=>e.jsxs(u,{value:t.id,children:["Ward ",typeof t.wardNumber=="object"?JSON.stringify(t.wardNumber):t.wardNumber]},t.id))]})]}),e.jsxs(qe,{sx:{minWidth:150},children:[e.jsx(Ve,{id:"status-filter-label",sx:{top:-8},children:"Status"}),e.jsxs(Te,{labelId:"status-filter-label",value:G,onChange:t=>ys(t.target.value),label:"Status",startAdornment:e.jsx(ve,{position:"start",children:e.jsx(_s,{sx:{fontSize:18,color:"text.secondary"}})}),sx:{height:40,backgroundColor:"#f8f9fa"},children:[e.jsx(u,{value:"ALL",children:"All Status"}),e.jsx(u,{value:"ACTIVE",children:"Active"}),e.jsx(u,{value:"INACTIVE",children:"Inactive"}),e.jsx(u,{value:"SUSPENDED",children:"Suspended"}),e.jsx(u,{value:"PENDING",children:"Pending"})]})]}),(S||G!=="ALL"||b!=="ALL"||I||N)&&e.jsx(L,{variant:"outlined",onClick:Qe,sx:{height:40,textTransform:"none",borderColor:"#e0e0e0",color:"text.secondary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Clear Filters"})]}),e.jsx(Bs,{component:Hs,elevation:0,children:e.jsxs(Gs,{sx:{minWidth:650},children:[e.jsx(Ks,{children:e.jsxs(ze,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(g,{padding:"checkbox",children:e.jsx(ns,{indeterminate:p.length>0&&p.length<W.length,checked:W.length>0&&p.length===W.length,onChange:As})}),e.jsx(g,{sx:{fontWeight:600},children:"Citizen"}),e.jsx(g,{sx:{fontWeight:600},children:"Contact"}),e.jsx(g,{sx:{fontWeight:600},children:"City Corporation"}),e.jsx(g,{sx:{fontWeight:600},children:"Location"}),e.jsx(g,{sx:{fontWeight:600},children:"Complaints"}),e.jsx(g,{sx:{fontWeight:600},children:"Resolved"}),e.jsx(g,{sx:{fontWeight:600},children:"Unresolved"}),e.jsx(g,{sx:{fontWeight:600},children:"Join Date"}),e.jsx(g,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Qs,{children:E?Array.from({length:5}).map((t,d)=>e.jsxs(ze,{children:[e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(se,{variant:"rectangular",height:40})})]},d)):a?e.jsx(ze,{children:e.jsx(g,{colSpan:9,children:e.jsx(ke,{severity:"error",sx:{my:2},children:a})})}):W.length===0?e.jsx(ze,{children:e.jsx(g,{colSpan:9,children:e.jsx(dt,{icon:S||G!=="ALL"?e.jsx(Xs,{sx:{fontSize:40,color:"#9e9e9e"}}):e.jsx(Ys,{sx:{fontSize:40,color:"#9e9e9e"}}),title:S||G!=="ALL"?"No users found":"No users registered yet",description:S||G!=="ALL"?"Try adjusting your search or filters to find what you're looking for.":"Users who register through the mobile app will appear here.",action:S||G!=="ALL"?{label:"Clear Filters",onClick:Qe}:void 0})})}):W.map(t=>{var h,k;const d=p.indexOf(t.id)!==-1;return typeof t.ward=="object"&&t.ward!==null&&!("wardNumber"in t.ward)&&console.error("Suspicious Ward object found:",t.ward),typeof t.zone=="object"&&t.zone!==null&&!("zoneNumber"in t.zone)&&console.error("Suspicious Zone object found:",t.zone),e.jsxs(ze,{hover:!0,selected:d,sx:{"&:hover":{backgroundColor:"#f8f9fa"}},children:[e.jsx(g,{padding:"checkbox",children:e.jsx(ns,{checked:d,onChange:()=>Ws(t.id)})}),e.jsx(g,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.avatar?e.jsx(_e,{src:t.avatar,sx:{width:40,height:40}}):e.jsx(_e,{sx:{width:40,height:40,bgcolor:"#4CAF50"},children:Ts(t.firstName,t.lastName)}),e.jsxs(o,{children:[e.jsx(i,{variant:"body1",sx:{fontWeight:500},children:`${typeof t.firstName=="object"?JSON.stringify(t.firstName):t.firstName} ${typeof t.lastName=="object"?JSON.stringify(t.lastName):t.lastName}`}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["#",String(t.id).padStart(6,"0")]})]})]})}),e.jsx(g,{children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(is,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:typeof t.email=="object"?JSON.stringify(t.email):t.email||"N/A"})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ls,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:typeof t.phone=="object"?JSON.stringify(t.phone):Es(t.phone)})]})]})}),e.jsx(g,{children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:typeof((h=t.cityCorporation)==null?void 0:h.name)=="object"?JSON.stringify(t.cityCorporation.name):((k=t.cityCorporation)==null?void 0:k.name)||"N/A"}),t.cityCorporation&&e.jsx(i,{variant:"caption",color:"text.secondary",children:typeof t.cityCorporation.code=="object"?JSON.stringify(t.cityCorporation.code):t.cityCorporation.code})]})}),e.jsx(g,{children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[t.zone?e.jsx(ge,{label:`Zone ${typeof t.zone.zoneNumber=="object"?JSON.stringify(t.zone.zoneNumber):t.zone.zoneNumber}${t.zone.name?` - ${typeof t.zone.name=="object"?JSON.stringify(t.zone.name):t.zone.name}`:""}`,size:"small",variant:"outlined",color:"primary",sx:{height:24,justifyContent:"flex-start"}}):null,t.ward?e.jsx(ge,{label:`Ward ${typeof t.ward.wardNumber=="object"?JSON.stringify(t.ward.wardNumber):t.ward.wardNumber}`,size:"small",variant:"outlined",sx:{height:24,justifyContent:"flex-start"}}):null,!t.zone&&!t.ward&&e.jsx(i,{variant:"caption",color:"text.secondary",children:"N/A"}),t.address&&e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",gap:.5,mt:.5},children:[e.jsx(ds,{sx:{fontSize:14,color:"text.secondary",mt:.2}}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem",lineHeight:1.3,maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:typeof t.address=="object"?JSON.stringify(t.address):t.address})]})]})}),e.jsx(g,{children:e.jsx(ge,{label:String(t.statistics.totalComplaints),sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}})}),e.jsx(g,{children:e.jsx(ge,{label:String(t.statistics.resolvedComplaints),sx:{backgroundColor:"#e8f5e8",color:"#2e7d2e",fontWeight:500}})}),e.jsx(g,{children:e.jsx(ge,{label:String(t.statistics.unresolvedComplaints),sx:{backgroundColor:"#ffebee",color:"#c62828",fontWeight:500}})}),e.jsx(g,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(cs,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:Ps(t.createdAt)})]})}),e.jsx(g,{children:e.jsxs(o,{sx:{display:"flex",gap:1},children:[["MASTER_ADMIN","SUPER_ADMIN","ADMIN"].includes((s==null?void 0:s.role)||"")&&e.jsx(L,{variant:"outlined",size:"small",startIcon:Ze.viewUser===t.id?e.jsx(Ae,{size:16}):e.jsx(We,{}),onClick:()=>Cs(t.id),disabled:Ze.viewUser===t.id,sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:Ze.viewUser===t.id?"Loading...":"View"}),e.jsx(L,{variant:"outlined",size:"small",color:"primary",onClick:()=>Is(t),sx:{textTransform:"none",borderColor:"#e0e0e0",minWidth:"40px",color:"text.primary","&:hover":{borderColor:"#2196F3",color:"#2196F3"}},children:e.jsx(et,{fontSize:"small"})}),e.jsx(L,{variant:"outlined",size:"small",startIcon:e.jsx(xs,{}),onClick:()=>bs(t),sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Edit"})]})})]},t.id)})})]})}),!E&&!a&&W.length>0&&e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderTop:"1px solid #e0e0e0",flexWrap:"wrap",gap:2},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Showing ",(m.page-1)*m.limit+1," to"," ",Math.min(m.page*m.limit,m.total)," of"," ",m.total.toLocaleString()," users"]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Rows per page:"}),e.jsxs(Te,{value:m.limit,onChange:t=>K(d=>({...d,limit:Number(t.target.value),page:1})),size:"small",sx:{minWidth:80},children:[e.jsx(u,{value:20,children:"20"}),e.jsx(u,{value:50,children:"50"}),e.jsx(u,{value:100,children:"100"}),e.jsx(u,{value:200,children:"200"})]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(L,{size:"small",onClick:()=>K(t=>({...t,page:1})),disabled:m.page===1,sx:{minWidth:"auto",px:1},children:"First"}),e.jsx(L,{size:"small",onClick:()=>K(t=>({...t,page:t.page-1})),disabled:m.page===1,sx:{minWidth:"auto",px:1},children:"Previous"}),e.jsxs(i,{variant:"body2",sx:{mx:2},children:["Page ",m.page," of ",Math.ceil(m.total/m.limit)]}),e.jsx(L,{size:"small",onClick:()=>K(t=>({...t,page:t.page+1})),disabled:m.page>=Math.ceil(m.total/m.limit),sx:{minWidth:"auto",px:1},children:"Next"}),e.jsx(L,{size:"small",onClick:()=>K(t=>({...t,page:Math.ceil(m.total/m.limit)})),disabled:m.page>=Math.ceil(m.total/m.limit),sx:{minWidth:"auto",px:1},children:"Last"})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Go to:"}),e.jsx(A,{type:"number",size:"small",value:m.page,onChange:t=>{const d=parseInt(t.target.value),h=Math.ceil(m.total/m.limit);d>=1&&d<=h&&K(k=>({...k,page:d}))},inputProps:{min:1,max:Math.ceil(m.total/m.limit),style:{textAlign:"center"}},sx:{width:80}})]})]})]})]})})]}),e.jsx(ct,{user:ce,recentComplaints:B,open:O,onClose:()=>{l(!1),xe(null),be([])},onEdit:()=>{l(!1),U(!0)}}),e.jsx(ht,{user:ce,open:R,onClose:()=>{U(!1),xe(null)},onSave:vs}),e.jsx(mt,{open:v,onClose:()=>c(!1),onSave:Ss}),P&&e.jsx(ft,{userId:P.id,userName:`${P.firstName} ${P.lastName}`,userDetails:P,open:y,onClose:Ns}),e.jsx(st,{open:T.open,autoHideDuration:6e3,onClose:Xe,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ke,{onClose:Xe,severity:T.severity,sx:{width:"100%"},children:T.message})})]})})};export{St as default};
