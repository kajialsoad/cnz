import{u as N,j as a,ay as P,P as w,be as u,B as i,T as r,p as T,b as z,bL as L,C as M,a4 as B,a6 as F,af as U,a8 as E,H as O,al as W,a9 as D,ct as q,q as H,i as $,O as G,aS as J}from"./mui-vendor-Y6GvQTLC.js";import{d as K,r as o,a as Q}from"./react-vendor-D7yrL1sD.js";import{S as V,M as X,T as n,z as l}from"./index-B_PiLh6w.js";import{f as Y}from"./dateUtils-Ct98g1e7.js";import"./query-vendor-D4yC0Jq7.js";import"./chart-vendor-BgnY-Lfo.js";const ra=()=>{N();const j=K(),{refreshUnreadCount:c}=V(),[f,p]=o.useState(!0),[h,d]=o.useState([]),[x,b]=o.useState(1),[y,k]=o.useState(1),[t,v]=o.useState(!1),R=async()=>{try{p(!0);const e=await n.getUserNotifications(x,20,t);d(e.notifications),k(e.pagination.totalPages)}catch(e){console.error("Error fetching notifications:",e),l.error("Failed to load notifications")}finally{p(!1)}};o.useEffect(()=>{R()},[x,t]);const C=(e,s)=>{b(s)},I=async(e,s)=>{s.stopPropagation();try{await n.markAsRead(e),d(g=>g.map(m=>m.id===e?{...m,isRead:!0}:m)),c()}catch{l.error("Failed to mark as read")}},A=async()=>{try{await n.markAllAsRead(),d(e=>e.map(s=>({...s,isRead:!0}))),c(),l.success("All notifications marked as read")}catch{l.error("Failed to mark all as read")}},S=async e=>{if(!e.isRead)try{await n.markAsRead(e.id),c()}catch(s){console.error("Failed to mark as read on click",s)}e.complaintId&&j(`/complaints/${e.complaintId}`)};return a.jsx(X,{title:"Notifications",children:a.jsx(P,{maxWidth:"lg",sx:{py:4},children:a.jsxs(w,{elevation:0,sx:{p:3,border:"1px solid #e0e0e0",borderRadius:2},children:[a.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[a.jsxs(i,{children:[a.jsx(r,{variant:"h5",fontWeight:600,gutterBottom:!0,children:"Notifications"}),a.jsx(r,{variant:"body2",color:"text.secondary",children:"Stay updated with recent activities and status changes"})]}),a.jsxs(u,{direction:"row",spacing:2,children:[a.jsx(T,{label:t?"Showing Unread":"Showing All",onClick:()=>v(!t),color:t?"primary":"default",variant:t?"filled":"outlined",sx:{cursor:"pointer"}}),a.jsx(z,{variant:"outlined",startIcon:a.jsx(L,{}),onClick:A,size:"small",children:"Mark all read"})]})]}),f?a.jsx(i,{display:"flex",justifyContent:"center",py:8,children:a.jsx(M,{})}):h.length===0?a.jsxs(i,{display:"flex",flexDirection:"column",alignItems:"center",py:8,children:[a.jsx(B,{sx:{fontSize:60,color:"text.disabled",mb:2}}),a.jsx(r,{color:"text.secondary",children:"No notifications found"})]}):a.jsx(F,{children:h.map(e=>a.jsxs(U,{alignItems:"flex-start",sx:{mb:1,borderRadius:2,bgcolor:e.isRead?"transparent":"action.hover",cursor:"pointer","&:hover":{bgcolor:"action.selected"},border:"1px solid",borderColor:"divider"},secondaryAction:!e.isRead&&a.jsx(H,{title:"Mark as read",children:a.jsx($,{edge:"end",onClick:s=>I(e.id,s),size:"small",children:a.jsx(G,{color:"primary",fontSize:"small"})})}),onClick:()=>S(e),children:[a.jsx(E,{children:a.jsx(O,{sx:{bgcolor:e.isRead?"grey.300":"primary.main"},children:a.jsx(W,{})})}),a.jsx(D,{primary:a.jsxs(i,{display:"flex",alignItems:"center",gap:1,children:[a.jsx(r,{variant:"subtitle1",fontWeight:e.isRead?400:600,children:e.title}),!e.isRead&&a.jsx(q,{sx:{fontSize:10,color:"primary.main"}})]}),primaryTypographyProps:{component:"div"},secondary:a.jsxs(Q.Fragment,{children:[a.jsx(r,{component:"span",variant:"body2",color:"text.primary",display:"block",sx:{my:.5},children:e.message}),a.jsx(r,{variant:"caption",color:"text.secondary",children:Y(e.createdAt)})]})})]},e.id))}),y>1&&a.jsx(i,{display:"flex",justifyContent:"center",mt:3,children:a.jsx(J,{count:y,page:x,onChange:C,color:"primary"})})]})})})};export{ra as default};
