var ms=Object.defineProperty;var bs=(r,t,o)=>t in r?ms(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o;var Ct=(r,t,o)=>bs(r,typeof t!="symbol"?t+"":t,o);import{g as It,a as At,r as n,u as Tt,c as fe,j as e,s as Se,b as Qt,d as Rt,B as es,m as Ot,e as Me,f as Cs,h as ts,o as ss,i as rs,k as ot,l as Lt,n as St,p as Re,q as Ss,t as ys,v as os,w as Oe,x as Fe,D as ns,y as Nt,z as pe,A as js,C as vs,E as as,F as f,G as Es,T as x,I as yt,H as Bt,J as ls,K as $e,L as ws,M as Is,N as wt,O as Xe,P as xe,Q as Le,R as nt,S as at,U as Ue,V as _e,W as M,X as He,Y as As,Z as Ts,_ as Rs,$ as Os,a0 as Ls,a1 as Ms,a2 as Wt,a3 as Dt,a4 as Ps,a5 as zs,a6 as ks,a7 as Ft,a8 as Ns,a9 as Ht,aa as Bs,ab as Ws,ac as Ds,ad as Fs,ae as Hs,af as jt,ag as $,ah as $s,ai as $t,aj as Ut,ak as Us,al as _s}from"./index-DeUEnMZz.js";import{s as st,a as _t,b as Xs}from"./toastUtils-DOc4dMvB.js";import{E as Xt,a as Vt,u as Vs,C as Gs,b as Ks}from"./useDebounce-BWOmAok2.js";import{P as Ys}from"./Person-DMojptl5.js";import{I as Js,c as is,H as Zs,a as Gt}from"./categoryService-oHOqZNfH.js";import{S as qs}from"./Send-DGu9YltK.js";import"./userManagementService-CeRzAMvK.js";import{w as Qs}from"./wardService-GBSQYL9j.js";import{F as er}from"./FilterList-D2MNHuoQ.js";import{C as tr}from"./Collapse-Bcskhq6s.js";import{G as ce}from"./Grid-kRAokODX.js";import{D as sr}from"./Download-CrG_CMYD.js";import{P as rr}from"./Pagination-BIoSFEhF.js";import"./styled-CVTyowA6.js";import"./useThemeProps-C2aBZQ1b.js";function or(r){return At("MuiTab",r)}const te=It("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper","icon"]),nr=r=>{const{classes:t,textColor:o,fullWidth:d,wrapped:c,icon:u,label:h,selected:g,disabled:m}=r,j={root:["root",u&&h&&"labelIcon",`textColor${Qt(o)}`,d&&"fullWidth",c&&"wrapped",g&&"selected",m&&"disabled"],icon:["iconWrapper","icon"]};return Rt(j,or,t)},ar=Se(es,{name:"MuiTab",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[t.root,o.label&&o.icon&&t.labelIcon,t[`textColor${Qt(o.textColor)}`],o.fullWidth&&t.fullWidth,o.wrapped&&t.wrapped,{[`& .${te.iconWrapper}`]:t.iconWrapper},{[`& .${te.icon}`]:t.icon}]}})(Ot(({theme:r})=>({...r.typography.button,maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center",lineHeight:1.25,variants:[{props:({ownerState:t})=>t.label&&(t.iconPosition==="top"||t.iconPosition==="bottom"),style:{flexDirection:"column"}},{props:({ownerState:t})=>t.label&&t.iconPosition!=="top"&&t.iconPosition!=="bottom",style:{flexDirection:"row"}},{props:({ownerState:t})=>t.icon&&t.label,style:{minHeight:72,paddingTop:9,paddingBottom:9}},{props:({ownerState:t,iconPosition:o})=>t.icon&&t.label&&o==="top",style:{[`& > .${te.icon}`]:{marginBottom:6}}},{props:({ownerState:t,iconPosition:o})=>t.icon&&t.label&&o==="bottom",style:{[`& > .${te.icon}`]:{marginTop:6}}},{props:({ownerState:t,iconPosition:o})=>t.icon&&t.label&&o==="start",style:{[`& > .${te.icon}`]:{marginRight:r.spacing(1)}}},{props:({ownerState:t,iconPosition:o})=>t.icon&&t.label&&o==="end",style:{[`& > .${te.icon}`]:{marginLeft:r.spacing(1)}}},{props:{textColor:"inherit"},style:{color:"inherit",opacity:.6,[`&.${te.selected}`]:{opacity:1},[`&.${te.disabled}`]:{opacity:(r.vars||r).palette.action.disabledOpacity}}},{props:{textColor:"primary"},style:{color:(r.vars||r).palette.text.secondary,[`&.${te.selected}`]:{color:(r.vars||r).palette.primary.main},[`&.${te.disabled}`]:{color:(r.vars||r).palette.text.disabled}}},{props:{textColor:"secondary"},style:{color:(r.vars||r).palette.text.secondary,[`&.${te.selected}`]:{color:(r.vars||r).palette.secondary.main},[`&.${te.disabled}`]:{color:(r.vars||r).palette.text.disabled}}},{props:({ownerState:t})=>t.fullWidth,style:{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"}},{props:({ownerState:t})=>t.wrapped,style:{fontSize:r.typography.pxToRem(12)}}]}))),De=n.forwardRef(function(t,o){const d=Tt({props:t,name:"MuiTab"}),{className:c,disabled:u=!1,disableFocusRipple:h=!1,fullWidth:g,icon:m,iconPosition:j="top",indicator:v,label:w,onChange:l,onClick:R,onFocus:I,selected:O,selectionFollowsFocus:D,textColor:P="inherit",value:G,wrapped:k=!1,...N}=d,U={...d,disabled:u,disableFocusRipple:h,selected:O,icon:!!m,iconPosition:j,label:!!w,fullWidth:g,textColor:P,wrapped:k},J=nr(U),L=m&&w&&n.isValidElement(m)?n.cloneElement(m,{className:fe(J.icon,m.props.className)}):m,oe=_=>{!O&&l&&l(_,G),R&&R(_)},Q=_=>{D&&!O&&l&&l(_,G),I&&I(_)};return e.jsxs(ar,{focusRipple:!h,className:fe(J.root,c),ref:o,role:"tab","aria-selected":O,disabled:u,onClick:oe,onFocus:Q,ownerState:U,tabIndex:O?0:-1,...N,children:[j==="top"||j==="start"?e.jsxs(n.Fragment,{children:[L,w]}):e.jsxs(n.Fragment,{children:[w,L]}),v]})}),lr=Me(e.jsx("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})),ir=Me(e.jsx("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}));function cr(r){return(1+Math.sin(Math.PI*r-Math.PI/2))/2}function dr(r,t,o,d={},c=()=>{}){const{ease:u=cr,duration:h=300}=d;let g=null;const m=t[r];let j=!1;const v=()=>{j=!0},w=l=>{if(j){c(new Error("Animation cancelled"));return}g===null&&(g=l);const R=Math.min(1,(l-g)/h);if(t[r]=u(R)*(o-m)+m,R>=1){requestAnimationFrame(()=>{c(null)});return}requestAnimationFrame(w)};return m===o?(c(new Error("Element already at target position")),v):(requestAnimationFrame(w),v)}const ur={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};function hr(r){const{onChange:t,...o}=r,d=n.useRef(),c=n.useRef(null),u=()=>{d.current=c.current.offsetHeight-c.current.clientHeight};return Cs(()=>{const h=ts(()=>{const m=d.current;u(),m!==d.current&&t(d.current)}),g=ss(c.current);return g.addEventListener("resize",h),()=>{h.clear(),g.removeEventListener("resize",h)}},[t]),n.useEffect(()=>{u(),t(d.current)},[t]),e.jsx("div",{style:ur,...o,ref:c})}function pr(r){return At("MuiTabScrollButton",r)}const xr=It("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),fr=r=>{const{classes:t,orientation:o,disabled:d}=r;return Rt({root:["root",o,d&&"disabled"]},pr,t)},gr=Se(es,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[t.root,o.orientation&&t[o.orientation]]}})({width:40,flexShrink:0,opacity:.8,[`&.${xr.disabled}`]:{opacity:0},variants:[{props:{orientation:"vertical"},style:{width:"100%",height:40,"& svg":{transform:"var(--TabScrollButton-svgRotate)"}}}]}),mr=n.forwardRef(function(t,o){const d=Tt({props:t,name:"MuiTabScrollButton"}),{className:c,slots:u={},slotProps:h={},direction:g,orientation:m,disabled:j,...v}=d,w=rs(),l={isRtl:w,...d},R=fr(l),I=u.StartScrollButtonIcon??lr,O=u.EndScrollButtonIcon??ir,D=ot({elementType:I,externalSlotProps:h.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:l}),P=ot({elementType:O,externalSlotProps:h.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:l});return e.jsx(gr,{component:"div",className:fe(R.root,c),ref:o,role:null,ownerState:l,tabIndex:null,...v,style:{...v.style,...m==="vertical"&&{"--TabScrollButton-svgRotate":`rotate(${w?-90:90}deg)`}},children:g==="left"?e.jsx(I,{...D}):e.jsx(O,{...P})})});function br(r){return At("MuiTabs",r)}const vt=It("MuiTabs",["root","vertical","list","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),Kt=(r,t)=>r===t?r.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r.firstChild,Yt=(r,t)=>r===t?r.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r.lastChild,rt=(r,t,o)=>{let d=!1,c=o(r,t);for(;c;){if(c===r.firstChild){if(d)return;d=!0}const u=c.disabled||c.getAttribute("aria-disabled")==="true";if(!c.hasAttribute("tabindex")||u)c=o(r,c);else{c.focus();return}}},Cr=r=>{const{vertical:t,fixed:o,hideScrollbar:d,scrollableX:c,scrollableY:u,centered:h,scrollButtonsHideMobile:g,classes:m}=r;return Rt({root:["root",t&&"vertical"],scroller:["scroller",o&&"fixed",d&&"hideScrollbar",c&&"scrollableX",u&&"scrollableY"],list:["list","flexContainer",t&&"flexContainerVertical",t&&"vertical",h&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",g&&"scrollButtonsHideMobile"],scrollableX:[c&&"scrollableX"],hideScrollbar:[d&&"hideScrollbar"]},br,m)},Sr=Se("div",{name:"MuiTabs",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[{[`& .${vt.scrollButtons}`]:t.scrollButtons},{[`& .${vt.scrollButtons}`]:o.scrollButtonsHideMobile&&t.scrollButtonsHideMobile},t.root,o.vertical&&t.vertical]}})(Ot(({theme:r})=>({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex",variants:[{props:({ownerState:t})=>t.vertical,style:{flexDirection:"column"}},{props:({ownerState:t})=>t.scrollButtonsHideMobile,style:{[`& .${vt.scrollButtons}`]:{[r.breakpoints.down("sm")]:{display:"none"}}}}]}))),yr=Se("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[t.scroller,o.fixed&&t.fixed,o.hideScrollbar&&t.hideScrollbar,o.scrollableX&&t.scrollableX,o.scrollableY&&t.scrollableY]}})({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap",variants:[{props:({ownerState:r})=>r.fixed,style:{overflowX:"hidden",width:"100%"}},{props:({ownerState:r})=>r.hideScrollbar,style:{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}},{props:({ownerState:r})=>r.scrollableX,style:{overflowX:"auto",overflowY:"hidden"}},{props:({ownerState:r})=>r.scrollableY,style:{overflowY:"auto",overflowX:"hidden"}}]}),jr=Se("div",{name:"MuiTabs",slot:"List",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[t.list,t.flexContainer,o.vertical&&t.flexContainerVertical,o.centered&&t.centered]}})({display:"flex",variants:[{props:({ownerState:r})=>r.vertical,style:{flexDirection:"column"}},{props:({ownerState:r})=>r.centered,style:{justifyContent:"center"}}]}),vr=Se("span",{name:"MuiTabs",slot:"Indicator"})(Ot(({theme:r})=>({position:"absolute",height:2,bottom:0,width:"100%",transition:r.transitions.create(),variants:[{props:{indicatorColor:"primary"},style:{backgroundColor:(r.vars||r).palette.primary.main}},{props:{indicatorColor:"secondary"},style:{backgroundColor:(r.vars||r).palette.secondary.main}},{props:({ownerState:t})=>t.vertical,style:{height:"100%",width:2,right:0}}]}))),Er=Se(hr)({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),Jt={},wr=n.forwardRef(function(t,o){const d=Tt({props:t,name:"MuiTabs"}),c=Lt(),u=rs(),{"aria-label":h,"aria-labelledby":g,action:m,centered:j=!1,children:v,className:w,component:l="div",allowScrollButtonsMobile:R=!1,indicatorColor:I="primary",onChange:O,orientation:D="horizontal",ScrollButtonComponent:P,scrollButtons:G="auto",selectionFollowsFocus:k,slots:N={},slotProps:U={},TabIndicatorProps:J={},TabScrollButtonProps:L={},textColor:oe="primary",value:Q,variant:_="standard",visibleScrollbar:F=!1,...ge}=d,Z=_==="scrollable",X=D==="vertical",B=X?"scrollTop":"scrollLeft",p=X?"top":"left",b=X?"bottom":"right",K=X?"clientHeight":"clientWidth",H=X?"height":"width",W={...d,component:l,allowScrollButtonsMobile:R,indicatorColor:I,orientation:D,vertical:X,scrollButtons:G,textColor:oe,variant:_,visibleScrollbar:F,fixed:!Z,hideScrollbar:Z&&!F,scrollableX:Z&&!X,scrollableY:Z&&X,centered:j&&!Z,scrollButtonsHideMobile:!R},ee=Cr(W),me=ot({elementType:N.StartScrollButtonIcon,externalSlotProps:U.startScrollButtonIcon,ownerState:W}),Mt=ot({elementType:N.EndScrollButtonIcon,externalSlotProps:U.endScrollButtonIcon,ownerState:W}),[Pe,be]=n.useState(!1),[ne,z]=n.useState(Jt),[Y,lt]=n.useState(!1),[Ve,it]=n.useState(!1),[Ge,ct]=n.useState(!1),[ze,dt]=n.useState({overflow:"hidden",scrollbarWidth:0}),Ke=new Map,se=n.useRef(null),le=n.useRef(null),de={slots:N,slotProps:{indicator:J,scrollButton:L,...U}},Ye=()=>{const a=se.current;let i;if(a){const y=a.getBoundingClientRect();i={clientWidth:a.clientWidth,scrollLeft:a.scrollLeft,scrollTop:a.scrollTop,scrollWidth:a.scrollWidth,top:y.top,bottom:y.bottom,left:y.left,right:y.right}}let S;if(a&&Q!==!1){const y=le.current.children;if(y.length>0){const A=y[Ke.get(Q)];S=A?A.getBoundingClientRect():null}}return{tabsMeta:i,tabMeta:S}},ye=St(()=>{const{tabsMeta:a,tabMeta:i}=Ye();let S=0,y;X?(y="top",i&&a&&(S=i.top-a.top+a.scrollTop)):(y=u?"right":"left",i&&a&&(S=(u?-1:1)*(i[y]-a[y]+a.scrollLeft)));const A={[y]:S,[H]:i?i[H]:0};if(typeof ne[y]!="number"||typeof ne[H]!="number")z(A);else{const q=Math.abs(ne[y]-A[y]),re=Math.abs(ne[H]-A[H]);(q>=1||re>=1)&&z(A)}}),je=(a,{animation:i=!0}={})=>{i?dr(B,se.current,a,{duration:c.transitions.duration.standard}):se.current[B]=a},ve=a=>{let i=se.current[B];X?i+=a:i+=a*(u?-1:1),je(i)},Ee=()=>{const a=se.current[K];let i=0;const S=Array.from(le.current.children);for(let y=0;y<S.length;y+=1){const A=S[y];if(i+A[K]>a){y===0&&(i=a);break}i+=A[K]}return i},ut=()=>{ve(-1*Ee())},ht=()=>{ve(Ee())},[Je,{onChange:we,...Ze}]=Re("scrollbar",{className:fe(ee.scrollableX,ee.hideScrollbar),elementType:Er,shouldForwardComponentProp:!0,externalForwardedProps:de,ownerState:W}),ke=n.useCallback(a=>{we==null||we(a),dt({overflow:null,scrollbarWidth:a})},[we]),[Ne,Ie]=Re("scrollButtons",{className:fe(ee.scrollButtons,L.className),elementType:mr,externalForwardedProps:de,ownerState:W,additionalProps:{orientation:D,slots:{StartScrollButtonIcon:N.startScrollButtonIcon||N.StartScrollButtonIcon,EndScrollButtonIcon:N.endScrollButtonIcon||N.EndScrollButtonIcon},slotProps:{startScrollButtonIcon:me,endScrollButtonIcon:Mt}}}),qe=()=>{const a={};a.scrollbarSizeListener=Z?e.jsx(Je,{...Ze,onChange:ke}):null;const S=Z&&(G==="auto"&&(Y||Ve)||G===!0);return a.scrollButtonStart=S?e.jsx(Ne,{direction:u?"right":"left",onClick:ut,disabled:!Y,...Ie}):null,a.scrollButtonEnd=S?e.jsx(Ne,{direction:u?"left":"right",onClick:ht,disabled:!Ve,...Ie}):null,a},ae=St(a=>{const{tabsMeta:i,tabMeta:S}=Ye();if(!(!S||!i)){if(S[p]<i[p]){const y=i[B]+(S[p]-i[p]);je(y,{animation:a})}else if(S[b]>i[b]){const y=i[B]+(S[b]-i[b]);je(y,{animation:a})}}}),Ae=St(()=>{Z&&G!==!1&&ct(!Ge)});n.useEffect(()=>{const a=ts(()=>{se.current&&ye()});let i;const S=q=>{q.forEach(re=>{re.removedNodes.forEach(Ce=>{i==null||i.unobserve(Ce)}),re.addedNodes.forEach(Ce=>{i==null||i.observe(Ce)})}),a(),Ae()},y=ss(se.current);y.addEventListener("resize",a);let A;return typeof ResizeObserver<"u"&&(i=new ResizeObserver(a),Array.from(le.current.children).forEach(q=>{i.observe(q)})),typeof MutationObserver<"u"&&(A=new MutationObserver(S),A.observe(le.current,{childList:!0})),()=>{a.clear(),y.removeEventListener("resize",a),A==null||A.disconnect(),i==null||i.disconnect()}},[ye,Ae]),n.useEffect(()=>{const a=Array.from(le.current.children),i=a.length;if(typeof IntersectionObserver<"u"&&i>0&&Z&&G!==!1){const S=a[0],y=a[i-1],A={root:se.current,threshold:.99},q=We=>{lt(!We[0].isIntersecting)},re=new IntersectionObserver(q,A);re.observe(S);const Ce=We=>{it(!We[0].isIntersecting)},tt=new IntersectionObserver(Ce,A);return tt.observe(y),()=>{re.disconnect(),tt.disconnect()}}},[Z,G,Ge,v==null?void 0:v.length]),n.useEffect(()=>{be(!0)},[]),n.useEffect(()=>{ye()}),n.useEffect(()=>{ae(Jt!==ne)},[ae,ne]),n.useImperativeHandle(m,()=>({updateIndicator:ye,updateScrollButtons:Ae}),[ye,Ae]);const[ue,Pt]=Re("indicator",{className:fe(ee.indicator,J.className),elementType:vr,externalForwardedProps:de,ownerState:W,additionalProps:{style:ne}}),Qe=e.jsx(ue,{...Pt});let he=0;const pt=n.Children.map(v,a=>{if(!n.isValidElement(a))return null;const i=a.props.value===void 0?he:a.props.value;Ke.set(i,he);const S=i===Q;return he+=1,n.cloneElement(a,{fullWidth:_==="fullWidth",indicator:S&&!Pe&&Qe,selected:S,selectionFollowsFocus:k,onChange:O,textColor:oe,value:i,...he===1&&Q===!1&&!a.props.tabIndex?{tabIndex:0}:{}})}),xt=a=>{if(a.altKey||a.shiftKey||a.ctrlKey||a.metaKey)return;const i=le.current,S=Ss(ys(i));if((S==null?void 0:S.getAttribute("role"))!=="tab")return;let A=D==="horizontal"?"ArrowLeft":"ArrowUp",q=D==="horizontal"?"ArrowRight":"ArrowDown";switch(D==="horizontal"&&u&&(A="ArrowRight",q="ArrowLeft"),a.key){case A:a.preventDefault(),rt(i,S,Yt);break;case q:a.preventDefault(),rt(i,S,Kt);break;case"Home":a.preventDefault(),rt(i,null,Kt);break;case"End":a.preventDefault(),rt(i,null,Yt);break}},Be=qe(),[ft,gt]=Re("root",{ref:o,className:fe(ee.root,w),elementType:Sr,externalForwardedProps:{...de,...ge,component:l},ownerState:W}),[mt,Te]=Re("scroller",{ref:se,className:ee.scroller,elementType:yr,externalForwardedProps:de,ownerState:W,additionalProps:{style:{overflow:ze.overflow,[X?`margin${u?"Left":"Right"}`:"marginBottom"]:F?void 0:-ze.scrollbarWidth}}}),[bt,et]=Re("list",{ref:le,className:fe(ee.list,ee.flexContainer),elementType:jr,externalForwardedProps:de,ownerState:W,getSlotProps:a=>({...a,onKeyDown:i=>{var S;xt(i),(S=a.onKeyDown)==null||S.call(a,i)}})});return e.jsxs(ft,{...gt,children:[Be.scrollButtonStart,Be.scrollbarSizeListener,e.jsxs(mt,{...Te,children:[e.jsx(bt,{"aria-label":h,"aria-labelledby":g,"aria-orientation":D==="vertical"?"vertical":null,role:"tablist",...et,children:pt}),Pe&&Qe]}),Be.scrollButtonEnd]})}),Et=Me(e.jsx("path",{d:"m7 10 5 5 5-5z"})),Ir=Me([e.jsx("path",{d:"m12 2-5.5 9h11z"},"0"),e.jsx("circle",{cx:"17.5",cy:"17.5",r:"4.5"},"1"),e.jsx("path",{d:"M3 13.5h8v8H3z"},"2")]),Ar=Me(e.jsx("path",{d:"M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12z"})),Tr=Me(e.jsx("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"})),Rr=({complaintId:r,open:t,onClose:o,citizenName:d="Citizen",complaintTitle:c="Complaint"})=>{const u=Lt(),h=os(u.breakpoints.down("sm")),g=n.useRef(null),m=n.useRef(null),[j,v]=n.useState([]),[w,l]=n.useState(!1),[R,I]=n.useState(null),[O,D]=n.useState(""),[P,G]=n.useState(!1),[k,N]=n.useState(null),[U,J]=n.useState(!1),L=n.useCallback(()=>{g.current&&g.current.scrollIntoView({behavior:"smooth"})},[]);n.useEffect(()=>{t&&r&&(oe(),Q())},[t,r]),n.useEffect(()=>{L()},[j,L]),n.useEffect(()=>{if(t&&r)return Oe.startPolling(r,p=>{v(p)}),()=>{Oe.stopPolling(r)}},[t,r]);const oe=async()=>{if(r)try{l(!0),I(null);const{messages:p}=await Oe.getChatMessages(r);v(p)}catch(p){const b=Fe(p);I(b.userMessage)}finally{l(!1)}},Q=async()=>{if(r)try{await Oe.markAsRead(r)}catch(p){console.error("Error marking messages as read:",p)}},_=async()=>{if(!(!r||!O.trim()&&!k))try{G(!0);let p;k?p=await Oe.sendMessageWithFile(r,O.trim()||"Image",k.file):p=await Oe.sendMessage(r,{message:O.trim()}),v(b=>[...b,p]),D(""),N(null),L(),Le.success("Message sent successfully",{icon:"âœ…"})}catch(p){const b=Fe(p);Le.error(b.userMessage,{duration:5e3,icon:"âŒ"})}finally{G(!1)}},F=async p=>{var K;const b=(K=p.target.files)==null?void 0:K[0];if(b){if(!b.type.startsWith("image/")){Le.error("Please select an image file",{icon:"âŒ"});return}if(b.size>5*1024*1024){Le.error("Image size must be less than 5MB",{icon:"âŒ"});return}try{J(!0);const H=new FileReader;H.onloadend=()=>{N({file:b,preview:H.result})},H.readAsDataURL(b),Le.success("Image ready to send",{icon:"âœ…"})}catch(H){const W=Fe(H);Le.error(W.userMessage,{icon:"âŒ"}),N(null)}finally{J(!1)}}},ge=()=>{N(null)},Z=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),_())},X=p=>{const b=new Date(p),K=new Date,H=K.getTime()-b.getTime(),W=Math.floor(H/(1e3*60)),ee=Math.floor(H/(1e3*60*60)),me=Math.floor(H/(1e3*60*60*24));return W<1?"Just now":W<60?`${W}m ago`:ee<24?`${ee}h ago`:me<7?`${me}d ago`:b.toLocaleDateString("en-US",{month:"short",day:"numeric",year:b.getFullYear()!==K.getFullYear()?"numeric":void 0})},B=()=>{v([]),D(""),N(null),I(null),o()};return e.jsxs(ns,{open:t,onClose:B,maxWidth:"sm",fullWidth:!0,fullScreen:h,slotProps:{paper:{sx:{borderRadius:h?0:2,height:h?"100vh":"80vh",maxHeight:h?"100vh":"80vh",display:"flex",flexDirection:"column",animation:h?`${js} ${pe.normal.duration} ${pe.smooth.timing}`:`${vs} ${pe.normal.duration} ${pe.smooth.timing}`,animationFillMode:"both"}},backdrop:{sx:{animation:`${Nt} ${pe.fast.duration} ${pe.fast.timing}`}}},children:[e.jsxs(as,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0",flexShrink:0},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Es,{sx:{width:40,height:40,backgroundColor:"#4CAF50"},children:e.jsx(Ys,{})}),e.jsxs(f,{children:[e.jsx(x,{variant:"subtitle1",sx:{fontWeight:600,lineHeight:1.2},children:d}),e.jsx(x,{variant:"caption",color:"text.secondary",children:c})]})]}),e.jsx(yt,{onClick:B,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(Bt,{})})]}),e.jsxs(ls,{ref:m,sx:{flex:1,overflowY:"auto",p:2,display:"flex",flexDirection:"column",gap:2,backgroundColor:"#f8f9fa"},children:[w&&e.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsx($e,{})}),R&&!w&&e.jsx(ws,{severity:"error",sx:{mb:2},children:R}),!w&&!R&&j.length===0&&e.jsxs(f,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:200,textAlign:"center"},children:[e.jsx(x,{variant:"body1",color:"text.secondary",sx:{mb:1},children:"No messages yet"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Start the conversation by sending a message"})]}),!w&&!R&&j.map(p=>{const b=p.senderType==="ADMIN";return e.jsx(f,{sx:{display:"flex",justifyContent:b?"flex-end":"flex-start",animation:`${Nt} ${pe.fast.duration} ${pe.fast.timing}`},children:e.jsxs(f,{sx:{maxWidth:"70%",display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:.5,px:1,justifyContent:b?"flex-end":"flex-start"},children:[b&&e.jsx(Is,{sx:{fontSize:14,color:"#4CAF50"}}),e.jsx(x,{variant:"caption",sx:{fontWeight:600,color:b?"#4CAF50":"#1976d2"},children:p.senderName||(b?"Admin":d)})]}),e.jsxs(f,{sx:{backgroundColor:b?"#4CAF50":"white",color:b?"white":"text.primary",borderRadius:2,p:1.5,boxShadow:1},children:[p.imageUrl&&e.jsx(f,{component:"img",src:p.imageUrl,alt:"Message attachment",sx:{width:"100%",maxWidth:300,borderRadius:1,mb:p.message?1:0}}),p.message&&e.jsx(x,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:p.message})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{px:1,textAlign:b?"right":"left"},children:X(p.createdAt)})]})},p.id)}),e.jsx("div",{ref:g})]}),e.jsxs(f,{sx:{p:2,borderTop:"1px solid #e0e0e0",backgroundColor:"white",flexShrink:0},children:[k&&e.jsxs(f,{sx:{mb:1,position:"relative",display:"inline-block"},children:[e.jsx(f,{component:"img",src:k.preview,alt:"Preview",sx:{maxWidth:200,maxHeight:200,borderRadius:1,border:"1px solid #e0e0e0"}}),e.jsx(yt,{size:"small",onClick:ge,sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},children:e.jsx(Bt,{fontSize:"small"})})]}),e.jsxs(f,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx(wt,{fullWidth:!0,multiline:!0,maxRows:4,placeholder:"Type a message...",value:O,onChange:p=>D(p.target.value),onKeyPress:Z,disabled:P,slotProps:{input:{startAdornment:e.jsx(Xe,{position:"start",children:e.jsxs(yt,{component:"label",size:"small",disabled:U||P,children:[e.jsx(Js,{}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:F})]})})}},sx:{"& .MuiOutlinedInput-root":{borderRadius:3}}}),e.jsx(xe,{variant:"contained",onClick:_,disabled:!O.trim()&&!k||P,sx:{minWidth:56,height:56,borderRadius:"50%",backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},"&:disabled":{backgroundColor:"#e0e0e0"}},children:P?e.jsx($e,{size:24,sx:{color:"white"}}):e.jsx(qs,{})})]})]})]})};class Or{constructor(){Ct(this,"apiClient");this.apiClient=nt.create({baseURL:at.BASE_URL,timeout:at.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const o=localStorage.getItem("accessToken");o&&(t.headers.Authorization=`Bearer ${o}`)}catch(o){console.error("Error getting token:",o)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var o;return((o=t.response)==null?void 0:o.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(this.handleError(t))})}handleError(t){var o,d,c,u,h;if(nt.isAxiosError(t)){const g=((o=t.response)==null?void 0:o.status)||500,m=((c=(d=t.response)==null?void 0:d.data)==null?void 0:c.message)||"An error occurred",j=(h=(u=t.response)==null?void 0:u.data)==null?void 0:h.errors;return{name:"ApiError",statusCode:g,message:m,errors:j}}return{name:"ApiError",statusCode:500,message:t.message||"An unexpected error occurred"}}parseMetadata(t){if(!t)return null;try{return JSON.parse(t)}catch(o){return console.error("Error parsing notification metadata:",o),null}}async getNotifications(t={}){try{const o={page:t.page||1,limit:t.limit||20};t.unreadOnly!==void 0&&(o.unreadOnly=t.unreadOnly);const d=await this.apiClient.get("/api/notifications",{params:o}),c=d.data.data.notifications.map(u=>({...u,metadata:this.parseMetadata(u.metadata)}));return{...d.data.data,notifications:c}}catch(o){throw console.error("Error fetching notifications:",o),o}}async getUnreadCount(){try{return(await this.apiClient.get("/api/notifications/unread-count")).data.data.count}catch(t){throw console.error("Error fetching unread count:",t),t}}async markAsRead(t){try{return(await this.apiClient.patch(`/api/notifications/${t}/read`)).data.data}catch(o){throw console.error("Error marking notification as read:",o),o}}async markAllAsRead(){try{return(await this.apiClient.patch("/api/notifications/read-all")).data.data.updatedCount}catch(t){throw console.error("Error marking all notifications as read:",t),t}}}new Or;class Lr{constructor(){Ct(this,"apiClient");this.apiClient=nt.create({baseURL:at.BASE_URL,timeout:at.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const o=localStorage.getItem("accessToken");o&&(t.headers.Authorization=`Bearer ${o}`)}catch(o){console.error("Error getting token:",o)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var o;return((o=t.response)==null?void 0:o.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(this.handleError(t))})}handleError(t){var o,d,c,u,h;if(nt.isAxiosError(t)){const g=((o=t.response)==null?void 0:o.status)||500,m=((c=(d=t.response)==null?void 0:d.data)==null?void 0:c.message)||"An error occurred",j=(h=(u=t.response)==null?void 0:u.data)==null?void 0:h.errors;return{name:"ApiError",statusCode:g,message:m,errors:j}}return{name:"ApiError",statusCode:500,message:t.message||"An unexpected error occurred"}}async submitReview(t,o){try{return(await this.apiClient.post(`/api/complaints/${t}/review`,o)).data.data}catch(d){throw console.error("Error submitting review:",d),d}}async getComplaintReviews(t){try{return(await this.apiClient.get(`/api/complaints/${t}/reviews`)).data.data}catch(o){throw console.error("Error fetching complaint reviews:",o),o}}async getReviewAnalytics(t={}){try{const o={};return t.cityCorporationCode&&(o.cityCorporationCode=t.cityCorporationCode),t.zoneId!==void 0&&(o.zoneId=t.zoneId),t.wardId!==void 0&&(o.wardId=t.wardId),t.startDate&&(o.startDate=t.startDate),t.endDate&&(o.endDate=t.endDate),(await this.apiClient.get("/api/admin/complaints/analytics/reviews",{params:o})).data.data}catch(o){throw console.error("Error fetching review analytics:",o),o}}}new Lr;const Mr=({value:r,onChange:t,disabled:o=!1,fullWidth:d=!1})=>{const[c,u]=n.useState([]),[h,g]=n.useState(!0),[m,j]=n.useState(null);n.useEffect(()=>{v()},[]);const v=async()=>{try{g(!0),j(null);const l=await is.getAllCategories();u(l)}catch(l){console.error("Error fetching categories:",l),j(l.message||"Failed to load categories")}finally{g(!1)}},w=l=>{t(l.target.value)};return e.jsx(Ue,{sx:{minWidth:d?"100%":{xs:"100%",sm:180}},disabled:o||h,children:e.jsxs(_e,{value:r,onChange:w,displayEmpty:!0,startAdornment:e.jsx(Xe,{position:"start",children:h?e.jsx($e,{size:20,sx:{mr:1}}):e.jsx(Ir,{sx:{color:"text.secondary",mr:1}})}),sx:{backgroundColor:"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},children:[e.jsx(M,{value:"",children:e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:"All Categories"})}),e.jsx(M,{value:"uncategorized",children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Zs,{sx:{fontSize:18,color:"#9e9e9e"}}),e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"#757575"},children:"Uncategorized"})]})}),m?e.jsx(M,{disabled:!0,children:e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"error.main"},children:m})}):c.map(l=>e.jsx(M,{value:l.id,children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(f,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:l.color,flexShrink:0}}),e.jsxs(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:[l.english," (",l.bangla,")"]})]})},l.id))]})})},Pr=({categoryId:r,value:t,onChange:o,disabled:d=!1,fullWidth:c=!1})=>{const[u,h]=n.useState([]),[g,m]=n.useState(!1),[j,v]=n.useState(null);n.useEffect(()=>{r?w():(h([]),t&&o(""))},[r]);const w=async()=>{try{m(!0),v(null);const I=await is.getSubcategories(r);h(I)}catch(I){console.error("Error fetching subcategories:",I),v(I.message||"Failed to load subcategories"),h([])}finally{m(!1)}},l=I=>{o(I.target.value)},R=d||g||!r;return e.jsx(Ue,{sx:{minWidth:c?"100%":{xs:"100%",sm:200}},disabled:R,children:e.jsxs(_e,{value:t,onChange:l,displayEmpty:!0,startAdornment:e.jsx(Xe,{position:"start",children:g?e.jsx($e,{size:20,sx:{mr:1}}):e.jsx(Ar,{sx:{color:"text.secondary",mr:1}})}),sx:{backgroundColor:R?"#f5f5f5":"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:R?void 0:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},children:[e.jsx(M,{value:"",children:e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:r?"All Subcategories":"Select category first"})}),j?e.jsx(M,{disabled:!0,children:e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"error.main"},children:j})}):u.map(I=>e.jsx(M,{value:I.id,children:e.jsxs(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:[I.english," (",I.bangla,")"]})},I.id))]})})},Zt=["Engineering","Electricity","Health","Property (Eviction)"],qt=["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"],zr=({value:r,onChange:t,disabled:o=!1,fullWidth:d=!1})=>{const[c,u]=n.useState(!1),[h,g]=n.useState(!1),m=l=>{const R=l.target.value;t(R)},j=()=>r==="ALL"?"All Status":r==="OTHERS_ALL"?"All Others":r==="CORPORATION_INTERNAL"?"Corporation Internal":r==="CORPORATION_EXTERNAL"?"Corporation External":Zt.includes(r)?`Internal: ${r}`:qt.includes(r)?`External: ${r}`:r,v=l=>r===l,w=l=>v(l)?e.jsx(Ts,{sx:{fontSize:18,color:"#4CAF50",mr:1}}):e.jsx(Rs,{sx:{fontSize:18,color:"transparent",mr:1}});return e.jsx(Ue,{sx:{minWidth:d?"100%":{xs:"100%",sm:200}},disabled:o,children:e.jsxs(_e,{value:r,onChange:m,displayEmpty:!0,startAdornment:e.jsx(Xe,{position:"start",children:e.jsx(As,{sx:{color:"text.secondary",mr:1}})}),renderValue:()=>e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:j()}),sx:{backgroundColor:"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},MenuProps:{PaperProps:{sx:{maxHeight:400,"& .MuiMenuItem-root":{fontSize:{xs:"0.875rem",sm:"0.95rem"}}}}},children:[e.jsx(M,{value:"ALL",children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w("ALL"),e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:"All Status"})]})}),e.jsx(He,{sx:{my:.5}}),e.jsx(M,{value:"OTHERS_ALL",children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w("OTHERS_ALL"),e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:600},children:"All Others"})]})}),e.jsx(He,{sx:{my:.5}}),e.jsx(M,{value:"CORPORATION_INTERNAL",onClick:l=>{l.stopPropagation(),u(!c)},sx:{backgroundColor:c?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:c?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w("CORPORATION_INTERNAL"),e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:500,flex:1},children:"Corporation Internal"}),c?e.jsx(Xt,{sx:{fontSize:20,color:"text.secondary"}}):e.jsx(Vt,{sx:{fontSize:20,color:"text.secondary"}})]})}),c&&e.jsx(e.Fragment,{children:Zt.map(l=>e.jsx(M,{value:l,sx:{pl:5,backgroundColor:v(l)?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:v(l)?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w(l),e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:l})]})},l))}),e.jsx(He,{sx:{my:.5}}),e.jsx(M,{value:"CORPORATION_EXTERNAL",onClick:l=>{l.stopPropagation(),g(!h)},sx:{backgroundColor:h?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:h?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w("CORPORATION_EXTERNAL"),e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:500,flex:1},children:"Corporation External"}),h?e.jsx(Xt,{sx:{fontSize:20,color:"text.secondary"}}):e.jsx(Vt,{sx:{fontSize:20,color:"text.secondary"}})]})}),h&&e.jsx(e.Fragment,{children:qt.map(l=>e.jsx(M,{value:l,sx:{pl:5,backgroundColor:v(l)?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:v(l)?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w(l),e.jsx(x,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:l})]})},l))})]})})},Zr=()=>{const r=Os(),[t,o]=Ls(),d=Lt(),c=os(d.breakpoints.down("sm")),[u,h]=n.useState([]),[g,m]=n.useState(!0),[j,v]=n.useState(null),[w,l]=n.useState(null),[R,I]=n.useState(!1),[O,D]=n.useState(t.get("search")||""),[P,G]=n.useState(t.get("status")||"ALL"),[k,N]=n.useState(t.get("category")||""),[U,J]=n.useState(t.get("subcategory")||""),[L,oe]=n.useState(t.get("othersFilter")||"ALL"),[Q,_]=n.useState([]),[F,ge]=n.useState(t.get("cityCorporation")||"ALL"),[Z,X]=n.useState(null),[B,p]=n.useState(t.get("zone")?Number(t.get("zone")):""),[b,K]=n.useState(t.get("ward")?Number(t.get("ward")):null),[H,W]=n.useState([]),[ee,me]=n.useState(!1),[Mt,Pe]=n.useState(!1),[be,ne]=n.useState({total:0,pending:0,inProgress:0,resolved:0,rejected:0,others:0}),[z,Y]=n.useState({page:parseInt(t.get("page")||"1",10),limit:parseInt(t.get("limit")||"20",10),total:0,totalPages:0}),[lt,Ve]=n.useState(!1),[it,Ge]=n.useState(null),[ct,ze]=n.useState(!1),[dt,Ke]=n.useState(null),[se,le]=n.useState(""),[de,Ye]=n.useState(""),[ye,je]=n.useState(null),ve=Vs(O,500),[Ee,ut]=n.useState(!0),[ht,Je]=n.useState(null),[we,Ze]=n.useState(!1),[ke,Ne]=n.useState(!1),[Ie,qe]=n.useState(!1),[ae,Ae]=n.useState(""),[ue,Pt]=n.useState(""),[Qe,he]=n.useState(!1),[pt,xt]=n.useState(""),[Be,ft]=n.useState("");n.useEffect(()=>{gt()},[]),n.useEffect(()=>{if(F!=="ALL"){const s=Q.find(C=>C.code===F);s&&X(s.id)}else X(null),W([]);p(""),K(null)},[F,Q]),n.useEffect(()=>{B?mt(B):W([]),K(null)},[B]),n.useEffect(()=>{const s=new URLSearchParams;O&&s.set("search",O),P!=="ALL"&&s.set("status",P),k&&s.set("category",k),U&&s.set("subcategory",U),L!=="ALL"&&s.set("othersFilter",L),F!=="ALL"&&s.set("cityCorporation",F),B&&s.set("zone",B.toString()),b&&s.set("ward",b.toString()),ae&&s.set("startDate",ae),ue&&s.set("endDate",ue),z.page!==1&&s.set("page",z.page.toString()),z.limit!==20&&s.set("limit",z.limit.toString()),o(s,{replace:!0})},[O,P,k,U,L,F,B,b,ae,ue,z.page,z.limit]);const gt=async()=>{try{me(!0),console.log("ðŸ™ï¸ Fetching city corporations...");const s=await Ms.getCityCorporations("ACTIVE");console.log("âœ… City corporations fetched:",s),console.log("ðŸ“Š City corporations array:",s.cityCorporations),s.cityCorporations&&Array.isArray(s.cityCorporations)?(_(s.cityCorporations),console.log(`âœ… Set ${s.cityCorporations.length} city corporations`)):(console.warn("âš ï¸ City corporations response is not valid:",s),_([]))}catch(s){console.error("âŒ Error fetching city corporations:",s),st("Failed to load city corporations"),_([])}finally{me(!1)}},mt=async s=>{try{Pe(!0);const C=await Qs.getWardsByZone(s,"ACTIVE");W(C)}catch(C){console.error("Error fetching wards:",C),st("Failed to load wards")}finally{Pe(!1)}},Te=n.useCallback(async()=>{var s,C;try{m(!0),v(null),l(null),I(!1);const E={};P!=="ALL"&&(E.status=P),ve&&(E.search=ve),k&&(E.category=k),U&&(E.subcategory=U),L!=="ALL"&&(L==="OTHERS_ALL"?E.status="OTHERS":L==="CORPORATION_INTERNAL"?(E.status="OTHERS",E.othersCategory="CORPORATION_INTERNAL"):L==="CORPORATION_EXTERNAL"?(E.status="OTHERS",E.othersCategory="CORPORATION_EXTERNAL"):(E.status="OTHERS",E.othersSubcategory=L)),F!=="ALL"&&(E.cityCorporationCode=F),B&&(E.zoneId=B),b&&(E.wardId=b),ae&&(E.startDate=ae),ue&&(E.endDate=ue),console.log("Fetching complaints with params:",{page:z.page,limit:z.limit,filters:E});const T=await Gt.getComplaints(z.page,z.limit,E);console.log("Complaints fetched successfully:",T),h(T.complaints),ne(T.statusCounts),Y({page:T.pagination.page,limit:T.pagination.limit,total:T.pagination.total,totalPages:T.pagination.totalPages})}catch(E){console.error("Error fetching complaints:",E),console.error("Error response:",(s=E.response)==null?void 0:s.data),console.error("Error status:",(C=E.response)==null?void 0:C.status),Wt(E,"fetchComplaints");const T=Fe(E);v(T.userMessage),l(T.type),I(T.retryable),T.type===Dt.NETWORK?_t(T.userMessage):st(T.userMessage)}finally{m(!1)}},[z.page,z.limit,P,k,U,L,F,B,b,ve,ae,ue]);n.useEffect(()=>{Te()},[Te]);const bt=(s,C)=>{Y(E=>({...E,page:C})),window.scrollTo({top:0,behavior:"smooth"})},et=s=>{G(s),s==="OTHERS"?(N(""),J("")):oe("ALL"),Y(C=>({...C,page:1}))},a=s=>{D(s.target.value),Y(C=>({...C,page:1}))},i=s=>{N(s),J(""),Y(C=>({...C,page:1}))},S=s=>{J(s),Y(C=>({...C,page:1}))},y=s=>{oe(s),Y(C=>({...C,page:1}))},A=s=>{s.stopPropagation(),Je(s.currentTarget),Ze(!0)},q=()=>{Je(null),Ze(!1),Ne(!1),qe(!1)},re=s=>{y(s),et("OTHERS"),["CORPORATION_INTERNAL","CORPORATION_EXTERNAL"].includes(s)||q()},Ce=s=>{ge(s),Y(C=>({...C,page:1}))},tt=s=>{p(s),Y(C=>({...C,page:1}))},We=s=>{K(s),Y(C=>({...C,page:1}))},cs=()=>{D(""),G("ALL"),N(""),J(""),oe("ALL"),ge("ALL"),ge("ALL"),p(""),K(null),Y(s=>({...s,page:1}))},zt=n.useCallback(async(s,C)=>{try{je(s);const E=await Gt.updateComplaintStatus(s,{status:C});h(T=>T.map(ie=>ie.id===s?E:ie)),ne(T=>{const ie=u.find(gs=>gs.id===s);if(!ie)return T;const V={...T};return ie.status==="PENDING"?V.pending=Math.max(0,V.pending-1):ie.status==="IN_PROGRESS"?V.inProgress=Math.max(0,V.inProgress-1):ie.status==="RESOLVED"?V.resolved=Math.max(0,V.resolved-1):ie.status==="REJECTED"?V.rejected=Math.max(0,V.rejected-1):ie.status==="OTHERS"&&(V.others=Math.max(0,V.others-1)),C==="PENDING"?V.pending+=1:C==="IN_PROGRESS"?V.inProgress+=1:C==="RESOLVED"?V.resolved+=1:C==="REJECTED"?V.rejected+=1:C==="OTHERS"&&(V.others+=1),V}),Xs("Complaint status updated successfully")}catch(E){Wt(E,"handleStatusUpdate");const T=Fe(E);T.type===Dt.NETWORK?_t(T.userMessage):st(T.userMessage)}finally{je(null)}},[u]),ds=s=>{r(`/complaints/${s}`)},kt=()=>{Ve(!1),Ge(null)},us=s=>{Ke(s.id),le(`${s.user.firstName} ${s.user.lastName}`),Ye(s.category||s.title),ze(!0)},hs=s=>{kt(),r(`/chats/${s}`)},ps=n.useCallback(async(s,C)=>{await zt(s,C),Te()},[zt,Te]),xs=s=>{switch(s){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404",borderColor:"#ffeeba"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460",borderColor:"#bee5eb"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724",borderColor:"#c3e6cb"};case"REJECTED":return{backgroundColor:"#f8d7da",color:"#721c24",borderColor:"#f5c6cb"};default:return{backgroundColor:"#f8f9fa",color:"#6c757d"}}},fs=s=>{switch(s){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Solved";case"REJECTED":return"Others";default:return s}};return e.jsxs(Ps,{title:"All Complaints",children:[e.jsx(zs,{loading:g}),e.jsxs(f,{sx:{p:{xs:2,md:3},backgroundColor:"#f9fafb",minHeight:"100vh"},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(x,{variant:"h5",sx:{fontWeight:700,color:"#1e2939"},children:["All Complaints",z.total>0&&e.jsxs(x,{component:"span",variant:"body1",sx:{color:"#6b7280",ml:1.5,fontWeight:500},children:["(Total ",z.total,")"]})]}),e.jsx(xe,{variant:"contained",onClick:()=>ut(!Ee),startIcon:e.jsx(er,{}),sx:{backgroundColor:"#4CAF50",textTransform:"none","&:hover":{backgroundColor:"#45a049"}},children:Ee?"Hide Filters":"Show Filters"})]}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(wr,{value:P==="ALL"?"ALL":P,onChange:(s,C)=>et(C),variant:"scrollable",scrollButtons:"auto",sx:{"& .MuiTab-root":{textTransform:"none",minWidth:100,fontWeight:600}},children:[e.jsx(De,{label:`All (${be.total})`,value:"ALL"}),e.jsx(De,{label:`Pending (${be.pending})`,value:"PENDING"}),e.jsx(De,{label:`In Progress (${be.inProgress})`,value:"IN_PROGRESS"}),e.jsx(De,{label:`Solved (${be.resolved})`,value:"RESOLVED"}),e.jsx(De,{label:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:.5},children:[`Others (${be.others})`,e.jsx(f,{component:"span",onClick:A,sx:{display:"flex",alignItems:"center",borderRadius:"50%",p:.5,"&:hover":{bgcolor:"rgba(0,0,0,0.05)"}},children:e.jsx(Et,{fontSize:"small"})})]}),value:"OTHERS"})]})}),e.jsxs(ks,{anchorEl:ht,open:we,onClose:q,onClick:s=>s.stopPropagation(),PaperProps:{sx:{mt:1,width:250,maxHeight:400}},children:[e.jsx(M,{onClick:()=>re("OTHERS_ALL"),children:"All Others"}),e.jsx(He,{}),e.jsxs(M,{onClick:()=>Ne(!ke),sx:{fontWeight:"bold",justifyContent:"space-between"},children:["Corp. Internal",e.jsx(Et,{sx:{transform:ke?"rotate(180deg)":"rotate(0deg)",transition:"0.2s"}})]}),ke&&["Engineering","Electricity","Health","Property (Eviction)"].map(s=>e.jsx(M,{onClick:()=>re(s),sx:{pl:4,fontSize:"0.9rem"},selected:L===s,children:s},s)),e.jsx(He,{}),e.jsxs(M,{onClick:()=>qe(!Ie),sx:{fontWeight:"bold",justifyContent:"space-between"},children:["Corp. External",e.jsx(Et,{sx:{transform:Ie?"rotate(180deg)":"rotate(0deg)",transition:"0.2s"}})]}),Ie&&["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"].map(s=>e.jsx(M,{onClick:()=>re(s),sx:{pl:4,fontSize:"0.9rem"},selected:L===s,children:s},s))]}),e.jsx(tr,{in:Ee,children:e.jsxs(Ft,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e5e7eb",backgroundColor:"white"},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(x,{variant:"subtitle1",sx:{fontWeight:600,color:"#374151"},children:"Filter Options"}),e.jsx(xe,{size:"small",onClick:cs,startIcon:e.jsx(Ns,{}),sx:{textTransform:"none",color:"#ef4444"},children:"Clear Filters"})]}),e.jsxs(ce,{container:!0,spacing:2,children:[e.jsx(ce,{size:{xs:12,sm:6,md:3},children:e.jsx(wt,{fullWidth:!0,type:"date",size:"small",label:"Date",value:ae,onChange:s=>Ae(s.target.value),InputLabelProps:{shrink:!0},sx:{backgroundColor:"white"}})}),e.jsx(ce,{size:{xs:12,sm:6,md:3},children:e.jsxs(Ue,{fullWidth:!0,size:"small",children:[e.jsx(Ht,{children:"All City Corporations"}),e.jsxs(_e,{value:F||"",onChange:s=>Ce(s.target.value),label:"All City Corporations",children:[e.jsx(M,{value:"ALL",children:"All City Corporations"}),Q.map(s=>e.jsx(M,{value:s.code,children:s.name},s.id))]})]})}),e.jsx(ce,{size:{xs:12,sm:6,md:3},children:e.jsx(Bs,{value:B,onChange:tt,cityCorporationCode:F!=="ALL"?F:"",hideLabel:!1,label:"All Zones"})}),e.jsx(ce,{size:{xs:12,sm:6,md:3},children:e.jsxs(Ue,{fullWidth:!0,size:"small",children:[e.jsx(Ht,{children:"All Wards"}),e.jsxs(_e,{value:b||"",onChange:s=>We(s.target.value?Number(s.target.value):null),label:"All Wards",displayEmpty:!0,children:[e.jsx(M,{value:"",children:"All Wards"}),H&&H.map(s=>e.jsxs(M,{value:s.id,children:["Ward ",s.wardNumber||s.id]},s.id))]})]})}),P!=="OTHERS"&&e.jsx(ce,{size:{xs:12,sm:6,md:3},children:e.jsx(Mr,{value:k,onChange:i})}),P!=="OTHERS"&&e.jsx(ce,{size:{xs:12,sm:6,md:3},children:e.jsx(Pr,{value:U,onChange:S,categoryId:k,fullWidth:!0})}),P==="OTHERS"&&e.jsx(ce,{size:{xs:12,sm:6,md:3},children:e.jsx(zr,{value:L,onChange:y,fullWidth:!0})}),e.jsx(ce,{size:{xs:12},children:e.jsx(wt,{fullWidth:!0,placeholder:"Search by ID, citizen name, or phone number...",value:O,onChange:a,InputProps:{startAdornment:e.jsx(Xe,{position:"start",children:e.jsx(Ws,{sx:{color:"text.secondary"}})})},size:"small",sx:{backgroundColor:"white","& .MuiOutlinedInput-root":{fontSize:"0.95rem"}}})})]})]})}),e.jsxs(f,{sx:{display:"flex",justifyContent:"flex-end",mb:2,gap:1},children:[e.jsx(xe,{startIcon:e.jsx(sr,{}),variant:"outlined",size:"small",sx:{color:"#1976d2",borderColor:"#1976d2"},children:"Download"}),e.jsx(xe,{startIcon:e.jsx(Tr,{}),variant:"outlined",size:"small",sx:{color:"#9c27b0",borderColor:"#9c27b0"},children:"Print"})]}),!g&&!j&&e.jsx(Ds,{component:Ft,elevation:0,sx:{border:"1px solid #e0e0e0",borderRadius:2},children:e.jsxs(Fs,{sx:{minWidth:800},children:[e.jsx(Hs,{sx:{backgroundColor:"#f9fafb"},children:e.jsxs(jt,{children:[e.jsx($,{sx:{fontWeight:600},children:"Complaint No"}),e.jsx($,{sx:{fontWeight:600},children:"Citizen Info"}),e.jsx($,{sx:{fontWeight:600},children:"Location"}),e.jsx($,{sx:{fontWeight:600},children:"Category"}),e.jsx($,{sx:{fontWeight:600},children:"Status"}),e.jsx($,{sx:{fontWeight:600},children:"Review & Report"}),e.jsx($,{sx:{fontWeight:600},children:"Date"}),e.jsx($,{align:"right",sx:{fontWeight:600},children:"Action"})]})}),e.jsx($s,{children:u.length===0?e.jsx(jt,{children:e.jsx($,{colSpan:7,align:"center",sx:{py:8},children:e.jsx(x,{color:"text.secondary",children:"No complaints found"})})}):u.map(s=>e.jsxs(jt,{hover:!0,children:[e.jsx($,{children:e.jsx(x,{variant:"body2",sx:{fontWeight:600,color:"#4CAF50"},children:s.trackingNumber||`C${String(s.id).padStart(6,"0")}`})}),e.jsx($,{children:e.jsxs(f,{children:[e.jsxs(x,{variant:"body2",sx:{fontWeight:600},children:[s.user.firstName," ",s.user.lastName]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:s.user.phone||"N/A"})]})}),e.jsx($,{children:e.jsxs(f,{children:[e.jsx(x,{variant:"body2",children:s.location}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Zone: ",typeof s.user.zone=="object"&&s.user.zone!==null?s.user.zone.name||s.user.zone.zoneNumber:s.user.zone||"N/A"," | Ward: ",typeof s.user.ward=="object"&&s.user.ward!==null?s.user.ward.wardNumber||s.user.ward.number:s.user.ward||"N/A"]})]})}),e.jsx($,{children:e.jsxs(f,{children:[e.jsx(x,{variant:"body2",children:s.category||"N/A"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:s.subcategory})]})}),e.jsxs($,{children:[e.jsx($t,{label:fs(s.status),size:"small",sx:{...xs(s.status),fontWeight:500,borderRadius:1,height:24}}),(s.status==="OTHERS"||s.status==="REJECTED")&&(s.othersCategory||s.othersSubcategory)&&e.jsxs(f,{sx:{mt:.5,lineHeight:1.2},children:[s.othersCategory&&e.jsx(x,{variant:"caption",display:"block",sx:{fontWeight:600,fontSize:"0.7rem",color:"#4b5563"},children:s.othersCategory==="CORPORATION_INTERNAL"?"Corp. Internal":s.othersCategory==="CORPORATION_EXTERNAL"?"Corp. External":s.othersCategory}),s.othersSubcategory&&e.jsx(x,{variant:"caption",display:"block",sx:{color:"text.secondary",fontSize:"0.7rem"},children:s.othersSubcategory})]})]}),e.jsx($,{children:["RESOLVED","OTHERS","REJECTED"].includes(s.status)?e.jsxs(f,{sx:{maxWidth:200},children:[s.resolutionNote&&e.jsx(Ut,{title:"Click to view full note",children:e.jsxs(x,{variant:"caption",display:"block",sx:{color:"#1976d2",fontWeight:500,mb:.5,cursor:"pointer","&:hover":{textDecoration:"underline"}},noWrap:!0,onClick:()=>{xt(s.resolutionNote||""),ft("Admin Resolution Note"),he(!0)},children:["Admin: ",s.resolutionNote]})}),s.review?e.jsxs(f,{children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Us,{value:s.review.rating,readOnly:!0,size:"small",sx:{fontSize:"1rem"}}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:["(",s.review.rating,")"]})]}),s.review.comment&&e.jsx(Ut,{title:s.review.comment,children:e.jsxs(x,{variant:"caption",display:"block",color:"text.secondary",noWrap:!0,sx:{mt:.5},children:['"',s.review.comment,'"']})})]}):e.jsx(x,{variant:"caption",color:"text.disabled",sx:{fontStyle:"italic"},children:"Not reviewed yet"})]}):e.jsx($t,{label:"Unsolved",size:"small",variant:"outlined",sx:{borderColor:"#e0e0e0",color:"#9e9e9e",height:24,fontSize:"0.75rem"}})}),e.jsx($,{children:e.jsx(x,{variant:"body2",children:new Date(s.createdAt).toLocaleDateString()})}),e.jsxs($,{align:"right",children:[e.jsx(xe,{variant:"outlined",size:"small",startIcon:e.jsx(Gs,{}),onClick:()=>us(s),sx:{borderColor:"#e0e0e0",color:"text.primary",textTransform:"none",mr:1,"&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Chat"}),e.jsx(xe,{variant:"contained",size:"small",onClick:()=>ds(s.id),sx:{backgroundColor:"#4CAF50",color:"white",textTransform:"none",boxShadow:"none","&:hover":{backgroundColor:"#45a049",boxShadow:"none"}},children:"View Details"})]})]},s.id))})]})}),g&&e.jsx(f,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx($e,{})}),!g&&!j&&u.length>0&&z.total>0&&e.jsx(f,{sx:{mt:{xs:3,sm:4},mb:2,display:"flex",justifyContent:"center"},children:e.jsx(rr,{count:z.totalPages,page:z.page,onChange:bt,color:"primary",size:c?"small":"large",showFirstButton:!c,showLastButton:!c,siblingCount:c?0:1,boundaryCount:1,sx:{"& .MuiPaginationItem-root":{fontSize:{xs:"0.875rem",sm:"0.95rem"},"&.Mui-selected":{backgroundColor:"#4CAF50 !important",color:"white"}}}})})]}),e.jsx(Ks,{complaintId:it,open:lt,onClose:kt,onStatusUpdate:ps,onChatOpen:hs}),e.jsx(Rr,{open:ct,onClose:()=>ze(!1),complaintId:dt||0,complaintTitle:de,citizenName:se}),e.jsxs(ns,{open:Qe,onClose:()=>he(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(as,{sx:{fontWeight:600,color:"#1f2937"},children:Be}),e.jsx(ls,{dividers:!0,children:e.jsx(x,{variant:"body1",sx:{whiteSpace:"pre-wrap",color:"#374151"},children:pt})}),e.jsx(_s,{children:e.jsx(xe,{onClick:()=>he(!1),color:"primary",children:"Close"})})]})]})};export{Zr as default};
