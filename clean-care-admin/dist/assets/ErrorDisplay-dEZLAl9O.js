import{j as e,B as c,T as v,b as C,b9 as A,b7 as _,bN as $,P as q,i as E,v as J,C as D,q as B,aY as H,g as Q,b6 as V,A as X,R as F,E as N}from"./mui-vendor-DhgYLev2.js";import{r as f}from"./react-vendor-D7yrL1sD.js";import{z as g}from"./index-pueUXdzt.js";const ne=({type:t,onAction:o,actionLabel:r})=>{const s=(()=>{switch(t){case"no-chats":return{icon:e.jsx(A,{sx:{fontSize:64,color:"text.disabled"}}),title:"No users found",description:"No users found in your jurisdiction to chat with.",showAction:!1};case"no-messages":return{icon:e.jsx($,{sx:{fontSize:64,color:"text.disabled"}}),title:"No messages yet",description:"Start the conversation by sending a message below.",showAction:!1};case"no-results":return{icon:e.jsx(_,{sx:{fontSize:64,color:"text.disabled"}}),title:"No results found",description:"Try adjusting your search or filters to find what you're looking for.",showAction:!0};default:return{icon:e.jsx(A,{sx:{fontSize:64,color:"text.disabled"}}),title:"Nothing here",description:"",showAction:!1}}})();return e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:{xs:4,sm:6,md:8},px:3,textAlign:"center"},children:[e.jsx(c,{sx:{mb:2},children:s.icon}),e.jsx(v,{variant:"h6",color:"text.secondary",sx:{mb:1,fontWeight:500,fontSize:{xs:"1rem",sm:"1.25rem"}},children:s.title}),s.description&&e.jsx(v,{variant:"body2",color:"text.secondary",sx:{mb:s.showAction?3:0,maxWidth:400,lineHeight:1.6},children:s.description}),s.showAction&&o&&e.jsx(C,{variant:"outlined",size:"small",onClick:o,sx:{textTransform:"none"},children:r||"Clear Filters"})]})};async function Z(t,o=1920,r=1080,m=.8){return new Promise((s,p)=>{const i=new FileReader;i.onload=w=>{var b;const u=new Image;u.onload=()=>{let a=u.width,d=u.height;a>o&&(d=d*o/a,a=o),d>r&&(a=a*r/d,d=r);const x=document.createElement("canvas");x.width=a,x.height=d;const y=x.getContext("2d");if(!y){p(new Error("Failed to get canvas context"));return}y.drawImage(u,0,0,a,d),x.toBlob(h=>{h?s(h):p(new Error("Failed to compress image"))},"image/jpeg",m)},u.onerror=()=>{p(new Error("Failed to load image"))},u.src=(b=w.target)==null?void 0:b.result},i.onerror=()=>{p(new Error("Failed to read file"))},i.readAsDataURL(t)})}function ee(t,o=5){if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(t.type))return{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, GIF, or WebP image."};const m=o*1024*1024;return t.size>m?{valid:!1,error:`File size exceeds ${o}MB. Please choose a smaller image.`}:{valid:!0}}function oe(t,o){return new File([t],o,{type:t.type})}const ie=({onSend:t,onSendWithFile:o,sending:r,disabled:m=!1})=>{const[s,p]=f.useState(""),[i,w]=f.useState(null),[u,b]=f.useState(null),[a,d]=f.useState(!1),[x,y]=f.useState(null),h=f.useRef(null),T=f.useRef(null),U=n=>{p(n.target.value)},M=async n=>{var R;const l=(R=n.target.files)==null?void 0:R[0];if(!l)return;const I=ee(l,5);if(!I.valid){g.error(I.error||"Invalid image file",{icon:"‚ùå"});return}try{const k=g.loading("Compressing image..."),L=await Z(l,1920,1080,.8),j=oe(L,l.name),Y=((1-j.size/l.size)*100).toFixed(0);g.dismiss(k),j.size<l.size&&g.success(`Image compressed by ${Y}%`,{icon:"‚úÖ",duration:2e3}),w(j);const z=new FileReader;z.onloadend=()=>{b(z.result)},z.readAsDataURL(j),W(j)}catch(k){console.error("Error compressing image:",k),g.error("Failed to process image. Please try again.",{icon:"‚ùå"})}},W=async n=>{try{d(!0),y("READY_TO_SEND"),g.success("Image ready to send",{icon:"‚úÖ",duration:2e3})}catch(l){console.error("Error processing image:",l),g.error("Failed to process image. Please try again.",{icon:"‚ùå"}),S()}finally{d(!1)}},S=()=>{w(null),b(null),y(null),h.current&&(h.current.value="")},P=async()=>{var l;const n=s.trim();if(!n&&!x){g.error("Please enter a message or select an image",{icon:"‚ö†Ô∏è"});return}if(i&&!x){g.error("Please wait for image to finish uploading",{icon:"‚è≥"});return}try{if(console.log("üì§ Sending message with image file:",i==null?void 0:i.name),console.log("üì§ onSendWithFile available:",!!o),i&&o)console.log("‚úÖ Using onSendWithFile for file:",i.name),await o(n||"Image",i);else if(i&&!o){console.error("‚ùå onSendWithFile not available!"),console.error("‚ùå This means ChatConversationPanel did not pass onSendWithFile prop"),g.error("Cannot send image - feature not available",{icon:"‚ùå"});return}else console.log("‚úÖ Sending text only (no image)"),await t(n,void 0);p(""),S(),(l=T.current)==null||l.focus()}catch(I){console.error("‚ùå Error sending message:",I)}},O=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),!r&&!a&&!m&&P())},G=()=>{var n;(n=h.current)==null||n.click()},K=m||r||a||!s.trim()&&!x;return e.jsxs(c,{sx:{p:{xs:1.5,sm:2,md:2},borderTop:"1px solid",borderColor:"divider",backgroundColor:"background.paper"},children:[u&&e.jsxs(q,{elevation:2,sx:{mb:2,p:1,position:"relative",display:"inline-block",maxWidth:"200px"},children:[e.jsx(c,{component:"img",src:u,alt:"Preview",sx:{width:"100%",height:"auto",maxHeight:"150px",objectFit:"cover",borderRadius:"4px"}}),e.jsx(E,{size:"small",onClick:S,disabled:a,sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},children:e.jsx(J,{fontSize:"small"})}),a&&e.jsx(c,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:"4px"},children:e.jsx(D,{size:24})})]}),e.jsxs(c,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx("input",{ref:h,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",style:{display:"none"},onChange:M}),e.jsx(B,{title:"Attach image",children:e.jsx("span",{children:e.jsx(E,{color:"primary",onClick:G,disabled:m||r||a||!!i,sx:{mb:.5},children:e.jsx(H,{})})})}),e.jsx(Q,{inputRef:T,fullWidth:!0,multiline:!0,maxRows:4,placeholder:"Type a message...",value:s,onChange:U,onKeyDown:O,disabled:m||r,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:"20px",backgroundColor:"background.default"}}}),e.jsx(B,{title:r?"Sending...":"Send message (Enter)",children:e.jsx("span",{children:e.jsx(E,{color:"primary",onClick:P,disabled:K,sx:{mb:.5,backgroundColor:"primary.main",color:"white","&:hover":{backgroundColor:"primary.dark"},"&.Mui-disabled":{backgroundColor:"action.disabledBackground",color:"action.disabled"}},children:r?e.jsx(D,{size:24,color:"inherit"}):e.jsx(V,{})})})})]}),s.length>0&&e.jsx(c,{sx:{mt:.5,textAlign:"right"},children:e.jsxs(c,{component:"span",sx:{fontSize:"0.75rem",color:s.length>1e3?"error.main":"text.secondary"},children:[s.length," / 1000"]})})]})},ae=({error:t,onRetry:o,variant:r="centered"})=>r==="alert"?e.jsx(X,{severity:"error",sx:{m:2},action:o&&e.jsx(C,{color:"inherit",size:"small",onClick:o,startIcon:e.jsx(F,{}),children:"Retry"}),children:t}):r==="inline"?e.jsxs(c,{sx:{p:2,backgroundColor:"#ffebee",borderRadius:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{sx:{color:"error.main"}}),e.jsx(c,{sx:{flex:1},children:e.jsx(v,{variant:"body2",color:"error",children:t})}),o&&e.jsx(C,{size:"small",variant:"outlined",color:"error",onClick:o,startIcon:e.jsx(F,{}),children:"Retry"})]}):e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:6,px:3},children:[e.jsx(N,{sx:{fontSize:48,color:"error.main",mb:2}}),e.jsx(v,{variant:"h6",color:"error",sx:{mb:1,textAlign:"center"},children:"Something went wrong"}),e.jsx(v,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center",maxWidth:400},children:t}),o&&e.jsx(C,{variant:"contained",color:"primary",onClick:o,startIcon:e.jsx(F,{}),children:"Try Again"})]});export{ae as E,ie as M,ne as a};
