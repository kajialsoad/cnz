import{r as c,a as y,g as f,b as F,j as e,s as C,c as A,d as g,T as r,ba as ae,a8 as R,F as x,aj as w,ak as G,I as W,bR as ce,ay as de,bS as xe,bT as pe,D as ue,E as me,J as he,X as L,am as Te,P as D,a9 as Ee,L as je,U as X,aa as J,V as Y,W as O,N as K,K as ye}from"./index-CxAfVJz0.js";import{a as _}from"./activityLogService-DKz2OToL.js";import{u as v}from"./useThemeProps-DiqZILQi.js";import{A as fe}from"./Add-C76tQo6G.js";import{D as Ce}from"./Delete-DXw15u2u.js";import{P as Ae}from"./Person-BidrUZ-X.js";import{f as q}from"./format-eKnIX3p_.js";import{G as m}from"./Grid-ptee2XwM.js";import{F as ge}from"./FilterList-BOl_i48b.js";import{D as ve}from"./Download-9AVPuT7u.js";import"./useThemeProps-PQhTHjVC.js";import"./styled-BeqMul2r.js";const Se={CREATE_USER:"CREATE_USER",UPDATE_USER:"UPDATE_USER",DELETE_USER:"DELETE_USER",UPDATE_USER_STATUS:"UPDATE_USER_STATUS",UPDATE_USER_PERMISSIONS:"UPDATE_USER_PERMISSIONS",CREATE_COMPLAINT:"CREATE_COMPLAINT",UPDATE_COMPLAINT:"UPDATE_COMPLAINT",DELETE_COMPLAINT:"DELETE_COMPLAINT",ASSIGN_COMPLAINT:"ASSIGN_COMPLAINT",UPDATE_COMPLAINT_STATUS:"UPDATE_COMPLAINT_STATUS",SEND_MESSAGE:"SEND_MESSAGE",DELETE_MESSAGE:"DELETE_MESSAGE",LOGIN:"LOGIN",LOGOUT:"LOGOUT",FAILED_LOGIN:"FAILED_LOGIN",CREATE_ZONE:"CREATE_ZONE",UPDATE_ZONE:"UPDATE_ZONE",DELETE_ZONE:"DELETE_ZONE",CREATE_WARD:"CREATE_WARD",UPDATE_WARD:"UPDATE_WARD",DELETE_WARD:"DELETE_WARD",EXPORT_DATA:"EXPORT_DATA"},De={USER:"USER",COMPLAINT:"COMPLAINT",MESSAGE:"MESSAGE",ZONE:"ZONE",WARD:"WARD",CITY_CORPORATION:"CITY_CORPORATION"};function k(t){return{CREATE_USER:"Created User",UPDATE_USER:"Updated User",DELETE_USER:"Deleted User",UPDATE_USER_STATUS:"Updated User Status",UPDATE_USER_PERMISSIONS:"Updated User Permissions",CREATE_COMPLAINT:"Created Complaint",UPDATE_COMPLAINT:"Updated Complaint",DELETE_COMPLAINT:"Deleted Complaint",ASSIGN_COMPLAINT:"Assigned Complaint",UPDATE_COMPLAINT_STATUS:"Updated Complaint Status",SEND_MESSAGE:"Sent Message",DELETE_MESSAGE:"Deleted Message",LOGIN:"Logged In",LOGOUT:"Logged Out",FAILED_LOGIN:"Failed Login",CREATE_ZONE:"Created Zone",UPDATE_ZONE:"Updated Zone",DELETE_ZONE:"Deleted Zone",CREATE_WARD:"Created Ward",UPDATE_WARD:"Updated Ward",DELETE_WARD:"Deleted Ward",EXPORT_DATA:"Exported Data"}[t]||t}function Re(t){return t.startsWith("CREATE")?"success":t.startsWith("UPDATE")?"info":t.startsWith("DELETE")?"error":t==="LOGIN"?"success":t==="LOGOUT"?"grey":t==="FAILED_LOGIN"?"error":"grey"}const b=c.createContext({});function be(t){return y("MuiTimeline",t)}f("MuiTimeline",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function j(t){return t==="alternate-reverse"?"positionAlternateReverse":`position${F(t)}`}const Ie=t=>{const{position:s,classes:o}=t,i={root:["root",s&&j(s)]};return g(i,be,o)},Le=C("ul",{name:"MuiTimeline",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,o.position&&s[j(o.position)]]}})({display:"flex",flexDirection:"column",padding:"6px 16px",flexGrow:1}),Oe=c.forwardRef(function(s,o){const i=v({props:s,name:"MuiTimeline"}),{position:l="right",className:n,...p}=i,u={...i,position:l},a=Ie(u),E=c.useMemo(()=>({position:l}),[l]);return e.jsx(b.Provider,{value:E,children:e.jsx(Le,{className:A(a.root,n),ownerState:u,ref:o,...p})})});function Ue(t){return y("MuiTimelineConnector",t)}f("MuiTimelineConnector",["root"]);const Me=t=>{const{classes:s}=t;return g({root:["root"]},Ue,s)},Ne=C("span",{name:"MuiTimelineConnector",slot:"Root"})(({theme:t})=>({width:2,backgroundColor:(t.vars||t).palette.grey[400],flexGrow:1})),Pe=c.forwardRef(function(s,o){const i=v({props:s,name:"MuiTimelineConnector"}),{className:l,...n}=i,p=i,u=Me(p);return e.jsx(Ne,{className:A(u.root,l),ownerState:p,ref:o,...n})});function _e(t){return y("MuiTimelineContent",t)}const we=f("MuiTimelineContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),Ge=t=>{const{position:s,classes:o}=t,i={root:["root",j(s)]};return g(i,_e,o)},We=C(r,{name:"MuiTimelineContent",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,s[j(o.position)]]}})(({ownerState:t})=>({flex:1,padding:"6px 16px",textAlign:"left",...t.position==="left"&&{textAlign:"right"}})),Fe=c.forwardRef(function(s,o){const i=v({props:s,name:"MuiTimelineContent"}),{className:l,...n}=i,{position:p}=c.useContext(b),u={...i,position:p||"right"},a=Ge(u);return e.jsx(We,{component:"div",className:A(a.root,l),ownerState:u,ref:o,...n})});function ke(t){return y("MuiTimelineDot",t)}f("MuiTimelineDot",["root","filled","outlined","filledGrey","outlinedGrey","filledPrimary","outlinedPrimary","filledSecondary","outlinedSecondary"]);const $e=t=>{const{color:s,variant:o,classes:i}=t,l={root:["root",o,s!=="inherit"&&`${o}${F(s)}`]};return g(l,ke,i)},Ze=C("span",{name:"MuiTimelineDot",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,s[o.color!=="inherit"&&`${o.variant}${F(o.color)}`],s[o.variant]]}})(({ownerState:t,theme:s})=>({display:"flex",alignSelf:"baseline",borderStyle:"solid",borderWidth:2,padding:4,borderRadius:"50%",boxShadow:(s.vars||s).shadows[1],margin:"11.5px 0",...t.variant==="filled"&&{borderColor:"transparent",...t.color!=="inherit"&&{...t.color==="grey"?{color:(s.vars||s).palette.grey[50],backgroundColor:(s.vars||s).palette.grey[400]}:{color:(s.vars||s).palette[t.color].contrastText,backgroundColor:(s.vars||s).palette[t.color].main}}},...t.variant==="outlined"&&{boxShadow:"none",backgroundColor:"transparent",...t.color!=="inherit"&&{...t.color==="grey"?{borderColor:(s.vars||s).palette.grey[400]}:{borderColor:(s.vars||s).palette[t.color].main}}}})),Be=c.forwardRef(function(s,o){const i=v({props:s,name:"MuiTimelineDot"}),{className:l,color:n="grey",variant:p="filled",...u}=i,a={...i,color:n,variant:p},E=$e(a);return e.jsx(Ze,{className:A(E.root,l),ownerState:a,ref:o,...u})});function Ve(t){return y("MuiTimelineOppositeContent",t)}const ze=f("MuiTimelineOppositeContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),He=t=>{const{position:s,classes:o}=t,i={root:["root",j(s)]};return g(i,Ve,o)},Xe=C(r,{name:"MuiTimelineOppositeContent",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,s[j(o.position)]]}})(({ownerState:t})=>({padding:"6px 16px",marginRight:"auto",textAlign:"right",flex:1,...t.position==="left"&&{textAlign:"left"}})),Q=c.forwardRef(function(s,o){const i=v({props:s,name:"MuiTimelineOppositeContent"}),{className:l,...n}=i,{position:p}=c.useContext(b),u={...i,position:p||"left"},a=He(u);return e.jsx(Xe,{component:"div",className:A(a.root,l),ownerState:u,ref:o,...n})});Q.muiName="TimelineOppositeContent";function Je(t){return y("MuiTimelineItem",t)}f("MuiTimelineItem",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse","missingOppositeContent"]);const Ye=t=>{const{position:s,classes:o,hasOppositeContent:i}=t,l={root:["root",j(s),!i&&"missingOppositeContent"]};return g(l,Je,o)},Ke=C("li",{name:"MuiTimelineItem",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,s[j(o.position)]]}})(({ownerState:t})=>({listStyle:"none",display:"flex",position:"relative",minHeight:70,...t.position==="left"&&{flexDirection:"row-reverse"},...(t.position==="alternate"||t.position==="alternate-reverse")&&{[`&:nth-of-type(${t.position==="alternate"?"even":"odd"})`]:{flexDirection:"row-reverse",[`& .${we.root}`]:{textAlign:"right"},[`& .${ze.root}`]:{textAlign:"left"}}},...!t.hasOppositeContent&&{"&::before":{content:'""',flex:1,padding:"6px 16px"}}})),qe=c.forwardRef(function(s,o){const i=v({props:s,name:"MuiTimelineItem"}),{position:l,className:n,...p}=i,{position:u}=c.useContext(b);let a=!1;c.Children.forEach(i.children,N=>{ae(N,["TimelineOppositeContent"])&&(a=!0)});const E={...i,position:l||u||"right",hasOppositeContent:a},U=Ye(E),M=c.useMemo(()=>({position:E.position}),[E.position]);return e.jsx(b.Provider,{value:M,children:e.jsx(Ke,{className:A(U.root,n),ownerState:E,ref:o,...p})})});function Qe(t){return y("MuiTimelineSeparator",t)}f("MuiTimelineSeparator",["root"]);const et=t=>{const{classes:s}=t;return g({root:["root"]},Qe,s)},tt=C("div",{name:"MuiTimelineSeparator",slot:"Root"})({display:"flex",flexDirection:"column",flex:0,alignItems:"center"}),st=c.forwardRef(function(s,o){const i=v({props:s,name:"MuiTimelineSeparator"}),{className:l,...n}=i,p=i,u=et(p);return e.jsx(tt,{className:A(u.root,l),ownerState:p,ref:o,...n})}),nt=({logs:t,onLogClick:s})=>{const o=n=>n.startsWith("CREATE")?e.jsx(fe,{}):n.startsWith("UPDATE")?e.jsx(de,{}):n.startsWith("DELETE")?e.jsx(Ce,{}):n==="LOGIN"?e.jsx(xe,{}):n==="LOGOUT"?e.jsx(pe,{}):e.jsx(Ae,{}),i=n=>q(new Date(n),"MMM dd, yyyy HH:mm:ss"),l=n=>{const p=new Date,u=new Date(n),a=Math.floor((p.getTime()-u.getTime())/1e3);return a<60?`${a}s ago`:a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:`${Math.floor(a/86400)}d ago`};return e.jsx(Oe,{position:"right",children:t.map((n,p)=>e.jsxs(qe,{children:[e.jsxs(Q,{sx:{m:"auto 0",minWidth:150},align:"right",variant:"body2",color:"text.secondary",children:[e.jsx(r,{variant:"caption",display:"block",children:l(n.timestamp)}),e.jsx(r,{variant:"caption",display:"block",color:"text.disabled",children:i(n.timestamp)})]}),e.jsxs(st,{children:[e.jsx(Be,{color:Re(n.action),children:o(n.action)}),p<t.length-1&&e.jsx(Pe,{})]}),e.jsx(Fe,{sx:{py:"12px",px:2},children:e.jsxs(R,{elevation:1,sx:{p:2,cursor:"pointer","&:hover":{elevation:3,backgroundColor:"action.hover"}},onClick:()=>s(n),children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsxs(x,{children:[e.jsx(r,{variant:"h6",component:"span",children:k(n.action)}),e.jsx(w,{label:n.entityType,size:"small",sx:{ml:1}})]}),e.jsx(G,{title:"View Details",children:e.jsx("span",{children:e.jsx(W,{size:"small",children:e.jsx(ce,{fontSize:"small"})})})})]}),n.user&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["By: ",n.user.firstName," ",n.user.lastName,n.user.email&&` (${n.user.email})`]}),n.entityId&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Entity ID: ",n.entityId]}),n.ipAddress&&e.jsxs(r,{variant:"caption",color:"text.disabled",display:"block",sx:{mt:1},children:["IP: ",n.ipAddress]})]})})]},n.id))})},ot=({log:t,open:s,onClose:o})=>{if(!t)return null;const i=n=>q(new Date(n),"MMMM dd, yyyy HH:mm:ss"),l=n=>n==null?e.jsx(r,{color:"text.disabled",children:"N/A"}):typeof n=="object"?e.jsx(R,{variant:"outlined",sx:{p:2,backgroundColor:"grey.50"},children:e.jsx("pre",{style:{margin:0,fontSize:"0.875rem",overflow:"auto"},children:JSON.stringify(n,null,2)})}):e.jsx(r,{children:String(n)});return e.jsxs(ue,{open:s,onClose:o,maxWidth:"md",fullWidth:!0,children:[e.jsx(me,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"h6",children:"Activity Log Details"}),e.jsx(w,{label:t.action,size:"small"})]})}),e.jsx(he,{dividers:!0,children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Basic Information"}),e.jsxs(x,{sx:{pl:2},children:[e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Action:"}),e.jsx(r,{variant:"body1",children:k(t.action)})]}),e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Entity Type:"}),e.jsx(r,{variant:"body1",children:t.entityType})]}),t.entityId&&e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Entity ID:"}),e.jsx(r,{variant:"body1",children:t.entityId})]}),e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Timestamp:"}),e.jsx(r,{variant:"body1",children:i(t.timestamp)})]})]})]}),e.jsx(m,{item:!0,xs:12,children:e.jsx(L,{})}),t.user&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Performed By"}),e.jsxs(x,{sx:{pl:2},children:[e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Name:"}),e.jsxs(r,{variant:"body1",children:[t.user.firstName," ",t.user.lastName]})]}),t.user.email&&e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Email:"}),e.jsx(r,{variant:"body1",children:t.user.email})]}),e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Role:"}),e.jsx(w,{label:t.user.role,size:"small"})]})]})]}),e.jsx(m,{item:!0,xs:12,children:e.jsx(L,{})})]}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Technical Information"}),e.jsxs(x,{sx:{pl:2},children:[t.ipAddress&&e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"IP Address:"}),e.jsx(r,{variant:"body1",children:t.ipAddress})]}),t.userAgent&&e.jsxs(x,{sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"User Agent:"}),e.jsx(r,{variant:"body1",sx:{wordBreak:"break-word"},children:t.userAgent})]})]})]}),t.oldValue&&e.jsxs(e.Fragment,{children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(L,{})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Old Value"}),e.jsx(x,{sx:{pl:2},children:l(t.oldValue)})]})]}),t.newValue&&e.jsxs(e.Fragment,{children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(L,{})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"New Value"}),e.jsx(x,{sx:{pl:2},children:l(t.newValue)})]})]})]})}),e.jsx(Te,{children:e.jsx(D,{onClick:o,children:"Close"})})]})},Et=()=>{const[t,s]=c.useState([]),[o,i]=c.useState(!1),[l,n]=c.useState(null),[p,u]=c.useState(!1),[a,E]=c.useState(1),[U]=c.useState(50),[M,N]=c.useState(0),[$,ee]=c.useState(0),[S,Z]=c.useState({page:1,limit:50}),[B,te]=c.useState(!1),[se,V]=c.useState(null),[ne,z]=c.useState(!1),P=async()=>{var d,h;try{i(!0),n(null);const T=await _.getActivityLogs({...S,page:a,limit:U});s(T.logs),N(T.pagination.total),ee(T.pagination.totalPages)}catch(T){console.error("Error fetching activity logs:",T),n(((h=(d=T.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to fetch activity logs")}finally{i(!1)}},oe=async()=>{var d,h;try{u(!0);const T=await _.exportActivityLogs(S);_.downloadActivityLogs(T)}catch(T){console.error("Error exporting activity logs:",T),n(((h=(d=T.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to export activity logs")}finally{u(!1)}},I=(d,h)=>{Z(T=>({...T,[d]:h}))},ie=()=>{E(1),P()},re=()=>{Z({page:1,limit:50}),E(1)},le=d=>{V(d),z(!0)},H=d=>{E(d)};return c.useEffect(()=>{P()},[a]),e.jsxs(x,{sx:{p:3},children:[e.jsxs(x,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"h4",component:"h1",children:"Activity Logs"}),e.jsxs(x,{sx:{display:"flex",gap:1},children:[e.jsx(G,{title:"Refresh",children:e.jsx(W,{onClick:P,disabled:o,children:e.jsx(Ee,{})})}),e.jsx(G,{title:"Toggle Filters",children:e.jsx(W,{onClick:()=>te(!B),children:e.jsx(ge,{})})}),e.jsx(D,{variant:"contained",startIcon:e.jsx(ve,{}),onClick:oe,disabled:p||o,children:p?"Exporting...":"Export CSV"})]})]}),l&&e.jsx(je,{severity:"error",sx:{mb:2},onClose:()=>n(null),children:l}),B&&e.jsxs(R,{sx:{p:2,mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Filters"}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(J,{children:"Action"}),e.jsxs(Y,{value:S.action||"",onChange:d=>I("action",d.target.value||void 0),label:"Action",children:[e.jsx(O,{value:"",children:"All Actions"}),Object.entries(Se).map(([d,h])=>e.jsx(O,{value:h,children:k(h)},d))]})]})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(J,{children:"Entity Type"}),e.jsxs(Y,{value:S.entityType||"",onChange:d=>I("entityType",d.target.value||void 0),label:"Entity Type",children:[e.jsx(O,{value:"",children:"All Types"}),Object.entries(De).map(([d,h])=>e.jsx(O,{value:h,children:h},d))]})]})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(K,{fullWidth:!0,label:"Start Date",type:"date",value:S.startDate||"",onChange:d=>I("startDate",d.target.value||void 0),InputLabelProps:{shrink:!0}})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(K,{fullWidth:!0,label:"End Date",type:"date",value:S.endDate||"",onChange:d=>I("endDate",d.target.value||void 0),InputLabelProps:{shrink:!0}})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(x,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(D,{onClick:re,children:"Clear Filters"}),e.jsx(D,{variant:"contained",onClick:ie,children:"Apply Filters"})]})})]})]}),e.jsx(R,{sx:{p:2,mb:3},children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Showing ",t.length," of ",M," activity logs"]})}),o?e.jsx(x,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(ye,{})}):t.length===0?e.jsx(R,{sx:{p:4,textAlign:"center"},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:"No activity logs found"})}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{logs:t,onLogClick:le}),e.jsxs(x,{sx:{mt:3,display:"flex",justifyContent:"center",gap:1},children:[e.jsx(D,{disabled:a===1,onClick:()=>H(a-1),children:"Previous"}),e.jsxs(r,{sx:{px:2,py:1},children:["Page ",a," of ",$]}),e.jsx(D,{disabled:a===$,onClick:()=>H(a+1),children:"Next"})]})]}),e.jsx(ot,{log:se,open:ne,onClose:()=>{z(!1),V(null)}})]})};export{Et as default};
