var yt=Object.defineProperty;var bt=(s,f,C)=>f in s?yt(s,f,{enumerable:!0,configurable:!0,writable:!0,value:C}):s[f]=C;var $e=(s,f,C)=>bt(s,typeof f!="symbol"?f+"":f,C);import{e as De,j as e,F as r,T as i,P,D as we,y as vt,z as te,A as He,C as Ge,E as Se,I as ce,H as Ee,J as Ie,G as Ne,ai as de,az as ke,X as wt,ay as Ke,Z as qe,ax as _e,av as St,au as Qe,aA as It,aB as Wt,aC as zt,aD as Nt,al as Pe,aw as Ye,aE as At,r as o,a1 as Ue,aF as Xe,L as ye,N as z,W as j,O as ue,aG as Ae,aH as be,K as ve,R as Et,S as Pt,l as kt,v as Tt,M as Lt,Q as Dt,aI as Ut,aJ as Ft,a4 as Mt,ap as Ve,aq as Ze,an as K,ab as Rt,U as Te,a9 as Le,V as ze,aa as Ot,ac as $t,a7 as qt,ad as Vt,ae as Zt,af as Ce,ag as g,aK as Be,ah as Bt}from"./index-DlgNj6PR.js";import{f as Jt}from"./format-CEK1tlAi.js";import{w as Fe}from"./wardService-DVNqzDgF.js";import{S as Ht}from"./Save-CV9Wxu5f.js";import{P as Gt}from"./Person-b8_9sEqB.js";import{S as Kt}from"./Send-DdDqbu_h.js";import{u as pe}from"./userManagementService-CMvBwgtZ.js";import{F as _t}from"./FilterList-BGcVVVlC.js";import{S as Qt}from"./SearchOff-C45S3qTz.js";import{C as Yt}from"./ChatBubbleOutline-CmHiqucm.js";import{S as Xt}from"./Snackbar-BR8h77I1.js";const es=De(e.jsx("path",{d:"M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2m0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19z"})),et=De(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),ts=De(e.jsx("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76zm1.19 4.02L2.81 2.81 1.39 4.22l8.89 8.89c-1.81.23-3.39.79-4.67 1.45-1 .51-1.61 1.54-1.61 2.66V20h13.17l2.61 2.61z"})),ss=({icon:s,title:f,description:C,action:n})=>e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,px:3,textAlign:"center"},children:[e.jsx(r,{sx:{width:80,height:80,borderRadius:"50%",backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",mb:3},children:s||e.jsx(es,{sx:{fontSize:40,color:"#9e9e9e"}})}),e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:1},children:f}),C&&e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3,maxWidth:400},children:C}),n&&e.jsx(P,{variant:"contained",onClick:n.onClick,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3},children:n.label})]}),rs=({user:s,recentComplaints:f,open:C,onClose:n,onEdit:a})=>{var M,E,L,b;if(!s)return null;const h=y=>{switch(y){case"ACTIVE":return{backgroundColor:"#e8f5e8",color:"#2e7d2e"};case"INACTIVE":return{backgroundColor:"#f5f5f5",color:"#666666"};case"SUSPENDED":return{backgroundColor:"#ffebee",color:"#c62828"};case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},S=y=>{switch(y){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724"};case"REJECTED":return{backgroundColor:"#ffebee",color:"#c62828"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},u=y=>{if(!y)return"Never";try{return Jt(new Date(y),"MMM dd, yyyy hh:mm a")}catch{return"Invalid date"}},A=s.statistics.totalComplaints>0?Math.round(s.statistics.resolvedComplaints/s.statistics.totalComplaints*100):0;return e.jsxs(we,{open:C,onClose:n,maxWidth:"md",fullWidth:!0,fullScreen:window.innerWidth<600,slotProps:{paper:{sx:{borderRadius:{xs:0,sm:2},animation:window.innerWidth<600?`${He} ${te.normal.duration} ${te.smooth.timing}`:`${Ge} ${te.normal.duration} ${te.smooth.timing}`,animationFillMode:"both",maxHeight:{xs:"100vh",sm:"90vh"}}},backdrop:{sx:{animation:`${vt} ${te.fast.duration} ${te.fast.timing}`}}},children:[e.jsx(Se,{sx:{pb:{xs:1.5,sm:2}},children:e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600,fontSize:{xs:"1.25rem",sm:"1.5rem"}},children:"User Details"}),e.jsx(ce,{onClick:n,size:"small",children:e.jsx(Ee,{})})]})}),e.jsxs(Ie,{dividers:!0,sx:{px:{xs:2,sm:3},py:{xs:2,sm:2}},children:[e.jsxs(r,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center",sm:"center"},gap:{xs:2,sm:3},mb:2},children:[e.jsxs(Ne,{sx:{width:{xs:64,sm:80},height:{xs:64,sm:80},bgcolor:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2rem"},fontWeight:600},src:s.avatar||void 0,children:[s.firstName[0],s.lastName[0]]}),e.jsxs(r,{sx:{flex:1,textAlign:{xs:"center",sm:"left"},width:{xs:"100%",sm:"auto"}},children:[e.jsxs(i,{variant:"h6",sx:{fontWeight:600,mb:.5,fontSize:{xs:"1rem",sm:"1.25rem"}},children:[s.firstName," ",s.lastName]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{mb:1,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["User ID: #",s.id.toString().padStart(6,"0")]}),e.jsxs(r,{sx:{display:"flex",gap:1,justifyContent:{xs:"center",sm:"flex-start"},flexWrap:"wrap"},children:[e.jsx(de,{label:s.status,size:"small",sx:{...h(s.status),...ke,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}}),e.jsx(de,{label:s.role,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",...ke,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}})]})]})]}),e.jsx(wt,{sx:{my:{xs:1.5,sm:2}}}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(r,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(Ke,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(r,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Email"}),e.jsx(i,{variant:"body2",sx:{wordBreak:"break-word",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.email||"Not provided"})]}),s.emailVerified&&e.jsx(qe,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(r,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(_e,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Phone"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.phone})]}),s.phoneVerified&&e.jsx(qe,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(r,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(St,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20},mt:.5}}),e.jsxs(r,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Location"}),s.cityCorporation&&e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:500},children:s.cityCorporation.name}),s.thana&&e.jsxs(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Thana: ",s.thana.name]}),e.jsxs(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Ward ",((M=s.ward)==null?void 0:M.wardNumber)??"N/A"," • Zone ",((E=s.zone)==null?void 0:E.zoneNumber)??"N/A"]}),((L=s.ward)==null?void 0:L.inspectorName)&&e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Inspector: ",s.ward.inspectorName," ",s.ward.inspectorPhone?`(${s.ward.inspectorPhone})`:""]}),((b=s.zone)==null?void 0:b.officerName)&&e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Zonal Officer: ",s.zone.officerName," ",s.zone.officerPhone?`(${s.zone.officerPhone})`:""]}),s.address&&e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.8rem"},mt:.5,wordBreak:"break-word"},children:s.address})]})]})}),e.jsx(r,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(Qe,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(r,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Joined"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:u(s.createdAt)})]})]})})]})]}),e.jsxs(r,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Activity Statistics"}),e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(r,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#2196F3",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.totalComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Total Complaints"})]})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(r,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.resolvedComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Resolved"})]})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(r,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#FF9800",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.unresolvedComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Unresolved"})]})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(r,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsxs(i,{variant:"h4",sx:{fontWeight:700,color:"#9C27B0",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:[A,"%"]}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Success Rate"})]})})]}),e.jsx(r,{sx:{mt:{xs:1.5,sm:2}},children:e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Last Login: ",u(s.lastLoginAt)]})})]}),e.jsxs(r,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Recent Complaints"}),f.length>0?e.jsx(It,{sx:{p:0},children:f.map(y=>e.jsx(Wt.Fragment,{children:e.jsx(zt,{sx:{px:{xs:1.5,sm:2},py:{xs:1,sm:1.5},backgroundColor:"#f8f9fa",borderRadius:1,mb:1},children:e.jsx(Nt,{primary:e.jsxs(r,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},gap:{xs:.5,sm:1}},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:y.title}),e.jsx(de,{label:y.status.replace("_"," "),size:"small",sx:{...S(y.status),...ke,height:{xs:18,sm:20},fontSize:{xs:"0.65rem",sm:"0.7rem"}}})]}),secondary:e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:u(y.createdAt)})})})},y.id))}):e.jsx(i,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:{xs:2,sm:3},fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"No complaints yet"})]})]}),e.jsxs(Pe,{sx:{px:{xs:2,sm:3},py:{xs:1.5,sm:2},flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[e.jsx(P,{onClick:n,variant:"outlined",sx:{textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Close"}),e.jsx(P,{onClick:a,variant:"contained",startIcon:e.jsx(Ye,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Edit User"})]})]})},as=({open:s,title:f,message:C,confirmText:n="Confirm",cancelText:a="Cancel",onConfirm:h,onCancel:S,severity:u="warning"})=>{const A=()=>{switch(u){case"error":return"#d32f2f";case"warning":return"#ed6c02";case"info":return"#0288d1";default:return"#ed6c02"}};return e.jsxs(we,{open:s,onClose:S,maxWidth:"xs",fullWidth:!0,children:[e.jsx(Se,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(r,{sx:{width:40,height:40,borderRadius:"50%",backgroundColor:`${A()}20`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(At,{sx:{color:A()}})}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:f})]})}),e.jsx(Ie,{children:e.jsx(i,{variant:"body1",color:"text.secondary",children:C})}),e.jsxs(Pe,{sx:{px:3,pb:2},children:[e.jsx(P,{onClick:S,sx:{textTransform:"none",color:"text.secondary"},children:a}),e.jsx(P,{onClick:h,variant:"contained",sx:{textTransform:"none",backgroundColor:A(),"&:hover":{backgroundColor:A(),opacity:.9}},children:n})]})]})},os=({user:s,open:f,onClose:C,onSave:n})=>{const[a,h]=o.useState({firstName:"",lastName:"",email:"",phone:"",cityCorporationCode:"",zoneId:"",wardId:"",status:"ACTIVE",newPassword:"",confirmPassword:""}),[S,u]=o.useState([]),[A,M]=o.useState([]),[E,L]=o.useState([]),[b,y]=o.useState(!1),[se,H]=o.useState(!1),[W,V]=o.useState(!1),[k,J]=o.useState(!1),[q,_]=o.useState(!1),[x,D]=o.useState({}),[w,G]=o.useState(!1),[I,re]=o.useState(null),[ae,ne]=o.useState(!1);o.useEffect(()=>{ie()},[]),o.useEffect(()=>{a.cityCorporationCode?Q(a.cityCorporationCode):(M([]),L([]),h(d=>({...d,zoneId:"",wardId:""})))},[a.cityCorporationCode]),o.useEffect(()=>{a.zoneId?he(parseInt(a.zoneId)):(L([]),h(d=>({...d,wardId:""})))},[a.zoneId]);const ie=async()=>{try{y(!0);const d=await Ue.getCityCorporations("ACTIVE");u(d.cityCorporations||[])}catch(d){console.error("Error fetching city corporations:",d),u([])}finally{y(!1)}},Q=async d=>{try{H(!0);const N=await Xe.getZones({cityCorporationCode:d,status:"ACTIVE"});M(N.zones||[])}catch(N){console.error("Error fetching zones:",N),M([])}finally{H(!1)}},he=async d=>{try{V(!0);const N=await Fe.getWards({zoneId:d,status:"ACTIVE"});L(N.wards||[])}catch(N){console.error("Error fetching wards:",N),L([])}finally{V(!1)}};o.useEffect(()=>{var d,N,oe,v,X,O,le;s&&(h({firstName:s.firstName,lastName:s.lastName,email:s.email||"",phone:s.phone,cityCorporationCode:((d=s.cityCorporation)==null?void 0:d.code)||"",zoneId:((oe=(N=s.zone)==null?void 0:N.id)==null?void 0:oe.toString())||"",wardId:((X=(v=s.ward)==null?void 0:v.id)==null?void 0:X.toString())||"",status:s.status,newPassword:"",confirmPassword:""}),D({}),re(null),(O=s.cityCorporation)!=null&&O.code&&Q(s.cityCorporation.code),(le=s.zone)!=null&&le.id&&he(s.zone.id))},[s]);const me=d=>d?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d):!0,Z=d=>/^01[0-9]{9}$/.test(d.replace(/\s+/g,"")),xe=()=>{const d={};return a.firstName.trim()||(d.firstName="First name is required"),a.lastName.trim()||(d.lastName="Last name is required"),a.phone.trim()?Z(a.phone)||(d.phone="Invalid phone format (must be 11 digits starting with 01)"):d.phone="Phone number is required",a.email&&!me(a.email)&&(d.email="Invalid email format"),a.cityCorporationCode||(d.cityCorporationCode="City Corporation is required"),a.zoneId||(d.zoneId="Zone is required"),a.wardId||(d.wardId="Ward is required"),(a.newPassword||a.confirmPassword)&&(a.newPassword.length<8&&(d.newPassword="Password must be at least 8 characters"),a.newPassword!==a.confirmPassword&&(d.confirmPassword="Passwords do not match")),D(d),Object.keys(d).length===0},R=d=>N=>{const oe=N.target.value;h(v=>({...v,[d]:oe})),x[d]&&D(v=>({...v,[d]:void 0})),I&&re(null)},l=async(d=!1)=>{var v,X,O,le,m,B,fe,ge;if(!xe())return;const N=a.status!==(s==null?void 0:s.status),oe=a.status==="SUSPENDED"||a.status==="INACTIVE";if(N&&oe&&!d){ne(!0);return}G(!0),re(null);try{const F={};a.firstName!==(s==null?void 0:s.firstName)&&(F.firstName=a.firstName),a.lastName!==(s==null?void 0:s.lastName)&&(F.lastName=a.lastName),a.email!==((s==null?void 0:s.email)||"")&&(F.email=a.email||void 0),a.phone!==(s==null?void 0:s.phone)&&(F.phone=a.phone),a.cityCorporationCode!==((v=s==null?void 0:s.cityCorporation)==null?void 0:v.code)&&(F.cityCorporationCode=a.cityCorporationCode),a.zoneId!==((O=(X=s==null?void 0:s.zone)==null?void 0:X.id)==null?void 0:O.toString())&&(F.zoneId=parseInt(a.zoneId)),a.wardId!==((m=(le=s==null?void 0:s.ward)==null?void 0:le.id)==null?void 0:m.toString())&&(F.wardId=parseInt(a.wardId)),a.status!==(s==null?void 0:s.status)&&(F.status=a.status),a.newPassword&&(F.password=a.newPassword),await n(F),C()}catch(F){console.error("Error updating user:",F),re(((ge=(fe=(B=F.response)==null?void 0:B.data)==null?void 0:fe.error)==null?void 0:ge.message)||F.message||"Failed to update user. Please try again.")}finally{G(!1)}},U=()=>{ne(!1),l(!0)},Y=()=>{ne(!1)},T=()=>{w||C()};return s?e.jsxs(we,{open:f,onClose:T,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(Se,{sx:{pb:2},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Edit User"}),e.jsx(ce,{onClick:T,size:"small",disabled:w,children:e.jsx(Ee,{})})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Update user information and account settings"})]}),e.jsxs(Ie,{dividers:!0,children:[I&&e.jsx(ye,{severity:"error",sx:{mb:3},onClose:()=>re(null),children:I}),e.jsxs(r,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"First Name",value:a.firstName,onChange:R("firstName"),error:!!x.firstName,helperText:x.firstName,disabled:w,required:!0})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Last Name",value:a.lastName,onChange:R("lastName"),error:!!x.lastName,helperText:x.lastName,disabled:w,required:!0})})]}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Email",type:"email",value:a.email,onChange:R("email"),error:!!x.email,helperText:x.email,disabled:w})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Phone",value:a.phone,onChange:R("phone"),error:!!x.phone,helperText:x.phone,disabled:w,required:!0})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(z,{fullWidth:!0,select:!0,label:"City Corporation",value:a.cityCorporationCode,onChange:R("cityCorporationCode"),disabled:w||b,error:!!x.cityCorporationCode,helperText:x.cityCorporationCode,required:!0,children:[e.jsx(j,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),S.map(d=>e.jsx(j,{value:d.code,children:d.name},d.code))]})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(z,{fullWidth:!0,select:!0,label:"Zone",value:a.zoneId,onChange:R("zoneId"),disabled:w||se||!a.cityCorporationCode,error:!!x.zoneId,helperText:x.zoneId||(a.cityCorporationCode?se?"Loading zones...":A.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(j,{value:"",children:e.jsx("em",{children:"Select Zone"})}),A.map(d=>e.jsx(j,{value:d.id.toString(),children:d.name||`Zone ${d.zoneNumber}`},d.id))]})})]}),e.jsx(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(z,{fullWidth:!0,select:!0,label:"Ward",value:a.wardId,onChange:R("wardId"),disabled:w||W||!a.zoneId,error:!!x.wardId,helperText:x.wardId||(a.zoneId?W?"Loading wards...":E.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(j,{value:"",children:e.jsx("em",{children:"Select Ward"})}),E.map(d=>e.jsxs(j,{value:d.id.toString(),children:["Ward ",typeof d.wardNumber=="object"?JSON.stringify(d.wardNumber):d.wardNumber]},d.id))]})})}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Change Password (Optional)"}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"New Password",type:k?"text":"password",value:a.newPassword,onChange:R("newPassword"),error:!!x.newPassword,helperText:x.newPassword||"Leave blank to keep current password",disabled:w,slotProps:{input:{endAdornment:e.jsx(ue,{position:"end",children:e.jsx(ce,{onClick:()=>J(!k),edge:"end",size:"small",children:k?e.jsx(Ae,{}):e.jsx(be,{})})})}}})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Confirm New Password",type:q?"text":"password",value:a.confirmPassword,onChange:R("confirmPassword"),error:!!x.confirmPassword,helperText:x.confirmPassword,disabled:w,slotProps:{input:{endAdornment:e.jsx(ue,{position:"end",children:e.jsx(ce,{onClick:()=>_(!q),edge:"end",size:"small",children:q?e.jsx(Ae,{}):e.jsx(be,{})})})}}})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Settings"}),e.jsx(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(z,{fullWidth:!0,select:!0,label:"Status",value:a.status,onChange:R("status"),disabled:w,children:[e.jsx(j,{value:"ACTIVE",children:"Active"}),e.jsx(j,{value:"INACTIVE",children:"Inactive"}),e.jsx(j,{value:"SUSPENDED",children:"Suspended"}),e.jsx(j,{value:"PENDING",children:"Pending"})]})})})]})]}),e.jsxs(Pe,{sx:{px:3,py:2},children:[e.jsx(P,{onClick:T,variant:"outlined",disabled:w,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(P,{onClick:()=>l(),variant:"contained",disabled:w,startIcon:w?e.jsx(ve,{size:20}):e.jsx(Ht,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:w?"Saving...":"Save Changes"})]}),e.jsx(as,{open:ae,title:a.status==="SUSPENDED"?"Suspend User":"Deactivate User",message:a.status==="SUSPENDED"?`Are you sure you want to suspend ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}? This will immediately block their access to the system.`:`Are you sure you want to deactivate ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}? They will not be able to access the system.`,confirmText:"Confirm",cancelText:"Cancel",severity:"warning",onConfirm:U,onCancel:Y})]}):null},ns=({open:s,onClose:f,onSave:C})=>{const[n,a]=o.useState({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),[h,S]=o.useState({}),[u,A]=o.useState(!1),[M,E]=o.useState(null),[L,b]=o.useState(!1),[y,se]=o.useState(!1),[H,W]=o.useState([]),[V,k]=o.useState([]),[J,q]=o.useState([]),[_,x]=o.useState(!1),[D,w]=o.useState(!1),[G,I]=o.useState(!1);o.useEffect(()=>{re()},[]),o.useEffect(()=>{n.cityCorporationCode?ae(n.cityCorporationCode):(k([]),q([]),a(l=>({...l,zoneId:"",wardId:""})))},[n.cityCorporationCode]),o.useEffect(()=>{n.zoneId?ne(parseInt(n.zoneId)):(q([]),a(l=>({...l,wardId:""})))},[n.zoneId]);const re=async()=>{try{x(!0);const l=await Ue.getCityCorporations("ACTIVE");W(l.cityCorporations||[])}catch(l){console.error("Error fetching city corporations:",l),W([]),E("Failed to load city corporations. Please try again.")}finally{x(!1)}},ae=async l=>{try{w(!0);const U=await Xe.getZones({cityCorporationCode:l,status:"ACTIVE"});k(U.zones||[])}catch(U){console.error("Error fetching zones:",U),k([])}finally{w(!1)}},ne=async l=>{try{I(!0);const U=await Fe.getWards({zoneId:l,status:"ACTIVE"});q(U.wards||[])}catch(U){console.error("Error fetching wards:",U),q([])}finally{I(!1)}},ie=l=>l?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l):!0,Q=l=>/^01[0-9]{9}$/.test(l.replace(/\s+/g,"")),he=l=>l.length>=8,me=()=>{const l={};return n.firstName.trim()||(l.firstName="First name is required"),n.lastName.trim()||(l.lastName="Last name is required"),n.phone.trim()?Q(n.phone)||(l.phone="Invalid phone format (must be 11 digits starting with 01)"):l.phone="Phone number is required",n.password?he(n.password)||(l.password="Password must be at least 8 characters"):l.password="Password is required",n.confirmPassword?n.password!==n.confirmPassword&&(l.confirmPassword="Passwords do not match"):l.confirmPassword="Please confirm your password",n.cityCorporationCode||(l.cityCorporationCode="City Corporation is required"),n.zoneId||(l.zoneId="Zone is required"),n.wardId||(l.wardId="Ward is required"),n.email&&!ie(n.email)&&(l.email="Invalid email format"),S(l),Object.keys(l).length===0},Z=l=>U=>{const Y=U.target.value;a(T=>({...T,[l]:Y})),h[l]&&S(T=>({...T,[l]:void 0})),M&&E(null)},xe=async()=>{var l,U,Y;if(me()){A(!0),E(null);try{const T={firstName:n.firstName,lastName:n.lastName,phone:n.phone,password:n.password,role:n.role};n.email&&(T.email=n.email),n.cityCorporationCode&&(T.cityCorporationCode=n.cityCorporationCode),n.zoneId&&(T.zoneId=parseInt(n.zoneId)),n.wardId&&(T.wardId=parseInt(n.wardId)),await C(T),a({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),f()}catch(T){console.error("Error creating user:",T),E(((Y=(U=(l=T.response)==null?void 0:l.data)==null?void 0:U.error)==null?void 0:Y.message)||T.message||"Failed to create user. Please try again.")}finally{A(!1)}}},R=()=>{u||(a({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),S({}),E(null),f())};return e.jsxs(we,{open:s,onClose:R,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(Se,{sx:{pb:2},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Add New User"}),e.jsx(ce,{onClick:R,size:"small",disabled:u,children:e.jsx(Ee,{})})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create a new user account"})]}),e.jsxs(Ie,{dividers:!0,children:[M&&e.jsx(ye,{severity:"error",sx:{mb:3},onClose:()=>E(null),children:M}),e.jsxs(r,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"First Name",value:n.firstName,onChange:Z("firstName"),error:!!h.firstName,helperText:h.firstName,disabled:u,required:!0})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Last Name",value:n.lastName,onChange:Z("lastName"),error:!!h.lastName,helperText:h.lastName,disabled:u,required:!0})})]}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Email",type:"email",value:n.email,onChange:Z("email"),error:!!h.email,helperText:h.email||"Optional",disabled:u})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Phone",value:n.phone,onChange:Z("phone"),error:!!h.phone,helperText:h.phone,disabled:u,required:!0})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Credentials"}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Password",type:L?"text":"password",value:n.password,onChange:Z("password"),error:!!h.password,helperText:h.password||"Minimum 8 characters",disabled:u,required:!0,slotProps:{input:{endAdornment:e.jsx(ue,{position:"end",children:e.jsx(ce,{onClick:()=>b(!L),edge:"end",size:"small",children:L?e.jsx(Ae,{}):e.jsx(be,{})})})}}})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(z,{fullWidth:!0,label:"Confirm Password",type:y?"text":"password",value:n.confirmPassword,onChange:Z("confirmPassword"),error:!!h.confirmPassword,helperText:h.confirmPassword,disabled:u,required:!0,slotProps:{input:{endAdornment:e.jsx(ue,{position:"end",children:e.jsx(ce,{onClick:()=>se(!y),edge:"end",size:"small",children:y?e.jsx(Ae,{}):e.jsx(be,{})})})}}})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(z,{fullWidth:!0,select:!0,label:"City Corporation",value:n.cityCorporationCode,onChange:Z("cityCorporationCode"),disabled:u||_,error:!!h.cityCorporationCode,helperText:h.cityCorporationCode||"Required",required:!0,children:[e.jsx(j,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),H.map(l=>e.jsx(j,{value:l.code,children:l.name},l.code))]})}),e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(z,{fullWidth:!0,select:!0,label:"Zone",value:n.zoneId,onChange:Z("zoneId"),disabled:u||D||!n.cityCorporationCode,error:!!h.zoneId,helperText:h.zoneId||(n.cityCorporationCode?D?"Loading zones...":V.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(j,{value:"",children:e.jsx("em",{children:"Select Zone"})}),V.map(l=>e.jsx(j,{value:l.id.toString(),children:l.name||`Zone ${l.zoneNumber}`},l.id))]})})]}),e.jsx(r,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(r,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(z,{fullWidth:!0,select:!0,label:"Ward",value:n.wardId,onChange:Z("wardId"),disabled:u||G||!n.zoneId,error:!!h.wardId,helperText:h.wardId||(n.zoneId?G?"Loading wards...":J.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(j,{value:"",children:e.jsx("em",{children:"Select Ward"})}),J.map(l=>e.jsxs(j,{value:l.id.toString(),children:["Ward ",typeof l.wardNumber=="object"?JSON.stringify(l.wardNumber):l.wardNumber]},l.id))]})})})]})]}),e.jsxs(Pe,{sx:{px:3,py:2},children:[e.jsx(P,{onClick:R,variant:"outlined",disabled:u,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(P,{onClick:xe,variant:"contained",disabled:u,startIcon:u?e.jsx(ve,{size:20}):e.jsx(et,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:u?"Creating...":"Create User"})]})]})};class is{constructor(){$e(this,"apiClient");this.apiClient=Et.create({baseURL:Pt.BASE_URL,headers:{"Content-Type":"application/json"}}),this.apiClient.interceptors.request.use(f=>{const C=localStorage.getItem("accessToken");return C&&(f.headers.Authorization=`Bearer ${C}`),f})}async getConversation(f,C=1,n=50){try{return(await this.apiClient.get(`/api/admin/direct-chat/${f}`,{params:{page:C,limit:n}})).data.data}catch(a){throw a}}async sendMessage(f,C,n){try{return(await this.apiClient.post(`/api/admin/direct-chat/${f}`,{content:C,fileUrl:n})).data.data}catch(a){throw a}}}const Je=new is,ls=({userId:s,open:f,onClose:C,userName:n="User"})=>{const a=kt(),h=Tt(a.breakpoints.down("sm")),S=o.useRef(null),[u,A]=o.useState([]),[M,E]=o.useState(!1),[L,b]=o.useState(null),[y,se]=o.useState(""),[H,W]=o.useState(!1),V=o.useCallback(()=>{S.current&&S.current.scrollIntoView({behavior:"smooth"})},[]);o.useEffect(()=>{f&&s&&k()},[f,s]),o.useEffect(()=>{V()},[u,V]);const k=async()=>{if(s)try{E(!0),b(null);const x=await Je.getConversation(s);A(x.messages||[])}catch(x){console.error(x),b("Failed to load conversation")}finally{E(!1)}},J=async()=>{if(!(!s||!y.trim()))try{W(!0);const x=await Je.sendMessage(s,y.trim());A(D=>[...D,x]),se(""),V()}catch(x){console.error(x),Dt.error("Failed to send message")}finally{W(!1)}},q=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),J())},_=()=>{A([]),se(""),b(null),C()};return e.jsxs(we,{open:f,onClose:_,maxWidth:"sm",fullWidth:!0,fullScreen:h,PaperProps:{sx:{borderRadius:h?0:2,height:h?"100vh":"80vh",maxHeight:h?"100vh":"80vh",display:"flex",flexDirection:"column",animation:h?`${He} ${te.normal.duration} ${te.smooth.timing}`:`${Ge} ${te.normal.duration} ${te.smooth.timing}`,animationFillMode:"both"}},children:[e.jsxs(Se,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Ne,{sx:{width:40,height:40,bgcolor:"#2196F3"},children:e.jsx(Gt,{})}),e.jsxs(r,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:n}),e.jsx(i,{variant:"caption",color:"text.secondary",children:"Direct Message"})]})]}),e.jsx(ce,{onClick:_,size:"small",children:e.jsx(Ee,{})})]}),e.jsxs(Ie,{sx:{flex:1,overflowY:"auto",p:2,bgcolor:"#f8f9fa",display:"flex",flexDirection:"column",gap:2},children:[M&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ve,{})}),L&&e.jsx(ye,{severity:"error",children:L}),!M&&!L&&u.length===0&&e.jsxs(r,{sx:{textAlign:"center",pt:4,opacity:.7},children:[e.jsx(i,{children:"No messages yet."}),e.jsx(i,{variant:"caption",children:"Start a conversation!"})]}),!M&&u.map(x=>{var w,G,I;const D=((G=(w=x.sender)==null?void 0:w.role)==null?void 0:G.includes("ADMIN"))||x.senderType==="ADMIN";return e.jsx(r,{sx:{display:"flex",justifyContent:D?"flex-end":"flex-start"},children:e.jsxs(r,{sx:{maxWidth:"75%"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5,justifyContent:D?"flex-end":"flex-start"},children:[D&&e.jsx(Lt,{sx:{fontSize:12,color:"success.main"}}),e.jsx(i,{variant:"caption",color:"text.secondary",children:D?"You":((I=x.sender)==null?void 0:I.firstName)||n})]}),e.jsx(r,{sx:{p:1.5,bgcolor:D?"primary.main":"white",color:D?"white":"text.primary",borderRadius:2,boxShadow:1},children:e.jsx(i,{variant:"body2",children:x.content||x.message})})]})},x.id)}),e.jsx("div",{ref:S})]}),e.jsx(r,{sx:{p:2,borderTop:"1px solid #e0e0e0",bgcolor:"white"},children:e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(z,{fullWidth:!0,size:"small",placeholder:"Type a message...",value:y,onChange:x=>se(x.target.value),onKeyPress:q,disabled:H,sx:{"& .MuiOutlinedInput-root":{borderRadius:3}}}),e.jsx(P,{variant:"contained",onClick:J,disabled:!y.trim()||H,sx:{minWidth:50,height:40,borderRadius:"50%"},children:H?e.jsx(ve,{size:20,color:"inherit"}):e.jsx(Kt,{fontSize:"small"})})]})})]})},bs=()=>{const[s,f]=o.useState([]),[C,n]=o.useState(!0),[a,h]=o.useState(null),[S,u]=o.useState(""),[A,M]=o.useState(""),[E,L]=o.useState([]),[b,y]=o.useState("ALL"),[se,H]=o.useState(null),[W,V]=o.useState(""),[k,J]=o.useState(null),[q,_]=o.useState([]),[x,D]=o.useState(!1),[w,G]=o.useState(!1),[I,re]=o.useState(null),[ae,ne]=o.useState(!0),[ie,Q]=o.useState(null),[he,me]=o.useState([]),[Z,xe]=o.useState(!1),[R,l]=o.useState(!1),[U,Y]=o.useState(!1),[T,d]=o.useState(!1),[N,oe]=o.useState(null),[v,X]=o.useState([]),[O,le]=o.useState(Ut.ACTIVE),[m,B]=o.useState({page:1,limit:20,total:0}),[fe,ge]=o.useState({open:!1,message:"",severity:"success"}),[F,Me]=o.useState({viewUser:null,statusChange:null});o.useEffect(()=>{const t=setTimeout(()=>{M(S)},500);return()=>clearTimeout(t)},[S]),o.useEffect(()=>{tt()},[]),o.useEffect(()=>{if(b!=="ALL"){const t=E.find(c=>c.code===b);t&&H(t.id)}else H(null),_([]);V(""),J(null)},[b,E]),o.useEffect(()=>{W?st(W):_([]),J(null)},[W]),o.useEffect(()=>{We()},[A,O,b,W,k,m.page]),o.useEffect(()=>{je()},[b,W,k]),o.useEffect(()=>{const t=setInterval(()=>{je()},3e4);return()=>clearInterval(t)},[b,W,k]);const tt=async()=>{try{D(!0);const t=await Ue.getCityCorporations("ACTIVE");console.log("✅ City Corporations response in UserManagement:",t),L(t.cityCorporations||[])}catch(t){console.error("Error fetching city corporations:",t),ee("Failed to load city corporations","error"),L([])}finally{D(!1)}},st=async t=>{try{G(!0);const c=await Fe.getWardsByZone(t,"ACTIVE");_(c)}catch(c){console.error("Error fetching wards:",c),ee("Failed to load wards","error")}finally{G(!1)}},We=o.useCallback(async()=>{var t,c;try{n(!0),h(null);const p=await pe.getUsers({page:m.page,limit:m.limit,search:A||void 0,status:O!=="ALL"?O:void 0,role:"CUSTOMER",cityCorporationCode:b!=="ALL"?b:void 0,zoneId:W||void 0,wardId:k||void 0});f(p.users),B($=>({...$,total:p.pagination.total}))}catch(p){console.error("Error fetching users:",p),h(((c=(t=p.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to load users. Please try again."),ee("Failed to load users","error")}finally{n(!1)}},[A,O,b,W,k,m.page,m.limit]),je=async()=>{try{ne(!0);const t=await pe.getUserStatistics(b!=="ALL"?b:void 0,"CUSTOMER",W?Number(W):void 0,k?Number(k):void 0);re(t)}catch(t){console.error("Error fetching statistics:",t)}finally{ne(!1)}},rt=t=>{u(t),B(c=>({...c,page:1}))},at=t=>{le(t),B(c=>({...c,page:1}))},Re=()=>{u(""),le("ALL"),y("ALL"),y("ALL"),V(""),J(null),B(t=>({...t,page:1}))},ot=async t=>{try{Me(p=>({...p,viewUser:t}));const c=await pe.getUserById(t);Q(c.user),me(c.recentComplaints||[]),xe(!0)}catch(c){console.error("Error fetching user details:",c),ee("Failed to load user details","error")}finally{Me(c=>({...c,viewUser:null}))}},nt=t=>{Q(t),l(!0)},it=()=>{Y(!0)},lt=async t=>{var c,p;if(ie)try{await pe.updateUser(ie.id,t),ee("User updated successfully","success"),l(!1),Q(null),await We(),await je()}catch($){throw console.error("Error updating user:",$),ee(((p=(c=$.response)==null?void 0:c.data)==null?void 0:p.message)||"Failed to update user","error"),$}},dt=async t=>{var c,p;try{await pe.createUser(t),ee("User created successfully","success"),Y(!1),await We(),await je()}catch($){throw console.error("Error creating user:",$),ee(((p=(c=$.response)==null?void 0:c.data)==null?void 0:p.message)||"Failed to create user","error"),$}},ct=t=>{oe(t),d(!0)},xt=()=>{d(!1),oe(null)},ht=async()=>{if(v.length!==0&&window.confirm(`Are you sure you want to delete ${v.length} users?`))try{await pe.bulkDeleteUsers(v),ee("Users deleted successfully","success"),X([]),We(),je()}catch(t){ee(t.message||"Failed to delete users","error")}},mt=t=>{if(t.target.checked){const c=s.map(p=>p.id);X(c);return}X([])},ft=t=>{const c=v.indexOf(t);let p=[];c===-1?p=p.concat(v,t):c===0?p=p.concat(v.slice(1)):c===v.length-1?p=p.concat(v.slice(0,-1)):c>0&&(p=p.concat(v.slice(0,c),v.slice(c+1))),X(p)},ee=(t,c)=>{ge({open:!0,message:t,severity:c})},Oe=()=>{ge(t=>({...t,open:!1}))},pt=t=>t?t.startsWith("+")?t:t.length===11&&t.startsWith("0")?`+880 ${t.substring(1,5)}-${t.substring(5)}`:t:"N/A",ut=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),gt=(t,c)=>{const p=typeof t=="string"?t:String(t||""),$=typeof c=="string"?c:String(c||"");return`${p.charAt(0)}${$.charAt(0)}`.toUpperCase()},jt=()=>!I||I.totalComplaints===0?"0":(I.resolvedComplaints/I.totalComplaints*100).toFixed(0),Ct=[{title:"Total Citizens",value:ae?"...":String((I==null?void 0:I.totalCitizens)||0),color:"#2196F3"},{title:"Total Complaints",value:ae?"...":String((I==null?void 0:I.totalComplaints)||0),color:"#FF9800"},{title:"Resolved",value:ae?"...":String((I==null?void 0:I.resolvedComplaints)||0),color:"#4CAF50"},{title:"Success Rate",value:ae?"...":`${jt()}%`,color:"#9C27B0"}];return e.jsx(Ft,{children:e.jsxs(Mt,{title:"User Management",children:[e.jsxs(r,{sx:{width:"100%",maxWidth:"100%",px:1.5,mx:0},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(r,{children:[e.jsx(i,{variant:"h4",sx:{fontWeight:600,mb:.5,color:"text.primary"},children:"User Management"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Manage citizen accounts and information"})]}),e.jsx(P,{variant:"contained",startIcon:e.jsx(et,{}),onClick:it,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3,py:1.5,borderRadius:2},children:"Add New User"})]}),e.jsx(r,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"repeat(4, 1fr)"},gap:2,mb:4},children:Ct.map((t,c)=>e.jsx(Ve,{sx:{borderRadius:2,border:"1px solid #e0e0e0","&:hover":{boxShadow:2}},children:e.jsx(Ze,{sx:{p:3,textAlign:"center"},children:ae?e.jsxs(e.Fragment,{children:[e.jsx(K,{variant:"rectangular",width:"60%",height:48,sx:{mx:"auto",mb:1,borderRadius:1}}),e.jsx(K,{variant:"text",width:"80%",height:20,sx:{mx:"auto"}})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:t.color,mb:1},children:t.value}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:t.title})]})})},c))}),e.jsx(Ve,{sx:{borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(Ze,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,gap:2},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Citizen Directory"}),e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(z,{placeholder:"Search by name, email, or ward...",value:S,onChange:t=>rt(t.target.value),InputProps:{startAdornment:e.jsx(ue,{position:"start",children:e.jsx(Rt,{sx:{color:"text.secondary"}})})},sx:{width:300,"& .MuiOutlinedInput-root":{height:40,backgroundColor:"#f8f9fa"}}}),v.length>0&&e.jsxs(P,{variant:"outlined",color:"error",onClick:ht,sx:{ml:2,height:40},children:["Delete Selected (",v.length,")"]})]})]}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(Te,{sx:{minWidth:200},children:[e.jsx(Le,{id:"city-corporation-filter-label",sx:{top:-8},children:"City Corporation"}),e.jsxs(ze,{labelId:"city-corporation-filter-label",value:b,onChange:t=>y(t.target.value),label:"City Corporation",disabled:x,sx:{height:40,backgroundColor:"#f8f9fa"},children:[e.jsx(j,{value:"ALL",children:"All City Corporations"}),E&&E.map(t=>e.jsx(j,{value:t.code,children:typeof t.name=="object"?JSON.stringify(t.name):t.name},t.code))]})]}),e.jsx(r,{sx:{minWidth:200},children:e.jsx(Ot,{value:W,onChange:t=>V(t),cityCorporationCode:b!=="ALL"?b:"",disabled:!1})}),e.jsxs(Te,{sx:{minWidth:200},children:[e.jsx(Le,{id:"ward-filter-label",sx:{top:-8},children:"Ward"}),e.jsxs(ze,{labelId:"ward-filter-label",value:k||"",onChange:t=>J(t.target.value?Number(t.target.value):null),label:"Ward",disabled:!W||w||!q||q.length===0,sx:{height:40,backgroundColor:"#f8f9fa"},children:[e.jsx(j,{value:"",children:"All Wards"}),q&&q.map(t=>e.jsxs(j,{value:t.id,children:["Ward ",typeof t.wardNumber=="object"?JSON.stringify(t.wardNumber):t.wardNumber]},t.id))]})]}),e.jsxs(Te,{sx:{minWidth:150},children:[e.jsx(Le,{id:"status-filter-label",sx:{top:-8},children:"Status"}),e.jsxs(ze,{labelId:"status-filter-label",value:O,onChange:t=>at(t.target.value),label:"Status",startAdornment:e.jsx(ue,{position:"start",children:e.jsx(_t,{sx:{fontSize:18,color:"text.secondary"}})}),sx:{height:40,backgroundColor:"#f8f9fa"},children:[e.jsx(j,{value:"ALL",children:"All Status"}),e.jsx(j,{value:"ACTIVE",children:"Active"}),e.jsx(j,{value:"INACTIVE",children:"Inactive"}),e.jsx(j,{value:"SUSPENDED",children:"Suspended"}),e.jsx(j,{value:"PENDING",children:"Pending"})]})]}),(S||O!=="ALL"||b!=="ALL"||W||k)&&e.jsx(P,{variant:"outlined",onClick:Re,sx:{height:40,textTransform:"none",borderColor:"#e0e0e0",color:"text.secondary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Clear Filters"})]}),e.jsx($t,{component:qt,elevation:0,children:e.jsxs(Vt,{sx:{minWidth:650},children:[e.jsx(Zt,{children:e.jsxs(Ce,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(g,{padding:"checkbox",children:e.jsx(Be,{indeterminate:v.length>0&&v.length<s.length,checked:s.length>0&&v.length===s.length,onChange:mt})}),e.jsx(g,{sx:{fontWeight:600},children:"Citizen"}),e.jsx(g,{sx:{fontWeight:600},children:"Contact"}),e.jsx(g,{sx:{fontWeight:600},children:"City Corporation"}),e.jsx(g,{sx:{fontWeight:600},children:"Location"}),e.jsx(g,{sx:{fontWeight:600},children:"Complaints"}),e.jsx(g,{sx:{fontWeight:600},children:"Resolved"}),e.jsx(g,{sx:{fontWeight:600},children:"Unresolved"}),e.jsx(g,{sx:{fontWeight:600},children:"Join Date"}),e.jsx(g,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Bt,{children:C?Array.from({length:5}).map((t,c)=>e.jsxs(Ce,{children:[e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})}),e.jsx(g,{children:e.jsx(K,{variant:"rectangular",height:40})})]},c)):a?e.jsx(Ce,{children:e.jsx(g,{colSpan:9,children:e.jsx(ye,{severity:"error",sx:{my:2},children:a})})}):s.length===0?e.jsx(Ce,{children:e.jsx(g,{colSpan:9,children:e.jsx(ss,{icon:S||O!=="ALL"?e.jsx(Qt,{sx:{fontSize:40,color:"#9e9e9e"}}):e.jsx(ts,{sx:{fontSize:40,color:"#9e9e9e"}}),title:S||O!=="ALL"?"No users found":"No users registered yet",description:S||O!=="ALL"?"Try adjusting your search or filters to find what you're looking for.":"Users who register through the mobile app will appear here.",action:S||O!=="ALL"?{label:"Clear Filters",onClick:Re}:void 0})})}):s.map(t=>{var p,$;const c=v.indexOf(t.id)!==-1;return typeof t.ward=="object"&&t.ward!==null&&!("wardNumber"in t.ward)&&console.error("Suspicious Ward object found:",t.ward),typeof t.zone=="object"&&t.zone!==null&&!("zoneNumber"in t.zone)&&console.error("Suspicious Zone object found:",t.zone),e.jsxs(Ce,{hover:!0,selected:c,sx:{"&:hover":{backgroundColor:"#f8f9fa"}},children:[e.jsx(g,{padding:"checkbox",children:e.jsx(Be,{checked:c,onChange:()=>ft(t.id)})}),e.jsx(g,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.avatar?e.jsx(Ne,{src:t.avatar,sx:{width:40,height:40}}):e.jsx(Ne,{sx:{width:40,height:40,bgcolor:"#4CAF50"},children:gt(t.firstName,t.lastName)}),e.jsxs(r,{children:[e.jsx(i,{variant:"body1",sx:{fontWeight:500},children:`${typeof t.firstName=="object"?JSON.stringify(t.firstName):t.firstName} ${typeof t.lastName=="object"?JSON.stringify(t.lastName):t.lastName}`}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["#",String(t.id).padStart(6,"0")]})]})]})}),e.jsx(g,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ke,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:typeof t.email=="object"?JSON.stringify(t.email):t.email||"N/A"})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:typeof t.phone=="object"?JSON.stringify(t.phone):pt(t.phone)})]})]})}),e.jsx(g,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:typeof((p=t.cityCorporation)==null?void 0:p.name)=="object"?JSON.stringify(t.cityCorporation.name):(($=t.cityCorporation)==null?void 0:$.name)||"N/A"}),t.cityCorporation&&e.jsx(i,{variant:"caption",color:"text.secondary",children:typeof t.cityCorporation.code=="object"?JSON.stringify(t.cityCorporation.code):t.cityCorporation.code})]})}),e.jsx(g,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[t.zone?e.jsx(de,{label:`Zone ${typeof t.zone.zoneNumber=="object"?JSON.stringify(t.zone.zoneNumber):t.zone.zoneNumber}${t.zone.name?` - ${typeof t.zone.name=="object"?JSON.stringify(t.zone.name):t.zone.name}`:""}`,size:"small",variant:"outlined",color:"primary",sx:{height:24,justifyContent:"flex-start"}}):null,t.ward?e.jsx(de,{label:`Ward ${typeof t.ward.wardNumber=="object"?JSON.stringify(t.ward.wardNumber):t.ward.wardNumber}`,size:"small",variant:"outlined",sx:{height:24,justifyContent:"flex-start"}}):null,!t.zone&&!t.ward&&e.jsx(i,{variant:"caption",color:"text.secondary",children:"N/A"})]})}),e.jsx(g,{children:e.jsx(de,{label:String(t.statistics.totalComplaints),sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}})}),e.jsx(g,{children:e.jsx(de,{label:String(t.statistics.resolvedComplaints),sx:{backgroundColor:"#e8f5e8",color:"#2e7d2e",fontWeight:500}})}),e.jsx(g,{children:e.jsx(de,{label:String(t.statistics.unresolvedComplaints),sx:{backgroundColor:"#ffebee",color:"#c62828",fontWeight:500}})}),e.jsx(g,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Qe,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:ut(t.createdAt)})]})}),e.jsx(g,{children:e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(P,{variant:"outlined",size:"small",startIcon:F.viewUser===t.id?e.jsx(ve,{size:16}):e.jsx(be,{}),onClick:()=>ot(t.id),disabled:F.viewUser===t.id,sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:F.viewUser===t.id?"Loading...":"View"}),e.jsx(P,{variant:"outlined",size:"small",color:"primary",onClick:()=>ct(t),sx:{textTransform:"none",borderColor:"#e0e0e0",minWidth:"40px",color:"text.primary","&:hover":{borderColor:"#2196F3",color:"#2196F3"}},children:e.jsx(Yt,{fontSize:"small"})}),e.jsx(P,{variant:"outlined",size:"small",startIcon:e.jsx(Ye,{}),onClick:()=>nt(t),sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Edit"})]})})]},t.id)})})]})}),!C&&!a&&s.length>0&&e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderTop:"1px solid #e0e0e0",flexWrap:"wrap",gap:2},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Showing ",(m.page-1)*m.limit+1," to"," ",Math.min(m.page*m.limit,m.total)," of"," ",m.total.toLocaleString()," users"]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Rows per page:"}),e.jsxs(ze,{value:m.limit,onChange:t=>B(c=>({...c,limit:Number(t.target.value),page:1})),size:"small",sx:{minWidth:80},children:[e.jsx(j,{value:20,children:"20"}),e.jsx(j,{value:50,children:"50"}),e.jsx(j,{value:100,children:"100"}),e.jsx(j,{value:200,children:"200"})]})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{size:"small",onClick:()=>B(t=>({...t,page:1})),disabled:m.page===1,sx:{minWidth:"auto",px:1},children:"First"}),e.jsx(P,{size:"small",onClick:()=>B(t=>({...t,page:t.page-1})),disabled:m.page===1,sx:{minWidth:"auto",px:1},children:"Previous"}),e.jsxs(i,{variant:"body2",sx:{mx:2},children:["Page ",m.page," of ",Math.ceil(m.total/m.limit)]}),e.jsx(P,{size:"small",onClick:()=>B(t=>({...t,page:t.page+1})),disabled:m.page>=Math.ceil(m.total/m.limit),sx:{minWidth:"auto",px:1},children:"Next"}),e.jsx(P,{size:"small",onClick:()=>B(t=>({...t,page:Math.ceil(m.total/m.limit)})),disabled:m.page>=Math.ceil(m.total/m.limit),sx:{minWidth:"auto",px:1},children:"Last"})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Go to:"}),e.jsx(z,{type:"number",size:"small",value:m.page,onChange:t=>{const c=parseInt(t.target.value),p=Math.ceil(m.total/m.limit);c>=1&&c<=p&&B($=>({...$,page:c}))},inputProps:{min:1,max:Math.ceil(m.total/m.limit),style:{textAlign:"center"}},sx:{width:80}})]})]})]})]})})]}),e.jsx(rs,{user:ie,recentComplaints:he,open:Z,onClose:()=>{xe(!1),Q(null),me([])},onEdit:()=>{xe(!1),l(!0)}}),e.jsx(os,{user:ie,open:R,onClose:()=>{l(!1),Q(null)},onSave:lt}),e.jsx(ns,{open:U,onClose:()=>Y(!1),onSave:dt}),N&&e.jsx(ls,{userId:N.id,userName:`${N.firstName} ${N.lastName}`,open:T,onClose:xt}),e.jsx(Xt,{open:fe.open,autoHideDuration:6e3,onClose:Oe,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ye,{onClose:Oe,severity:fe.severity,sx:{width:"100%"},children:fe.message})})]})})};export{bs as default};
