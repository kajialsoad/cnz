import{j as t,B as r,H as R,T as o,p as u,u as T,o as $,g as W,I as A,Z as O,C as P}from"./mui-vendor-DhgYLev2.js";import{r as a,a as F}from"./react-vendor-D7yrL1sD.js";import{u as L}from"./useDebounce-CcxK0pTh.js";import{f as D}from"./dateUtils-C0RMjwBf.js";import{f as M,a as p}from"./index-pueUXdzt.js";import{a as B}from"./browserNotifications-BvguxRB7.js";import{a as y}from"./ErrorDisplay-dEZLAl9O.js";const G=({chat:e,isSelected:m,onClick:g})=>{const h=()=>`${e.citizen.firstName.charAt(0)}${e.citizen.lastName.charAt(0)}`,d=(i,x=50)=>i.length<=x?i:`${i.substring(0,x)}...`,s=()=>{switch(e.complaintStatus){case"PENDING":return"#FF9800";case"IN_PROGRESS":return"#2196F3";case"RESOLVED":return"#4CAF50";case"REJECTED":return"#f44336";default:return"#9E9E9E"}},l=()=>{switch(e.complaintStatus){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Solved";case"REJECTED":return"Rejected";default:return e.complaintStatus}};return t.jsx(r,{onClick:g,sx:{p:{xs:1.5,sm:2,md:2},borderBottom:"1px solid",borderColor:"divider",cursor:"pointer",backgroundColor:m?"action.selected":"transparent",transition:`all ${p.fast.duration} ${p.fast.timing}`,animation:`${M} ${p.normal.duration} ${p.normal.timing}`,"&:hover":{backgroundColor:m?"action.selected":"action.hover",transform:"translateX(4px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)"}},children:t.jsxs(r,{sx:{display:"flex",gap:1.5},children:[t.jsx(R,{src:e.citizen.profilePicture,sx:{width:40,height:40,bgcolor:"#4CAF50",color:"white",fontWeight:600,fontSize:"0.875rem",flexShrink:0},children:h()}),t.jsxs(r,{sx:{flex:1,minWidth:0},children:[t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:.5,gap:1},children:[t.jsxs(o,{variant:"subtitle2",sx:{fontWeight:e.unreadCount>0?600:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:[e.citizen.firstName," ",e.citizen.lastName]}),t.jsx(o,{variant:"caption",color:"text.secondary",sx:{flexShrink:0,fontSize:"0.7rem"},children:e.lastMessage?D(e.lastMessage.timestamp.toString()):"No messages"})]}),t.jsxs(o,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["#",e.trackingNumber," â€¢ ",e.complaintTitle]}),t.jsxs(o,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.7rem"},children:["ðŸ“ ",e.citizen.cityCorporationName||e.citizen.district,e.citizen.thanaName&&`, ${e.citizen.thanaName}`,!e.citizen.cityCorporationName&&`, ${e.citizen.upazila}`]}),t.jsxs(r,{sx:{display:"flex",gap:.5,mb:.5,flexWrap:"wrap"},children:[e.citizen.zone&&t.jsx(u,{label:`Zone ${e.citizen.zone}`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem",color:"text.secondary",borderColor:"divider",backgroundColor:"action.hover"}}),e.citizen.ward&&t.jsx(u,{label:`Ward ${e.citizen.ward}`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem",color:"text.secondary",borderColor:"divider",backgroundColor:"action.hover"}})]}),t.jsx(o,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:e.unreadCount>0?500:400,fontSize:"0.875rem",mb:.5},children:e.lastMessage?d(e.lastMessage.text,50):"No messages yet"}),t.jsxs(r,{sx:{display:"flex",gap:.5,flexWrap:"wrap",alignItems:"center"},children:[t.jsx(u,{label:l(),size:"small",sx:{height:20,fontSize:"0.7rem",fontWeight:500,backgroundColor:s(),color:"white"}}),e.isNew&&t.jsx(u,{label:"New",size:"small",sx:{height:20,fontSize:"0.7rem",fontWeight:600,backgroundColor:"#FF5722",color:"white"}}),e.unreadCount>0&&t.jsx(u,{label:e.unreadCount,size:"small",sx:{height:20,minWidth:20,backgroundColor:"#4CAF50",color:"white",fontSize:"0.7rem",fontWeight:600}})]})]})]})})},q=({chats:e,selectedChatId:m,onChatSelect:g,searchTerm:h,onSearchChange:d,loading:s,hasMore:l=!1,onLoadMore:i,totalChats:x=0})=>{const I=T(),E=$(I.breakpoints.down("sm")),[f,j]=a.useState(h),[b,v]=a.useState(!1),C=a.useRef(null),c=a.useRef(null),S=a.useRef(null),z=L(f,500);F.useEffect(()=>{d(z)},[z,d]);const w=a.useCallback(()=>{!s&&!b&&l&&i&&(v(!0),i(),setTimeout(()=>v(!1),1e3))},[s,b,l,i]);a.useEffect(()=>{if(S.current)return c.current&&c.current.disconnect(),c.current=new IntersectionObserver(n=>{n[0].isIntersecting&&w()},{root:C.current,rootMargin:"100px",threshold:.1}),c.current.observe(S.current),()=>{c.current&&c.current.disconnect()}},[w]);const N=n=>{j(n.target.value)},k=()=>{j(""),d("")};return t.jsxs(r,{sx:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[t.jsxs(r,{sx:{p:{xs:1.5,sm:2,md:2},borderBottom:"1px solid",borderColor:"divider"},children:[t.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:1.5,fontSize:{xs:"1.1rem",sm:"1.25rem",md:"1.25rem"}},children:"Inbox"}),t.jsx(W,{fullWidth:!0,placeholder:E?"Search...":"Search conversations...",value:f,onChange:N,size:"small",slotProps:{input:{startAdornment:t.jsx(A,{position:"start",children:t.jsx(O,{sx:{color:"text.secondary",fontSize:20}})})}},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"background.default"}}})]}),t.jsxs(r,{ref:C,sx:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[s&&e.length===0&&t.jsx(B,{count:5}),!s&&e.length===0&&f!==""&&t.jsx(y,{type:"no-results",onAction:k,actionLabel:"Clear Search"}),!s&&e.length===0&&f===""&&t.jsx(y,{type:"no-chats"}),e.length>0&&t.jsxs(r,{children:[e.map(n=>t.jsx(G,{chat:n,isSelected:m===n.complaintId,onClick:()=>g(n.complaintId)},n.complaintId||`citizen-${n.citizen.id}`)),l&&t.jsx(r,{ref:S,sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,minHeight:60},children:(s||b)&&t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(P,{size:20}),t.jsx(o,{variant:"body2",color:"text.secondary",children:"Loading more..."})]})}),!l&&e.length>0&&t.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,color:"text.secondary"},children:t.jsx(o,{variant:"body2",children:x>0?`All ${x} conversations loaded`:"No more conversations"})})]})]})]})};export{q as C};
