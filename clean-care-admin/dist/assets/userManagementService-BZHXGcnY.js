var m=Object.defineProperty;var f=(p,r,s)=>r in p?m(p,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[r]=s;var w=(p,r,s)=>f(p,typeof r!="symbol"?r+"":r,s);import{a as i}from"./query-vendor-CZVuOxbJ.js";import{A as g}from"./index-DBuvollO.js";import"./react-vendor-D7yrL1sD.js";import"./mui-vendor-Brc-2iiC.js";import"./chart-vendor-CrjdDA16.js";class y{constructor(){w(this,"apiClient");this.apiClient=i.create({baseURL:g.BASE_URL,timeout:g.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(r=>{try{const s=localStorage.getItem("accessToken");s&&(r.headers.Authorization=`Bearer ${s}`)}catch(s){console.error("Error getting token:",s)}return r},r=>Promise.reject(r)),this.apiClient.interceptors.response.use(r=>r,r=>{var s;return((s=r.response)==null?void 0:s.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(r)})}async getUsers(r){var s,t,e,a,c,n,d,l,u,h;try{console.log("ðŸ” Fetching users with query:",r);const o=await this.apiClient.get("/api/admin/users",{params:r});if(console.log("âœ… Full response:",o),console.log("âœ… Response data:",o.data),console.log("âœ… Response data type:",typeof o.data),console.log("âœ… Response data keys:",Object.keys(o.data||{})),(s=o.data)!=null&&s.success&&((t=o.data)!=null&&t.data))return console.log("âœ… Using response.data.data structure"),o.data.data;if((e=o.data)!=null&&e.users&&((a=o.data)!=null&&a.pagination))return console.log("âœ… Using direct structure"),o.data;throw console.error("âŒ Unexpected response structure:",o.data),new Error("Unexpected response structure from server")}catch(o){throw console.error("âŒ Error fetching users:",o),i.isAxiosError(o)?(console.error("Response data:",(c=o.response)==null?void 0:c.data),console.error("Response status:",(n=o.response)==null?void 0:n.status),console.error("Request URL:",(d=o.config)==null?void 0:d.url),console.error("Request params:",(l=o.config)==null?void 0:l.params),new Error(((h=(u=o.response)==null?void 0:u.data)==null?void 0:h.message)||"Failed to fetch users")):o}}async getUserById(r){var s,t;try{return(await this.apiClient.get(`/api/admin/users/${r}?t=${Date.now()}`)).data.data}catch(e){throw i.isAxiosError(e)?new Error(((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch user details"):e}}async getUserStatistics(r,s,t,e){var a,c;try{const n={};return r&&(n.cityCorporationCode=r),s&&(n.role=s),t&&(n.zoneId=t),e&&(n.wardId=e),(await this.apiClient.get("/api/admin/users/statistics",{params:Object.keys(n).length>0?n:void 0})).data.data}catch(n){throw i.isAxiosError(n)?new Error(((c=(a=n.response)==null?void 0:a.data)==null?void 0:c.message)||"Failed to fetch statistics"):n}}async createUser(r){var s,t;try{console.log("ðŸ”µ UserManagementService.createUser - Sending data:",{...r,password:"***"});const e=await this.apiClient.post("/api/admin/users",r);return console.log("âœ… UserManagementService.createUser - Success:",e.data),e.data}catch(e){if(console.error("âŒ UserManagementService.createUser - Error:",e),i.isAxiosError(e)){console.error("âŒ Axios error response:",e.response),console.error("âŒ Axios error data:",(s=e.response)==null?void 0:s.data);const a=(t=e.response)==null?void 0:t.data;if(a!=null&&a.errors&&Array.isArray(a.errors)){const c=a.errors.map(n=>`${n.field||"Field"}: ${n.message}`).join(", ");throw new Error(c||a.message||"Validation failed")}throw new Error((a==null?void 0:a.message)||"Failed to create user")}throw e}}async updateUser(r,s){var t,e;try{return(await this.apiClient.put(`/api/admin/users/${r}`,s)).data}catch(a){throw i.isAxiosError(a)?new Error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to update user"):a}}async updateUserStatus(r,s){var t,e;try{return(await this.apiClient.patch(`/api/admin/users/${r}/status`,s)).data}catch(a){throw i.isAxiosError(a)?new Error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to update user status"):a}}async uploadAvatar(r){var s,t;try{const e=new FormData;return e.append("image",r),(await this.apiClient.post("/api/uploads/avatar",e,{headers:{"Content-Type":"multipart/form-data"}})).data.data.url}catch(e){throw i.isAxiosError(e)?new Error(((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to upload avatar"):e}}async bulkDeleteUsers(r){var s,t;try{await this.apiClient.post("/api/admin/users/bulk-delete",{userIds:r})}catch(e){throw i.isAxiosError(e)?new Error(((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to bulk delete users"):e}}async getUserReactions(r){var s,t;try{return(await this.apiClient.get(`/api/waste-management/admin/users/${r}/reactions`)).data}catch(e){throw i.isAxiosError(e)?new Error(((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch user reactions"):e}}async getUserNoticeInteractions(r){var s,t;try{return(await this.apiClient.get(`/api/notices/admin/users/${r}/interactions`)).data}catch(e){throw i.isAxiosError(e)?new Error(((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch user notice interactions"):e}}}const v=new y;export{v as userManagementService};
