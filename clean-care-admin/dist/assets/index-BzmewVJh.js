var Ms=Object.defineProperty;var Ls=(s,x,v)=>x in s?Ms(s,x,{enumerable:!0,configurable:!0,writable:!0,value:v}):s[x]=v;var ts=(s,x,v)=>Ls(s,typeof x!="symbol"?x+"":x,v);import{e as _e,j as e,F as a,T as i,P as D,a1 as Le,D as We,y as Rs,z as ie,A as is,C as ls,E as ze,I as ge,H as Re,J as Ee,G as De,aj as pe,aB as Ue,X as Fs,aA as ds,Z as Ve,az as cs,ax as Os,aw as xs,aC as $s,aD as Zs,aE as Us,aF as Vs,am as Fe,ay as hs,aG as qs,r as n,an as Be,ao as He,aH as ms,a2 as ke,L as Ne,N as T,W as y,O as be,aI as Me,aJ as Ae,K as we,R as Js,S as _s,l as Bs,v as Hs,M as Gs,Q as Ks,aK as Qs,aL as Ys,a5 as Xs,as,at as rs,aq as re,ac as et,U as qe,aa as Je,V as Te,ab as st,ad as tt,a8 as at,ae as rt,af as ot,ag as Ie,ah as C,aM as os,ai as nt}from"./index-D65jGImX.js";import{f as it}from"./format-f5IwIX-o.js";import{S as lt}from"./Save-D8eytItB.js";import{P as dt}from"./Person-BfSXJYBV.js";import{S as ct}from"./Send-CpARVR0v.js";import{u as ye}from"./userManagementService-YI3WZDim.js";import{F as xt}from"./FilterList-CNhGr-sa.js";import{S as ht}from"./SearchOff-6ikdVoEn.js";import{C as mt}from"./ChatBubbleOutline-ItU874Bo.js";import{S as ft}from"./Snackbar-BxH8kjn1.js";const pt=_e(e.jsx("path",{d:"M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2m0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19z"})),fs=_e(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),gt=_e(e.jsx("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76zm1.19 4.02L2.81 2.81 1.39 4.22l8.89 8.89c-1.81.23-3.39.79-4.67 1.45-1 .51-1.61 1.54-1.61 2.66V20h13.17l2.61 2.61z"})),ut=({icon:s,title:x,description:v,action:S})=>e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,px:3,textAlign:"center"},children:[e.jsx(a,{sx:{width:80,height:80,borderRadius:"50%",backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",mb:3},children:s||e.jsx(pt,{sx:{fontSize:40,color:"#9e9e9e"}})}),e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:1},children:x}),v&&e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3,maxWidth:400},children:v}),S&&e.jsx(D,{variant:"contained",onClick:S.onClick,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3},children:S.label})]}),jt=({user:s,recentComplaints:x,open:v,onClose:S,onEdit:o})=>{var $,A,Z,b,M;const{user:r}=Le();if(!s)return null;const m=E=>{switch(E){case"ACTIVE":return{backgroundColor:"#e8f5e8",color:"#2e7d2e"};case"INACTIVE":return{backgroundColor:"#f5f5f5",color:"#666666"};case"SUSPENDED":return{backgroundColor:"#ffebee",color:"#c62828"};case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},N=E=>{switch(E){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724"};case"REJECTED":return{backgroundColor:"#ffebee",color:"#c62828"};default:return{backgroundColor:"#f5f5f5",color:"#666666"}}},p=E=>{if(!E)return"Never";try{return it(new Date(E),"MMM dd, yyyy hh:mm a")}catch{return"Invalid date"}},_=s.statistics.totalComplaints>0?Math.round(s.statistics.resolvedComplaints/s.statistics.totalComplaints*100):0;return e.jsxs(We,{open:v,onClose:S,maxWidth:"md",fullWidth:!0,fullScreen:window.innerWidth<600,slotProps:{paper:{sx:{borderRadius:{xs:0,sm:2},animation:window.innerWidth<600?`${is} ${ie.normal.duration} ${ie.smooth.timing}`:`${ls} ${ie.normal.duration} ${ie.smooth.timing}`,animationFillMode:"both",maxHeight:{xs:"100vh",sm:"90vh"}}},backdrop:{sx:{animation:`${Rs} ${ie.fast.duration} ${ie.fast.timing}`}}},children:[e.jsx(ze,{sx:{pb:{xs:1.5,sm:2}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600,fontSize:{xs:"1.25rem",sm:"1.5rem"}},children:"User Details"}),e.jsx(ge,{onClick:S,size:"small",children:e.jsx(Re,{})})]})}),e.jsxs(Ee,{dividers:!0,sx:{px:{xs:2,sm:3},py:{xs:2,sm:2}},children:[e.jsxs(a,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(a,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center",sm:"center"},gap:{xs:2,sm:3},mb:2},children:[e.jsxs(De,{sx:{width:{xs:64,sm:80},height:{xs:64,sm:80},bgcolor:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2rem"},fontWeight:600},src:s.avatar||void 0,children:[s.firstName[0],s.lastName[0]]}),e.jsxs(a,{sx:{flex:1,textAlign:{xs:"center",sm:"left"},width:{xs:"100%",sm:"auto"}},children:[e.jsxs(i,{variant:"h6",sx:{fontWeight:600,mb:.5,fontSize:{xs:"1rem",sm:"1.25rem"}},children:[s.firstName," ",s.lastName]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{mb:1,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["User ID: #",s.id.toString().padStart(6,"0")]}),e.jsxs(a,{sx:{display:"flex",gap:1,justifyContent:{xs:"center",sm:"flex-start"},flexWrap:"wrap"},children:[e.jsx(pe,{label:s.status,size:"small",sx:{...m(s.status),...Ue,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}}),e.jsx(pe,{label:s.role,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",...Ue,fontWeight:500,fontSize:{xs:"0.7rem",sm:"0.75rem"}}})]})]})]}),e.jsx(Fs,{sx:{my:{xs:1.5,sm:2}}}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(ds,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Email"}),e.jsx(i,{variant:"body2",sx:{wordBreak:"break-word",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.email||"Not provided"})]}),s.emailVerified&&e.jsx(Ve,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(cs,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{sx:{flex:1},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Phone"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.phone})]}),s.phoneVerified&&e.jsx(Ve,{sx:{color:"#4CAF50",fontSize:{xs:16,sm:18}}})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(Os,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20},mt:.5}}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Location"}),s.cityCorporation&&e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:500},children:s.cityCorporation.name}),e.jsxs(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Ward ",(($=s.ward)==null?void 0:$.wardNumber)??"N/A"," â€¢ Zone ",((A=s.zone)==null?void 0:A.zoneNumber)??"N/A"]}),((Z=s.ward)==null?void 0:Z.inspectorName)&&e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Inspector: ",s.ward.inspectorName," ",s.ward.inspectorPhone?`(${s.ward.inspectorPhone})`:""]}),((b=s.zone)==null?void 0:b.officerName)&&e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["Zonal Officer: ",s.zone.officerName," ",s.zone.officerPhone?`(${s.zone.officerPhone})`:""]}),s.address&&e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.8rem"},mt:.5,wordBreak:"break-word"},children:s.address})]})]})}),e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(xs,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Joined"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:p(s.createdAt)})]})]})}),(r==null?void 0:r.role)==="MASTER_ADMIN"&&e.jsx(a,{sx:{flex:{xs:"1 1 100%",sm:"1 1 45%"},minWidth:{xs:"100%",sm:"200px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:{xs:1.5,sm:2}},children:[e.jsx(Ve,{sx:{color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(a,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Password"}),e.jsx(i,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontFamily:"monospace"},children:s.visiblePassword?e.jsx("span",{style:{color:"#2e7d32",fontWeight:"bold"},children:s.visiblePassword}):e.jsxs("span",{style:{color:"#666"},children:["Hash: ",(M=s.passwordHash)==null?void 0:M.substring(0,20),"... (Reset to see actual)"]})})]})]})})]})]}),e.jsxs(a,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Activity Statistics"}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:{xs:1.5,sm:2}},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#2196F3",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.totalComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Total Complaints"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#4CAF50",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.resolvedComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Resolved"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#FF9800",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:s.statistics.unresolvedComplaints}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Unresolved"})]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:{xs:"100px",sm:"120px"}},children:e.jsxs(a,{sx:{textAlign:"center",p:{xs:1.5,sm:2},backgroundColor:"#f8f9fa",borderRadius:2},children:[e.jsxs(i,{variant:"h4",sx:{fontWeight:700,color:"#9C27B0",fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:[_,"%"]}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:"Success Rate"})]})})]}),e.jsx(a,{sx:{mt:{xs:1.5,sm:2}},children:e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["Last Login: ",p(s.lastLoginAt)]})})]}),e.jsxs(a,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:{xs:1.5,sm:2},fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Recent Complaints"}),x.length>0?e.jsx($s,{sx:{p:0},children:x.map(E=>e.jsx(Zs.Fragment,{children:e.jsx(Us,{sx:{px:{xs:1.5,sm:2},py:{xs:1,sm:1.5},backgroundColor:"#f8f9fa",borderRadius:1,mb:1},children:e.jsx(Vs,{primary:e.jsxs(a,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},gap:{xs:.5,sm:1}},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:E.title}),e.jsx(pe,{label:E.status.replace("_"," "),size:"small",sx:{...N(E.status),...Ue,height:{xs:18,sm:20},fontSize:{xs:"0.65rem",sm:"0.7rem"}}})]}),secondary:e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}},children:p(E.createdAt)})})})},E.id))}):e.jsx(i,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:{xs:2,sm:3},fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"No complaints yet"})]})]}),e.jsxs(Fe,{sx:{px:{xs:2,sm:3},py:{xs:1.5,sm:2},flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[e.jsx(D,{onClick:S,variant:"outlined",sx:{textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Close"}),e.jsx(D,{onClick:o,variant:"contained",startIcon:e.jsx(hs,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",width:{xs:"100%",sm:"auto"},minHeight:{xs:44,sm:"auto"}},children:"Edit User"})]})]})},Ct=({open:s,title:x,message:v,confirmText:S="Confirm",cancelText:o="Cancel",onConfirm:r,onCancel:m,severity:N="warning"})=>{const p=()=>{switch(N){case"error":return"#d32f2f";case"warning":return"#ed6c02";case"info":return"#0288d1";default:return"#ed6c02"}};return e.jsxs(We,{open:s,onClose:m,maxWidth:"xs",fullWidth:!0,children:[e.jsx(ze,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"50%",backgroundColor:`${p()}20`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(qs,{sx:{color:p()}})}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:x})]})}),e.jsx(Ee,{children:e.jsx(i,{variant:"body1",color:"text.secondary",children:v})}),e.jsxs(Fe,{sx:{px:3,pb:2},children:[e.jsx(D,{onClick:m,sx:{textTransform:"none",color:"text.secondary"},children:o}),e.jsx(D,{onClick:r,variant:"contained",sx:{textTransform:"none",backgroundColor:p(),"&:hover":{backgroundColor:p(),opacity:.9}},children:S})]})]})},yt=({user:s,open:x,onClose:v,onSave:S})=>{const{user:o}=Le(),[r,m]=n.useState({firstName:"",lastName:"",email:"",phone:"",cityCorporationCode:"",zoneId:"",wardId:"",status:"ACTIVE",newPassword:"",confirmPassword:""}),[N,p]=n.useState([]),[_,$]=n.useState([]),[A,Z]=n.useState([]),[b,M]=n.useState(!1),[E,se]=n.useState(!1),[W,X]=n.useState(!1),[P,te]=n.useState(!1),[L,j]=n.useState(!1),[f,ee]=n.useState({}),[I,H]=n.useState(!1),[le,de]=n.useState(null),[U,ue]=n.useState(!1);n.useEffect(()=>{ce()},[]),n.useEffect(()=>{r.cityCorporationCode?je(r.cityCorporationCode):($([]),Z([]),m(c=>({...c,zoneId:"",wardId:""})))},[r.cityCorporationCode]),n.useEffect(()=>{r.zoneId?xe(parseInt(r.zoneId)):(Z([]),m(c=>({...c,wardId:""})))},[r.zoneId]);const ce=async()=>{try{M(!0);const c=await Be.getCityCorporations("ACTIVE");p(c.cityCorporations||[])}catch(c){console.error("Error fetching city corporations:",c),p([])}finally{M(!1)}},je=async c=>{try{if(se(!0),(o==null?void 0:o.role)==="SUPER_ADMIN")try{const K=await He.getAssignedZones(Number(o.id)),F=N.find(u=>u.code===c),oe=K.filter(u=>u.zone.cityCorporationCode===c).map(u=>({id:u.zone.id,zoneNumber:u.zone.zoneNumber,name:u.zone.name,cityCorporationId:(F==null?void 0:F.id)||0,status:"ACTIVE",createdAt:u.assignedAt,updatedAt:u.assignedAt}));$(oe);return}catch(K){console.error("Error fetching assigned zones:",K),$([]);return}const w=await ms.getZones({cityCorporationCode:c,status:"ACTIVE"});$(w.zones||[])}catch(w){console.error("Error fetching zones:",w),$([])}finally{se(!1)}},xe=async c=>{try{X(!0);const w=await ke.getWards({zoneId:c,status:"ACTIVE"});Z(w.wards||[])}catch(w){console.error("Error fetching wards:",w),Z([])}finally{X(!1)}};n.useEffect(()=>{var c,w,K,F,oe,u,ne;s&&(m({firstName:s.firstName,lastName:s.lastName,email:s.email||"",phone:s.phone,cityCorporationCode:((c=s.cityCorporation)==null?void 0:c.code)||"",zoneId:((K=(w=s.zone)==null?void 0:w.id)==null?void 0:K.toString())||"",wardId:((oe=(F=s.ward)==null?void 0:F.id)==null?void 0:oe.toString())||"",status:s.status,newPassword:"",confirmPassword:""}),ee({}),de(null),(u=s.cityCorporation)!=null&&u.code&&je(s.cityCorporation.code),(ne=s.zone)!=null&&ne.id&&xe(s.zone.id))},[s]);const he=c=>c?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c):!0,G=c=>/^01[0-9]{9}$/.test(c.replace(/\s+/g,"")),Ce=()=>{const c={};return r.firstName.trim()||(c.firstName="First name is required"),r.lastName.trim()||(c.lastName="Last name is required"),r.phone.trim()?G(r.phone)||(c.phone="Invalid phone format (must be 11 digits starting with 01)"):c.phone="Phone number is required",r.email&&!he(r.email)&&(c.email="Invalid email format"),r.cityCorporationCode||(c.cityCorporationCode="City Corporation is required"),r.zoneId||(c.zoneId="Zone is required"),r.wardId||(c.wardId="Ward is required"),(r.newPassword||r.confirmPassword)&&(r.newPassword.length<8&&(c.newPassword="Password must be at least 8 characters"),r.newPassword!==r.confirmPassword&&(c.confirmPassword="Passwords do not match")),ee(c),Object.keys(c).length===0},V=c=>w=>{const K=w.target.value;m(F=>({...F,[c]:K})),f[c]&&ee(F=>({...F,[c]:void 0})),le&&de(null)},l=async(c=!1)=>{var F,oe,u,ne,Q,ve,g,Y;if(!Ce())return;const w=r.status!==(s==null?void 0:s.status),K=r.status==="SUSPENDED"||r.status==="INACTIVE";if(w&&K&&!c){ue(!0);return}H(!0),de(null);try{const O={};r.firstName!==(s==null?void 0:s.firstName)&&(O.firstName=r.firstName),r.lastName!==(s==null?void 0:s.lastName)&&(O.lastName=r.lastName),r.email!==((s==null?void 0:s.email)||"")&&(O.email=r.email||void 0),r.phone!==(s==null?void 0:s.phone)&&(O.phone=r.phone),r.cityCorporationCode!==((F=s==null?void 0:s.cityCorporation)==null?void 0:F.code)&&(O.cityCorporationCode=r.cityCorporationCode),r.zoneId!==((u=(oe=s==null?void 0:s.zone)==null?void 0:oe.id)==null?void 0:u.toString())&&(O.zoneId=parseInt(r.zoneId)),r.wardId!==((Q=(ne=s==null?void 0:s.ward)==null?void 0:ne.id)==null?void 0:Q.toString())&&(O.wardId=parseInt(r.wardId)),r.status!==(s==null?void 0:s.status)&&(O.status=r.status),r.newPassword&&(O.password=r.newPassword),await S(O),v()}catch(O){console.error("Error updating user:",O),de(((Y=(g=(ve=O.response)==null?void 0:ve.data)==null?void 0:g.error)==null?void 0:Y.message)||O.message||"Failed to update user. Please try again.")}finally{H(!1)}},R=()=>{ue(!1),l(!0)},B=()=>{ue(!1)},z=()=>{I||v()};return s?e.jsxs(We,{open:x,onClose:z,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(ze,{sx:{pb:2},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Edit User"}),e.jsx(ge,{onClick:z,size:"small",disabled:I,children:e.jsx(Re,{})})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Update user information and account settings"})]}),e.jsxs(Ee,{dividers:!0,children:[le&&e.jsx(Ne,{severity:"error",sx:{mb:3},onClose:()=>de(null),children:le}),e.jsxs(a,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"First Name",value:r.firstName,onChange:V("firstName"),error:!!f.firstName,helperText:f.firstName,disabled:I,required:!0})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Last Name",value:r.lastName,onChange:V("lastName"),error:!!f.lastName,helperText:f.lastName,disabled:I,required:!0})})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Email",type:"email",value:r.email,onChange:V("email"),error:!!f.email,helperText:f.email,disabled:I})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Phone",value:r.phone,onChange:V("phone"),error:!!f.phone,helperText:f.phone,disabled:I,required:!0})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(T,{fullWidth:!0,select:!0,label:"City Corporation",value:r.cityCorporationCode,onChange:V("cityCorporationCode"),disabled:I||b||(o==null?void 0:o.role)!=="MASTER_ADMIN",error:!!f.cityCorporationCode,helperText:f.cityCorporationCode,required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),N.map(c=>e.jsx(y,{value:c.code,children:c.name},c.code))]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(T,{fullWidth:!0,select:!0,label:"Zone",value:r.zoneId,onChange:V("zoneId"),disabled:I||E||!r.cityCorporationCode||(o==null?void 0:o.role)!=="MASTER_ADMIN",error:!!f.zoneId,helperText:f.zoneId||(r.cityCorporationCode?E?"Loading zones...":_.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select Zone"})}),_.map(c=>e.jsx(y,{value:c.id.toString(),children:c.name||`Zone ${c.zoneNumber}`},c.id))]})})]}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(T,{fullWidth:!0,select:!0,label:"Ward",value:r.wardId,onChange:V("wardId"),disabled:I||W||!r.zoneId||(o==null?void 0:o.role)!=="MASTER_ADMIN",error:!!f.wardId,helperText:f.wardId||(r.zoneId?W?"Loading wards...":A.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select Ward"})}),A.map(c=>e.jsxs(y,{value:c.id.toString(),children:["Ward ",typeof c.wardNumber=="object"?JSON.stringify(c.wardNumber):c.wardNumber]},c.id))]})})}),(o==null?void 0:o.role)==="MASTER_ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Change Password (Optional)"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"New Password",type:P?"text":"password",value:r.newPassword,onChange:V("newPassword"),error:!!f.newPassword,helperText:f.newPassword||"Leave blank to keep current password",disabled:I,slotProps:{input:{endAdornment:e.jsx(be,{position:"end",children:e.jsx(ge,{onClick:()=>te(!P),edge:"end",size:"small",children:P?e.jsx(Me,{}):e.jsx(Ae,{})})})}}})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Confirm New Password",type:L?"text":"password",value:r.confirmPassword,onChange:V("confirmPassword"),error:!!f.confirmPassword,helperText:f.confirmPassword,disabled:I,slotProps:{input:{endAdornment:e.jsx(be,{position:"end",children:e.jsx(ge,{onClick:()=>j(!L),edge:"end",size:"small",children:L?e.jsx(Me,{}):e.jsx(Ae,{})})})}}})})]})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Settings"}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(T,{fullWidth:!0,select:!0,label:"Status",value:r.status,onChange:V("status"),disabled:I,children:[e.jsx(y,{value:"ACTIVE",children:"Active"}),e.jsx(y,{value:"INACTIVE",children:"Inactive"}),e.jsx(y,{value:"SUSPENDED",children:"Suspended"}),e.jsx(y,{value:"PENDING",children:"Pending"})]})})})]})]}),e.jsxs(Fe,{sx:{px:3,py:2},children:[e.jsx(D,{onClick:z,variant:"outlined",disabled:I,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(D,{onClick:()=>l(),variant:"contained",disabled:I,startIcon:I?e.jsx(we,{size:20}):e.jsx(lt,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:I?"Saving...":"Save Changes"})]}),e.jsx(Ct,{open:U,title:r.status==="SUSPENDED"?"Suspend User":"Deactivate User",message:r.status==="SUSPENDED"?`Are you sure you want to suspend ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}? This will immediately block their access to the system.`:`Are you sure you want to deactivate ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}? They will not be able to access the system.`,confirmText:"Confirm",cancelText:"Cancel",severity:"warning",onConfirm:R,onCancel:B})]}):null},bt=({open:s,onClose:x,onSave:v})=>{const{user:S}=Le(),[o,r]=n.useState({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),[m,N]=n.useState({}),[p,_]=n.useState(!1),[$,A]=n.useState(null),[Z,b]=n.useState(!1),[M,E]=n.useState(!1),[se,W]=n.useState([]),[X,P]=n.useState([]),[te,L]=n.useState([]),[j,f]=n.useState(!1),[ee,I]=n.useState(!1),[H,le]=n.useState(!1);n.useEffect(()=>{de()},[]),n.useEffect(()=>{o.cityCorporationCode?U(o.cityCorporationCode):(P([]),L([]),r(l=>({...l,zoneId:"",wardId:""})))},[o.cityCorporationCode]),n.useEffect(()=>{o.zoneId?ue(parseInt(o.zoneId)):(L([]),r(l=>({...l,wardId:""})))},[o.zoneId]);const de=async()=>{try{f(!0);const l=await Be.getCityCorporations("ACTIVE");W(l.cityCorporations||[])}catch(l){console.error("Error fetching city corporations:",l),W([]),A("Failed to load city corporations. Please try again.")}finally{f(!1)}},U=async l=>{try{if(I(!0),(S==null?void 0:S.role)==="SUPER_ADMIN")try{const B=await He.getAssignedZones(Number(S.id)),z=se.find(w=>w.code===l),c=B.filter(w=>w.zone.cityCorporationCode===l).map(w=>({id:w.zone.id,zoneNumber:w.zone.zoneNumber,name:w.zone.name,cityCorporationId:(z==null?void 0:z.id)||0,status:"ACTIVE",createdAt:w.assignedAt,updatedAt:w.assignedAt}));P(c);return}catch(B){console.error("Error fetching assigned zones:",B),P([]);return}const R=await ms.getZones({cityCorporationCode:l,status:"ACTIVE"});P(R.zones||[])}catch(R){console.error("Error fetching zones:",R),P([])}finally{I(!1)}},ue=async l=>{try{le(!0);const R=await ke.getWards({zoneId:l,status:"ACTIVE"});L(R.wards||[])}catch(R){console.error("Error fetching wards:",R),L([])}finally{le(!1)}},ce=l=>l?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l):!0,je=l=>/^01[0-9]{9}$/.test(l.replace(/\s+/g,"")),xe=l=>l.length>=8,he=()=>{const l={};return o.firstName.trim()||(l.firstName="First name is required"),o.lastName.trim()||(l.lastName="Last name is required"),o.phone.trim()?je(o.phone)||(l.phone="Invalid phone format (must be 11 digits starting with 01)"):l.phone="Phone number is required",o.password?xe(o.password)||(l.password="Password must be at least 8 characters"):l.password="Password is required",o.confirmPassword?o.password!==o.confirmPassword&&(l.confirmPassword="Passwords do not match"):l.confirmPassword="Please confirm your password",o.cityCorporationCode||(l.cityCorporationCode="City Corporation is required"),o.zoneId||(l.zoneId="Zone is required"),o.wardId||(l.wardId="Ward is required"),o.email&&!ce(o.email)&&(l.email="Invalid email format"),N(l),Object.keys(l).length===0},G=l=>R=>{const B=R.target.value;r(z=>({...z,[l]:B})),m[l]&&N(z=>({...z,[l]:void 0})),$&&A(null)},Ce=async()=>{var l,R,B;if(he()){_(!0),A(null);try{const z={firstName:o.firstName,lastName:o.lastName,phone:o.phone,password:o.password,role:o.role};o.email&&(z.email=o.email),o.cityCorporationCode&&(z.cityCorporationCode=o.cityCorporationCode),o.zoneId&&(z.zoneId=parseInt(o.zoneId)),o.wardId&&(z.wardId=parseInt(o.wardId)),await v(z),r({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),x()}catch(z){console.error("Error creating user:",z),A(((B=(R=(l=z.response)==null?void 0:l.data)==null?void 0:R.error)==null?void 0:B.message)||z.message||"Failed to create user. Please try again.")}finally{_(!1)}}},V=()=>{p||(r({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",cityCorporationCode:"",zoneId:"",wardId:"",role:"CUSTOMER"}),N({}),A(null),x())};return e.jsxs(We,{open:s,onClose:V,maxWidth:"md",fullWidth:!0,slotProps:{paper:{sx:{borderRadius:2}}},children:[e.jsxs(ze,{sx:{pb:2},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Add New User"}),e.jsx(ge,{onClick:V,size:"small",disabled:p,children:e.jsx(Re,{})})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create a new user account"})]}),e.jsxs(Ee,{dividers:!0,children:[$&&e.jsx(Ne,{severity:"error",sx:{mb:3},onClose:()=>A(null),children:$}),e.jsxs(a,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Personal Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"First Name",value:o.firstName,onChange:G("firstName"),error:!!m.firstName,helperText:m.firstName,disabled:p,required:!0})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Last Name",value:o.lastName,onChange:G("lastName"),error:!!m.lastName,helperText:m.lastName,disabled:p,required:!0})})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Email",type:"email",value:o.email,onChange:G("email"),error:!!m.email,helperText:m.email||"Optional",disabled:p})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Phone",value:o.phone,onChange:G("phone"),error:!!m.phone,helperText:m.phone,disabled:p,required:!0})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Account Credentials"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Password",type:Z?"text":"password",value:o.password,onChange:G("password"),error:!!m.password,helperText:m.password||"Minimum 8 characters",disabled:p,required:!0,slotProps:{input:{endAdornment:e.jsx(be,{position:"end",children:e.jsx(ge,{onClick:()=>b(!Z),edge:"end",size:"small",children:Z?e.jsx(Me,{}):e.jsx(Ae,{})})})}}})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsx(T,{fullWidth:!0,label:"Confirm Password",type:M?"text":"password",value:o.confirmPassword,onChange:G("confirmPassword"),error:!!m.confirmPassword,helperText:m.confirmPassword,disabled:p,required:!0,slotProps:{input:{endAdornment:e.jsx(be,{position:"end",children:e.jsx(ge,{onClick:()=>E(!M),edge:"end",size:"small",children:M?e.jsx(Me,{}):e.jsx(Ae,{})})})}}})})]}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:2,mt:3},children:"Location Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(T,{fullWidth:!0,select:!0,label:"City Corporation",value:o.cityCorporationCode,onChange:G("cityCorporationCode"),disabled:p||j,error:!!m.cityCorporationCode,helperText:m.cityCorporationCode||"Required",required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select City Corporation"})}),se.map(l=>e.jsx(y,{value:l.code,children:l.name},l.code))]})}),e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(T,{fullWidth:!0,select:!0,label:"Zone",value:o.zoneId,onChange:G("zoneId"),disabled:p||ee||!o.cityCorporationCode,error:!!m.zoneId,helperText:m.zoneId||(o.cityCorporationCode?ee?"Loading zones...":X.length===0?"No zones available":"Required":"Select City Corporation first"),required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select Zone"})}),X.map(l=>e.jsx(y,{value:l.id.toString(),children:l.name||`Zone ${l.zoneNumber}`},l.id))]})})]}),e.jsx(a,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:e.jsx(a,{sx:{flex:"1 1 calc(50% - 8px)",minWidth:"200px"},children:e.jsxs(T,{fullWidth:!0,select:!0,label:"Ward",value:o.wardId,onChange:G("wardId"),disabled:p||H||!o.zoneId,error:!!m.wardId,helperText:m.wardId||(o.zoneId?H?"Loading wards...":te.length===0?"No wards available":"Required":"Select Zone first"),required:!0,children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"Select Ward"})}),te.map(l=>e.jsxs(y,{value:l.id.toString(),children:["Ward ",typeof l.wardNumber=="object"?JSON.stringify(l.wardNumber):l.wardNumber]},l.id))]})})})]})]}),e.jsxs(Fe,{sx:{px:3,py:2},children:[e.jsx(D,{onClick:V,variant:"outlined",disabled:p,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(D,{onClick:Ce,variant:"contained",disabled:p,startIcon:p?e.jsx(we,{size:20}):e.jsx(fs,{}),sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none"},children:p?"Creating...":"Create User"})]})]})};class wt{constructor(){ts(this,"apiClient");this.apiClient=Js.create({baseURL:_s.BASE_URL,headers:{"Content-Type":"application/json"}}),this.apiClient.interceptors.request.use(x=>{const v=localStorage.getItem("accessToken");return v&&(x.headers.Authorization=`Bearer ${v}`),x})}async getConversation(x,v=1,S=50){try{return(await this.apiClient.get(`/api/admin/direct-chat/${x}`,{params:{page:v,limit:S}})).data.data}catch(o){throw o}}async sendMessage(x,v,S){try{return(await this.apiClient.post(`/api/admin/direct-chat/${x}`,{content:v,fileUrl:S})).data.data}catch(o){throw o}}}const ns=new wt,vt=({userId:s,open:x,onClose:v,userName:S="User"})=>{const o=Bs(),r=Hs(o.breakpoints.down("sm")),m=n.useRef(null),[N,p]=n.useState([]),[_,$]=n.useState(!1),[A,Z]=n.useState(null),[b,M]=n.useState(""),[E,se]=n.useState(!1),W=n.useCallback(()=>{m.current&&m.current.scrollIntoView({behavior:"smooth"})},[]);n.useEffect(()=>{x&&s&&X()},[x,s]),n.useEffect(()=>{W()},[N,W]);const X=async()=>{if(s)try{$(!0),Z(null);const j=await ns.getConversation(s);p(j.messages||[])}catch(j){console.error(j),Z("Failed to load conversation")}finally{$(!1)}},P=async()=>{if(!(!s||!b.trim()))try{se(!0);const j=await ns.sendMessage(s,b.trim());p(f=>[...f,j]),M(""),W()}catch(j){console.error(j),Ks.error("Failed to send message")}finally{se(!1)}},te=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),P())},L=()=>{p([]),M(""),Z(null),v()};return e.jsxs(We,{open:x,onClose:L,maxWidth:"sm",fullWidth:!0,fullScreen:r,PaperProps:{sx:{borderRadius:r?0:2,height:r?"100vh":"80vh",maxHeight:r?"100vh":"80vh",display:"flex",flexDirection:"column",animation:r?`${is} ${ie.normal.duration} ${ie.smooth.timing}`:`${ls} ${ie.normal.duration} ${ie.smooth.timing}`,animationFillMode:"both"}},children:[e.jsxs(ze,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(De,{sx:{width:40,height:40,bgcolor:"#2196F3"},children:e.jsx(dt,{})}),e.jsxs(a,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:S}),e.jsx(i,{variant:"caption",color:"text.secondary",children:"Direct Message"})]})]}),e.jsx(ge,{onClick:L,size:"small",children:e.jsx(Re,{})})]}),e.jsxs(Ee,{sx:{flex:1,overflowY:"auto",p:2,bgcolor:"#f8f9fa",display:"flex",flexDirection:"column",gap:2},children:[_&&e.jsx(a,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(we,{})}),A&&e.jsx(Ne,{severity:"error",children:A}),!_&&!A&&N.length===0&&e.jsxs(a,{sx:{textAlign:"center",pt:4,opacity:.7},children:[e.jsx(i,{children:"No messages yet."}),e.jsx(i,{variant:"caption",children:"Start a conversation!"})]}),!_&&N.map(j=>{var ee,I,H;const f=((I=(ee=j.sender)==null?void 0:ee.role)==null?void 0:I.includes("ADMIN"))||j.senderType==="ADMIN";return e.jsx(a,{sx:{display:"flex",justifyContent:f?"flex-end":"flex-start"},children:e.jsxs(a,{sx:{maxWidth:"75%"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5,justifyContent:f?"flex-end":"flex-start"},children:[f&&e.jsx(Gs,{sx:{fontSize:12,color:"success.main"}}),e.jsx(i,{variant:"caption",color:"text.secondary",children:f?"You":((H=j.sender)==null?void 0:H.firstName)||S})]}),e.jsx(a,{sx:{p:1.5,bgcolor:f?"primary.main":"white",color:f?"white":"text.primary",borderRadius:2,boxShadow:1},children:e.jsx(i,{variant:"body2",children:j.content||j.message})})]})},j.id)}),e.jsx("div",{ref:m})]}),e.jsx(a,{sx:{p:2,borderTop:"1px solid #e0e0e0",bgcolor:"white"},children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(T,{fullWidth:!0,size:"small",placeholder:"Type a message...",value:b,onChange:j=>M(j.target.value),onKeyPress:te,disabled:E,sx:{"& .MuiOutlinedInput-root":{borderRadius:3}}}),e.jsx(D,{variant:"contained",onClick:P,disabled:!b.trim()||E,sx:{minWidth:50,height:40,borderRadius:"50%"},children:E?e.jsx(we,{size:20,color:"inherit"}):e.jsx(ct,{fontSize:"small"})})]})})]})},Mt=()=>{var Xe,es;const{user:s}=Le(),[x,v]=n.useState([]),[S,o]=n.useState(!0),[r,m]=n.useState(null),[N,p]=n.useState(""),[_,$]=n.useState(""),[A,Z]=n.useState([]),[b,M]=n.useState(""),[E,se]=n.useState(null),[W,X]=n.useState(""),[P,te]=n.useState(null),[L,j]=n.useState([]),[f,ee]=n.useState(!1),[I,H]=n.useState(!1),[le,de]=n.useState([]),[U,ue]=n.useState(null),[ce,je]=n.useState(!0),[xe,he]=n.useState(null),[G,Ce]=n.useState([]),[V,l]=n.useState(!1),[R,B]=n.useState(!1),[z,c]=n.useState(!1),[w,K]=n.useState(!1),[F,oe]=n.useState(null),[u,ne]=n.useState([]),[Q,ve]=n.useState(Qs.ACTIVE),[g,Y]=n.useState({page:1,limit:20,total:0}),[O,Ge]=n.useState({open:!1,message:"",severity:"success"}),[Oe,Ke]=n.useState({viewUser:null,statusChange:null});n.useEffect(()=>{const t=setTimeout(()=>{$(N)},500);return()=>clearTimeout(t)},[N]),n.useEffect(()=>{s&&(async()=>{var h,k;console.log("ðŸ”„ UserManagement: Starting data fetch for user:",s==null?void 0:s.id,s==null?void 0:s.role);const d=[Be.getCityCorporations("ACTIVE").catch(fe=>(console.error("âŒ Error fetching city corporations:",fe),{cityCorporations:[]}))];(s==null?void 0:s.role)==="SUPER_ADMIN"&&s.id&&(console.log("ðŸ‘¤ Fetching assigned zones for Super Admin:",s.id),d.push(He.getAssignedZones(Number(s.id)).catch(fe=>(console.error("âŒ Error fetching assigned zones:",fe),[])))),ee(!0);try{const fe=await Promise.all(d),Ds=fe[0],$e=fe[1];let Ze=Ds.cityCorporations||[];if(console.log("ðŸ™ï¸ Fetched City Corps:",Ze.length),Z(Ze),s&&s.role!=="MASTER_ADMIN"){const q=s.cityCorporationCode||((h=s.cityCorporation)==null?void 0:h.code);q&&(console.log("ðŸŽ¯ Auto-selecting City Corp for assigned code:",q),Ze.some(ae=>ae.code===q)&&b!==q&&M(q))}if($e){console.log("ðŸ›¡ï¸ Raw Assigned Zones:",$e);const q=$e.map(J=>{const ae=J.zone||J;return!ae||!ae.id?null:{id:ae.id,zoneNumber:ae.zoneNumber,name:ae.name,cityCorporationId:ae.cityCorporationId||0,status:"ACTIVE",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}).filter(J=>J!==null);console.log("âœ… Formatted Assigned Zones:",q),de(q),q.length===1&&(console.log("ðŸ‘Œ Auto-selecting single zone:",q[0].id),X(q[0].id))}if((s==null?void 0:s.role)==="ADMIN"){console.log("ðŸ‘¤ Loading assigned wards for Admin");let q=[];if(s.permissions)try{const J=JSON.parse(s.permissions);J.wards&&Array.isArray(J.wards)&&(q=J.wards)}catch(J){console.error("Error parsing admin permissions:",J)}if(console.log(`ðŸ”’ ADMIN assigned ward IDs: [${q.join(", ")}]`),q.length>0)try{H(!0);const J=s.cityCorporationCode||((k=s.cityCorporation)==null?void 0:k.code);if(J){const ae=await ke.getWards({cityCorporationCode:J,status:"ACTIVE"});console.log("ðŸ“‹ All wards from API:",ae.wards);const ss=ae.wards.filter(ks=>q.includes(ks.id));console.log("âœ… Filtered assigned wards:",ss),j(ss)}}catch(J){console.error("âŒ Error fetching assigned wards:",J),j([])}finally{H(!1)}else console.log("âš ï¸ ADMIN has no assigned wards"),j([])}}catch(fe){console.error("âŒ Error in UserManagement fetchData:",fe)}finally{ee(!1)}})()},[s]),n.useEffect(()=>{if(b!=="ALL"){const t=A.find(d=>d.code===b);t&&se(t.id)}else se(null),j([]);X(""),te(null)},[b,A]),n.useEffect(()=>{(s==null?void 0:s.role)!=="ADMIN"&&(W?ps(W):j([]),te(null))},[W,s]),n.useEffect(()=>{Pe()},[_,Q,b,W,P,g.page]),n.useEffect(()=>{Se()},[b,W,P]),n.useEffect(()=>{const t=setInterval(()=>{Se()},3e4);return()=>clearInterval(t)},[b,W,P]);const ps=async t=>{try{H(!0);const d=await ke.getWardsByZone(t,"ACTIVE");j(d)}catch(d){console.error("Error fetching wards:",d),me("Failed to load wards","error")}finally{H(!1)}},Pe=n.useCallback(async()=>{var t,d;try{o(!0),m(null);const h=await ye.getUsers({page:g.page,limit:g.limit,search:_||void 0,status:Q!=="ALL"?Q:void 0,role:"CUSTOMER",cityCorporationCode:b!=="ALL"?b:void 0,zoneId:W||void 0,wardId:P||void 0});v(h.users),Y(k=>({...k,total:h.pagination.total}))}catch(h){console.error("Error fetching users:",h),m(((d=(t=h.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to load users. Please try again."),me("Failed to load users","error")}finally{o(!1)}},[_,Q,b,W,P,g.page,g.limit]),Se=async()=>{try{je(!0);const t=await ye.getUserStatistics(b!=="ALL"?b:void 0,"CUSTOMER",W?Number(W):void 0,P?Number(P):void 0);ue(t)}catch(t){console.error("Error fetching statistics:",t)}finally{je(!1)}},gs=t=>{p(t),Y(d=>({...d,page:1}))},us=t=>{ve(t),Y(d=>({...d,page:1}))},Qe=()=>{p(""),ve("ALL"),M("ALL"),M("ALL"),X(""),te(null),Y(t=>({...t,page:1}))},js=async t=>{try{Ke(h=>({...h,viewUser:t}));const d=await ye.getUserById(t);he(d.user),Ce(d.recentComplaints||[]),l(!0)}catch(d){console.error("Error fetching user details:",d),me("Failed to load user details","error")}finally{Ke(d=>({...d,viewUser:null}))}},Cs=t=>{he(t),B(!0)},ys=()=>{c(!0)},bs=async t=>{var d,h;if(xe)try{await ye.updateUser(xe.id,t),me("User updated successfully","success"),B(!1),he(null),await Pe(),await Se()}catch(k){throw console.error("Error updating user:",k),me(((h=(d=k.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to update user","error"),k}},ws=async t=>{var d,h;try{await ye.createUser(t),me("User created successfully","success"),c(!1),await Pe(),await Se()}catch(k){throw console.error("Error creating user:",k),me(((h=(d=k.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to create user","error"),k}},vs=t=>{oe(t),K(!0)},Ss=()=>{K(!1),oe(null)},Is=async()=>{if(u.length!==0&&window.confirm(`Are you sure you want to delete ${u.length} users?`))try{await ye.bulkDeleteUsers(u),me("Users deleted successfully","success"),ne([]),Pe(),Se()}catch(t){me(t.message||"Failed to delete users","error")}},Ns=t=>{if(t.target.checked){const d=x.map(h=>h.id);ne(d);return}ne([])},As=t=>{const d=u.indexOf(t);let h=[];d===-1?h=h.concat(u,t):d===0?h=h.concat(u.slice(1)):d===u.length-1?h=h.concat(u.slice(0,-1)):d>0&&(h=h.concat(u.slice(0,d),u.slice(d+1))),ne(h)},me=(t,d)=>{Ge({open:!0,message:t,severity:d})},Ye=()=>{Ge(t=>({...t,open:!1}))},Ws=t=>t?t.startsWith("+")?t:t.length===11&&t.startsWith("0")?`+880 ${t.substring(1,5)}-${t.substring(5)}`:t:"N/A",zs=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Es=(t,d)=>{const h=typeof t=="string"?t:String(t||""),k=typeof d=="string"?d:String(d||"");return`${h.charAt(0)}${k.charAt(0)}`.toUpperCase()},Ps=()=>!U||U.totalComplaints===0?"0":(U.resolvedComplaints/U.totalComplaints*100).toFixed(0),Ts=[{title:"Total Citizens",value:ce?"...":String((U==null?void 0:U.totalCitizens)||0),color:"#2196F3"},{title:"Total Complaints",value:ce?"...":String((U==null?void 0:U.totalComplaints)||0),color:"#FF9800"},{title:"Resolved",value:ce?"...":String((U==null?void 0:U.resolvedComplaints)||0),color:"#4CAF50"},{title:"Success Rate",value:ce?"...":`${Ps()}%`,color:"#9C27B0"}];return e.jsx(Ys,{children:e.jsxs(Xs,{title:"User Management",children:[e.jsxs(a,{sx:{width:"100%",maxWidth:"100%",px:1.5,mx:0},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"h4",sx:{fontWeight:600,mb:.5,color:"text.primary"},children:"User Management"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Manage citizen accounts and information"})]}),((s==null?void 0:s.role)==="MASTER_ADMIN"||(s==null?void 0:s.role)==="SUPER_ADMIN"&&!((es=(Xe=s==null?void 0:s.permissions)==null?void 0:Xe.features)!=null&&es.viewOnlyMode))&&e.jsx(D,{variant:"contained",startIcon:e.jsx(fs,{}),onClick:ys,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3,py:1.5,borderRadius:2},children:"Add New User"})]}),e.jsx(a,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"repeat(4, 1fr)"},gap:2,mb:4},children:Ts.map((t,d)=>e.jsx(as,{sx:{borderRadius:2,border:"1px solid #e0e0e0","&:hover":{boxShadow:2}},children:e.jsx(rs,{sx:{p:3,textAlign:"center"},children:ce?e.jsxs(e.Fragment,{children:[e.jsx(re,{variant:"rectangular",width:"60%",height:48,sx:{mx:"auto",mb:1,borderRadius:1}}),e.jsx(re,{variant:"text",width:"80%",height:20,sx:{mx:"auto"}})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:t.color,mb:1},children:t.value}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:t.title})]})})},d))}),e.jsx(as,{sx:{borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(rs,{sx:{p:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,gap:2},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Citizen Directory"}),e.jsxs(a,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(T,{placeholder:"Search by name, email, or ward...",value:N,onChange:t=>gs(t.target.value),InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(et,{sx:{color:"text.secondary"}})})},sx:{width:300,"& .MuiOutlinedInput-root":{height:40,backgroundColor:"#f8f9fa"}}}),u.length>0&&e.jsxs(D,{variant:"outlined",color:"error",onClick:Is,sx:{ml:2,height:40},children:["Delete Selected (",u.length,")"]})]})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(qe,{sx:{minWidth:200},children:[e.jsx(Je,{id:"city-corporation-filter-label",sx:{top:-8},children:"City Corporation"}),e.jsxs(Te,{labelId:"city-corporation-filter-label",value:f?"":b,onChange:t=>M(t.target.value),label:"City Corporation",disabled:(s==null?void 0:s.role)==="ADMIN"||f||(s==null?void 0:s.role)!=="MASTER_ADMIN"&&A.length<=1,sx:{height:40,backgroundColor:"#f8f9fa"},displayEmpty:!0,renderValue:t=>{if(f)return e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{size:16}),e.jsx(i,{variant:"body2",children:"Loading..."})]});if(!t)return"Select City Corporation";if(t==="ALL")return"All City Corporations";const d=A.find(h=>h.code===t);return d?typeof d.name=="object"?JSON.stringify(d.name):d.name:t},children:[(s==null?void 0:s.role)==="MASTER_ADMIN"&&e.jsx(y,{value:"ALL",children:"All City Corporations"}),A&&A.map(t=>e.jsx(y,{value:t.code,children:typeof t.name=="object"?JSON.stringify(t.name):t.name},t.code))]})]}),(s==null?void 0:s.role)!=="ADMIN"&&e.jsx(a,{sx:{minWidth:200},children:e.jsx(st,{value:W,onChange:t=>X(t),cityCorporationCode:b!=="ALL"?b:"",disabled:!1,zones:le.length>0?le:void 0})}),e.jsxs(qe,{sx:{minWidth:200},children:[e.jsx(Je,{id:"ward-filter-label",sx:{top:-8},children:"Ward"}),e.jsxs(Te,{labelId:"ward-filter-label",value:P||"",onChange:t=>te(t.target.value?Number(t.target.value):null),label:"Ward",disabled:(s==null?void 0:s.role)==="ADMIN"?I||!L||L.length===0:!W||I||!L||L.length===0,sx:{height:40,backgroundColor:"#f8f9fa"},children:[(s==null?void 0:s.role)!=="ADMIN"&&e.jsx(y,{value:"",children:"All Wards"}),L&&L.map(t=>e.jsxs(y,{value:t.id,children:["Ward ",typeof t.wardNumber=="object"?JSON.stringify(t.wardNumber):t.wardNumber]},t.id))]})]}),e.jsxs(qe,{sx:{minWidth:150},children:[e.jsx(Je,{id:"status-filter-label",sx:{top:-8},children:"Status"}),e.jsxs(Te,{labelId:"status-filter-label",value:Q,onChange:t=>us(t.target.value),label:"Status",startAdornment:e.jsx(be,{position:"start",children:e.jsx(xt,{sx:{fontSize:18,color:"text.secondary"}})}),sx:{height:40,backgroundColor:"#f8f9fa"},children:[e.jsx(y,{value:"ALL",children:"All Status"}),e.jsx(y,{value:"ACTIVE",children:"Active"}),e.jsx(y,{value:"INACTIVE",children:"Inactive"}),e.jsx(y,{value:"SUSPENDED",children:"Suspended"}),e.jsx(y,{value:"PENDING",children:"Pending"})]})]}),(N||Q!=="ALL"||b!=="ALL"||W||P)&&e.jsx(D,{variant:"outlined",onClick:Qe,sx:{height:40,textTransform:"none",borderColor:"#e0e0e0",color:"text.secondary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Clear Filters"})]}),e.jsx(tt,{component:at,elevation:0,children:e.jsxs(rt,{sx:{minWidth:650},children:[e.jsx(ot,{children:e.jsxs(Ie,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(C,{padding:"checkbox",children:e.jsx(os,{indeterminate:u.length>0&&u.length<x.length,checked:x.length>0&&u.length===x.length,onChange:Ns})}),e.jsx(C,{sx:{fontWeight:600},children:"Citizen"}),e.jsx(C,{sx:{fontWeight:600},children:"Contact"}),e.jsx(C,{sx:{fontWeight:600},children:"City Corporation"}),e.jsx(C,{sx:{fontWeight:600},children:"Location"}),e.jsx(C,{sx:{fontWeight:600},children:"Complaints"}),e.jsx(C,{sx:{fontWeight:600},children:"Resolved"}),e.jsx(C,{sx:{fontWeight:600},children:"Unresolved"}),e.jsx(C,{sx:{fontWeight:600},children:"Join Date"}),e.jsx(C,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(nt,{children:S?Array.from({length:5}).map((t,d)=>e.jsxs(Ie,{children:[e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})}),e.jsx(C,{children:e.jsx(re,{variant:"rectangular",height:40})})]},d)):r?e.jsx(Ie,{children:e.jsx(C,{colSpan:9,children:e.jsx(Ne,{severity:"error",sx:{my:2},children:r})})}):x.length===0?e.jsx(Ie,{children:e.jsx(C,{colSpan:9,children:e.jsx(ut,{icon:N||Q!=="ALL"?e.jsx(ht,{sx:{fontSize:40,color:"#9e9e9e"}}):e.jsx(gt,{sx:{fontSize:40,color:"#9e9e9e"}}),title:N||Q!=="ALL"?"No users found":"No users registered yet",description:N||Q!=="ALL"?"Try adjusting your search or filters to find what you're looking for.":"Users who register through the mobile app will appear here.",action:N||Q!=="ALL"?{label:"Clear Filters",onClick:Qe}:void 0})})}):x.map(t=>{var h,k;const d=u.indexOf(t.id)!==-1;return typeof t.ward=="object"&&t.ward!==null&&!("wardNumber"in t.ward)&&console.error("Suspicious Ward object found:",t.ward),typeof t.zone=="object"&&t.zone!==null&&!("zoneNumber"in t.zone)&&console.error("Suspicious Zone object found:",t.zone),e.jsxs(Ie,{hover:!0,selected:d,sx:{"&:hover":{backgroundColor:"#f8f9fa"}},children:[e.jsx(C,{padding:"checkbox",children:e.jsx(os,{checked:d,onChange:()=>As(t.id)})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.avatar?e.jsx(De,{src:t.avatar,sx:{width:40,height:40}}):e.jsx(De,{sx:{width:40,height:40,bgcolor:"#4CAF50"},children:Es(t.firstName,t.lastName)}),e.jsxs(a,{children:[e.jsx(i,{variant:"body1",sx:{fontWeight:500},children:`${typeof t.firstName=="object"?JSON.stringify(t.firstName):t.firstName} ${typeof t.lastName=="object"?JSON.stringify(t.lastName):t.lastName}`}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["#",String(t.id).padStart(6,"0")]})]})]})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ds,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:typeof t.email=="object"?JSON.stringify(t.email):t.email||"N/A"})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(cs,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:typeof t.phone=="object"?JSON.stringify(t.phone):Ws(t.phone)})]})]})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:typeof((h=t.cityCorporation)==null?void 0:h.name)=="object"?JSON.stringify(t.cityCorporation.name):((k=t.cityCorporation)==null?void 0:k.name)||"N/A"}),t.cityCorporation&&e.jsx(i,{variant:"caption",color:"text.secondary",children:typeof t.cityCorporation.code=="object"?JSON.stringify(t.cityCorporation.code):t.cityCorporation.code})]})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[t.zone?e.jsx(pe,{label:`Zone ${typeof t.zone.zoneNumber=="object"?JSON.stringify(t.zone.zoneNumber):t.zone.zoneNumber}${t.zone.name?` - ${typeof t.zone.name=="object"?JSON.stringify(t.zone.name):t.zone.name}`:""}`,size:"small",variant:"outlined",color:"primary",sx:{height:24,justifyContent:"flex-start"}}):null,t.ward?e.jsx(pe,{label:`Ward ${typeof t.ward.wardNumber=="object"?JSON.stringify(t.ward.wardNumber):t.ward.wardNumber}`,size:"small",variant:"outlined",sx:{height:24,justifyContent:"flex-start"}}):null,!t.zone&&!t.ward&&e.jsx(i,{variant:"caption",color:"text.secondary",children:"N/A"})]})}),e.jsx(C,{children:e.jsx(pe,{label:String(t.statistics.totalComplaints),sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}})}),e.jsx(C,{children:e.jsx(pe,{label:String(t.statistics.resolvedComplaints),sx:{backgroundColor:"#e8f5e8",color:"#2e7d2e",fontWeight:500}})}),e.jsx(C,{children:e.jsx(pe,{label:String(t.statistics.unresolvedComplaints),sx:{backgroundColor:"#ffebee",color:"#c62828",fontWeight:500}})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xs,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(i,{variant:"body2",children:zs(t.createdAt)})]})}),e.jsx(C,{children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[["MASTER_ADMIN","SUPER_ADMIN"].includes((s==null?void 0:s.role)||"")&&e.jsx(D,{variant:"outlined",size:"small",startIcon:Oe.viewUser===t.id?e.jsx(we,{size:16}):e.jsx(Ae,{}),onClick:()=>js(t.id),disabled:Oe.viewUser===t.id,sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:Oe.viewUser===t.id?"Loading...":"View"}),e.jsx(D,{variant:"outlined",size:"small",color:"primary",onClick:()=>vs(t),sx:{textTransform:"none",borderColor:"#e0e0e0",minWidth:"40px",color:"text.primary","&:hover":{borderColor:"#2196F3",color:"#2196F3"}},children:e.jsx(mt,{fontSize:"small"})}),e.jsx(D,{variant:"outlined",size:"small",startIcon:e.jsx(hs,{}),onClick:()=>Cs(t),sx:{textTransform:"none",borderColor:"#e0e0e0",color:"text.primary","&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Edit"})]})})]},t.id)})})]})}),!S&&!r&&x.length>0&&e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderTop:"1px solid #e0e0e0",flexWrap:"wrap",gap:2},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Showing ",(g.page-1)*g.limit+1," to"," ",Math.min(g.page*g.limit,g.total)," of"," ",g.total.toLocaleString()," users"]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Rows per page:"}),e.jsxs(Te,{value:g.limit,onChange:t=>Y(d=>({...d,limit:Number(t.target.value),page:1})),size:"small",sx:{minWidth:80},children:[e.jsx(y,{value:20,children:"20"}),e.jsx(y,{value:50,children:"50"}),e.jsx(y,{value:100,children:"100"}),e.jsx(y,{value:200,children:"200"})]})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(D,{size:"small",onClick:()=>Y(t=>({...t,page:1})),disabled:g.page===1,sx:{minWidth:"auto",px:1},children:"First"}),e.jsx(D,{size:"small",onClick:()=>Y(t=>({...t,page:t.page-1})),disabled:g.page===1,sx:{minWidth:"auto",px:1},children:"Previous"}),e.jsxs(i,{variant:"body2",sx:{mx:2},children:["Page ",g.page," of ",Math.ceil(g.total/g.limit)]}),e.jsx(D,{size:"small",onClick:()=>Y(t=>({...t,page:t.page+1})),disabled:g.page>=Math.ceil(g.total/g.limit),sx:{minWidth:"auto",px:1},children:"Next"}),e.jsx(D,{size:"small",onClick:()=>Y(t=>({...t,page:Math.ceil(g.total/g.limit)})),disabled:g.page>=Math.ceil(g.total/g.limit),sx:{minWidth:"auto",px:1},children:"Last"})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Go to:"}),e.jsx(T,{type:"number",size:"small",value:g.page,onChange:t=>{const d=parseInt(t.target.value),h=Math.ceil(g.total/g.limit);d>=1&&d<=h&&Y(k=>({...k,page:d}))},inputProps:{min:1,max:Math.ceil(g.total/g.limit),style:{textAlign:"center"}},sx:{width:80}})]})]})]})]})})]}),e.jsx(jt,{user:xe,recentComplaints:G,open:V,onClose:()=>{l(!1),he(null),Ce([])},onEdit:()=>{l(!1),B(!0)}}),e.jsx(yt,{user:xe,open:R,onClose:()=>{B(!1),he(null)},onSave:bs}),e.jsx(bt,{open:z,onClose:()=>c(!1),onSave:ws}),F&&e.jsx(vt,{userId:F.id,userName:`${F.firstName} ${F.lastName}`,open:w,onClose:Ss}),e.jsx(ft,{open:O.open,autoHideDuration:6e3,onClose:Ye,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ne,{onClose:Ye,severity:O.severity,sx:{width:"100%"},children:O.message})})]})})};export{Mt as default};
