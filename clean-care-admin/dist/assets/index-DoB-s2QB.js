var ws=Object.defineProperty;var Is=(o,t,r)=>t in o?ws(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r;var vt=(o,t,r)=>Is(o,typeof t!="symbol"?t+"":t,r);import{g as Mt,a as Nt,r as n,u as Lt,c as Se,j as e,s as Ee,b as as,d as zt,B as ls,m as Pt,e as ze,f as As,h as is,o as cs,i as ds,k as lt,l as kt,n as Et,p as Me,q as Rs,t as Ts,v as us,w as Ne,x as Ke,D as hs,y as $t,z as be,A as Os,C as Ms,E as ps,F as m,G as Ns,T as p,I as wt,H as _t,J as xs,K as Ye,L as Ls,M as zs,N as Ot,O as Qe,P as Ce,Q as Le,R as it,S as ct,U as Je,V as qe,W as T,X as Ze,Y as Ps,Z as ks,_ as Ds,$ as Ws,a0 as Bs,a1 as Fs,a2 as Vt,a3 as Xt,a4 as Ut,a5 as Hs,a6 as $s,a7 as _s,a8 as Gt,a9 as Vs,aa as Kt,ab as Xs,ac as Us,ad as Gs,ae as Ks,af as Zs,ag as It,ah as H,ai as Ys,aj as Zt,ak as Yt,al as Js,am as qs,an as Qs,ao as eo}from"./index-CpMFUl0-.js";import{s as At,a as Jt,b as to}from"./toastUtils-D0pTWm9R.js";import{E as qt,a as Qt,u as so,C as oo,b as ro}from"./useDebounce-DWbdzK6W.js";import{P as no}from"./Person-Cga43oxl.js";import{I as ao,c as fs,H as lo,a as es}from"./categoryService-CLCJf9LD.js";import{S as io}from"./Send-Dj4BuzPp.js";import"./userManagementService-C7pm6TD4.js";import{F as co}from"./FilterList-NQreUJZr.js";import{C as uo}from"./Collapse-DR_hkSFT.js";import{G as xe}from"./Grid-CXliHFNi.js";import{D as ho}from"./Download-rwr3ndKm.js";import{P as po}from"./Pagination-Cw5CmmXv.js";import"./styled-C0WY_1v_.js";import"./useThemeProps-DQBRHprK.js";function xo(o){return Nt("MuiTab",o)}const re=Mt("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper","icon"]),fo=o=>{const{classes:t,textColor:r,fullWidth:d,wrapped:a,icon:u,label:h,selected:b,disabled:C}=o,j={root:["root",u&&h&&"labelIcon",`textColor${as(r)}`,d&&"fullWidth",a&&"wrapped",b&&"selected",C&&"disabled"],icon:["iconWrapper","icon"]};return zt(j,xo,t)},go=Ee(ls,{name:"MuiTab",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.root,r.label&&r.icon&&t.labelIcon,t[`textColor${as(r.textColor)}`],r.fullWidth&&t.fullWidth,r.wrapped&&t.wrapped,{[`& .${re.iconWrapper}`]:t.iconWrapper},{[`& .${re.icon}`]:t.icon}]}})(Pt(({theme:o})=>({...o.typography.button,maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center",lineHeight:1.25,variants:[{props:({ownerState:t})=>t.label&&(t.iconPosition==="top"||t.iconPosition==="bottom"),style:{flexDirection:"column"}},{props:({ownerState:t})=>t.label&&t.iconPosition!=="top"&&t.iconPosition!=="bottom",style:{flexDirection:"row"}},{props:({ownerState:t})=>t.icon&&t.label,style:{minHeight:72,paddingTop:9,paddingBottom:9}},{props:({ownerState:t,iconPosition:r})=>t.icon&&t.label&&r==="top",style:{[`& > .${re.icon}`]:{marginBottom:6}}},{props:({ownerState:t,iconPosition:r})=>t.icon&&t.label&&r==="bottom",style:{[`& > .${re.icon}`]:{marginTop:6}}},{props:({ownerState:t,iconPosition:r})=>t.icon&&t.label&&r==="start",style:{[`& > .${re.icon}`]:{marginRight:o.spacing(1)}}},{props:({ownerState:t,iconPosition:r})=>t.icon&&t.label&&r==="end",style:{[`& > .${re.icon}`]:{marginLeft:o.spacing(1)}}},{props:{textColor:"inherit"},style:{color:"inherit",opacity:.6,[`&.${re.selected}`]:{opacity:1},[`&.${re.disabled}`]:{opacity:(o.vars||o).palette.action.disabledOpacity}}},{props:{textColor:"primary"},style:{color:(o.vars||o).palette.text.secondary,[`&.${re.selected}`]:{color:(o.vars||o).palette.primary.main},[`&.${re.disabled}`]:{color:(o.vars||o).palette.text.disabled}}},{props:{textColor:"secondary"},style:{color:(o.vars||o).palette.text.secondary,[`&.${re.selected}`]:{color:(o.vars||o).palette.secondary.main},[`&.${re.disabled}`]:{color:(o.vars||o).palette.text.disabled}}},{props:({ownerState:t})=>t.fullWidth,style:{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"}},{props:({ownerState:t})=>t.wrapped,style:{fontSize:o.typography.pxToRem(12)}}]}))),Ge=n.forwardRef(function(t,r){const d=Lt({props:t,name:"MuiTab"}),{className:a,disabled:u=!1,disableFocusRipple:h=!1,fullWidth:b,icon:C,iconPosition:j="top",indicator:v,label:w,onChange:i,onClick:R,onFocus:I,selected:L,selectionFollowsFocus:W,textColor:B="inherit",value:V,wrapped:$=!1,...z}=d,q={...d,disabled:u,disableFocusRipple:h,selected:L,icon:!!C,iconPosition:j,label:!!w,fullWidth:b,textColor:B,wrapped:$},Q=fo(q),P=C&&w&&n.isValidElement(C)?n.cloneElement(C,{className:Se(Q.icon,C.props.className)}):C,ae=U=>{!L&&i&&i(U,V),R&&R(U)},le=U=>{W&&!L&&i&&i(U,V),I&&I(U)};return e.jsxs(go,{focusRipple:!h,className:Se(Q.root,a),ref:r,role:"tab","aria-selected":L,disabled:u,onClick:ae,onFocus:le,ownerState:q,tabIndex:L?0:-1,...z,children:[j==="top"||j==="start"?e.jsxs(n.Fragment,{children:[P,w]}):e.jsxs(n.Fragment,{children:[w,P]}),v]})}),mo=ze(e.jsx("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})),bo=ze(e.jsx("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}));function Co(o){return(1+Math.sin(Math.PI*o-Math.PI/2))/2}function So(o,t,r,d={},a=()=>{}){const{ease:u=Co,duration:h=300}=d;let b=null;const C=t[o];let j=!1;const v=()=>{j=!0},w=i=>{if(j){a(new Error("Animation cancelled"));return}b===null&&(b=i);const R=Math.min(1,(i-b)/h);if(t[o]=u(R)*(r-C)+C,R>=1){requestAnimationFrame(()=>{a(null)});return}requestAnimationFrame(w)};return C===r?(a(new Error("Element already at target position")),v):(requestAnimationFrame(w),v)}const yo={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};function jo(o){const{onChange:t,...r}=o,d=n.useRef(),a=n.useRef(null),u=()=>{d.current=a.current.offsetHeight-a.current.clientHeight};return As(()=>{const h=is(()=>{const C=d.current;u(),C!==d.current&&t(d.current)}),b=cs(a.current);return b.addEventListener("resize",h),()=>{h.clear(),b.removeEventListener("resize",h)}},[t]),n.useEffect(()=>{u(),t(d.current)},[t]),e.jsx("div",{style:yo,...r,ref:a})}function vo(o){return Nt("MuiTabScrollButton",o)}const Eo=Mt("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),wo=o=>{const{classes:t,orientation:r,disabled:d}=o;return zt({root:["root",r,d&&"disabled"]},vo,t)},Io=Ee(ls,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.root,r.orientation&&t[r.orientation]]}})({width:40,flexShrink:0,opacity:.8,[`&.${Eo.disabled}`]:{opacity:0},variants:[{props:{orientation:"vertical"},style:{width:"100%",height:40,"& svg":{transform:"var(--TabScrollButton-svgRotate)"}}}]}),Ao=n.forwardRef(function(t,r){const d=Lt({props:t,name:"MuiTabScrollButton"}),{className:a,slots:u={},slotProps:h={},direction:b,orientation:C,disabled:j,...v}=d,w=ds(),i={isRtl:w,...d},R=wo(i),I=u.StartScrollButtonIcon??mo,L=u.EndScrollButtonIcon??bo,W=lt({elementType:I,externalSlotProps:h.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:i}),B=lt({elementType:L,externalSlotProps:h.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:i});return e.jsx(Io,{component:"div",className:Se(R.root,a),ref:r,role:null,ownerState:i,tabIndex:null,...v,style:{...v.style,...C==="vertical"&&{"--TabScrollButton-svgRotate":`rotate(${w?-90:90}deg)`}},children:b==="left"?e.jsx(I,{...W}):e.jsx(L,{...B})})});function Ro(o){return Nt("MuiTabs",o)}const Rt=Mt("MuiTabs",["root","vertical","list","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),ts=(o,t)=>o===t?o.firstChild:t&&t.nextElementSibling?t.nextElementSibling:o.firstChild,ss=(o,t)=>o===t?o.lastChild:t&&t.previousElementSibling?t.previousElementSibling:o.lastChild,at=(o,t,r)=>{let d=!1,a=r(o,t);for(;a;){if(a===o.firstChild){if(d)return;d=!0}const u=a.disabled||a.getAttribute("aria-disabled")==="true";if(!a.hasAttribute("tabindex")||u)a=r(o,a);else{a.focus();return}}},To=o=>{const{vertical:t,fixed:r,hideScrollbar:d,scrollableX:a,scrollableY:u,centered:h,scrollButtonsHideMobile:b,classes:C}=o;return zt({root:["root",t&&"vertical"],scroller:["scroller",r&&"fixed",d&&"hideScrollbar",a&&"scrollableX",u&&"scrollableY"],list:["list","flexContainer",t&&"flexContainerVertical",t&&"vertical",h&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",b&&"scrollButtonsHideMobile"],scrollableX:[a&&"scrollableX"],hideScrollbar:[d&&"hideScrollbar"]},Ro,C)},Oo=Ee("div",{name:"MuiTabs",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[{[`& .${Rt.scrollButtons}`]:t.scrollButtons},{[`& .${Rt.scrollButtons}`]:r.scrollButtonsHideMobile&&t.scrollButtonsHideMobile},t.root,r.vertical&&t.vertical]}})(Pt(({theme:o})=>({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex",variants:[{props:({ownerState:t})=>t.vertical,style:{flexDirection:"column"}},{props:({ownerState:t})=>t.scrollButtonsHideMobile,style:{[`& .${Rt.scrollButtons}`]:{[o.breakpoints.down("sm")]:{display:"none"}}}}]}))),Mo=Ee("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.scroller,r.fixed&&t.fixed,r.hideScrollbar&&t.hideScrollbar,r.scrollableX&&t.scrollableX,r.scrollableY&&t.scrollableY]}})({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap",variants:[{props:({ownerState:o})=>o.fixed,style:{overflowX:"hidden",width:"100%"}},{props:({ownerState:o})=>o.hideScrollbar,style:{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}},{props:({ownerState:o})=>o.scrollableX,style:{overflowX:"auto",overflowY:"hidden"}},{props:({ownerState:o})=>o.scrollableY,style:{overflowY:"auto",overflowX:"hidden"}}]}),No=Ee("div",{name:"MuiTabs",slot:"List",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.list,t.flexContainer,r.vertical&&t.flexContainerVertical,r.centered&&t.centered]}})({display:"flex",variants:[{props:({ownerState:o})=>o.vertical,style:{flexDirection:"column"}},{props:({ownerState:o})=>o.centered,style:{justifyContent:"center"}}]}),Lo=Ee("span",{name:"MuiTabs",slot:"Indicator"})(Pt(({theme:o})=>({position:"absolute",height:2,bottom:0,width:"100%",transition:o.transitions.create(),variants:[{props:{indicatorColor:"primary"},style:{backgroundColor:(o.vars||o).palette.primary.main}},{props:{indicatorColor:"secondary"},style:{backgroundColor:(o.vars||o).palette.secondary.main}},{props:({ownerState:t})=>t.vertical,style:{height:"100%",width:2,right:0}}]}))),zo=Ee(jo)({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),os={},Po=n.forwardRef(function(t,r){const d=Lt({props:t,name:"MuiTabs"}),a=kt(),u=ds(),{"aria-label":h,"aria-labelledby":b,action:C,centered:j=!1,children:v,className:w,component:i="div",allowScrollButtonsMobile:R=!1,indicatorColor:I="primary",onChange:L,orientation:W="horizontal",ScrollButtonComponent:B,scrollButtons:V="auto",selectionFollowsFocus:$,slots:z={},slotProps:q={},TabIndicatorProps:Q={},TabScrollButtonProps:P={},textColor:ae="primary",value:le,variant:U="standard",visibleScrollbar:ee=!1,...fe}=d,G=U==="scrollable",X=W==="vertical",ue=X?"scrollTop":"scrollLeft",x=X?"top":"left",f=X?"bottom":"right",te=X?"clientHeight":"clientWidth",N=X?"height":"width",k={...d,component:i,allowScrollButtonsMobile:R,indicatorColor:I,orientation:W,vertical:X,scrollButtons:V,textColor:ae,variant:U,visibleScrollbar:ee,fixed:!G,hideScrollbar:G&&!ee,scrollableX:G&&!X,scrollableY:G&&X,centered:j&&!G,scrollButtonsHideMobile:!R},K=To(k),ie=lt({elementType:z.StartScrollButtonIcon,externalSlotProps:q.startScrollButtonIcon,ownerState:k}),Dt=lt({elementType:z.EndScrollButtonIcon,externalSlotProps:q.endScrollButtonIcon,ownerState:k}),[Pe,Wt]=n.useState(!1),[ce,ge]=n.useState(os),[ke,Z]=n.useState(!1),[Y,dt]=n.useState(!1),[et,ut]=n.useState(!1),[tt,ht]=n.useState({overflow:"hidden",scrollbarWidth:0}),De=new Map,ne=n.useRef(null),he=n.useRef(null),me={slots:z,slotProps:{indicator:Q,scrollButton:P,...q}},st=()=>{const l=ne.current;let c;if(l){const y=l.getBoundingClientRect();c={clientWidth:l.clientWidth,scrollLeft:l.scrollLeft,scrollTop:l.scrollTop,scrollWidth:l.scrollWidth,top:y.top,bottom:y.bottom,left:y.left,right:y.right}}let S;if(l&&le!==!1){const y=he.current.children;if(y.length>0){const A=y[De.get(le)];S=A?A.getBoundingClientRect():null}}return{tabsMeta:c,tabMeta:S}},ye=Et(()=>{const{tabsMeta:l,tabMeta:c}=st();let S=0,y;X?(y="top",c&&l&&(S=c.top-l.top+l.scrollTop)):(y=u?"right":"left",c&&l&&(S=(u?-1:1)*(c[y]-l[y]+l.scrollLeft)));const A={[y]:S,[N]:c?c[N]:0};if(typeof ce[y]!="number"||typeof ce[N]!="number")ge(A);else{const se=Math.abs(ce[y]-A[y]),de=Math.abs(ce[N]-A[N]);(se>=1||de>=1)&&ge(A)}}),We=(l,{animation:c=!0}={})=>{c?So(ue,ne.current,l,{duration:a.transitions.duration.standard}):ne.current[ue]=l},pt=l=>{let c=ne.current[ue];X?c+=l:c+=l*(u?-1:1),We(c)},Be=()=>{const l=ne.current[te];let c=0;const S=Array.from(he.current.children);for(let y=0;y<S.length;y+=1){const A=S[y];if(c+A[te]>l){y===0&&(c=l);break}c+=A[te]}return c},Fe=()=>{pt(-1*Be())},He=()=>{pt(Be())},[xt,{onChange:we,...ot}]=Me("scrollbar",{className:Se(K.scrollableX,K.hideScrollbar),elementType:zo,shouldForwardComponentProp:!0,externalForwardedProps:me,ownerState:k}),ft=n.useCallback(l=>{we==null||we(l),ht({overflow:null,scrollbarWidth:l})},[we]),[$e,Ie]=Me("scrollButtons",{className:Se(K.scrollButtons,P.className),elementType:Ao,externalForwardedProps:me,ownerState:k,additionalProps:{orientation:W,slots:{StartScrollButtonIcon:z.startScrollButtonIcon||z.StartScrollButtonIcon,EndScrollButtonIcon:z.endScrollButtonIcon||z.EndScrollButtonIcon},slotProps:{startScrollButtonIcon:ie,endScrollButtonIcon:Dt}}}),rt=()=>{const l={};l.scrollbarSizeListener=G?e.jsx(xt,{...ot,onChange:ft}):null;const S=G&&(V==="auto"&&(ke||Y)||V===!0);return l.scrollButtonStart=S?e.jsx($e,{direction:u?"right":"left",onClick:Fe,disabled:!ke,...Ie}):null,l.scrollButtonEnd=S?e.jsx($e,{direction:u?"left":"right",onClick:He,disabled:!Y,...Ie}):null,l},Ae=Et(l=>{const{tabsMeta:c,tabMeta:S}=st();if(!(!S||!c)){if(S[x]<c[x]){const y=c[ue]+(S[x]-c[x]);We(y,{animation:l})}else if(S[f]>c[f]){const y=c[ue]+(S[f]-c[f]);We(y,{animation:l})}}}),je=Et(()=>{G&&V!==!1&&ut(!et)});n.useEffect(()=>{const l=is(()=>{ne.current&&ye()});let c;const S=se=>{se.forEach(de=>{de.removedNodes.forEach(pe=>{c==null||c.unobserve(pe)}),de.addedNodes.forEach(pe=>{c==null||c.observe(pe)})}),l(),je()},y=cs(ne.current);y.addEventListener("resize",l);let A;return typeof ResizeObserver<"u"&&(c=new ResizeObserver(l),Array.from(he.current.children).forEach(se=>{c.observe(se)})),typeof MutationObserver<"u"&&(A=new MutationObserver(S),A.observe(he.current,{childList:!0})),()=>{l.clear(),y.removeEventListener("resize",l),A==null||A.disconnect(),c==null||c.disconnect()}},[ye,je]),n.useEffect(()=>{const l=Array.from(he.current.children),c=l.length;if(typeof IntersectionObserver<"u"&&c>0&&G&&V!==!1){const S=l[0],y=l[c-1],A={root:ne.current,threshold:.99},se=Ue=>{Z(!Ue[0].isIntersecting)},de=new IntersectionObserver(se,A);de.observe(S);const pe=Ue=>{dt(!Ue[0].isIntersecting)},nt=new IntersectionObserver(pe,A);return nt.observe(y),()=>{de.disconnect(),nt.disconnect()}}},[G,V,et,v==null?void 0:v.length]),n.useEffect(()=>{Wt(!0)},[]),n.useEffect(()=>{ye()}),n.useEffect(()=>{Ae(os!==ce)},[Ae,ce]),n.useImperativeHandle(C,()=>({updateIndicator:ye,updateScrollButtons:je}),[ye,je]);const[Re,gt]=Me("indicator",{className:Se(K.indicator,Q.className),elementType:Lo,externalForwardedProps:me,ownerState:k,additionalProps:{style:ce}}),Te=e.jsx(Re,{...gt});let _e=0;const mt=n.Children.map(v,l=>{if(!n.isValidElement(l))return null;const c=l.props.value===void 0?_e:l.props.value;De.set(c,_e);const S=c===le;return _e+=1,n.cloneElement(l,{fullWidth:U==="fullWidth",indicator:S&&!Pe&&Te,selected:S,selectionFollowsFocus:$,onChange:L,textColor:ae,value:c,..._e===1&&le===!1&&!l.props.tabIndex?{tabIndex:0}:{}})}),Ve=l=>{if(l.altKey||l.shiftKey||l.ctrlKey||l.metaKey)return;const c=he.current,S=Rs(Ts(c));if((S==null?void 0:S.getAttribute("role"))!=="tab")return;let A=W==="horizontal"?"ArrowLeft":"ArrowUp",se=W==="horizontal"?"ArrowRight":"ArrowDown";switch(W==="horizontal"&&u&&(A="ArrowRight",se="ArrowLeft"),l.key){case A:l.preventDefault(),at(c,S,ss);break;case se:l.preventDefault(),at(c,S,ts);break;case"Home":l.preventDefault(),at(c,null,ts);break;case"End":l.preventDefault(),at(c,null,ss);break}},Xe=rt(),[bt,Ct]=Me("root",{ref:r,className:Se(K.root,w),elementType:Oo,externalForwardedProps:{...me,...fe,component:i},ownerState:k}),[St,yt]=Me("scroller",{ref:ne,className:K.scroller,elementType:Mo,externalForwardedProps:me,ownerState:k,additionalProps:{style:{overflow:tt.overflow,[X?`margin${u?"Left":"Right"}`:"marginBottom"]:ee?void 0:-tt.scrollbarWidth}}}),[Oe,jt]=Me("list",{ref:he,className:Se(K.list,K.flexContainer),elementType:No,externalForwardedProps:me,ownerState:k,getSlotProps:l=>({...l,onKeyDown:c=>{var S;Ve(c),(S=l.onKeyDown)==null||S.call(l,c)}})});return e.jsxs(bt,{...Ct,children:[Xe.scrollButtonStart,Xe.scrollbarSizeListener,e.jsxs(St,{...yt,children:[e.jsx(Oe,{"aria-label":h,"aria-labelledby":b,"aria-orientation":W==="vertical"?"vertical":null,role:"tablist",...jt,children:mt}),Pe&&Te]}),Xe.scrollButtonEnd]})}),Tt=ze(e.jsx("path",{d:"m7 10 5 5 5-5z"})),ko=ze([e.jsx("path",{d:"m12 2-5.5 9h11z"},"0"),e.jsx("circle",{cx:"17.5",cy:"17.5",r:"4.5"},"1"),e.jsx("path",{d:"M3 13.5h8v8H3z"},"2")]),Do=ze(e.jsx("path",{d:"M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12z"})),Wo=ze(e.jsx("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"})),Bo=({complaintId:o,open:t,onClose:r,citizenName:d="Citizen",complaintTitle:a="Complaint"})=>{const u=kt(),h=us(u.breakpoints.down("sm")),b=n.useRef(null),C=n.useRef(null),[j,v]=n.useState([]),[w,i]=n.useState(!1),[R,I]=n.useState(null),[L,W]=n.useState(""),[B,V]=n.useState(!1),[$,z]=n.useState(null),[q,Q]=n.useState(!1),P=n.useCallback(()=>{b.current&&b.current.scrollIntoView({behavior:"smooth"})},[]);n.useEffect(()=>{t&&o&&(ae(),le())},[t,o]),n.useEffect(()=>{P()},[j,P]),n.useEffect(()=>{if(t&&o)return Ne.startPolling(o,x=>{v(x)}),()=>{Ne.stopPolling(o)}},[t,o]);const ae=async()=>{if(o)try{i(!0),I(null);const{messages:x}=await Ne.getChatMessages(o);v(x)}catch(x){const f=Ke(x);I(f.userMessage)}finally{i(!1)}},le=async()=>{if(o)try{await Ne.markAsRead(o)}catch(x){console.error("Error marking messages as read:",x)}},U=async()=>{if(!(!o||!L.trim()&&!$))try{V(!0);let x;$?x=await Ne.sendMessageWithFile(o,L.trim()||"Image",$.file):x=await Ne.sendMessage(o,{message:L.trim()}),v(f=>[...f,x]),W(""),z(null),P(),Le.success("Message sent successfully",{icon:"âœ…"})}catch(x){const f=Ke(x);Le.error(f.userMessage,{duration:5e3,icon:"âŒ"})}finally{V(!1)}},ee=async x=>{var te;const f=(te=x.target.files)==null?void 0:te[0];if(f){if(!f.type.startsWith("image/")){Le.error("Please select an image file",{icon:"âŒ"});return}if(f.size>5*1024*1024){Le.error("Image size must be less than 5MB",{icon:"âŒ"});return}try{Q(!0);const N=new FileReader;N.onloadend=()=>{z({file:f,preview:N.result})},N.readAsDataURL(f),Le.success("Image ready to send",{icon:"âœ…"})}catch(N){const k=Ke(N);Le.error(k.userMessage,{icon:"âŒ"}),z(null)}finally{Q(!1)}}},fe=()=>{z(null)},G=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),U())},X=x=>{const f=new Date(x),te=new Date,N=te.getTime()-f.getTime(),k=Math.floor(N/(1e3*60)),K=Math.floor(N/(1e3*60*60)),ie=Math.floor(N/(1e3*60*60*24));return k<1?"Just now":k<60?`${k}m ago`:K<24?`${K}h ago`:ie<7?`${ie}d ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:f.getFullYear()!==te.getFullYear()?"numeric":void 0})},ue=()=>{v([]),W(""),z(null),I(null),r()};return e.jsxs(hs,{open:t,onClose:ue,maxWidth:"sm",fullWidth:!0,fullScreen:h,slotProps:{paper:{sx:{borderRadius:h?0:2,height:h?"100vh":"80vh",maxHeight:h?"100vh":"80vh",display:"flex",flexDirection:"column",animation:h?`${Os} ${be.normal.duration} ${be.smooth.timing}`:`${Ms} ${be.normal.duration} ${be.smooth.timing}`,animationFillMode:"both"}},backdrop:{sx:{animation:`${$t} ${be.fast.duration} ${be.fast.timing}`}}},children:[e.jsxs(ps,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0",flexShrink:0},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Ns,{sx:{width:40,height:40,backgroundColor:"#4CAF50"},children:e.jsx(no,{})}),e.jsxs(m,{children:[e.jsx(p,{variant:"subtitle1",sx:{fontWeight:600,lineHeight:1.2},children:d}),e.jsx(p,{variant:"caption",color:"text.secondary",children:a})]})]}),e.jsx(wt,{onClick:ue,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(_t,{})})]}),e.jsxs(xs,{ref:C,sx:{flex:1,overflowY:"auto",p:2,display:"flex",flexDirection:"column",gap:2,backgroundColor:"#f8f9fa"},children:[w&&e.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsx(Ye,{})}),R&&!w&&e.jsx(Ls,{severity:"error",sx:{mb:2},children:R}),!w&&!R&&j.length===0&&e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:200,textAlign:"center"},children:[e.jsx(p,{variant:"body1",color:"text.secondary",sx:{mb:1},children:"No messages yet"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:"Start the conversation by sending a message"})]}),!w&&!R&&j.map(x=>{const f=x.senderType==="ADMIN";return e.jsx(m,{sx:{display:"flex",justifyContent:f?"flex-end":"flex-start",animation:`${$t} ${be.fast.duration} ${be.fast.timing}`},children:e.jsxs(m,{sx:{maxWidth:"70%",display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5,px:1,justifyContent:f?"flex-end":"flex-start"},children:[f&&e.jsx(zs,{sx:{fontSize:14,color:"#4CAF50"}}),e.jsx(p,{variant:"caption",sx:{fontWeight:600,color:f?"#4CAF50":"#1976d2"},children:x.senderName||(f?"Admin":d)})]}),e.jsxs(m,{sx:{backgroundColor:f?"#4CAF50":"white",color:f?"white":"text.primary",borderRadius:2,p:1.5,boxShadow:1},children:[x.imageUrl&&e.jsx(m,{component:"img",src:x.imageUrl,alt:"Message attachment",sx:{width:"100%",maxWidth:300,borderRadius:1,mb:x.message?1:0}}),x.message&&e.jsx(p,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:x.message})]}),e.jsx(p,{variant:"caption",color:"text.secondary",sx:{px:1,textAlign:f?"right":"left"},children:X(x.createdAt)})]})},x.id)}),e.jsx("div",{ref:b})]}),e.jsxs(m,{sx:{p:2,borderTop:"1px solid #e0e0e0",backgroundColor:"white",flexShrink:0},children:[$&&e.jsxs(m,{sx:{mb:1,position:"relative",display:"inline-block"},children:[e.jsx(m,{component:"img",src:$.preview,alt:"Preview",sx:{maxWidth:200,maxHeight:200,borderRadius:1,border:"1px solid #e0e0e0"}}),e.jsx(wt,{size:"small",onClick:fe,sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},children:e.jsx(_t,{fontSize:"small"})})]}),e.jsxs(m,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx(Ot,{fullWidth:!0,multiline:!0,maxRows:4,placeholder:"Type a message...",value:L,onChange:x=>W(x.target.value),onKeyPress:G,disabled:B,slotProps:{input:{startAdornment:e.jsx(Qe,{position:"start",children:e.jsxs(wt,{component:"label",size:"small",disabled:q||B,children:[e.jsx(ao,{}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:ee})]})})}},sx:{"& .MuiOutlinedInput-root":{borderRadius:3}}}),e.jsx(Ce,{variant:"contained",onClick:U,disabled:!L.trim()&&!$||B,sx:{minWidth:56,height:56,borderRadius:"50%",backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},"&:disabled":{backgroundColor:"#e0e0e0"}},children:B?e.jsx(Ye,{size:24,sx:{color:"white"}}):e.jsx(io,{})})]})]})]})};class Fo{constructor(){vt(this,"apiClient");this.apiClient=it.create({baseURL:ct.BASE_URL,timeout:ct.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const r=localStorage.getItem("accessToken");r&&(t.headers.Authorization=`Bearer ${r}`)}catch(r){console.error("Error getting token:",r)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var r;return((r=t.response)==null?void 0:r.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(this.handleError(t))})}handleError(t){var r,d,a,u,h;if(it.isAxiosError(t)){const b=((r=t.response)==null?void 0:r.status)||500,C=((a=(d=t.response)==null?void 0:d.data)==null?void 0:a.message)||"An error occurred",j=(h=(u=t.response)==null?void 0:u.data)==null?void 0:h.errors;return{name:"ApiError",statusCode:b,message:C,errors:j}}return{name:"ApiError",statusCode:500,message:t.message||"An unexpected error occurred"}}parseMetadata(t){if(!t)return null;try{return JSON.parse(t)}catch(r){return console.error("Error parsing notification metadata:",r),null}}async getNotifications(t={}){try{const r={page:t.page||1,limit:t.limit||20};t.unreadOnly!==void 0&&(r.unreadOnly=t.unreadOnly);const d=await this.apiClient.get("/api/notifications",{params:r}),a=d.data.data.notifications.map(u=>({...u,metadata:this.parseMetadata(u.metadata)}));return{...d.data.data,notifications:a}}catch(r){throw console.error("Error fetching notifications:",r),r}}async getUnreadCount(){try{return(await this.apiClient.get("/api/notifications/unread-count")).data.data.count}catch(t){throw console.error("Error fetching unread count:",t),t}}async markAsRead(t){try{return(await this.apiClient.patch(`/api/notifications/${t}/read`)).data.data}catch(r){throw console.error("Error marking notification as read:",r),r}}async markAllAsRead(){try{return(await this.apiClient.patch("/api/notifications/read-all")).data.data.updatedCount}catch(t){throw console.error("Error marking all notifications as read:",t),t}}}new Fo;class Ho{constructor(){vt(this,"apiClient");this.apiClient=it.create({baseURL:ct.BASE_URL,timeout:ct.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const r=localStorage.getItem("accessToken");r&&(t.headers.Authorization=`Bearer ${r}`)}catch(r){console.error("Error getting token:",r)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var r;return((r=t.response)==null?void 0:r.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(this.handleError(t))})}handleError(t){var r,d,a,u,h;if(it.isAxiosError(t)){const b=((r=t.response)==null?void 0:r.status)||500,C=((a=(d=t.response)==null?void 0:d.data)==null?void 0:a.message)||"An error occurred",j=(h=(u=t.response)==null?void 0:u.data)==null?void 0:h.errors;return{name:"ApiError",statusCode:b,message:C,errors:j}}return{name:"ApiError",statusCode:500,message:t.message||"An unexpected error occurred"}}async submitReview(t,r){try{return(await this.apiClient.post(`/api/complaints/${t}/review`,r)).data.data}catch(d){throw console.error("Error submitting review:",d),d}}async getComplaintReviews(t){try{return(await this.apiClient.get(`/api/complaints/${t}/reviews`)).data.data}catch(r){throw console.error("Error fetching complaint reviews:",r),r}}async getReviewAnalytics(t={}){try{const r={};return t.cityCorporationCode&&(r.cityCorporationCode=t.cityCorporationCode),t.zoneId!==void 0&&(r.zoneId=t.zoneId),t.wardId!==void 0&&(r.wardId=t.wardId),t.startDate&&(r.startDate=t.startDate),t.endDate&&(r.endDate=t.endDate),(await this.apiClient.get("/api/admin/complaints/analytics/reviews",{params:r})).data.data}catch(r){throw console.error("Error fetching review analytics:",r),r}}}new Ho;const $o=({value:o,onChange:t,disabled:r=!1,fullWidth:d=!1})=>{const[a,u]=n.useState([]),[h,b]=n.useState(!0),[C,j]=n.useState(null);n.useEffect(()=>{v()},[]);const v=async()=>{try{b(!0),j(null);const i=await fs.getAllCategories();u(i)}catch(i){console.error("Error fetching categories:",i),j(i.message||"Failed to load categories")}finally{b(!1)}},w=i=>{t(i.target.value)};return e.jsx(Je,{sx:{minWidth:d?"100%":{xs:"100%",sm:180}},disabled:r||h,children:e.jsxs(qe,{value:o,onChange:w,displayEmpty:!0,startAdornment:e.jsx(Qe,{position:"start",children:h?e.jsx(Ye,{size:20,sx:{mr:1}}):e.jsx(ko,{sx:{color:"text.secondary",mr:1}})}),sx:{backgroundColor:"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},children:[e.jsx(T,{value:"",children:e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:"All Categories"})}),e.jsx(T,{value:"uncategorized",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(lo,{sx:{fontSize:18,color:"#9e9e9e"}}),e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"#757575"},children:"Uncategorized"})]})}),C?e.jsx(T,{disabled:!0,children:e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"error.main"},children:C})}):a.map(i=>e.jsx(T,{value:i.id,children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(m,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:i.color,flexShrink:0}}),e.jsxs(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:[i.english," (",i.bangla,")"]})]})},i.id))]})})},_o=({categoryId:o,value:t,onChange:r,disabled:d=!1,fullWidth:a=!1})=>{const[u,h]=n.useState([]),[b,C]=n.useState(!1),[j,v]=n.useState(null);n.useEffect(()=>{o?w():(h([]),t&&r(""))},[o]);const w=async()=>{try{C(!0),v(null);const I=await fs.getSubcategories(o);h(I)}catch(I){console.error("Error fetching subcategories:",I),v(I.message||"Failed to load subcategories"),h([])}finally{C(!1)}},i=I=>{r(I.target.value)},R=d||b||!o;return e.jsx(Je,{sx:{minWidth:a?"100%":{xs:"100%",sm:200}},disabled:R,children:e.jsxs(qe,{value:t,onChange:i,displayEmpty:!0,startAdornment:e.jsx(Qe,{position:"start",children:b?e.jsx(Ye,{size:20,sx:{mr:1}}):e.jsx(Do,{sx:{color:"text.secondary",mr:1}})}),sx:{backgroundColor:R?"#f5f5f5":"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:R?void 0:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},children:[e.jsx(T,{value:"",children:e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:o?"All Subcategories":"Select category first"})}),j?e.jsx(T,{disabled:!0,children:e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},color:"error.main"},children:j})}):u.map(I=>e.jsx(T,{value:I.id,children:e.jsxs(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:[I.english," (",I.bangla,")"]})},I.id))]})})},rs=["Engineering","Electricity","Health","Property (Eviction)"],ns=["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"],Vo=({value:o,onChange:t,disabled:r=!1,fullWidth:d=!1})=>{const[a,u]=n.useState(!1),[h,b]=n.useState(!1),C=i=>{const R=i.target.value;t(R)},j=()=>o==="ALL"?"All Status":o==="OTHERS_ALL"?"All Others":o==="CORPORATION_INTERNAL"?"Corporation Internal":o==="CORPORATION_EXTERNAL"?"Corporation External":rs.includes(o)?`Internal: ${o}`:ns.includes(o)?`External: ${o}`:o,v=i=>o===i,w=i=>v(i)?e.jsx(ks,{sx:{fontSize:18,color:"#4CAF50",mr:1}}):e.jsx(Ds,{sx:{fontSize:18,color:"transparent",mr:1}});return e.jsx(Je,{sx:{minWidth:d?"100%":{xs:"100%",sm:200}},disabled:r,children:e.jsxs(qe,{value:o,onChange:C,displayEmpty:!0,startAdornment:e.jsx(Qe,{position:"start",children:e.jsx(Ps,{sx:{color:"text.secondary",mr:1}})}),renderValue:()=>e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:j()}),sx:{backgroundColor:"white",height:{xs:40,sm:44},fontSize:{xs:"0.875rem",sm:"0.95rem"},"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50"}},"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#4CAF50",borderWidth:2}}},MenuProps:{PaperProps:{sx:{maxHeight:400,"& .MuiMenuItem-root":{fontSize:{xs:"0.875rem",sm:"0.95rem"}}}}},children:[e.jsx(T,{value:"ALL",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w("ALL"),e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:"All Status"})]})}),e.jsx(Ze,{sx:{my:.5}}),e.jsx(T,{value:"OTHERS_ALL",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w("OTHERS_ALL"),e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:600},children:"All Others"})]})}),e.jsx(Ze,{sx:{my:.5}}),e.jsx(T,{value:"CORPORATION_INTERNAL",onClick:i=>{i.stopPropagation(),u(!a)},sx:{backgroundColor:a?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:a?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w("CORPORATION_INTERNAL"),e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:500,flex:1},children:"Corporation Internal"}),a?e.jsx(qt,{sx:{fontSize:20,color:"text.secondary"}}):e.jsx(Qt,{sx:{fontSize:20,color:"text.secondary"}})]})}),a&&e.jsx(e.Fragment,{children:rs.map(i=>e.jsx(T,{value:i,sx:{pl:5,backgroundColor:v(i)?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:v(i)?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w(i),e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:i})]})},i))}),e.jsx(Ze,{sx:{my:.5}}),e.jsx(T,{value:"CORPORATION_EXTERNAL",onClick:i=>{i.stopPropagation(),b(!h)},sx:{backgroundColor:h?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:h?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w("CORPORATION_EXTERNAL"),e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"},fontWeight:500,flex:1},children:"Corporation External"}),h?e.jsx(qt,{sx:{fontSize:20,color:"text.secondary"}}):e.jsx(Qt,{sx:{fontSize:20,color:"text.secondary"}})]})}),h&&e.jsx(e.Fragment,{children:ns.map(i=>e.jsx(T,{value:i,sx:{pl:5,backgroundColor:v(i)?"rgba(76, 175, 80, 0.08)":"transparent","&:hover":{backgroundColor:v(i)?"rgba(76, 175, 80, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[w(i),e.jsx(p,{sx:{fontSize:{xs:"0.875rem",sm:"0.95rem"}},children:i})]})},i))})]})})},ar=()=>{const o=Ws(),[t]=Bs(),r=kt(),d=us(r.breakpoints.down("sm")),{user:a}=Fs(),[u,h]=n.useState([]),[b,C]=n.useState(!0),[j,v]=n.useState(null),[w,i]=n.useState(null),[R,I]=n.useState(!1),[L,W]=n.useState(t.get("search")||""),[B,V]=n.useState(t.get("status")||"ALL"),[$,z]=n.useState(t.get("category")||""),[q,Q]=n.useState(t.get("subcategory")||""),[P,ae]=n.useState(t.get("othersFilter")||"ALL"),[le,U]=n.useState([]),[ee,fe]=n.useState(t.get("cityCorporation")||"ALL"),[G,X]=n.useState([]),[ue,x]=n.useState(null),[f,te]=n.useState(t.get("zone")?Number(t.get("zone")):""),[N,k]=n.useState(t.get("ward")?Number(t.get("ward")):null),[K,ie]=n.useState([]),[Dt,Pe]=n.useState(!1),[Wt,ce]=n.useState(!1),[ge,ke]=n.useState({total:0,pending:0,inProgress:0,resolved:0,rejected:0,others:0}),[Z,Y]=n.useState({page:parseInt(t.get("page")||"1",10),limit:parseInt(t.get("limit")||"20",10),total:0,totalPages:0}),[dt,et]=n.useState(!1),[ut,tt]=n.useState(null),[ht,De]=n.useState(!1),[ne,he]=n.useState(null),[me,st]=n.useState(""),[ye,We]=n.useState(""),[pt,Be]=n.useState(null),Fe=so(L,500),[He,xt]=n.useState(!0),[we,ot]=n.useState(null),[ft,$e]=n.useState(!1),[Ie,rt]=n.useState(!1),[Ae,je]=n.useState(!1),[Re,gt]=n.useState(""),[Te,_e]=n.useState(""),[mt,Ve]=n.useState(!1),[Xe,bt]=n.useState(""),[Ct,St]=n.useState("");n.useEffect(()=>{a&&(async()=>{var oe,J;console.log("ðŸ”„ AllComplaints: Starting data fetch for user:",a==null?void 0:a.id,a==null?void 0:a.role);const g=[Qs.getCityCorporations("ACTIVE").catch(O=>(console.error("âŒ Error fetching city corporations:",O),{cityCorporations:[]}))];(a==null?void 0:a.role)==="SUPER_ADMIN"&&a.id&&(console.log("ðŸ‘¤ Fetching assigned zones for Super Admin:",a.id),g.push(eo.getAssignedZones(Number(a.id)).catch(O=>(console.error("âŒ Error fetching assigned zones:",O),[])))),Pe(!0);try{const O=await Promise.all(g),M=O[0],E=O[1];let D=M.cityCorporations||[];if(console.log("ðŸ™ï¸ Fetched City Corps:",D.length),a&&a.role!=="MASTER_ADMIN"){const _=a.cityCorporationCode||((oe=a.cityCorporation)==null?void 0:oe.code);_&&(console.log("ðŸŽ¯ Filtering City Corps for assigned code:",_),D=D.filter(F=>F.code===_),ee!==_&&fe(_))}if(U(D),E){console.log("ðŸ›¡ï¸ Raw Assigned Zones:",E);const _=E.map(F=>{const ve=F.zone||F;return!ve||!ve.id?null:{id:ve.id,zoneNumber:ve.zoneNumber,name:ve.name,cityCorporationId:ve.cityCorporationId||0,status:"ACTIVE",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}).filter(F=>F!==null);console.log("âœ… Formatted Assigned Zones:",_),X(_),_.length===1&&(console.log("ðŸ‘Œ Auto-selecting single zone:",_[0].id),te(_[0].id))}if((a==null?void 0:a.role)==="ADMIN"){console.log("ðŸ‘¤ Loading assigned wards for Admin");let _=[];if(a.permissions)try{const F=JSON.parse(a.permissions);F.wards&&Array.isArray(F.wards)&&(_=F.wards)}catch(F){console.error("Error parsing admin permissions:",F)}if(console.log(`ðŸ”’ ADMIN assigned ward IDs: [${_.join(", ")}]`),_.length>0)try{const F=a.cityCorporationCode||((J=a.cityCorporation)==null?void 0:J.code);if(F){const Ht=(await Vt.getWards({cityCorporationCode:F,status:"ACTIVE"})).wards.filter(Es=>_.includes(Es.id));console.log("âœ… Loaded assigned wards:",Ht),ie(Ht)}}catch(F){console.error("âŒ Error fetching assigned wards:",F),ie([])}else console.log("âš ï¸ ADMIN has no assigned wards"),ie([])}}catch(O){console.error("âŒ Error in AllComplaints fetchData:",O)}finally{Pe(!1)}})()},[a]),n.useEffect(()=>{(a==null?void 0:a.role)!=="ADMIN"&&(console.log("ðŸ”„ useEffect triggered for selectedZone:",f),f?(console.log("ðŸš€ Calling fetchWards with zoneId:",f),yt(f)):ie([]),k(null))},[f,a]);const yt=async s=>{try{console.log("ðŸ“¡ fetchWards called for zoneId:",s),ce(!0);const g=await Vt.getWardsByZone(s,"ACTIVE");console.log("âœ… Wards fetched:",g),ie(g)}catch(g){console.error("Error fetching wards:",g),At("Failed to load wards")}finally{ce(!1)}},Oe=n.useCallback(async()=>{var s,g,oe,J,O,M;try{C(!0),v(null),i(null),I(!1);const E={};B!=="ALL"&&(E.status=B),Fe&&(E.search=Fe),$&&(E.category=$),q&&(E.subcategory=q),P!=="ALL"&&(P==="OTHERS_ALL"?E.status="OTHERS":P==="CORPORATION_INTERNAL"?(E.status="OTHERS",E.othersCategory="CORPORATION_INTERNAL"):P==="CORPORATION_EXTERNAL"?(E.status="OTHERS",E.othersCategory="CORPORATION_EXTERNAL"):(E.status="OTHERS",E.othersSubcategory=P)),ee!=="ALL"&&(E.complaintCityCorporationCode=ee),f&&(E.complaintZoneId=f),N&&(E.complaintWardId=N),Re&&(E.startDate=Re),Te&&(E.endDate=Te),console.log("Fetching complaints with params:",{page:Z.page,limit:Z.limit,filters:E});const D=await es.getComplaints(Z.page,Z.limit,E);console.log("Complaints fetched successfully:",D),h(D.complaints),ke(D.statusCounts||{total:0,pending:0,inProgress:0,resolved:0,rejected:0,others:0}),Y({page:((s=D.pagination)==null?void 0:s.page)||1,limit:((g=D.pagination)==null?void 0:g.limit)||20,total:((oe=D.pagination)==null?void 0:oe.total)||0,totalPages:((J=D.pagination)==null?void 0:J.totalPages)||0})}catch(E){console.error("Error fetching complaints:",E),console.error("Error response:",(O=E.response)==null?void 0:O.data),console.error("Error status:",(M=E.response)==null?void 0:M.status),Xt(E,"fetchComplaints");const D=Ke(E);v(D.userMessage),i(D.type),I(D.retryable),D.type===Ut.NETWORK?Jt(D.userMessage):At(D.userMessage)}finally{C(!1)}},[Z.page,Z.limit,B,$,q,P,ee,f,N,Fe,Re,Te]);n.useEffect(()=>{Oe()},[Oe]);const jt=(s,g)=>{Y(oe=>({...oe,page:g})),window.scrollTo({top:0,behavior:"smooth"})},l=s=>{V(s),s==="OTHERS"?(z(""),Q("")):ae("ALL"),Y(g=>({...g,page:1}))},c=s=>{W(s.target.value),Y(g=>({...g,page:1}))},S=s=>{z(s),Q(""),Y(g=>({...g,page:1}))},y=s=>{Q(s),Y(g=>({...g,page:1}))},A=s=>{ae(s),Y(g=>({...g,page:1}))},se=s=>{s.stopPropagation(),ot(s.currentTarget),$e(!0)},de=()=>{ot(null),$e(!1),rt(!1),je(!1)},pe=s=>{A(s),l("OTHERS"),["CORPORATION_INTERNAL","CORPORATION_EXTERNAL"].includes(s)||de()},nt=s=>{fe(s),Y(g=>({...g,page:1}))},Ue=s=>{te(s),Y(g=>({...g,page:1}))},gs=s=>{k(s),Y(g=>({...g,page:1}))},ms=()=>{W(""),V("ALL"),z(""),Q(""),ae("ALL"),fe("ALL"),fe("ALL"),te(""),k(null),Y(s=>({...s,page:1}))},Bt=n.useCallback(async(s,g)=>{try{Be(s);const oe=await es.updateComplaintStatus(s,{status:g});h(J=>J.map(O=>O.id===s?oe:O)),ke(J=>{const O=u.find(E=>E.id===s);if(!O)return J;const M={...J};return O.status==="PENDING"?M.pending=Math.max(0,M.pending-1):O.status==="IN_PROGRESS"?M.inProgress=Math.max(0,M.inProgress-1):O.status==="RESOLVED"?M.resolved=Math.max(0,M.resolved-1):O.status==="REJECTED"?M.rejected=Math.max(0,M.rejected-1):O.status==="OTHERS"&&(M.others=Math.max(0,M.others-1)),g==="PENDING"?M.pending+=1:g==="IN_PROGRESS"?M.inProgress+=1:g==="RESOLVED"?M.resolved+=1:g==="REJECTED"?M.rejected+=1:g==="OTHERS"&&(M.others+=1),M}),to("Complaint status updated successfully")}catch(oe){Xt(oe,"handleStatusUpdate");const J=Ke(oe);J.type===Ut.NETWORK?Jt(J.userMessage):At(J.userMessage)}finally{Be(null)}},[u]),bs=s=>{o(`/complaints/${s}`)},Ft=()=>{et(!1),tt(null)},Cs=s=>{he(s.id),st(`${s.user.firstName} ${s.user.lastName}`),We(s.category||s.title),De(!0)},Ss=s=>{Ft(),o(`/chats/${s}`)},ys=n.useCallback(async(s,g)=>{await Bt(s,g),Oe()},[Bt,Oe]),js=s=>{switch(s){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404",borderColor:"#ffeeba"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460",borderColor:"#bee5eb"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724",borderColor:"#c3e6cb"};case"REJECTED":return{backgroundColor:"#f8d7da",color:"#721c24",borderColor:"#f5c6cb"};default:return{backgroundColor:"#f8f9fa",color:"#6c757d"}}},vs=s=>{switch(s){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Solved";case"REJECTED":return"Others";default:return s}};return e.jsxs(Hs,{title:"All Complaints",children:[e.jsx($s,{loading:b}),e.jsxs(m,{sx:{p:{xs:2,md:3},backgroundColor:"#f9fafb",minHeight:"100vh"},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(p,{variant:"h5",sx:{fontWeight:700,color:"#1e2939"},children:["All Complaints",Z.total>0&&e.jsxs(p,{component:"span",variant:"body1",sx:{color:"#6b7280",ml:1.5,fontWeight:500},children:["(Total ",Z.total,")"]})]}),e.jsx(Ce,{variant:"contained",onClick:()=>xt(!He),startIcon:e.jsx(co,{}),sx:{backgroundColor:"#4CAF50",textTransform:"none","&:hover":{backgroundColor:"#45a049"}},children:He?"Hide Filters":"Show Filters"})]}),e.jsx(m,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Po,{value:B==="ALL"?"ALL":B,onChange:(s,g)=>l(g),variant:"scrollable",scrollButtons:"auto",sx:{"& .MuiTab-root":{textTransform:"none",minWidth:100,fontWeight:600}},children:[e.jsx(Ge,{label:`All (${ge.total})`,value:"ALL"}),e.jsx(Ge,{label:`Pending (${ge.pending})`,value:"PENDING"}),e.jsx(Ge,{label:`In Progress (${ge.inProgress})`,value:"IN_PROGRESS"}),e.jsx(Ge,{label:`Solved (${ge.resolved})`,value:"RESOLVED"}),e.jsx(Ge,{label:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5},children:[`Others (${ge.others})`,e.jsx(m,{component:"span",onClick:se,sx:{display:"flex",alignItems:"center",borderRadius:"50%",p:.5,"&:hover":{bgcolor:"rgba(0,0,0,0.05)"}},children:e.jsx(Tt,{fontSize:"small"})})]}),value:"OTHERS"})]})}),e.jsxs(_s,{anchorEl:we,open:ft,onClose:de,onClick:s=>s.stopPropagation(),PaperProps:{sx:{mt:1,width:250,maxHeight:400}},children:[e.jsx(T,{onClick:()=>pe("OTHERS_ALL"),children:"All Others"}),e.jsx(Ze,{}),e.jsxs(T,{onClick:()=>rt(!Ie),sx:{fontWeight:"bold",justifyContent:"space-between"},children:["Corp. Internal",e.jsx(Tt,{sx:{transform:Ie?"rotate(180deg)":"rotate(0deg)",transition:"0.2s"}})]}),Ie&&["Engineering","Electricity","Health","Property (Eviction)"].map(s=>e.jsx(T,{onClick:()=>pe(s),sx:{pl:4,fontSize:"0.9rem"},selected:P===s,children:s},s)),e.jsx(Ze,{}),e.jsxs(T,{onClick:()=>je(!Ae),sx:{fontWeight:"bold",justifyContent:"space-between"},children:["Corp. External",e.jsx(Tt,{sx:{transform:Ae?"rotate(180deg)":"rotate(0deg)",transition:"0.2s"}})]}),Ae&&["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"].map(s=>e.jsx(T,{onClick:()=>pe(s),sx:{pl:4,fontSize:"0.9rem"},selected:P===s,children:s},s))]}),e.jsx(uo,{in:He,children:e.jsxs(Gt,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e5e7eb",backgroundColor:"white"},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(p,{variant:"subtitle1",sx:{fontWeight:600,color:"#374151"},children:"Filter Options"}),e.jsx(Ce,{size:"small",onClick:ms,startIcon:e.jsx(Vs,{}),sx:{textTransform:"none",color:"#ef4444"},children:"Clear Filters"})]}),e.jsxs(xe,{container:!0,spacing:2,children:[e.jsx(xe,{size:{xs:12,sm:6,md:3},children:e.jsx(Ot,{fullWidth:!0,type:"date",size:"small",label:"Date",value:Re,onChange:s=>gt(s.target.value),InputLabelProps:{shrink:!0},sx:{backgroundColor:"white"}})}),e.jsx(xe,{size:{xs:12,sm:6,md:3},children:e.jsxs(Je,{fullWidth:!0,size:"small",children:[e.jsx(Kt,{children:"All City Corporations"}),e.jsxs(qe,{value:ee||"",onChange:s=>nt(s.target.value),label:"All City Corporations",disabled:(a==null?void 0:a.role)==="ADMIN",children:[e.jsx(T,{value:"ALL",children:"All City Corporations"}),le.map(s=>e.jsx(T,{value:s.code,children:s.name},s.id))]})]})}),(a==null?void 0:a.role)!=="ADMIN"&&e.jsx(xe,{size:{xs:12,sm:6,md:3},children:e.jsx(Xs,{value:f,onChange:Ue,cityCorporationCode:ee!=="ALL"?ee:void 0,zones:(a==null?void 0:a.role)==="SUPER_ADMIN"?G:void 0,hideLabel:!1,label:"All Zones"})}),e.jsx(xe,{size:{xs:12,sm:6,md:3},children:e.jsxs(Je,{fullWidth:!0,size:"small",children:[e.jsx(Kt,{children:"All Wards"}),e.jsxs(qe,{value:N||"",onChange:s=>gs(s.target.value?Number(s.target.value):null),label:"All Wards",displayEmpty:!0,children:[e.jsx(T,{value:"",children:"All Wards"}),K&&K.map(s=>e.jsxs(T,{value:s.id,children:["Ward ",s.wardNumber||s.id]},s.id))]})]})}),B!=="OTHERS"&&e.jsx(xe,{size:{xs:12,sm:6,md:3},children:e.jsx($o,{value:$,onChange:S})}),B!=="OTHERS"&&e.jsx(xe,{size:{xs:12,sm:6,md:3},children:e.jsx(_o,{value:q,onChange:y,categoryId:$,fullWidth:!0})}),B==="OTHERS"&&e.jsx(xe,{size:{xs:12,sm:6,md:3},children:e.jsx(Vo,{value:P,onChange:A,fullWidth:!0})}),e.jsx(xe,{size:{xs:12},children:e.jsx(Ot,{fullWidth:!0,placeholder:"Search by ID, citizen name, or phone number...",value:L,onChange:c,InputProps:{startAdornment:e.jsx(Qe,{position:"start",children:e.jsx(Us,{sx:{color:"text.secondary"}})})},size:"small",sx:{backgroundColor:"white","& .MuiOutlinedInput-root":{fontSize:"0.95rem"}}})})]})]})}),e.jsxs(m,{sx:{display:"flex",justifyContent:"flex-end",mb:2,gap:1},children:[e.jsx(Ce,{startIcon:e.jsx(ho,{}),variant:"outlined",size:"small",sx:{color:"#1976d2",borderColor:"#1976d2"},children:"Download"}),e.jsx(Ce,{startIcon:e.jsx(Wo,{}),variant:"outlined",size:"small",sx:{color:"#9c27b0",borderColor:"#9c27b0"},children:"Print"})]}),!b&&!j&&e.jsx(Gs,{component:Gt,elevation:0,sx:{border:"1px solid #e0e0e0",borderRadius:2},children:e.jsxs(Ks,{sx:{minWidth:800},children:[e.jsx(Zs,{sx:{backgroundColor:"#f9fafb"},children:e.jsxs(It,{children:[e.jsx(H,{sx:{fontWeight:600},children:"Complaint No"}),e.jsx(H,{sx:{fontWeight:600},children:"Citizen Info"}),e.jsx(H,{sx:{fontWeight:600},children:"Location"}),e.jsx(H,{sx:{fontWeight:600},children:"Category"}),e.jsx(H,{sx:{fontWeight:600},children:"Status"}),e.jsx(H,{sx:{fontWeight:600},children:"Review & Report"}),e.jsx(H,{sx:{fontWeight:600},children:"Date"}),e.jsx(H,{align:"right",sx:{fontWeight:600},children:"Action"})]})}),e.jsx(Ys,{children:u.length===0?e.jsx(It,{children:e.jsx(H,{colSpan:7,align:"center",sx:{py:8},children:e.jsx(p,{color:"text.secondary",children:"No complaints found"})})}):u.map(s=>e.jsxs(It,{hover:!0,children:[e.jsx(H,{children:e.jsx(p,{variant:"body2",sx:{fontWeight:600,color:"#4CAF50"},children:s.trackingNumber||`C${String(s.id).padStart(6,"0")}`})}),e.jsx(H,{children:e.jsxs(m,{children:[e.jsxs(p,{variant:"body2",sx:{fontWeight:600},children:[s.user.firstName," ",s.user.lastName]}),e.jsx(p,{variant:"caption",color:"text.secondary",children:s.user.phone||"N/A"})]})}),e.jsx(H,{children:e.jsxs(m,{children:[e.jsx(p,{variant:"body2",children:s.location}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:["Zone: ",typeof s.user.zone=="object"&&s.user.zone!==null?s.user.zone.name||s.user.zone.zoneNumber||"N/A":s.user.zone||"N/A"," | Ward: ",typeof s.user.ward=="object"&&s.user.ward!==null?s.user.ward.wardNumber||s.user.ward.number||"N/A":s.user.ward||"N/A"]})]})}),e.jsx(H,{children:e.jsxs(m,{children:[e.jsx(p,{variant:"body2",children:s.category||"N/A"}),e.jsx(p,{variant:"caption",color:"text.secondary",children:s.subcategory})]})}),e.jsxs(H,{children:[e.jsx(Zt,{label:vs(s.status),size:"small",sx:{...js(s.status),fontWeight:500,borderRadius:1,height:24}}),(s.status==="OTHERS"||s.status==="REJECTED")&&(s.othersCategory||s.othersSubcategory)&&e.jsxs(m,{sx:{mt:.5,lineHeight:1.2},children:[s.othersCategory&&e.jsx(p,{variant:"caption",display:"block",sx:{fontWeight:600,fontSize:"0.7rem",color:"#4b5563"},children:s.othersCategory==="CORPORATION_INTERNAL"?"Corp. Internal":s.othersCategory==="CORPORATION_EXTERNAL"?"Corp. External":s.othersCategory}),s.othersSubcategory&&e.jsx(p,{variant:"caption",display:"block",sx:{color:"text.secondary",fontSize:"0.7rem"},children:s.othersSubcategory})]})]}),e.jsx(H,{children:["RESOLVED","OTHERS","REJECTED"].includes(s.status)?e.jsxs(m,{sx:{maxWidth:200},children:[s.resolutionNote&&e.jsx(Yt,{title:"Click to view full note",children:e.jsxs(p,{variant:"caption",display:"block",sx:{color:"#1976d2",fontWeight:500,mb:.5,cursor:"pointer","&:hover":{textDecoration:"underline"}},noWrap:!0,onClick:()=>{bt(s.resolutionNote||""),St("Admin Resolution Note"),Ve(!0)},children:["Admin: ",s.resolutionNote]})}),s.review?e.jsxs(m,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Js,{value:s.review.rating,readOnly:!0,size:"small",sx:{fontSize:"1rem"}}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:["(",s.review.rating,")"]})]}),s.review.comment&&e.jsx(Yt,{title:s.review.comment,children:e.jsxs(p,{variant:"caption",display:"block",color:"text.secondary",noWrap:!0,sx:{mt:.5},children:['"',s.review.comment,'"']})})]}):e.jsx(p,{variant:"caption",color:"text.disabled",sx:{fontStyle:"italic"},children:"Not reviewed yet"})]}):e.jsx(Zt,{label:"Unsolved",size:"small",variant:"outlined",sx:{borderColor:"#e0e0e0",color:"#9e9e9e",height:24,fontSize:"0.75rem"}})}),e.jsx(H,{children:e.jsx(p,{variant:"body2",children:new Date(s.createdAt).toLocaleDateString()})}),e.jsxs(H,{align:"right",children:[e.jsx(Ce,{variant:"outlined",size:"small",startIcon:e.jsx(oo,{}),onClick:()=>Cs(s),sx:{borderColor:"#e0e0e0",color:"text.primary",textTransform:"none",mr:1,"&:hover":{borderColor:"#4CAF50",color:"#4CAF50"}},children:"Chat"}),e.jsx(Ce,{variant:"contained",size:"small",onClick:()=>bs(s.id),sx:{backgroundColor:"#4CAF50",color:"white",textTransform:"none",boxShadow:"none","&:hover":{backgroundColor:"#45a049",boxShadow:"none"}},children:"View Details"})]})]},s.id))})]})}),b&&e.jsx(m,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(Ye,{})}),!b&&!j&&u.length>0&&Z&&Z.total>0&&e.jsx(m,{sx:{mt:{xs:3,sm:4},mb:2,display:"flex",justifyContent:"center"},children:e.jsx(po,{count:Z.totalPages||0,page:Z.page||1,onChange:jt,color:"primary",size:d?"small":"large",showFirstButton:!d,showLastButton:!d,siblingCount:d?0:1,boundaryCount:1,sx:{"& .MuiPaginationItem-root":{fontSize:{xs:"0.875rem",sm:"0.95rem"},"&.Mui-selected":{backgroundColor:"#4CAF50 !important",color:"white"}}}})})]}),e.jsx(ro,{complaintId:ut,open:dt,onClose:Ft,onStatusUpdate:ys,onChatOpen:Ss}),e.jsx(Bo,{open:ht,onClose:()=>De(!1),complaintId:ne||0,complaintTitle:ye,citizenName:me}),e.jsxs(hs,{open:mt,onClose:()=>Ve(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ps,{sx:{fontWeight:600,color:"#1f2937"},children:Ct}),e.jsx(xs,{dividers:!0,children:e.jsx(p,{variant:"body1",sx:{whiteSpace:"pre-wrap",color:"#374151"},children:Xe})}),e.jsx(qs,{children:e.jsx(Ce,{onClick:()=>Ve(!1),color:"primary",children:"Close"})})]})]})};export{ar as default};
