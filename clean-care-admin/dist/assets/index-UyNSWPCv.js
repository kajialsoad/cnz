import{u as N,j as a,cm as w,P,b8 as y,B as i,T as r,q as z,b as T,bo as L,C as M,a5 as B,a7 as F,ag as U,a9 as E,J as O,am as W,aa as D,cn as Q,s as q,i as J,Q as $,aR as G}from"./mui-vendor-Dt-wTuK2.js";import{d as H,r as o,a as K}from"./react-vendor-D7yrL1sD.js";import{O as V,M as X,Q as n,z as c}from"./index-CEqbPxQ7.js";import{f as Y}from"./dateUtils-BIeWpBVH.js";import"./query-vendor-CyFhwaPb.js";import"./chart-vendor-TjDrWffg.js";const ra=()=>{N();const j=H(),{refreshUnreadCount:l}=V(),[f,p]=o.useState(!0),[h,d]=o.useState([]),[x,b]=o.useState(1),[g,k]=o.useState(1),[t,C]=o.useState(!1),v=async()=>{try{p(!0);const e=await n.getUserNotifications(x,20,t);d(e.notifications),k(e.pagination.totalPages)}catch(e){console.error("Error fetching notifications:",e),c.error("Failed to load notifications")}finally{p(!1)}};o.useEffect(()=>{v()},[x,t]);const R=(e,s)=>{b(s)},I=async(e,s)=>{s.stopPropagation();try{await n.markAsRead(e),d(u=>u.map(m=>m.id===e?{...m,isRead:!0}:m)),l()}catch{c.error("Failed to mark as read")}},A=async()=>{try{await n.markAllAsRead(),d(e=>e.map(s=>({...s,isRead:!0}))),l(),c.success("All notifications marked as read")}catch{c.error("Failed to mark all as read")}},S=async e=>{if(!e.isRead)try{await n.markAsRead(e.id),l()}catch(s){console.error("Failed to mark as read on click",s)}e.complaintId&&j(`/complaints/${e.complaintId}`)};return a.jsx(X,{title:"Notifications",children:a.jsx(w,{maxWidth:"lg",sx:{py:4},children:a.jsxs(P,{elevation:0,sx:{p:3,border:"1px solid #e0e0e0",borderRadius:2},children:[a.jsxs(y,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[a.jsxs(i,{children:[a.jsx(r,{variant:"h5",fontWeight:600,gutterBottom:!0,children:"Notifications"}),a.jsx(r,{variant:"body2",color:"text.secondary",children:"Stay updated with recent activities and status changes"})]}),a.jsxs(y,{direction:"row",spacing:2,children:[a.jsx(z,{label:t?"Showing Unread":"Showing All",onClick:()=>C(!t),color:t?"primary":"default",variant:t?"filled":"outlined",sx:{cursor:"pointer"}}),a.jsx(T,{variant:"outlined",startIcon:a.jsx(L,{}),onClick:A,size:"small",children:"Mark all read"})]})]}),f?a.jsx(i,{display:"flex",justifyContent:"center",py:8,children:a.jsx(M,{})}):h.length===0?a.jsxs(i,{display:"flex",flexDirection:"column",alignItems:"center",py:8,children:[a.jsx(B,{sx:{fontSize:60,color:"text.disabled",mb:2}}),a.jsx(r,{color:"text.secondary",children:"No notifications found"})]}):a.jsx(F,{children:h.map(e=>a.jsxs(U,{alignItems:"flex-start",sx:{mb:1,borderRadius:2,bgcolor:e.isRead?"transparent":"action.hover",cursor:"pointer","&:hover":{bgcolor:"action.selected"},border:"1px solid",borderColor:"divider"},secondaryAction:!e.isRead&&a.jsx(q,{title:"Mark as read",children:a.jsx(J,{edge:"end",onClick:s=>I(e.id,s),size:"small",children:a.jsx($,{color:"primary",fontSize:"small"})})}),onClick:()=>S(e),children:[a.jsx(E,{children:a.jsx(O,{sx:{bgcolor:e.isRead?"grey.300":"primary.main"},children:a.jsx(W,{})})}),a.jsx(D,{primary:a.jsxs(i,{display:"flex",alignItems:"center",gap:1,children:[a.jsx(r,{variant:"subtitle1",fontWeight:e.isRead?400:600,children:e.title}),!e.isRead&&a.jsx(Q,{sx:{fontSize:10,color:"primary.main"}})]}),secondary:a.jsxs(K.Fragment,{children:[a.jsx(r,{component:"span",variant:"body2",color:"text.primary",display:"block",sx:{my:.5},children:e.message}),a.jsx(r,{variant:"caption",color:"text.secondary",children:Y(e.createdAt)})]})})]},e.id))}),g>1&&a.jsx(i,{display:"flex",justifyContent:"center",mt:3,children:a.jsx(G,{count:g,page:x,onChange:R,color:"primary"})})]})})})};export{ra as default};
