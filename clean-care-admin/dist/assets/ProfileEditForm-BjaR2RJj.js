import{cc as Y,r as o,cd as _,ce as T,l as D,v as U,j as s,F as H,y as ee,T as B,X as R,a8 as re,A as ae,N as w,L,P as Z,bQ as se,K as te,Z as oe}from"./index-D65jGImX.js";import{A as ne}from"./AvatarUpload-Bz4ow2Vp.js";import{S as ie}from"./Save-D8eytItB.js";import{S as V}from"./Snackbar-BxH8kjn1.js";import"./CloudUpload-qDcbyucg.js";const le=r=>{const{updateProfile:y}=Y(),[I,p]=o.useState(!1),[i,x]=o.useState(null),[m,e]=o.useState({}),C=o.useCallback(async t=>{var j,W;p(!0),x(null),e({});try{if(!t||Object.keys(t).length===0)throw new Error("No data provided for update");const b=_(t);if(!b.isValid){e(b.errors);const v=Object.values(b.errors)[0];throw new Error(v)}const f={};t.firstName&&(f.firstName=T(t.firstName)),t.lastName&&(f.lastName=T(t.lastName)),t.avatar&&(f.avatar=t.avatar.trim()),t.ward&&(f.ward=T(t.ward)),t.zone&&(f.zone=T(t.zone)),t.address&&(f.address=T(t.address)),await y(f),(j=r==null?void 0:r.onSuccess)==null||j.call(r)}catch(b){const f=b instanceof Error?b.message:"Failed to update profile";throw x(f),(W=r==null?void 0:r.onError)==null||W.call(r,f),b}finally{p(!1)}},[y,r]),l=o.useCallback(()=>{x(null)},[]),N=o.useCallback(()=>{e({})},[]);return{updateProfile:C,isUpdating:I,updateError:i,validationErrors:m,clearUpdateError:l,clearValidationErrors:N}},he=({initialData:r,onSave:y,onCancel:I})=>{const p=D(),i=U(p.breakpoints.down("sm")),x=U(p.breakpoints.between("sm","md")),m=U("(orientation: landscape)"),[e,C]=o.useState({firstName:r.firstName||"",lastName:r.lastName||"",avatar:r.avatar,ward:r.ward||"",zone:r.zone||"",address:r.address||""}),[l,N]=o.useState({}),[t,j]=o.useState(!1),[W,b]=o.useState(!1),[f,v]=o.useState(!1),[Q,z]=o.useState(""),{isUpdating:h,updateError:M,clearUpdateError:E}=le({onSuccess:()=>{b(!0)},onError:d=>{z(d),v(!0)}}),P=o.useRef(null),K=o.useMemo(()=>{var u,n,c,A;const d=((n=(u=e.firstName)==null?void 0:u.charAt(0))==null?void 0:n.toUpperCase())||"",a=((A=(c=e.lastName)==null?void 0:c.charAt(0))==null?void 0:A.toUpperCase())||"";return`${d}${a}`||"?"},[e.firstName,e.lastName]),g=o.useCallback((d,a)=>{switch(d){case"firstName":if(!a.trim())return"First name is required";if(a.trim().length<2)return"First name must be at least 2 characters";if(a.trim().length>50)return"First name must not exceed 50 characters";if(!/^[a-zA-Z\s'-]+$/.test(a))return"First name can only contain letters, spaces, hyphens, and apostrophes";break;case"lastName":if(!a.trim())return"Last name is required";if(a.trim().length<2)return"Last name must be at least 2 characters";if(a.trim().length>50)return"Last name must not exceed 50 characters";if(!/^[a-zA-Z\s'-]+$/.test(a))return"Last name can only contain letters, spaces, hyphens, and apostrophes";break;case"ward":if(a&&a.trim().length>20)return"Ward must not exceed 20 characters";break;case"zone":if(a&&a.trim().length>20)return"Zone must not exceed 20 characters";break;case"address":if(a&&a.trim().length>200)return"Address must not exceed 200 characters";break}},[]),$=o.useCallback(()=>{const d={},a=g("firstName",e.firstName);a&&(d.firstName=a);const u=g("lastName",e.lastName);if(u&&(d.lastName=u),e.ward){const n=g("ward",e.ward);n&&(d.ward=n)}if(e.zone){const n=g("zone",e.zone);n&&(d.zone=n)}if(e.address){const n=g("address",e.address);n&&(d.address=n)}return N(d),Object.keys(d).length===0},[e,g]),k=o.useCallback(d=>{const{name:a,value:u}=d.target;C(n=>({...n,[a]:u})),N(n=>{const c={...n};return delete c[a],c}),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{const n=g(a,u);n&&N(c=>({...c,[a]:n}))},300)},[g]),S=o.useCallback(d=>{const{name:a,value:u}=d.target,n=g(a,u);n&&N(c=>({...c,[a]:n}))},[g]),X=o.useCallback(async d=>{C(a=>({...a,avatar:d}))},[]),F=o.useMemo(()=>e.firstName!==r.firstName||e.lastName!==r.lastName||e.avatar!==r.avatar||e.ward!==(r.ward||"")||e.zone!==(r.zone||"")||e.address!==(r.address||""),[e,r]),G=o.useCallback(async d=>{var a,u,n;if(d.preventDefault(),!$()){z("Please fix the validation errors"),v(!0);return}if(!F()){z("No changes to save"),v(!0);return}j(!0),E();try{const c={};e.firstName!==r.firstName&&(c.firstName=e.firstName.trim()),e.lastName!==r.lastName&&(c.lastName=e.lastName.trim()),e.avatar!==r.avatar&&(c.avatar=e.avatar),e.ward!==(r.ward||"")&&(c.ward=((a=e.ward)==null?void 0:a.trim())||void 0),e.zone!==(r.zone||"")&&(c.zone=((u=e.zone)==null?void 0:u.trim())||void 0),e.address!==(r.address||"")&&(c.address=((n=e.address)==null?void 0:n.trim())||void 0),await y(c),b(!0)}catch(c){const A=c instanceof Error?c.message:"Failed to update profile";z(A),v(!0)}finally{j(!1)}},[e,r,$,F,y,E]),J=o.useCallback(()=>{C({firstName:r.firstName||"",lastName:r.lastName||"",avatar:r.avatar,ward:r.ward||"",zone:r.zone||"",address:r.address||""}),N({}),E(),I()},[r,I,E]),q=o.useCallback(()=>{b(!1)},[]),O=o.useCallback(()=>{v(!1),z("")},[]);return o.useEffect(()=>()=>{P.current&&clearTimeout(P.current)},[]),s.jsxs(H,{component:"form",onSubmit:G,role:"form","aria-label":"Profile edit form",sx:{animation:`${ee} 0.3s ease-in-out`},children:[s.jsxs(H,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:i&&m?2:3,px:2,background:`linear-gradient(135deg, ${p.palette.primary.main}15 0%, ${p.palette.primary.main}05 100%)`},children:[s.jsx(ne,{currentAvatar:e.avatar,onUpload:X,size:i?m?80:100:x?110:120,initials:K,disabled:t||h}),s.jsx(B,{variant:"caption",sx:{mt:i&&m?1:2,color:p.palette.text.secondary,textAlign:"center",px:2},children:i?"Tap to upload":"Click or drag to upload a new profile picture"})]}),s.jsx(R,{}),s.jsxs(H,{sx:{p:i?m?1.5:2:x?2.5:3},children:[s.jsxs(re,{elevation:0,sx:{p:i?m?1.5:2:x?2.5:3,backgroundColor:p.palette.background.default,borderRadius:2,animation:`${ae} 0.4s ease-in-out`},children:[s.jsx(B,{variant:"subtitle2",sx:{fontWeight:600,mb:2,color:p.palette.text.primary},children:"Personal Information"}),s.jsx(w,{fullWidth:!0,label:"First Name",name:"firstName",value:e.firstName,onChange:k,onBlur:S,error:!!l.firstName,helperText:l.firstName,disabled:t||h,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{maxLength:50,"aria-label":"First name","aria-required":"true","aria-invalid":!!l.firstName,"aria-describedby":l.firstName?"firstName-error":void 0}},formHelperText:{id:"firstName-error",role:"alert"}}}),s.jsx(w,{fullWidth:!0,label:"Last Name",name:"lastName",value:e.lastName,onChange:k,onBlur:S,error:!!l.lastName,helperText:l.lastName,disabled:t||h,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{maxLength:50,"aria-label":"Last name","aria-required":"true","aria-invalid":!!l.lastName,"aria-describedby":l.lastName?"lastName-error":void 0}},formHelperText:{id:"lastName-error",role:"alert"}}}),s.jsx(w,{fullWidth:!0,label:"Email Address",value:r.email,disabled:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},helperText:"Email cannot be changed",slotProps:{input:{inputProps:{"aria-label":"Email address (read-only)","aria-readonly":"true"}}}}),s.jsx(w,{fullWidth:!0,label:"Phone Number",value:r.phone,disabled:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},helperText:"Phone number cannot be changed",slotProps:{input:{inputProps:{"aria-label":"Phone number (read-only)","aria-readonly":"true"}}}}),s.jsx(R,{sx:{my:2}}),s.jsx(B,{variant:"subtitle2",sx:{fontWeight:600,mb:2,color:p.palette.text.primary},children:"Location Information (Optional)"}),s.jsx(w,{fullWidth:!0,label:"Ward",name:"ward",value:e.ward,onChange:k,onBlur:S,error:!!l.ward,helperText:l.ward,disabled:t||h,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{maxLength:20,"aria-label":"Ward (optional)","aria-invalid":!!l.ward,"aria-describedby":l.ward?"ward-error":void 0}},formHelperText:{id:"ward-error",role:"alert"}}}),s.jsx(w,{fullWidth:!0,label:"Zone",name:"zone",value:e.zone,onChange:k,onBlur:S,error:!!l.zone,helperText:l.zone,disabled:t||h,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{maxLength:20,"aria-label":"Zone (optional)","aria-invalid":!!l.zone,"aria-describedby":l.zone?"zone-error":void 0}},formHelperText:{id:"zone-error",role:"alert"}}}),s.jsx(w,{fullWidth:!0,label:"Address",name:"address",value:e.address,onChange:k,onBlur:S,error:!!l.address,helperText:l.address,disabled:t||h,multiline:!0,rows:i&&m?2:3,slotProps:{input:{inputProps:{maxLength:200,"aria-label":"Address (optional)","aria-invalid":!!l.address,"aria-describedby":l.address?"address-error":void 0}},formHelperText:{id:"address-error",role:"alert"}}})]}),M&&s.jsx(L,{severity:"error",sx:{mt:2},onClose:E,children:M}),s.jsxs(H,{sx:{display:"flex",gap:2,mt:i&&m?2:3,flexDirection:i||x&&!m?"column":"row",justifyContent:"flex-end"},children:[s.jsx(Z,{variant:"outlined",startIcon:s.jsx(se,{}),onClick:J,disabled:t||h,fullWidth:i||x&&!m,"aria-label":"Cancel profile editing",sx:{borderRadius:2,textTransform:"none",fontWeight:600,minWidth:i?"auto":120,minHeight:i?44:36},children:"Cancel"}),s.jsx(Z,{type:"submit",variant:"contained",startIcon:t||h?s.jsx(te,{size:16,color:"inherit"}):s.jsx(ie,{}),disabled:t||h||!F,fullWidth:i||x&&!m,"aria-label":t||h?"Saving profile changes":"Save profile changes","aria-busy":t||h,"aria-disabled":!F,sx:{borderRadius:2,textTransform:"none",fontWeight:600,minWidth:i?"auto":120,minHeight:i?44:36},children:t||h?"Saving...":"Save Changes"})]})]}),s.jsx(V,{open:W,autoHideDuration:4e3,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(L,{onClose:q,severity:"success",icon:s.jsx(oe,{}),sx:{width:"100%"},children:"Profile updated successfully!"})}),s.jsx(V,{open:f,autoHideDuration:6e3,onClose:O,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(L,{onClose:O,severity:"error",sx:{width:"100%"},children:Q||"Failed to update profile"})})]})};export{he as default};
