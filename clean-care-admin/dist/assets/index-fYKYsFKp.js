var Be=Object.defineProperty;var ze=(t,o,x)=>o in t?Be(t,o,{enumerable:!0,configurable:!0,writable:!0,value:x}):t[o]=x;var je=(t,o,x)=>ze(t,typeof o!="symbol"?o+"":o,x);import{r as i,g as ye,a as Se,bO as $e,u as Ne,j as e,s as we,c as Ze,b as pe,d as Te,B as Me,m as ke,b3 as Pe,D as de,E as ce,J as ue,F as v,L as U,N as R,al as xe,P as L,K as Q,R as ee,S as ve,U as he,a9 as fe,V as ge,W as H,aF as K,ac as re,a7 as se,ad as ae,ae as ne,af as V,ag as r,ah as oe,an as M,T as y,ai as O,aj as _,I as X,aw as be,ap as le,aq as ie,aK as Fe,aD as Re,a1 as te,aJ as De,a4 as Oe,Y as Ce,bP as Le,Z as Ue}from"./index-DlgNj6PR.js";import{D as Ae}from"./Delete-CgbC_M7E.js";import{A as me}from"./Add-BUva3fGq.js";import{w as J}from"./wardService-DVNqzDgF.js";import{S as Ve}from"./Snackbar-BR8h77I1.js";function qe(t){return i.Children.toArray(t).filter(o=>i.isValidElement(o))}function Ge(t){return Se("MuiToggleButton",t)}const Y=ye("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),Ee=i.createContext({}),Ie=i.createContext(void 0);function _e(t,o){return o===void 0||t===void 0?!1:Array.isArray(o)?o.includes(t):t===o}const He=t=>{const{classes:o,fullWidth:x,selected:s,disabled:d,size:a,color:l}=t,c={root:["root",s&&"selected",d&&"disabled",x&&"fullWidth",`size${pe(a)}`,l]};return Te(c,Ge,o)},Ye=we(Me,{name:"MuiToggleButton",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:x}=t;return[o.root,o[`size${pe(x.size)}`]]}})(ke(({theme:t})=>({...t.typography.button,borderRadius:(t.vars||t).shape.borderRadius,padding:11,border:`1px solid ${(t.vars||t).palette.divider}`,color:(t.vars||t).palette.action.active,[`&.${Y.disabled}`]:{color:(t.vars||t).palette.action.disabled,border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${Y.selected}`]:{color:(t.vars||t).palette.text.primary,backgroundColor:t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.selectedOpacity),"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.text.primary,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.selectedOpacity)}}}}},...Object.entries(t.palette).filter(Pe()).map(([o])=>({props:{color:o},style:{[`&.${Y.selected}`]:{color:(t.vars||t).palette[o].main,backgroundColor:t.alpha((t.vars||t).palette[o].main,(t.vars||t).palette.action.selectedOpacity),"&:hover":{backgroundColor:t.alpha((t.vars||t).palette[o].main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:t.alpha((t.vars||t).palette[o].main,(t.vars||t).palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:t.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:t.typography.pxToRem(15)}}]}))),We=i.forwardRef(function(o,x){const{value:s,...d}=i.useContext(Ee),a=i.useContext(Ie),l=$e({...d,selected:_e(o.value,s)},o),c=Ne({props:l,name:"MuiToggleButton"}),{children:N,className:b,color:C="standard",disabled:Z=!1,disableFocusRipple:k=!1,fullWidth:p=!1,onChange:T,onClick:z,selected:g,size:u="medium",value:f,...h}=c,j={...c,color:C,disabled:Z,disableFocusRipple:k,fullWidth:p,size:u},W=He(j),w=A=>{z&&(z(A,f),A.defaultPrevented)||T&&T(A,f)},I=a||"";return e.jsx(Ye,{className:Ze(d.className,W.root,b,I),disabled:Z,focusRipple:!k,ref:x,onClick:w,onChange:T,value:f,ownerState:j,"aria-pressed":g,...h,children:N})});function Je(t){return Se("MuiToggleButtonGroup",t)}const $=ye("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Ke=t=>{const{classes:o,orientation:x,fullWidth:s,disabled:d}=t,a={root:["root",x,s&&"fullWidth"],grouped:["grouped",`grouped${pe(x)}`,d&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return Te(a,Je,o)},Qe=we("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:x}=t;return[{[`& .${$.grouped}`]:o.grouped},{[`& .${$.grouped}`]:o[`grouped${pe(x.orientation)}`]},{[`& .${$.firstButton}`]:o.firstButton},{[`& .${$.lastButton}`]:o.lastButton},{[`& .${$.middleButton}`]:o.middleButton},o.root,x.orientation==="vertical"&&o.vertical,x.fullWidth&&o.fullWidth]}})(ke(({theme:t})=>({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${$.grouped}`]:{[`&.${$.selected} + .${$.grouped}.${$.selected}`]:{borderTop:0,marginTop:0}},[`& .${$.firstButton},& .${$.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${$.lastButton},& .${$.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${$.lastButton}.${Y.disabled},& .${$.middleButton}.${Y.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${$.grouped}`]:{[`&.${$.selected} + .${$.grouped}.${$.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${$.firstButton},& .${$.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${$.lastButton},& .${$.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${$.lastButton}.${Y.disabled},& .${$.middleButton}.${Y.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),Xe=i.forwardRef(function(o,x){const s=Ne({props:o,name:"MuiToggleButtonGroup"}),{children:d,className:a,color:l="standard",disabled:c=!1,exclusive:N=!1,fullWidth:b=!1,onChange:C,orientation:Z="horizontal",size:k="medium",value:p,...T}=s,z={...s,disabled:c,fullWidth:b,orientation:Z,size:k},g=Ke(z),u=i.useCallback((I,A)=>{if(!C)return;const n=p&&p.indexOf(A);let m;p&&n>=0?(m=p.slice(),m.splice(n,1)):m=p?p.concat(A):[A],C(I,m)},[C,p]),f=i.useCallback((I,A)=>{C&&C(I,p===A?null:A)},[C,p]),h=i.useMemo(()=>({className:g.grouped,onChange:N?f:u,value:p,size:k,fullWidth:b,color:l,disabled:c}),[g.grouped,N,f,u,p,k,b,l,c]),j=qe(d),W=j.length,w=I=>{const A=I===0,n=I===W-1;return A&&n?"":A?g.firstButton:n?g.lastButton:g.middleButton};return e.jsx(Qe,{role:"group",className:Ze(g.root,a),ref:x,ownerState:z,...T,children:e.jsx(Ee.Provider,{value:h,children:j.map((I,A)=>e.jsx(Ie.Provider,{value:w(A),children:I},A))})})}),et=({open:t,onClose:o,onSave:x,cityCorporation:s,mode:d})=>{const[a,l]=i.useState({code:"",name:"",minWard:"",maxWard:"",minZone:"",maxZone:""}),[c,N]=i.useState({}),[b,C]=i.useState(!1),[Z,k]=i.useState(null);i.useEffect(()=>{var u,f,h,j;l(d==="edit"&&s?{code:s.code,name:s.name,minWard:((u=s.minWard)==null?void 0:u.toString())||"1",maxWard:((f=s.maxWard)==null?void 0:f.toString())||"100",minZone:((h=s.minZone)==null?void 0:h.toString())||"1",maxZone:((j=s.maxZone)==null?void 0:j.toString())||"20"}:{code:"",name:"",minWard:"1",maxWard:"100",minZone:"1",maxZone:"20"}),N({}),k(null)},[s,d,t]);const p=()=>{const u={};if(d==="create"&&(a.code.trim()?/^[A-Z]{2,10}$/.test(a.code.trim())||(u.code="Code must be 2-10 uppercase letters (e.g., DSCC, DNCC)"):u.code="Code is required"),a.name.trim()?a.name.trim().length<3&&(u.name="Name must be at least 3 characters"):u.name="Name is required",!a.minWard.trim())u.minWard="Minimum ward is required";else{const f=parseInt(a.minWard);(isNaN(f)||f<1)&&(u.minWard="Minimum ward must be a positive number")}if(!a.maxWard.trim())u.maxWard="Maximum ward is required";else{const f=parseInt(a.maxWard);(isNaN(f)||f<1)&&(u.maxWard="Maximum ward must be a positive number")}if(a.minWard&&a.maxWard){const f=parseInt(a.minWard),h=parseInt(a.maxWard);!isNaN(f)&&!isNaN(h)&&f>=h&&(u.maxWard="Maximum ward must be greater than minimum ward")}if(!a.minZone.trim())u.minZone="Minimum zone is required";else{const f=parseInt(a.minZone);(isNaN(f)||f<1)&&(u.minZone="Minimum zone must be a positive number")}if(!a.maxZone.trim())u.maxZone="Maximum zone is required";else{const f=parseInt(a.maxZone);(isNaN(f)||f<1)&&(u.maxZone="Maximum zone must be a positive number")}if(a.minZone&&a.maxZone){const f=parseInt(a.minZone),h=parseInt(a.maxZone);!isNaN(f)&&!isNaN(h)&&f>=h&&(u.maxZone="Maximum zone must be greater than minimum zone")}return N(u),Object.keys(u).length===0},T=(u,f)=>{l(h=>({...h,[u]:f})),c[u]&&N(h=>{const j={...h};return delete j[u],j})},z=async()=>{if(p()){C(!0),k(null);try{const u={name:a.name.trim(),minWard:parseInt(a.minWard),maxWard:parseInt(a.maxWard),minZone:parseInt(a.minZone),maxZone:parseInt(a.maxZone)};d==="create"&&(u.code=a.code.trim().toUpperCase()),await x(u),g()}catch(u){console.error("Error saving city corporation:",u),k(u.message||"Failed to save city corporation")}finally{C(!1)}}},g=()=>{b||(l({code:"",name:"",minWard:"1",maxWard:"100",minZone:"1",maxZone:"20"}),N({}),k(null),o())};return e.jsxs(de,{open:t,onClose:g,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(ce,{sx:{fontWeight:600,pb:1},children:d==="create"?"Add New City Corporation":"Edit City Corporation"}),e.jsx(ue,{children:e.jsxs(v,{sx:{display:"flex",flexDirection:"column",gap:2.5,pt:2},children:[Z&&e.jsx(U,{severity:"error",onClose:()=>k(null),children:Z}),d==="create"&&e.jsx(R,{label:"City Corporation Code",value:a.code,onChange:u=>T("code",u.target.value.toUpperCase()),error:!!c.code,helperText:c.code||"e.g., DSCC, DNCC, CTGCC",fullWidth:!0,required:!0,disabled:b,inputProps:{maxLength:10,style:{textTransform:"uppercase"}}}),e.jsx(R,{label:"City Corporation Name",value:a.name,onChange:u=>T("name",u.target.value),error:!!c.name,helperText:c.name||"e.g., Dhaka South City Corporation",fullWidth:!0,required:!0,disabled:b}),e.jsxs(v,{children:[e.jsx(v,{sx:{fontWeight:600,color:"text.secondary",mb:1.5},children:"Ward Range"}),e.jsxs(v,{sx:{display:"flex",gap:2},children:[e.jsx(R,{label:"Minimum Ward *",type:"number",value:a.minWard,onChange:u=>T("minWard",u.target.value),error:!!c.minWard,helperText:c.minWard||"Starting ward number",fullWidth:!0,required:!0,disabled:b,inputProps:{min:1}}),e.jsx(R,{label:"Maximum Ward *",type:"number",value:a.maxWard,onChange:u=>T("maxWard",u.target.value),error:!!c.maxWard,helperText:c.maxWard||(s!=null&&s.actualMaxWard&&s.actualMaxWard>parseInt(a.maxWard||"0")?`âš ï¸ Ward ${s.actualMaxWard} exists! Set at least ${s.actualMaxWard}`:s!=null&&s.actualMaxWard?`Current highest: Ward ${s.actualMaxWard}`:"Use 9999 for unlimited"),fullWidth:!0,required:!0,disabled:b,inputProps:{min:1,max:9999}})]})]}),e.jsxs(v,{children:[e.jsx(v,{sx:{fontWeight:600,color:"text.secondary",mb:1.5},children:"Zone Range"}),e.jsxs(v,{sx:{display:"flex",gap:2},children:[e.jsx(R,{label:"Minimum Zone *",type:"number",value:a.minZone,onChange:u=>T("minZone",u.target.value),error:!!c.minZone,helperText:c.minZone||"Starting zone number",fullWidth:!0,required:!0,disabled:b,inputProps:{min:1}}),e.jsx(R,{label:"Maximum Zone *",type:"number",value:a.maxZone,onChange:u=>T("maxZone",u.target.value),error:!!c.maxZone,helperText:c.maxZone||(s!=null&&s.actualMaxZone&&s.actualMaxZone>parseInt(a.maxZone||"0")?`âš ï¸ Zone ${s.actualMaxZone} exists! Set at least ${s.actualMaxZone}`:s!=null&&s.actualMaxZone?`Current highest: Zone ${s.actualMaxZone}`:"Use 9999 for unlimited"),fullWidth:!0,required:!0,disabled:b,inputProps:{min:1,max:9999}})]})]})]})}),e.jsxs(xe,{sx:{px:3,pb:2.5},children:[e.jsx(L,{onClick:g,disabled:b,sx:{textTransform:"none"},children:"Cancel"}),e.jsx(L,{onClick:z,variant:"contained",disabled:b,sx:{textTransform:"none",minWidth:100,backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"}},children:b?e.jsx(Q,{size:24}):d==="create"?"Create":"Save Changes"})]})]})};class tt{constructor(){je(this,"apiClient");this.apiClient=ee.create({baseURL:ve.BASE_URL,timeout:ve.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(o=>{try{const x=localStorage.getItem("accessToken");x&&(o.headers.Authorization=`Bearer ${x}`)}catch(x){console.error("Error getting token:",x)}return o},o=>Promise.reject(o)),this.apiClient.interceptors.response.use(o=>o,o=>{var x;return((x=o.response)==null?void 0:x.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(o)})}async getThanasByCityCorporation(o,x){var s,d;try{const a={cityCorporationCode:o};return x&&x!=="ALL"&&(a.status=x),(await this.apiClient.get("/api/admin/thanas",{params:a})).data.data}catch(a){throw ee.isAxiosError(a)?new Error(((d=(s=a.response)==null?void 0:s.data)==null?void 0:d.message)||"Failed to fetch thanas"):a}}async createThana(o){var x,s;try{return(await this.apiClient.post("/api/admin/thanas",o)).data.data}catch(d){throw ee.isAxiosError(d)?new Error(((s=(x=d.response)==null?void 0:x.data)==null?void 0:s.message)||"Failed to create thana"):d}}async updateThana(o,x){var s,d;try{return(await this.apiClient.put(`/api/admin/thanas/${o}`,x)).data.data}catch(a){throw ee.isAxiosError(a)?new Error(((d=(s=a.response)==null?void 0:s.data)==null?void 0:d.message)||"Failed to update thana"):a}}async getThanaStats(o){var x,s;try{return(await this.apiClient.get(`/api/admin/thanas/${o}/statistics`)).data.data}catch(d){throw ee.isAxiosError(d)?new Error(((s=(x=d.response)==null?void 0:x.data)==null?void 0:s.message)||"Failed to fetch thana statistics"):d}}}new tt;const rt=({open:t,onClose:o,onSave:x,zone:s,cityCorporationId:d,cityCorporationName:a,mode:l})=>{const[c,N]=i.useState(1),[b,C]=i.useState(""),[Z,k]=i.useState(""),[p,T]=i.useState(""),[z,g]=i.useState(""),[u,f]=i.useState(""),[h,j]=i.useState(!1),[W,w]=i.useState(null),[I,A]=i.useState([]),[n,m]=i.useState(!1);i.useEffect(()=>{(async()=>{if(t&&l==="create"&&d){m(!0);try{console.log("ðŸ” Fetching available zones for CC:",d);const E=await K.getAvailableZoneNumbers(d);console.log("âœ… Available zone numbers:",E),A(E),E.length>0&&N(E[0])}catch(E){console.error("âŒ Error fetching available zones:",E),w("Failed to load available zones")}finally{m(!1)}}})()},[t,l,d]),i.useEffect(()=>{l==="edit"&&s?(N(s.zoneNumber),C(s.name||""),k(s.officerName||""),T(s.officerDesignation||""),g(s.officerSerialNumber||""),f(s.officerPhone||"")):(C(""),k(""),T(""),g(""),f("")),w(null)},[l,s,t]);const F=async()=>{var B,E;try{j(!0),w(null);const D=l==="create"?{zoneNumber:c,name:b.trim()||void 0,cityCorporationId:d,officerName:Z.trim()||void 0,officerDesignation:p.trim()||void 0,officerSerialNumber:z.trim()||void 0,officerPhone:u.trim()||void 0}:{name:b.trim()||void 0,officerName:Z.trim()||void 0,officerDesignation:p.trim()||void 0,officerSerialNumber:z.trim()||void 0,officerPhone:u.trim()||void 0};await x(D),G()}catch(D){console.error("Error saving zone:",D),w(((E=(B=D.response)==null?void 0:B.data)==null?void 0:E.message)||D.message||"Failed to save zone")}finally{j(!1)}},G=()=>{h||(w(null),o())};return e.jsxs(de,{open:t,onClose:G,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(ce,{sx:{fontWeight:600,pb:1},children:l==="create"?"Add New Zone":"Edit Zone"}),e.jsxs(ue,{sx:{pt:2},children:[W&&e.jsx(U,{severity:"error",sx:{mb:2},onClose:()=>w(null),children:W}),e.jsxs(v,{sx:{display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(R,{fullWidth:!0,label:"City Corporation",value:a,disabled:!0,variant:"outlined"}),e.jsxs(he,{fullWidth:!0,children:[e.jsx(fe,{children:"Zone Number *"}),e.jsx(ge,{value:c,onChange:B=>N(Number(B.target.value)),label:"Zone Number *",disabled:l==="edit"||h||n,children:l==="edit"?e.jsxs(H,{value:c,children:["Zone ",c]}):n?e.jsxs(H,{disabled:!0,children:[e.jsx(Q,{size:20,sx:{mr:1}}),"Loading available zones..."]}):I.length===0?e.jsx(H,{disabled:!0,children:"No available zones (all zones are in use)"}):I.map(B=>e.jsxs(H,{value:B,children:["Zone ",B]},B))}),l==="create"&&!n&&e.jsx(v,{sx:{mt:.5,fontSize:"0.75rem",color:"text.secondary"},children:I.length===0?"All zones are already in use for this city corporation":`${I.length} zone(s) available`})]}),e.jsx(R,{fullWidth:!0,label:"Zone Name (Optional)",value:b,onChange:B=>C(B.target.value),placeholder:`Zone ${c}`,disabled:h,variant:"outlined",helperText:"Leave empty to use default name (e.g., Zone 1)"}),e.jsxs(v,{sx:{mt:1},children:[e.jsx(v,{sx:{borderTop:"1px solid #e0e0e0",pt:2,mb:2},children:e.jsx(v,{sx:{fontWeight:600,color:"text.secondary",mb:2},children:"Zone Officer Information (Optional)"})}),e.jsx(R,{fullWidth:!0,label:"Officer Name",value:Z,onChange:B=>k(B.target.value),disabled:h,variant:"outlined",sx:{mb:2.5}}),e.jsx(R,{fullWidth:!0,label:"Officer Designation",value:p,onChange:B=>T(B.target.value),disabled:h,variant:"outlined",sx:{mb:2.5}}),e.jsx(R,{fullWidth:!0,label:"Officer Serial Number",value:z,onChange:B=>g(B.target.value),disabled:h,variant:"outlined",sx:{mb:2.5}}),e.jsx(R,{fullWidth:!0,label:"Officer Phone Number",value:u,onChange:B=>f(B.target.value),disabled:h,variant:"outlined"})]})]})]}),e.jsxs(xe,{sx:{px:3,pb:2.5},children:[e.jsx(L,{onClick:G,disabled:h,sx:{textTransform:"none",px:3},children:"Cancel"}),e.jsx(L,{onClick:F,variant:"contained",disabled:h||l==="create"&&I.length===0,sx:{textTransform:"none",px:3,backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"}},children:h?e.jsx(Q,{size:24,sx:{color:"white"}}):l==="create"?"Create Zone":"Update Zone"})]})]})},st=({zones:t,loading:o,onEdit:x,onDelete:s,onSelectZone:d,selectedZoneId:a})=>o?e.jsx(re,{component:se,elevation:0,children:e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(V,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(r,{sx:{fontWeight:600},children:"Zone Number"}),e.jsx(r,{sx:{fontWeight:600},children:"Zone Name"}),e.jsx(r,{sx:{fontWeight:600},children:"Officer Name"}),e.jsx(r,{sx:{fontWeight:600},children:"Officer Designation"}),e.jsx(r,{sx:{fontWeight:600},children:"Officer Phone"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Wards"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Users"}),e.jsx(r,{sx:{fontWeight:600},children:"Status"}),e.jsx(r,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(oe,{children:Array.from({length:3}).map((l,c)=>e.jsxs(V,{children:[e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})})]},c))})]})}):t.length===0?e.jsx(v,{sx:{textAlign:"center",py:4},children:e.jsx(y,{variant:"body1",color:"text.secondary",children:'No zones added yet. Click "Add Zone" to create the first zone.'})}):e.jsx(re,{component:se,elevation:0,children:e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(V,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(r,{sx:{fontWeight:600},children:"Zone Number"}),e.jsx(r,{sx:{fontWeight:600},children:"Zone Name"}),e.jsx(r,{sx:{fontWeight:600},children:"Officer Name"}),e.jsx(r,{sx:{fontWeight:600},children:"Officer Designation"}),e.jsx(r,{sx:{fontWeight:600},children:"Officer Phone"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Wards"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Users"}),e.jsx(r,{sx:{fontWeight:600},children:"Status"}),e.jsx(r,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(oe,{children:t.map(l=>{var c,N;return e.jsxs(V,{onClick:()=>d(l),sx:{cursor:"pointer",backgroundColor:a===l.id?"#e3f2fd":"transparent","&:hover":{backgroundColor:a===l.id?"#e3f2fd":"#f8f9fa"}},children:[e.jsx(r,{children:e.jsxs(y,{variant:"body1",sx:{fontWeight:600},children:["Zone ",l.zoneNumber]})}),e.jsx(r,{children:e.jsx(y,{variant:"body1",children:l.name||`Zone ${l.zoneNumber}`})}),e.jsx(r,{children:e.jsx(y,{variant:"body2",color:"text.secondary",children:l.officerName||"-"})}),e.jsx(r,{children:e.jsx(y,{variant:"body2",color:"text.secondary",children:l.officerDesignation||"-"})}),e.jsx(r,{children:e.jsx(y,{variant:"body2",color:"text.secondary",children:l.officerPhone||"-"})}),e.jsx(r,{children:e.jsx(O,{label:((c=l._count)==null?void 0:c.wards)||l.totalWards||0,size:"small",sx:{backgroundColor:"#f3e5f5",color:"#7b1fa2",fontWeight:500}})}),e.jsx(r,{children:e.jsx(O,{label:((N=l._count)==null?void 0:N.users)||l.totalUsers||0,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}})}),e.jsx(r,{children:e.jsx(O,{label:l.status,size:"small",sx:{backgroundColor:l.status==="ACTIVE"?"#e8f5e8":"#ffebee",color:l.status==="ACTIVE"?"#2e7d2e":"#c62828",fontWeight:500}})}),e.jsx(r,{children:e.jsxs(v,{sx:{display:"flex",gap:1},children:[e.jsx(_,{title:"Edit Zone",children:e.jsx(X,{size:"small",onClick:b=>{b.stopPropagation(),x(l)},sx:{color:"#1976d2","&:hover":{backgroundColor:"#e3f2fd"}},children:e.jsx(be,{fontSize:"small"})})}),e.jsx(_,{title:"Delete Zone",children:e.jsx(X,{size:"small",onClick:b=>{b.stopPropagation(),s(l)},sx:{color:"#c62828","&:hover":{backgroundColor:"#ffebee"}},children:e.jsx(Ae,{fontSize:"small"})})})]})})]},l.id)})})]})}),at=({cityCorporationId:t,cityCorporationName:o,cityCorporationCode:x,onZoneSelect:s})=>{var F,G,B;const[d,a]=i.useState([]),[l,c]=i.useState(!1),[N,b]=i.useState(null),[C,Z]=i.useState(null),[k,p]=i.useState(!1),[T,z]=i.useState("create"),[g,u]=i.useState(null),[f,h]=i.useState(!1);i.useEffect(()=>{console.log("ðŸ”„ ZoneManagement: cityCorporationId changed:",t),t&&j()},[t]);const j=async()=>{var E,D,S;try{console.log("ðŸ“¡ Fetching zones for city corporation:",t),c(!0),b(null);const P=await K.getZonesByCityCorporation(t,"ALL");console.log("âœ… Zones fetched:",P.length,"zones"),console.log("   First zone:",P[0]),a(P)}catch(P){console.error("âŒ Error fetching zones:",P),console.error("   Error details:",(E=P.response)==null?void 0:E.data),b(((S=(D=P.response)==null?void 0:D.data)==null?void 0:S.message)||P.message||"Failed to load zones")}finally{c(!1)}},W=()=>{Z(null),z("create"),p(!0)},w=E=>{Z(E),z("edit"),p(!0)},I=async E=>{try{T==="create"?await K.createZone(E):C&&await K.updateZone(C.id,E),await j(),p(!1)}catch(D){throw console.error("Error saving zone:",D),D}},A=E=>{u(E),h(!0)},n=async()=>{var E,D;if(g)try{await K.deleteZone(g.id),await j(),h(!1),u(null),(C==null?void 0:C.id)===g.id&&(Z(null),s==null||s(null))}catch(S){console.error("Error deleting zone:",S),b(((D=(E=S.response)==null?void 0:E.data)==null?void 0:D.message)||S.message||"Failed to delete zone"),h(!1)}},m=E=>{Z(E),s==null||s(E)};return e.jsxs(le,{sx:{borderRadius:2,border:"2px solid #4CAF50",mt:3,boxShadow:"0 4px 12px rgba(76, 175, 80, 0.15)"},children:[e.jsxs(ie,{sx:{p:3,backgroundColor:"#f1f8f4"},children:[e.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(v,{children:[e.jsxs(y,{variant:"h5",sx:{fontWeight:700,mb:.5,color:"#2e7d32"},children:["ðŸ¢ Zone Management - ",o]}),e.jsxs(y,{variant:"body1",color:"text.secondary",sx:{fontWeight:500},children:["Manage zones for ",x]})]}),e.jsx(L,{variant:"contained",startIcon:e.jsx(me,{}),onClick:W,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3,py:1.5,fontSize:"1rem",fontWeight:600},children:"Add Zone"})]}),N&&e.jsx(U,{severity:"error",sx:{mb:3},onClose:()=>b(null),children:N}),e.jsx(st,{zones:d,loading:l,onEdit:w,onDelete:A,onSelectZone:m,selectedZoneId:C==null?void 0:C.id})]}),e.jsx(rt,{open:k,onClose:()=>{p(!1),Z(null)},onSave:I,zone:T==="edit"?C:null,cityCorporationId:t,cityCorporationName:o,mode:T}),e.jsxs(de,{open:f,onClose:()=>h(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ce,{children:"Delete Zone"}),e.jsxs(ue,{children:[e.jsxs(y,{children:["Are you sure you want to delete Zone ",g==null?void 0:g.zoneNumber,"?"]}),g&&(((F=g._count)==null?void 0:F.wards)||0)>0&&e.jsxs(U,{severity:"warning",sx:{mt:2},children:["This zone has ",(G=g._count)==null?void 0:G.wards," ward(s). You must remove all wards before deleting the zone."]})]}),e.jsxs(xe,{children:[e.jsx(L,{onClick:()=>h(!1),sx:{textTransform:"none"},children:"Cancel"}),e.jsx(L,{onClick:n,color:"error",variant:"contained",sx:{textTransform:"none"},disabled:!!(g&&(((B=g._count)==null?void 0:B.wards)||0)>0),children:"Delete"})]})]})]})},nt=({wards:t,loading:o,onEdit:x,onDelete:s})=>o?e.jsx(re,{component:se,elevation:0,children:e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(V,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(r,{sx:{fontWeight:600},children:"Ward Number"}),e.jsx(r,{sx:{fontWeight:600},children:"Inspector Name"}),e.jsx(r,{sx:{fontWeight:600},children:"Inspector Serial"}),e.jsx(r,{sx:{fontWeight:600},children:"Inspector Phone"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Users"}),e.jsx(r,{sx:{fontWeight:600},children:"Status"}),e.jsx(r,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(oe,{children:Array.from({length:3}).map((d,a)=>e.jsxs(V,{children:[e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})})]},a))})]})}):!t||!Array.isArray(t)?(console.error("Invalid wards data:",t),e.jsx(v,{sx:{textAlign:"center",py:4},children:e.jsx(y,{variant:"body1",color:"text.secondary",children:"Error loading wards. Please try again."})})):t.length===0?e.jsx(v,{sx:{textAlign:"center",py:4},children:e.jsx(y,{variant:"body1",color:"text.secondary",children:'No wards added yet. Click "Add Wards" to create wards for this zone.'})}):e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mb:2,p:2,backgroundColor:"#f8f9fa",borderRadius:1},children:e.jsxs(y,{variant:"body2",color:"text.secondary",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"}),' Click the Edit button to assign inspector name and serial number to wards. Wards without assigned inspectors will show "Not Assigned".']})}),e.jsx(re,{component:se,elevation:0,children:e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(V,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(r,{sx:{fontWeight:600},children:"Ward Number"}),e.jsx(r,{sx:{fontWeight:600},children:"Inspector Name"}),e.jsx(r,{sx:{fontWeight:600},children:"Inspector Serial"}),e.jsx(r,{sx:{fontWeight:600},children:"Inspector Phone"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Users"}),e.jsx(r,{sx:{fontWeight:600},children:"Status"}),e.jsx(r,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(oe,{children:t.map(d=>{var a;return e.jsxs(V,{sx:{"&:hover":{backgroundColor:"#f8f9fa"}},children:[e.jsx(r,{children:e.jsxs(y,{variant:"body1",sx:{fontWeight:600},children:["Ward ",d.wardNumber]})}),e.jsx(r,{children:d.inspectorName?e.jsx(y,{variant:"body2",color:"text.secondary",children:d.inspectorName}):e.jsx(_,{title:"Click Edit to assign inspector",children:e.jsx(O,{label:"Not Assigned",size:"small",sx:{backgroundColor:"#fff3e0",color:"#e65100",fontWeight:500,cursor:"pointer"}})})}),e.jsx(r,{children:d.inspectorSerialNumber?e.jsx(y,{variant:"body2",color:"text.secondary",children:d.inspectorSerialNumber}):e.jsx(_,{title:"Click Edit to assign serial number",children:e.jsx(O,{label:"Not Assigned",size:"small",sx:{backgroundColor:"#fff3e0",color:"#e65100",fontWeight:500,cursor:"pointer"}})})}),e.jsx(r,{children:d.inspectorPhone?e.jsx(y,{variant:"body2",color:"text.secondary",children:d.inspectorPhone}):e.jsx(_,{title:"Click Edit to assign phone number",children:e.jsx(O,{label:"No Phone",size:"small",sx:{backgroundColor:"#fff3e0",color:"#e65100",fontWeight:500,cursor:"pointer"}})})}),e.jsx(r,{children:e.jsx(O,{label:((a=d._count)==null?void 0:a.users)||d.totalUsers||0,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}})}),e.jsx(r,{children:e.jsx(O,{label:d.status,size:"small",sx:{backgroundColor:d.status==="ACTIVE"?"#e8f5e8":"#ffebee",color:d.status==="ACTIVE"?"#2e7d2e":"#c62828",fontWeight:500}})}),e.jsxs(r,{children:[e.jsx(_,{title:"Edit Ward",children:e.jsx(X,{size:"small",onClick:()=>x(d),sx:{color:"#1976d2","&:hover":{backgroundColor:"#e3f2fd"},mr:1},children:e.jsx(be,{fontSize:"small"})})}),e.jsx(_,{title:"Delete Ward",children:e.jsx(X,{size:"small",onClick:()=>s(d.id),sx:{color:"#d32f2f","&:hover":{backgroundColor:"#ffebee"}},children:e.jsx(Ae,{fontSize:"small"})})})]})]},d.id)})})]})})]}),ot=({open:t,onClose:o,onSave:x,ward:s})=>{const[d,a]=i.useState(""),[l,c]=i.useState(""),[N,b]=i.useState([]),[C,Z]=i.useState(""),[k,p]=i.useState(""),[T,z]=i.useState(""),[g,u]=i.useState(!1),[f,h]=i.useState(!1),[j,W]=i.useState(null);i.useEffect(()=>{var n,m,F;s&&(a(((n=s.wardNumber)==null?void 0:n.toString())||""),c(s.zoneId||""),Z(s.inspectorName||""),p(s.inspectorSerialNumber||""),z(s.inspectorPhone||""),(F=(m=s.zone)==null?void 0:m.cityCorporation)!=null&&F.id&&w(s.zone.cityCorporation.id)),W(null)},[s,t]);const w=async n=>{try{h(!0);const m=await K.getZonesByCityCorporation(n,"ACTIVE");b(m)}catch(m){console.error("Error fetching zones:",m)}finally{h(!1)}},I=async()=>{var n,m;try{u(!0),W(null);const F={wardNumber:parseInt(d),zoneId:l?Number(l):void 0,inspectorName:C.trim()||void 0,inspectorSerialNumber:k.trim()||void 0,inspectorPhone:T.trim()||void 0};await x(F),A()}catch(F){console.error("Error saving ward:",F),W(((m=(n=F.response)==null?void 0:n.data)==null?void 0:m.message)||F.message||"Failed to save ward")}finally{u(!1)}},A=()=>{g||(W(null),o())};return e.jsxs(de,{open:t,onClose:A,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(ce,{sx:{fontWeight:600,pb:1},children:["Edit Ward ",s.wardNumber]}),e.jsxs(ue,{sx:{pt:2},children:[j&&e.jsx(U,{severity:"error",sx:{mb:2},onClose:()=>W(null),children:j}),e.jsxs(v,{sx:{display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(R,{fullWidth:!0,label:"Ward Number",value:d,onChange:n=>a(n.target.value),disabled:g,variant:"outlined",type:"number",helperText:"Ensure this Ward Number is unique within the City Corporation"}),e.jsxs(he,{fullWidth:!0,variant:"outlined",children:[e.jsx(fe,{id:"zone-select-label",children:"Zone"}),e.jsx(ge,{labelId:"zone-select-label",value:l,onChange:n=>c(n.target.value),label:"Zone",disabled:g||f,children:N.map(n=>e.jsx(H,{value:n.id,children:`Zone ${n.zoneNumber}${n.name?` - ${n.name}`:""}`},n.id))})]}),e.jsxs(v,{sx:{mt:1},children:[e.jsx(v,{sx:{borderTop:"1px solid #e0e0e0",pt:2,mb:2},children:e.jsx(v,{sx:{fontWeight:600,color:"text.secondary",mb:2},children:"Ward Inspector Information"})}),e.jsx(R,{fullWidth:!0,label:"Inspector Name",value:C,onChange:n=>Z(n.target.value),disabled:g,variant:"outlined",sx:{mb:2.5},helperText:"Enter the name of the cleanliness inspector for this ward"}),e.jsx(R,{fullWidth:!0,label:"Inspector Serial Number",value:k,onChange:n=>p(n.target.value),disabled:g,variant:"outlined",sx:{mb:2.5},helperText:"Enter the serial number of the inspector"}),e.jsx(R,{fullWidth:!0,label:"Inspector Phone Number",value:T,onChange:n=>z(n.target.value),disabled:g,variant:"outlined",helperText:"Enter the contact number of the inspector"})]})]})]}),e.jsxs(xe,{sx:{px:3,pb:2.5},children:[e.jsx(L,{onClick:A,disabled:g,sx:{textTransform:"none",px:3},children:"Cancel"}),e.jsx(L,{onClick:I,variant:"contained",disabled:g,sx:{textTransform:"none",px:3,backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"}},children:g?e.jsx(Q,{size:24,sx:{color:"white"}}):"Update Ward"})]})]})},lt=({open:t,onClose:o,onSave:x,zoneId:s,zoneName:d})=>{const[a,l]=i.useState("single"),[c,N]=i.useState([]),[b,C]=i.useState(""),[Z,k]=i.useState([]),[p,T]=i.useState(!1),[z,g]=i.useState(!1),[u,f]=i.useState(null),[h,j]=i.useState(""),[W,w]=i.useState(""),[I,A]=i.useState("");i.useEffect(()=>{t&&s&&n()},[t,s]),i.useEffect(()=>{t&&(l("single"),N([]),C(""),j(""),w(""),A(""),f(null))},[t]);const n=async()=>{var S,P;try{g(!0),f(null);const q=await J.getAvailableWardNumbers(s);k(q)}catch(q){console.error("Error fetching available ward numbers:",q),f(((P=(S=q.response)==null?void 0:S.data)==null?void 0:P.message)||q.message||"Failed to load available wards")}finally{g(!1)}},m=(S,P)=>{P!==null&&(l(P),N([]),C(""),f(null))},F=S=>{const P=S.target.value;N(typeof P=="string"?P.split(",").map(Number):P)},G=async()=>{var S,P;try{if(T(!0),f(null),a==="single"){if(!b){f("Please select a ward number");return}const q={inspectorName:h.trim()||void 0,inspectorSerialNumber:W.trim()||void 0,inspectorPhone:I.trim()||void 0};await x([b],q)}else{if(c.length===0){f("Please select at least one ward");return}if(c.length>50){f("Maximum 50 wards can be added at once");return}await x(c)}B()}catch(q){console.error("Error saving wards:",q),f(((P=(S=q.response)==null?void 0:S.data)==null?void 0:P.message)||q.message||"Failed to save wards")}finally{T(!1)}},B=()=>{p||(N([]),C(""),j(""),w(""),A(""),f(null),o())},E=a==="bulk"&&c.length>50,D=a==="single"?b!=="":c.length>0&&!E;return e.jsxs(de,{open:t,onClose:B,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(ce,{sx:{fontWeight:600,pb:1},children:["Add Wards to ",d]}),e.jsxs(ue,{sx:{pt:2},children:[u&&e.jsx(U,{severity:"error",sx:{mb:2},onClose:()=>f(null),children:u}),z?e.jsx(v,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Q,{})}):Z.length===0?e.jsx(U,{severity:"info",children:"No available ward numbers. All wards have been added to this zone."}):e.jsxs(v,{sx:{display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(v,{sx:{display:"flex",justifyContent:"center",mb:1},children:e.jsxs(Xe,{value:a,exclusive:!0,onChange:m,"aria-label":"add mode",sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(We,{value:"single",sx:{px:3,"&.Mui-selected":{backgroundColor:"#4CAF50",color:"white","&:hover":{backgroundColor:"#45a049"}}},children:"Single Ward (with Inspector)"}),e.jsx(We,{value:"bulk",sx:{px:3,"&.Mui-selected":{backgroundColor:"#2196F3",color:"white","&:hover":{backgroundColor:"#1976d2"}}},children:"Multiple Wards (Bulk)"})]})}),a==="single"?e.jsxs(e.Fragment,{children:[e.jsxs(he,{fullWidth:!0,children:[e.jsx(fe,{children:"Ward Number *"}),e.jsx(ge,{value:b,onChange:S=>C(S.target.value),label:"Ward Number *",disabled:p,children:Z.map(S=>e.jsxs(H,{value:S,children:["Ward ",S]},S))})]}),e.jsxs(v,{sx:{mt:1},children:[e.jsx(v,{sx:{borderTop:"1px solid #e0e0e0",pt:2,mb:2},children:e.jsx(y,{sx:{fontWeight:600,color:"text.secondary",mb:2},children:"Ward Inspector Information (Optional)"})}),e.jsx(R,{fullWidth:!0,label:"Inspector Name",value:h,onChange:S=>j(S.target.value),disabled:p,variant:"outlined",sx:{mb:2.5},helperText:"Enter the name of the cleanliness inspector for this ward"}),e.jsx(R,{fullWidth:!0,label:"Inspector Serial Number",value:W,onChange:S=>w(S.target.value),disabled:p,variant:"outlined",sx:{mb:2.5},helperText:"Enter the serial number of the inspector"}),e.jsx(R,{fullWidth:!0,label:"Inspector Phone Number",value:I,onChange:S=>A(S.target.value),disabled:p,variant:"outlined",helperText:"Enter the contact number of the inspector"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(he,{fullWidth:!0,children:[e.jsx(fe,{children:"Select Wards"}),e.jsx(ge,{multiple:!0,value:c,onChange:F,label:"Select Wards",disabled:p,renderValue:S=>e.jsx(v,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:S.map(P=>e.jsx(O,{label:`Ward ${P}`,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2"}},P))}),children:Z.map(S=>e.jsxs(H,{value:S,children:[e.jsx(Fe,{checked:c.includes(S)}),e.jsx(Re,{primary:`Ward ${S}`})]},S))})]}),e.jsxs(v,{sx:{p:2,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e0e0e0"},children:[e.jsx(y,{variant:"body2",sx:{fontWeight:600,mb:1},children:"Selection Summary"}),e.jsxs(y,{variant:"body2",color:"text.secondary",children:["Selected: ",c.length," ward(s)"]}),e.jsxs(y,{variant:"body2",color:"text.secondary",children:["Available: ",Z.length," ward(s)"]}),e.jsx(y,{variant:"body2",color:"text.secondary",children:"No limit on wards per zone"})]}),E&&e.jsxs(U,{severity:"warning",children:["Maximum 50 wards can be added at once. Please deselect"," ",c.length-50," ward(s)."]}),c.length>0&&!E&&e.jsxs(U,{severity:"info",children:[c.length," ward(s) will be created. You can add inspector information later by editing each ward."]})]})]})]}),e.jsxs(xe,{sx:{px:3,pb:2.5},children:[e.jsx(L,{onClick:B,disabled:p,sx:{textTransform:"none",px:3},children:"Cancel"}),e.jsx(L,{onClick:G,variant:"contained",disabled:p||z||!D||Z.length===0,sx:{textTransform:"none",px:3,backgroundColor:a==="single"?"#4CAF50":"#2196F3","&:hover":{backgroundColor:a==="single"?"#45a049":"#1976d2"}},children:p?e.jsx(Q,{size:24,sx:{color:"white"}}):a==="single"?"Add Ward":`Add ${c.length} Ward${c.length!==1?"s":""}`})]})]})},it=({zone:t})=>{const[o,x]=i.useState([]),[s,d]=i.useState(!1),[a,l]=i.useState(null),[c,N]=i.useState(null),[b,C]=i.useState(!1),[Z,k]=i.useState(!1);i.useEffect(()=>{t?p():x([])},[t]);const p=async()=>{var h,j;if(t)try{d(!0),l(null);const W=await J.getWardsByZone(t.id,"ALL");let w=[];Array.isArray(W)?w=W:W&&typeof W=="object"&&(Array.isArray(W.wards)?w=W.wards:Array.isArray(W.data)&&(w=W.data)),x(w)}catch(W){console.error("Error fetching wards:",W),l(((j=(h=W.response)==null?void 0:h.data)==null?void 0:j.message)||W.message||"Failed to load wards"),x([])}finally{d(!1)}},T=()=>{k(!0)},z=h=>{N(h),C(!0)},g=async(h,j)=>{if(t)try{h.length===1&&j?await J.createWard({wardNumber:h[0],zoneId:t.id,inspectorName:j.inspectorName,inspectorSerialNumber:j.inspectorSerialNumber,inspectorPhone:j.inspectorPhone}):await J.createWardsBulk(t.id,h),await p(),k(!1)}catch(W){throw console.error("Error creating wards:",W),W}},u=async h=>{if(c)try{await J.updateWard(c.id,h),await p(),C(!1),N(null)}catch(j){throw console.error("Error updating ward:",j),j}},f=async h=>{var j,W;if(window.confirm("Are you sure you want to delete this ward?"))try{await J.deleteWard(h),await p()}catch(w){console.error("Error deleting ward:",w),l(((W=(j=w.response)==null?void 0:j.data)==null?void 0:W.message)||w.message||"Failed to delete ward")}};return t?e.jsxs(le,{sx:{borderRadius:2,border:"2px solid #2196F3",mt:3,boxShadow:"0 4px 12px rgba(33, 150, 243, 0.15)"},children:[e.jsxs(ie,{sx:{p:3,backgroundColor:"#e3f2fd"},children:[e.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(v,{children:[e.jsxs(y,{variant:"h5",sx:{fontWeight:700,mb:.5,color:"#1565c0"},children:["ðŸ“ Ward Management - ",t.name||`Zone ${t.zoneNumber}`]}),e.jsxs(y,{variant:"body1",color:"text.secondary",sx:{fontWeight:500},children:["Manage wards for Zone ",t.zoneNumber]})]}),e.jsx(L,{variant:"contained",startIcon:e.jsx(me,{}),onClick:T,sx:{backgroundColor:"#2196F3","&:hover":{backgroundColor:"#1976d2"},textTransform:"none",px:3,py:1.5,fontSize:"1rem",fontWeight:600},children:"Add Wards"})]}),a&&e.jsx(U,{severity:"error",sx:{mb:3},onClose:()=>l(null),children:a}),e.jsx(nt,{wards:o,loading:s,onEdit:z,onDelete:f})]}),e.jsx(lt,{open:Z,onClose:()=>k(!1),onSave:g,zoneId:t.id,zoneName:t.name||`Zone ${t.zoneNumber}`}),c&&e.jsx(ot,{open:b,onClose:()=>{C(!1),N(null)},onSave:u,ward:c})]}):e.jsx(le,{sx:{borderRadius:2,border:"1px solid #e0e0e0",mt:3},children:e.jsx(ie,{sx:{p:3},children:e.jsx(v,{sx:{textAlign:"center",py:4},children:e.jsx(y,{variant:"body1",color:"text.secondary",children:"Select a zone to manage its wards"})})})})},gt=()=>{const[t,o]=i.useState([]),[x,s]=i.useState(!0),[d,a]=i.useState(null),[l,c]=i.useState(null),[N,b]=i.useState(null),[C,Z]=i.useState(!1),[k,p]=i.useState("create"),[T,z]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{g()},[]);const g=async()=>{var n;try{s(!0),a(null);const m=await te.getCityCorporations("ALL");console.log("ðŸ¢ City Corporations Response:",m),console.log("ðŸ“Š First City Corp Data:",(n=m.cityCorporations)==null?void 0:n[0]),o(m.cityCorporations||[])}catch(m){console.error("Error fetching city corporations:",m),a(m.message||"Failed to load city corporations"),w("Failed to load city corporations","error"),o([])}finally{s(!1)}},u=()=>{c(null),p("create"),Z(!0)},f=n=>{c(n),p("edit"),Z(!0)},h=async n=>{try{if(k==="create"?(await te.createCityCorporation(n),w("City corporation created successfully","success")):l&&(console.log("ðŸ”„ Updating city corporation:",l.code,n),await te.updateCityCorporation(l.code,n),w("City corporation updated successfully","success")),console.log("ðŸ“¡ Fetching updated city corporations..."),s(!0),await g(),l){const F=(await te.getCityCorporations("ALL")).cityCorporations.find(G=>G.code===l.code);F&&(console.log("âœ… Updated selected city corporation:",F),c(F))}s(!1),console.log("âœ… City corporations refreshed")}catch(m){throw console.error("Error saving city corporation:",m),s(!1),m}},j=async n=>{try{const m=n.status==="ACTIVE"?"INACTIVE":"ACTIVE";await te.updateCityCorporation(n.code,{status:m}),w(`City corporation ${m==="ACTIVE"?"activated":"deactivated"} successfully`,"success"),await g(),(l==null?void 0:l.code)===n.code&&c(F=>F?{...F,status:m}:null)}catch(m){console.error("Error toggling city corporation status:",m),w("Failed to update city corporation status","error")}},W=n=>{console.log("ðŸ¢ Selected City Corporation:",n),c(n),b(null)},w=(n,m)=>{z({open:!0,message:n,severity:m})},I=()=>{z(n=>({...n,open:!1}))},A=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsx(De,{children:e.jsxs(Oe,{title:"City Corporation Management",children:[e.jsxs(v,{sx:{width:"100%",maxWidth:"100%",px:1.5,mx:0},children:[e.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(v,{children:[e.jsx(y,{variant:"h4",sx:{fontWeight:600,mb:.5,color:"text.primary"},children:"City Corporation Management"}),e.jsx(y,{variant:"body1",color:"text.secondary",children:"Manage city corporations and their thanas/areas"})]}),e.jsx(L,{variant:"contained",startIcon:e.jsx(me,{}),onClick:u,sx:{backgroundColor:"#4CAF50","&:hover":{backgroundColor:"#45a049"},textTransform:"none",px:3,py:1.5,borderRadius:2},children:"Add City Corporation"})]}),d&&e.jsx(U,{severity:"error",sx:{mb:3},onClose:()=>a(null),children:d}),e.jsx(le,{sx:{borderRadius:2,border:"1px solid #e0e0e0",mb:3},children:e.jsxs(ie,{sx:{p:3},children:[e.jsx(y,{variant:"h6",sx:{fontWeight:600,mb:3},children:"City Corporations"}),e.jsx(re,{component:se,elevation:0,children:e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(V,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(r,{sx:{fontWeight:600},children:"Code"}),e.jsx(r,{sx:{fontWeight:600},children:"Name"}),e.jsx(r,{sx:{fontWeight:600},children:"Zone Range"}),e.jsx(r,{sx:{fontWeight:600},children:"Ward Range"}),e.jsx(r,{sx:{fontWeight:600},children:"Status"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Users"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Complaints"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Zones"}),e.jsx(r,{sx:{fontWeight:600},children:"Total Wards"}),e.jsx(r,{sx:{fontWeight:600},children:"Created"}),e.jsx(r,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(oe,{children:x?Array.from({length:3}).map((n,m)=>e.jsxs(V,{children:[e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})}),e.jsx(r,{children:e.jsx(M,{variant:"rectangular",height:30})})]},m)):t.length===0?e.jsx(V,{children:e.jsx(r,{colSpan:11,children:e.jsxs(v,{sx:{textAlign:"center",py:4},children:[e.jsx(Ce,{sx:{fontSize:48,color:"#9e9e9e",mb:2}}),e.jsx(y,{variant:"body1",color:"text.secondary",sx:{mb:2},children:"No city corporations added yet"}),e.jsx(L,{variant:"outlined",startIcon:e.jsx(me,{}),onClick:u,sx:{textTransform:"none"},children:"Add First City Corporation"})]})})}):t.map(n=>e.jsxs(V,{onClick:()=>W(n),sx:{cursor:"pointer",backgroundColor:(l==null?void 0:l.id)===n.id?"#e3f2fd":"transparent","&:hover":{backgroundColor:(l==null?void 0:l.id)===n.id?"#e3f2fd":"#f8f9fa"}},children:[e.jsx(r,{children:e.jsx(y,{variant:"body1",sx:{fontWeight:600},children:n.code})}),e.jsx(r,{children:e.jsx(y,{variant:"body1",sx:{fontWeight:500},children:n.name})}),e.jsx(r,{children:e.jsxs(y,{variant:"body2",color:"text.secondary",children:[n.minZone," - ",n.maxZone]})}),e.jsx(r,{children:e.jsxs(y,{variant:"body2",color:"text.secondary",children:[n.minWard," - ",n.maxWard]})}),e.jsx(r,{children:e.jsx(O,{label:n.status,size:"small",sx:{backgroundColor:n.status==="ACTIVE"?"#e8f5e8":"#ffebee",color:n.status==="ACTIVE"?"#2e7d2e":"#c62828",fontWeight:500}})}),e.jsx(r,{children:e.jsx(O,{label:n.totalUsers||0,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontWeight:500}})}),e.jsx(r,{children:e.jsx(O,{label:n.totalComplaints||0,size:"small",sx:{backgroundColor:"#fff3e0",color:"#e65100",fontWeight:500}})}),e.jsx(r,{children:e.jsx(O,{label:n.totalZones||0,size:"small",sx:{backgroundColor:"#f3e5f5",color:"#7b1fa2",fontWeight:500}})}),e.jsx(r,{children:e.jsx(O,{label:n.totalWards||0,size:"small",sx:{backgroundColor:"#e1f5fe",color:"#0277bd",fontWeight:500}})}),e.jsx(r,{children:e.jsx(y,{variant:"body2",color:"text.secondary",children:A(n.createdAt)})}),e.jsx(r,{children:e.jsxs(v,{sx:{display:"flex",gap:1},children:[e.jsx(_,{title:"Edit",children:e.jsx(X,{size:"small",onClick:m=>{m.stopPropagation(),f(n)},sx:{color:"#1976d2","&:hover":{backgroundColor:"#e3f2fd"}},children:e.jsx(be,{fontSize:"small"})})}),e.jsx(_,{title:n.status==="ACTIVE"?"Deactivate":"Activate",children:e.jsx(X,{size:"small",onClick:m=>{m.stopPropagation(),j(n)},sx:{color:n.status==="ACTIVE"?"#c62828":"#2e7d2e","&:hover":{backgroundColor:n.status==="ACTIVE"?"#ffebee":"#e8f5e8"}},children:n.status==="ACTIVE"?e.jsx(Le,{fontSize:"small"}):e.jsx(Ue,{fontSize:"small"})})})]})})]},n.id))})]})})]})}),l?e.jsx(v,{sx:{mt:3},children:e.jsx(at,{cityCorporationId:l.id,cityCorporationName:l.name,cityCorporationCode:l.code,onZoneSelect:b})}):e.jsx(le,{sx:{borderRadius:2,border:"2px dashed #9e9e9e",mt:3,backgroundColor:"#fafafa"},children:e.jsxs(ie,{sx:{p:4,textAlign:"center"},children:[e.jsx(Ce,{sx:{fontSize:64,color:"#9e9e9e",mb:2}}),e.jsx(y,{variant:"h6",sx:{fontWeight:600,mb:1,color:"#616161"},children:"Select a City Corporation"}),e.jsx(y,{variant:"body1",color:"text.secondary",children:"Click on any City Corporation from the table above to manage its zones and wards"})]})}),N&&e.jsx(v,{sx:{mt:3},children:e.jsx(it,{zone:N})}),!1]}),e.jsx(et,{open:C,onClose:()=>{Z(!1),c(null)},onSave:h,cityCorporation:k==="edit"?l:void 0,mode:k}),e.jsx(Ve,{open:T.open,autoHideDuration:6e3,onClose:I,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(U,{onClose:I,severity:T.severity,sx:{width:"100%"},children:T.message})})]})})};export{gt as default};
