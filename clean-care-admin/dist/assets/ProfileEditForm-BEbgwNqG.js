import{u as he,p as q,j as s,B as k,T as S,D as V,P as X,g as y,L as pe,I as Y,i as D,V as ee,l as re,d as we,m as $,b as se,U as be,C as xe,b0 as ge,b5 as ae,Q as Pe}from"./mui-vendor-Dt-wTuK2.js";import{r as n}from"./react-vendor-D7yrL1sD.js";import{A as Ne}from"./AvatarUpload-DTm6DpnK.js";import{R as ve,S as ye,T as A,u as Ce,V as je,f as ke,s as te}from"./index-CEqbPxQ7.js";import"./query-vendor-CyFhwaPb.js";import"./chart-vendor-TjDrWffg.js";const Se=r=>{const{updateProfile:E}=ve(),[H,c]=n.useState(!1),[i,P]=n.useState(null),[b,j]=n.useState({}),z=n.useCallback(async u=>{var o,C;c(!0),P(null),j({});try{if(!u||Object.keys(u).length===0)throw new Error("No data provided for update");const l=ye(u);if(!l.isValid){j(l.errors);const U=Object.values(l.errors)[0];throw new Error(U)}const x={};u.firstName&&(x.firstName=A(u.firstName)),u.lastName&&(x.lastName=A(u.lastName)),u.avatar&&(x.avatar=u.avatar.trim()),u.ward&&(x.ward=A(u.ward)),u.zone&&(x.zone=A(u.zone)),u.address&&(x.address=A(u.address)),await E(x),(o=r==null?void 0:r.onSuccess)==null||o.call(r)}catch(l){const x=l instanceof Error?l.message:"Failed to update profile";throw P(x),(C=r==null?void 0:r.onError)==null||C.call(r,x),l}finally{c(!1)}},[E,r]),w=n.useCallback(()=>{P(null)},[]),e=n.useCallback(()=>{j({})},[]);return{updateProfile:z,isUpdating:H,updateError:i,validationErrors:b,clearUpdateError:w,clearValidationErrors:e}},Ae=({initialData:r,onSave:E,onCancel:H})=>{const c=he(),i=q(c.breakpoints.down("sm")),P=q(c.breakpoints.between("sm","md")),b=q("(orientation: landscape)"),{user:j}=Ce(),z=(j==null?void 0:j.role)==="MASTER_ADMIN",w=n.useCallback(t=>t?typeof t=="object"?t.name||(t.wardNumber?String(t.wardNumber):"")||(t.zoneNumber?String(t.zoneNumber):"")||(t.number?String(t.number):"")||"":String(t):"",[]),[e,u]=n.useState({firstName:r.firstName||"",lastName:r.lastName||"",avatar:r.avatar,ward:w(r.ward),zone:w(r.zone),address:r.address||"",email:r.email||"",phone:r.phone||"",newPassword:"",confirmPassword:""}),[o,C]=n.useState({}),[l,x]=n.useState(!1),[U,F]=n.useState(!1),[oe,I]=n.useState(!1),[ne,T]=n.useState(""),[O,Z]=n.useState(!1),[R,Q]=n.useState(!1),{isUpdating:f,updateError:_,clearUpdateError:M}=Se({onSuccess:()=>{F(!0)},onError:t=>{T(t),I(!0)}}),W=n.useRef(null),ie=n.useMemo(()=>{var h,m,p,d;const t=((m=(h=e.firstName)==null?void 0:h.charAt(0))==null?void 0:m.toUpperCase())||"",a=((d=(p=e.lastName)==null?void 0:p.charAt(0))==null?void 0:d.toUpperCase())||"";return`${t}${a}`||"?"},[e.firstName,e.lastName]),B=n.useMemo(()=>{const t=e.newPassword||"";if(!t)return{score:0,label:"",color:""};let a=0;t.length>=8&&(a+=25),t.length>=12&&(a+=25),/[a-z]/.test(t)&&(a+=15),/[A-Z]/.test(t)&&(a+=15),/[0-9]/.test(t)&&(a+=10),/[^a-zA-Z0-9]/.test(t)&&(a+=10);let h="",m="";return a<40?(h="Weak",m=c.palette.error.main):a<70?(h="Medium",m=c.palette.warning.main):(h="Strong",m=c.palette.success.main),{score:a,label:h,color:m}},[e.newPassword,c]),le=n.useCallback(()=>{Z(t=>!t)},[]),de=n.useCallback(()=>{Q(t=>!t)},[]),g=n.useCallback((t,a)=>{switch(t){case"firstName":if(!a.trim())return"First name is required";if(a.trim().length<2)return"First name must be at least 2 characters";if(a.trim().length>50)return"First name must not exceed 50 characters";break;case"lastName":if(!a.trim())return"Last name is required";if(a.trim().length<2)return"Last name must be at least 2 characters";if(a.trim().length>50)return"Last name must not exceed 50 characters";break;case"email":if(!a.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return"Invalid email address";break;case"phone":if(!a.trim())return"Phone number is required";if(!/^\d{11}$/.test(a.replace(/\D/g,"")))return"Phone number must be 11 digits";break;case"ward":if(a&&a.trim().length>20)return"Ward must not exceed 20 characters";break;case"zone":if(a&&a.trim().length>20)return"Zone must not exceed 20 characters";break;case"address":if(a&&a.trim().length>200)return"Address must not exceed 200 characters";break;case"newPassword":if(a&&a.length>0){if(a.length<8)return"Password must be at least 8 characters";if(a.length>100)return"Password must not exceed 100 characters"}break;case"confirmPassword":if(e.newPassword&&a!==e.newPassword)return"Passwords do not match";break}},[e.newPassword]),G=n.useCallback(()=>{const t={},a=g("firstName",e.firstName);a&&(t.firstName=a);const h=g("lastName",e.lastName);h&&(t.lastName=h);const m=g("email",e.email);m&&(t.email=m);const p=g("phone",e.phone);if(p&&(t.phone=p),e.ward){const d=g("ward",e.ward);d&&(t.ward=d)}if(e.zone){const d=g("zone",e.zone);d&&(t.zone=d)}if(e.address){const d=g("address",e.address);d&&(t.address=d)}return C(t),Object.keys(t).length===0},[e,g]),N=n.useCallback(t=>{const{name:a,value:h}=t.target;u(m=>({...m,[a]:h})),C(m=>{const p={...m};return delete p[a],p}),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{const m=g(a,h);m&&C(p=>({...p,[a]:m}))},300)},[g]),v=n.useCallback(t=>{const{name:a,value:h}=t.target,m=g(a,h);m&&C(p=>({...p,[a]:m}))},[g]),me=n.useCallback(async t=>{u(a=>({...a,avatar:t}))},[]),L=n.useMemo(()=>e.firstName!==r.firstName||e.lastName!==r.lastName||e.avatar!==r.avatar||e.ward!==w(r.ward)||e.zone!==w(r.zone)||e.address!==(r.address||"")||e.email!==r.email||e.phone!==r.phone||e.newPassword&&e.newPassword.length>0,[e,r,w]),ce=n.useCallback(async t=>{var a,h,m;if(t.preventDefault(),!G()){T("Please fix the validation errors"),I(!0);return}if(!L){T("No changes to save"),I(!0);return}x(!0),M();try{const p=e.newPassword&&e.newPassword.trim().length>0&&e.firstName===r.firstName&&e.lastName===r.lastName&&e.avatar===r.avatar&&e.ward===w(r.ward)&&e.zone===w(r.zone)&&e.address===(r.address||"")&&e.email===r.email&&e.phone===r.phone,d={};if(e.firstName!==r.firstName&&(d.firstName=e.firstName.trim()),e.lastName!==r.lastName&&(d.lastName=e.lastName.trim()),e.avatar!==r.avatar&&(d.avatar=e.avatar),e.ward!==w(r.ward)&&(d.ward=((a=e.ward)==null?void 0:a.trim())||void 0),e.zone!==w(r.zone)&&(d.zone=((h=e.zone)==null?void 0:h.trim())||void 0),e.address!==(r.address||"")&&(d.address=((m=e.address)==null?void 0:m.trim())||void 0),e.email!==r.email&&(d.email=e.email.trim()),e.phone!==r.phone&&(d.phone=e.phone.trim()),Object.keys(d).length>0&&await E(d),e.newPassword&&e.newPassword.trim().length>0){if(e.newPassword!==e.confirmPassword)throw new Error("Passwords do not match");await je.changePassword(r.id,e.newPassword),u(fe=>({...fe,newPassword:"",confirmPassword:""}))}F(!0)}catch(p){const d=p instanceof Error?p.message:"Failed to update profile";T(d),I(!0)}finally{x(!1)}},[e,r,G,L,E,M,w]),ue=n.useCallback(()=>{u({firstName:r.firstName||"",lastName:r.lastName||"",avatar:r.avatar,ward:w(r.ward),zone:w(r.zone),address:r.address||"",email:r.email||"",phone:r.phone||"",newPassword:"",confirmPassword:""}),C({}),Z(!1),Q(!1),M(),H()},[r,H,M,w]),J=n.useCallback(()=>{F(!1)},[]),K=n.useCallback(()=>{I(!1),T("")},[]);return n.useEffect(()=>()=>{W.current&&clearTimeout(W.current)},[]),s.jsxs(k,{component:"form",onSubmit:ce,role:"form","aria-label":"Profile edit form",sx:{animation:`${ke} 0.3s ease-in-out`},children:[s.jsxs(k,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:i&&b?2:3,px:2,background:`linear-gradient(135deg, ${c.palette.primary.main}15 0%, ${c.palette.primary.main}05 100%)`},children:[s.jsx(Ne,{currentAvatar:e.avatar,onUpload:me,size:i?b?80:100:P?110:120,initials:ie,disabled:l||f}),s.jsx(S,{variant:"caption",sx:{mt:i&&b?1:2,color:c.palette.text.secondary,textAlign:"center",px:2},children:i?"Tap to upload":"Click or drag to upload a new profile picture"})]}),s.jsx(V,{}),s.jsxs(k,{sx:{p:i?b?1.5:2:P?2.5:3},children:[s.jsxs(X,{elevation:0,sx:{p:i?b?1.5:2:P?2.5:3,backgroundColor:c.palette.background.default,borderRadius:2,animation:`${te} 0.4s ease-in-out`},children:[s.jsx(S,{variant:"subtitle2",sx:{fontWeight:600,mb:2,color:c.palette.text.primary},children:"Personal Information"}),s.jsx(y,{fullWidth:!0,label:"First Name",name:"firstName",value:e.firstName,onChange:N,onBlur:v,error:!!o.firstName,helperText:o.firstName,disabled:l||f,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{maxLength:50,"aria-label":"First name","aria-required":"true","aria-invalid":!!o.firstName,"aria-describedby":o.firstName?"firstName-error":void 0}},formHelperText:{id:"firstName-error",role:"alert"}}}),s.jsx(y,{fullWidth:!0,label:"Last Name",name:"lastName",value:e.lastName,onChange:N,onBlur:v,error:!!o.lastName,helperText:o.lastName,disabled:l||f,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{maxLength:50,"aria-label":"Last name","aria-required":"true","aria-invalid":!!o.lastName,"aria-describedby":o.lastName?"lastName-error":void 0}},formHelperText:{id:"lastName-error",role:"alert"}}}),s.jsx(y,{fullWidth:!0,label:"Email Address",name:"email",value:e.email,onChange:N,onBlur:v,error:!!o.email,helperText:o.email,disabled:l||f,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{"aria-label":"Email address","aria-invalid":!!o.email,"aria-describedby":o.email?"email-error":void 0}},formHelperText:{id:"email-error",role:"alert"}}}),s.jsx(y,{fullWidth:!0,label:"Phone Number",name:"phone",value:e.phone,onChange:N,onBlur:v,error:!!o.phone,helperText:o.phone,disabled:l||f,required:!0,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{"aria-label":"Phone number","aria-invalid":!!o.phone,"aria-describedby":o.phone?"phone-error":void 0}},formHelperText:{id:"phone-error",role:"alert"}}}),s.jsx(V,{sx:{my:2}}),s.jsx(S,{variant:"subtitle2",sx:{fontWeight:600,mb:2,color:c.palette.text.primary},children:"Location Information (Optional)"}),s.jsx(y,{fullWidth:!0,label:"Ward",name:"ward",value:e.ward,onChange:N,onBlur:v,error:!!o.ward,helperText:o.ward||(z?void 0:"Only Master Admin can edit Ward"),disabled:l||f||!z,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{maxLength:20,"aria-label":"Ward (optional)","aria-invalid":!!o.ward,"aria-describedby":o.ward?"ward-error":void 0}},formHelperText:{id:"ward-error",role:"alert"}}}),s.jsx(y,{fullWidth:!0,label:"Zone",name:"zone",value:e.zone,onChange:N,onBlur:v,error:!!o.zone,helperText:o.zone||(z?void 0:"Only Master Admin can edit Zone"),disabled:l||f||!z,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{inputProps:{maxLength:20,"aria-label":"Zone (optional)","aria-invalid":!!o.zone,"aria-describedby":o.zone?"zone-error":void 0}},formHelperText:{id:"zone-error",role:"alert"}}}),s.jsx(y,{fullWidth:!0,label:"Address",name:"address",value:e.address,onChange:N,onBlur:v,error:!!o.address,helperText:o.address,disabled:l||f,multiline:!0,rows:i&&b?2:3,slotProps:{input:{inputProps:{maxLength:200,"aria-label":"Address (optional)","aria-invalid":!!o.address,"aria-describedby":o.address?"address-error":void 0}},formHelperText:{id:"address-error",role:"alert"}}})]}),s.jsx(V,{sx:{my:3}}),s.jsxs(X,{elevation:0,sx:{p:i?b?1.5:2:P?2.5:3,backgroundColor:c.palette.background.default,borderRadius:2,animation:`${te} 0.5s ease-in-out`},children:[s.jsxs(k,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[s.jsx(pe,{sx:{color:c.palette.primary.main}}),s.jsx(S,{variant:"subtitle2",sx:{fontWeight:600,color:c.palette.text.primary},children:"Change Password (Optional)"})]}),s.jsx(S,{variant:"caption",sx:{display:"block",mb:2,color:c.palette.text.secondary},children:"Leave blank if you don't want to change your password"}),s.jsx(y,{fullWidth:!0,label:"New Password",name:"newPassword",type:O?"text":"password",value:e.newPassword||"",onChange:N,onBlur:v,error:!!o.newPassword,helperText:o.newPassword||"Minimum 8 characters",disabled:l||f,sx:{mb:2,"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{endAdornment:s.jsx(Y,{position:"end",children:s.jsx(D,{onClick:le,edge:"end","aria-label":O?"Hide password":"Show password",disabled:l||f,children:O?s.jsx(ee,{}):s.jsx(re,{})})}),inputProps:{maxLength:100,"aria-label":"New password","aria-invalid":!!o.newPassword,"aria-describedby":o.newPassword?"newPassword-error":void 0}},formHelperText:{id:"newPassword-error",role:"alert"}}}),e.newPassword&&e.newPassword.length>0&&s.jsxs(k,{sx:{mb:2},children:[s.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[s.jsx(S,{variant:"caption",sx:{color:c.palette.text.secondary},children:"Password Strength:"}),s.jsx(S,{variant:"caption",sx:{fontWeight:600,color:B.color},children:B.label})]}),s.jsx(we,{variant:"determinate",value:B.score,sx:{height:6,borderRadius:3,backgroundColor:c.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:B.color,borderRadius:3}}})]}),s.jsx(y,{fullWidth:!0,label:"Confirm New Password",name:"confirmPassword",type:R?"text":"password",value:e.confirmPassword||"",onChange:N,onBlur:v,error:!!o.confirmPassword,helperText:o.confirmPassword,disabled:l||f||!e.newPassword,sx:{"& .MuiInputBase-root":{minHeight:i?48:40}},slotProps:{input:{endAdornment:s.jsx(Y,{position:"end",children:s.jsx(D,{onClick:de,edge:"end","aria-label":R?"Hide password":"Show password",disabled:l||f||!e.newPassword,children:R?s.jsx(ee,{}):s.jsx(re,{})})}),inputProps:{maxLength:100,"aria-label":"Confirm new password","aria-invalid":!!o.confirmPassword,"aria-describedby":o.confirmPassword?"confirmPassword-error":void 0}},formHelperText:{id:"confirmPassword-error",role:"alert"}}})]}),_&&s.jsx($,{severity:"error",sx:{mt:2},onClose:M,children:_}),s.jsxs(k,{sx:{display:"flex",gap:2,mt:i&&b?2:3,flexDirection:i||P&&!b?"column":"row",justifyContent:"flex-end"},children:[s.jsx(se,{variant:"outlined",startIcon:s.jsx(be,{}),onClick:ue,disabled:l||f,fullWidth:i||P&&!b,"aria-label":"Cancel profile editing",sx:{borderRadius:2,textTransform:"none",fontWeight:600,minWidth:i?"auto":120,minHeight:i?44:36},children:"Cancel"}),s.jsx(se,{type:"submit",variant:"contained",startIcon:l||f?s.jsx(xe,{size:16,color:"inherit"}):s.jsx(ge,{}),disabled:l||f||!L,fullWidth:i||P&&!b,"aria-label":l||f?"Saving profile changes":"Save profile changes","aria-busy":l||f,"aria-disabled":!L,sx:{borderRadius:2,textTransform:"none",fontWeight:600,minWidth:i?"auto":120,minHeight:i?44:36},children:l||f?"Saving...":"Save Changes"})]})]}),s.jsx(ae,{open:U,autoHideDuration:4e3,onClose:J,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx($,{onClose:J,severity:"success",icon:s.jsx(Pe,{}),sx:{width:"100%"},children:"Profile updated successfully!"})}),s.jsx(ae,{open:oe,autoHideDuration:6e3,onClose:K,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx($,{onClose:K,severity:"error",sx:{width:"100%"},children:ne||"Failed to update profile"})})]})};export{Ae as default};
