var Wt=Object.defineProperty;var Lt=(o,t,s)=>t in o?Wt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var me=(o,t,s)=>Lt(o,typeof t!="symbol"?t+"":t,s);import{u as Pe,o as le,j as e,s as Et,t as kt,T as u,i as B,v as be,w as Nt,az as ce,_ as dt,av as ut,$ as ht,a1 as _e,B as l,bp as xt,g as Ft,b as q,x as Rt,G as Le,p as fe,M as mt,bq as Bt,br as Ht,bs as _t,bt as Vt,bu as Gt,bv as Jt,bw as Zt,C as Te,A as gt,aE as Kt,D as se,K as Ve,b0 as pt,J as Ot,h as zt,a_ as qt,bx as Xt,aY as Yt,aU as ft,aV as yt,by as Qt,bz as es,bA as ts,bB as ss,bC as rs,bD as as,an as os,aP as bt,y as Ct,aR as ns,bE as is,bF as cs,b1 as ls,bG as ds,bH as us,H as hs,aH as xs,aI as ms,aO as gs,l as ps,bI as fs,aN as ys,bJ as bs,bK as Cs,bL as js,aZ as jt}from"./mui-vendor-DhgYLev2.js";import{r as h,a as ws}from"./react-vendor-D7yrL1sD.js";import{A as ee,v as vs,h as Fe,f as At,a as J,s as Dt,b as Ss,j as Is,w as wt,z as Z,t as ge}from"./index-pueUXdzt.js";import{a as te}from"./query-vendor-dIV3S2E5.js";import{a as Es,E as ks,M as Ns}from"./ErrorDisplay-dEZLAl9O.js";class Rs{constructor(){me(this,"apiClient");this.apiClient=te.create({baseURL:ee.BASE_URL,timeout:ee.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const s=localStorage.getItem("accessToken");s&&(t.headers.Authorization=`Bearer ${s}`)}catch(s){console.error("Error getting token:",s)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var s;return((s=t.response)==null?void 0:s.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(this.handleError(t))})}handleError(t){var s,r,n,c,i;if(te.isAxiosError(t)){const g=((s=t.response)==null?void 0:s.status)||500,p=((n=(r=t.response)==null?void 0:r.data)==null?void 0:n.message)||"An error occurred",d=(i=(c=t.response)==null?void 0:c.data)==null?void 0:i.errors;return{name:"ApiError",statusCode:g,message:p,errors:d}}return{name:"ApiError",statusCode:500,message:t.message||"An unexpected error occurred"}}isCloudinaryUrl(t){return!!t&&t.includes("res.cloudinary.com")&&t.includes("/upload/")}fixLocalMediaUrl(t){if(!t||this.isCloudinaryUrl(t)||t.startsWith(ee.BASE_URL))return t;const s=/^https?:\/\/[^\/]+/;return s.test(t)?t.replace(s,ee.BASE_URL):t.startsWith("/")?`${ee.BASE_URL}${t}`:`${ee.BASE_URL}/${t}`}getCloudinaryThumbnail(t,s=200,r=200){return t&&(this.isCloudinaryUrl(t)?t.replace("/upload/",`/upload/w_${s},h_${r},c_fill,q_auto,f_auto/`):t)}getOptimizedCloudinaryUrl(t){return t&&(this.isCloudinaryUrl(t)?t.replace("/upload/","/upload/q_auto,f_auto/"):t)}parseMediaUrls(t){let s=[],r=[];try{if(t.imageUrl){let n;const c=t.imageUrl;if(typeof c=="string"&&c.trim().startsWith("["))try{n=JSON.parse(c)}catch{n=[c]}else Array.isArray(c)?n=c:n=[c];Array.isArray(n)&&(s=n.map(i=>this.fixLocalMediaUrl(i)))}}catch(n){console.error("Error processing imageUrl:",n)}try{if(t.audioUrl){let n;const c=t.audioUrl;if(typeof c=="string"&&c.trim().startsWith("["))try{n=JSON.parse(c)}catch{n=[c]}else Array.isArray(c)?n=c:n=[c];Array.isArray(n)&&(r=n.map(i=>this.fixLocalMediaUrl(i)))}}catch(n){console.error("Error processing audioUrl:",n)}return{...t,imageUrls:s,audioUrls:r}}async getComplaints(t=1,s=20,r){try{const n={page:t,limit:s};r&&(r.search&&(n.search=r.search),r.status&&r.status!=="ALL"&&(n.status=r.status),r.category==="uncategorized"?n.category="null":r.category&&(n.category=r.category),r.subcategory&&(n.subcategory=r.subcategory),r.complaintCityCorporationCode&&(n.complaintCityCorporationCode=r.complaintCityCorporationCode),r.complaintZoneId&&(n.complaintZoneId=r.complaintZoneId),r.complaintWardId&&(n.complaintWardId=r.complaintWardId),r.cityCorporationCode&&(n.cityCorporationCode=r.cityCorporationCode),r.zoneId&&(n.zoneId=r.zoneId),r.wardId&&(n.wardId=r.wardId),r.ward&&(n.ward=r.ward),r.thanaId&&(n.thanaId=r.thanaId),r.startDate&&(n.startDate=r.startDate),r.endDate&&(n.endDate=r.endDate),r.sortBy&&(n.sortBy=r.sortBy),r.sortOrder&&(n.sortOrder=r.sortOrder));const c=await this.apiClient.get("/api/admin/complaints",{params:n});if(!c.data||!c.data.data)throw console.error("Invalid response structure:",c.data),new Error("Invalid response structure from server");const i=c.data.data;if(!Array.isArray(i.complaints))throw console.error("Complaints is not an array:",i),new Error("Invalid complaints data from server");const g=i.complaints.map(p=>this.parseMediaUrls(p));return{...i,complaints:g}}catch(n){throw console.error("Error in getComplaints:",n),n}}async getComplaintById(t){try{const s=await this.apiClient.get(`/api/admin/complaints/${t}`);return this.parseMediaUrls(s.data.data.complaint)}catch(s){throw s}}async updateComplaintStatus(t,s){try{if(s.resolutionImageFiles&&s.resolutionImageFiles.length>0){const r=new FormData;r.append("status",s.status),s.note&&r.append("note",s.note),s.resolutionImages&&r.append("resolutionImages",s.resolutionImages),s.resolutionNote&&r.append("resolutionNote",s.resolutionNote),s.category&&r.append("category",s.category),s.subcategory&&r.append("subcategory",s.subcategory),s.resolutionImageFiles.forEach(c=>{r.append("resolutionImages",c)});const n=await this.apiClient.patch(`/api/admin/complaints/${t}/status`,r,{headers:{"Content-Type":"multipart/form-data"}});return this.parseMediaUrls(n.data.data.complaint)}else{const r=await this.apiClient.patch(`/api/admin/complaints/${t}/status`,s);return this.parseMediaUrls(r.data.data.complaint)}}catch(r){throw r}}async markComplaintAsOthers(t,s){try{const r=new FormData;r.append("othersCategory",s.othersCategory),r.append("othersSubcategory",s.othersSubcategory),s.note&&r.append("note",s.note),s.images&&s.images.length>0&&s.images.forEach(i=>{r.append("images",i)});const n=await this.apiClient.patch(`/api/admin/complaints/${t}/mark-others`,r,{headers:{"Content-Type":"multipart/form-data"}});return this.parseMediaUrls(n.data.data.complaint)}catch(r){throw r}}async updateComplaintStatusWithResolution(t,s,r,n){try{const c=new FormData;c.append("status",s),r&&c.append("resolutionNote",r),n&&n.length>0&&n.forEach(p=>{c.append("resolutionImages",p)});const i=await this.apiClient.patch(`/api/admin/complaints/${t}/status`,c,{headers:{"Content-Type":"multipart/form-data"}});return this.parseMediaUrls(i.data.data.complaint)}catch(c){throw c}}async searchComplaints(t,s=1,r=20){try{return await this.getComplaints(s,r,{search:t})}catch(n){throw n}}async getComplaintsByUser(t,s=1,r=20){try{const n=await this.apiClient.get(`/api/admin/users/${t}/complaints`,{params:{page:s,limit:r}}),c=n.data.data.complaints.map(i=>this.parseMediaUrls(i));return{...n.data.data,complaints:c}}catch(n){throw n}}getThumbnailUrl(t,s=200,r=200){return this.getCloudinaryThumbnail(t,s,r)}getOptimizedUrl(t){return this.getOptimizedCloudinaryUrl(t)}async uploadImage(t){try{const s=new FormData;s.append("images",t);const r=await this.apiClient.post("/api/uploads",s,{headers:{"Content-Type":"multipart/form-data"}});if(r.data.success&&r.data.data.fileUrls.length>0)return r.data.data.fileUrls[0];throw new Error("Failed to upload image")}catch(s){throw console.error("Error uploading image:",s),s}}async getOthersAnalytics(t={}){try{const s={};return t.cityCorporationCode&&(s.cityCorporationCode=t.cityCorporationCode),t.zoneId!==void 0&&(s.zoneId=t.zoneId),t.startDate&&(s.startDate=t.startDate),t.endDate&&(s.endDate=t.endDate),(await this.apiClient.get("/api/admin/complaints/analytics/others",{params:s})).data.data}catch(s){throw console.error("Error fetching Others analytics:",s),s}}async updateComplaintAudioUrls(t,s){try{const r=await this.apiClient.patch(`/api/admin/complaints/${t}/audio-urls`,{audioUrls:s});return this.parseMediaUrls(r.data.data.complaint)}catch(r){throw r}}}const Me=new Rs,Be={CORPORATION_INTERNAL:{label:"Corporation Internal",description:"Issues within city corporation jurisdiction handled by specific departments"},CORPORATION_EXTERNAL:{label:"Corporation External",description:"Issues outside city corporation jurisdiction handled by external agencies"}},Os={CORPORATION_INTERNAL:["Engineering","Electricity","Health","Property (Eviction)"],CORPORATION_EXTERNAL:["WASA","Titas","DPDC","DESCO","BTCL","Fire Service","Others"]},zs=({open:o,onClose:t,onConfirm:s,loading:r=!1})=>{const n=Pe(),c=le(n.breakpoints.down("sm")),[i,g]=h.useState(""),[p,d]=h.useState(""),[a,b]=h.useState(""),[f,S]=h.useState([]),[C,w]=h.useState({category:!1,subCategory:!1,note:!1}),v=y=>{g(y),d(""),w({...C,category:!0,subCategory:!1})},E=y=>{if(y.target.files){const k=Array.from(y.target.files),P=[...f,...k].slice(0,5);S(P)}},M=y=>{S(f.filter((k,P)=>P!==y))},T=()=>{if(!i){w({...C,category:!0});return}if(!p){w({...C,subCategory:!0});return}if(!a||a.length<20){w({...C,note:!0});return}s(i,p,a,f)},O=()=>{r||(g(""),d(""),b(""),S([]),w({category:!1,subCategory:!1,note:!1}),t())},D=i?Os[i]||[]:[];return e.jsxs(Et,{open:o,onClose:O,maxWidth:"sm",fullWidth:!0,fullScreen:c,PaperProps:{sx:{borderRadius:c?0:2}},children:[e.jsxs(kt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:600},children:"Mark as Others"}),e.jsx(B,{onClick:O,disabled:r,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(be,{})})]}),e.jsx(Nt,{sx:{pt:3,pb:2},children:e.jsxs(ce,{container:!0,spacing:3,children:[e.jsx(ce,{size:12,children:e.jsxs(dt,{fullWidth:!0,error:C.category&&!i,required:!0,children:[e.jsx(ut,{children:"Select Category"}),e.jsx(ht,{value:i,label:"Select Category",onChange:y=>v(y.target.value),disabled:r,children:Object.keys(Be).map(y=>e.jsx(_e,{value:y,children:e.jsxs(l,{children:[e.jsx(u,{variant:"body1",children:Be[y].label}),e.jsx(u,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:Be[y].description})]})},y))}),C.category&&!i&&e.jsx(xt,{children:"Please select a category"})]})}),i&&D.length>0&&e.jsx(ce,{size:12,children:e.jsxs(dt,{fullWidth:!0,error:C.subCategory&&!p,required:!0,children:[e.jsx(ut,{children:"Select Department/Agency"}),e.jsx(ht,{value:p,label:"Select Department/Agency",onChange:y=>{d(y.target.value),w({...C,subCategory:!0})},disabled:r,children:D.map(y=>e.jsx(_e,{value:y,children:y},y))}),C.subCategory&&!p&&e.jsx(xt,{children:"Please select a department/agency"})]})}),e.jsx(ce,{size:12,children:e.jsx(Ft,{fullWidth:!0,label:"Note (Required)",required:!0,multiline:!0,rows:3,value:a,onChange:y=>{b(y.target.value),y.target.value.length>=20&&w({...C,note:!1})},onBlur:()=>w({...C,note:!0}),disabled:r,placeholder:"Add reason for marking as Others (min 20 characters)...",helperText:C.note&&(!a||a.length<20)?`Minimum 20 characters required (${a.length}/20)`:`${a.length}/500 characters`,error:C.note&&(!a||a.length<20),inputProps:{maxLength:500}})}),e.jsxs(ce,{size:12,children:[e.jsxs(l,{sx:{mb:1},children:[e.jsx(u,{variant:"subtitle2",sx:{mb:.5},children:"Attach Images (Optional)"}),e.jsx(u,{variant:"caption",color:"text.secondary",children:"Max 5 images. Supported formats: JPEG, PNG, WebP."})]}),e.jsx("input",{accept:"image/jpeg,image/png,image/webp",style:{display:"none"},id:"mark-others-image-upload",multiple:!0,type:"file",onChange:E,disabled:r||f.length>=5}),e.jsx("label",{htmlFor:"mark-others-image-upload",children:e.jsx(q,{variant:"outlined",component:"span",disabled:r||f.length>=5,sx:{mb:2},children:"Upload Images"})}),f.length>0&&e.jsx(l,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:f.map((y,k)=>e.jsxs(l,{sx:{position:"relative",width:80,height:80,border:"1px solid #e0e0e0",borderRadius:1,overflow:"hidden"},children:[e.jsx("img",{src:URL.createObjectURL(y),alt:`Preview ${k}`,style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx(B,{size:"small",onClick:()=>M(k),sx:{position:"absolute",top:2,right:2,bgcolor:"rgba(255,255,255,0.8)",p:.5,"&:hover":{bgcolor:"white"}},children:e.jsx(be,{sx:{fontSize:16}})})]},k))})]}),i&&e.jsx(ce,{size:12,children:e.jsx(l,{sx:{p:2,bgcolor:"info.lighter",borderRadius:1,border:"1px solid",borderColor:"info.light"},children:e.jsxs(u,{variant:"body2",color:"info.dark",children:[e.jsx("strong",{children:"Note:"}),' This complaint will be marked as "Others" and categorized under'," ",e.jsx("strong",{children:i==="CORPORATION_INTERNAL"?"Corporation Internal":"Corporation External"}),p&&e.jsxs(e.Fragment,{children:[" - ",e.jsx("strong",{children:p})]}),". The user will be notified of this status change."]})})})]})}),e.jsxs(Rt,{sx:{borderTop:"1px solid #e0e0e0",px:3,py:2,gap:1.5,flexDirection:{xs:"column-reverse",sm:"row"},"& > button":{width:{xs:"100%",sm:"auto"},minHeight:{xs:48,sm:36}}},children:[e.jsx(q,{onClick:O,disabled:r,color:"inherit",variant:"outlined",children:"Cancel"}),e.jsx(q,{onClick:T,variant:"contained",color:"primary",disabled:r||!i||!p||!a||a.length<20,children:r?"Marking...":"Mark as Others"})]})]})};class As{constructor(){me(this,"apiClient");me(this,"cache");me(this,"CACHE_DURATION",30*60*1e3);this.apiClient=te.create({baseURL:ee.BASE_URL,timeout:ee.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.cache=new Map,this.setupInterceptors()}setupInterceptors(){this.apiClient.interceptors.request.use(t=>{try{const s=localStorage.getItem("accessToken");s&&(t.headers.Authorization=`Bearer ${s}`)}catch(s){console.error("Error getting token:",s)}return t},t=>Promise.reject(t)),this.apiClient.interceptors.response.use(t=>t,t=>{var s;return((s=t.response)==null?void 0:s.status)===401&&window.location.pathname!=="/login"&&window.location.assign("/login"),Promise.reject(t)})}getCacheKey(t,s){const r=s?JSON.stringify(s):"";return`${t}:${r}`}getCachedData(t){const s=this.cache.get(t);if(s){if(Date.now()-s.timestamp<this.CACHE_DURATION)return s.data;this.cache.delete(t)}return null}setCachedData(t,s){this.cache.set(t,{data:s,timestamp:Date.now()})}clearCache(){this.cache.clear()}async getAllCategories(){var t,s;try{const r=this.getCacheKey("categories"),n=this.getCachedData(r);if(n)return n;const i=(await this.apiClient.get("/api/categories")).data.data.categories;return this.setCachedData(r,i),i}catch(r){throw te.isAxiosError(r)?new Error(((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to fetch categories"):r}}async getCategoryById(t){var s,r;try{const n=this.getCacheKey(`category-${t}`),c=this.getCachedData(n);if(c)return c;const g=(await this.apiClient.get(`/api/categories/${t}`)).data.data.category;return this.setCachedData(n,g),g}catch(n){throw te.isAxiosError(n)?new Error(((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch category"):n}}async getSubcategories(t){var s,r;try{const n=this.getCacheKey(`subcategories-${t}`),c=this.getCachedData(n);if(c)return c;const g=(await this.apiClient.get(`/api/categories/${t}/subcategories`)).data.data.subcategories;return this.setCachedData(n,g),g}catch(n){throw te.isAxiosError(n)?new Error(((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch subcategories"):n}}async getCategoryStatistics(t){var s,r;try{const n=this.getCacheKey("category-statistics",t),c=this.cache.get(n);if(c&&Date.now()-c.timestamp<5*60*1e3)return c.data;const g=(await this.apiClient.get("/api/admin/analytics/categories",{params:t})).data.data;return this.setCachedData(n,g),g}catch(n){throw te.isAxiosError(n)?new Error(((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch category statistics"):n}}async getCategoryTrends(t){var s,r;try{const n=this.getCacheKey("category-trends",t),c=this.cache.get(n);if(c&&Date.now()-c.timestamp<5*60*1e3)return c.data;const g=(await this.apiClient.get("/api/admin/analytics/categories/trends",{params:t})).data.data;return this.setCachedData(n,g),g}catch(n){throw te.isAxiosError(n)?new Error(((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch category trends"):n}}async getCategoryName(t,s="en"){if(t==="CORPORATION_INTERNAL")return s==="bn"?"à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨ (à¦…à¦­à§à¦¯à¦¨à§à¦¤à¦°à§€à¦£)":"Corporation (Internal)";if(t==="CORPORATION_EXTERNAL")return s==="bn"?"à¦•à¦°à§à¦ªà§‹à¦°à§‡à¦¶à¦¨ (à¦¬à¦¾à¦¹à§à¦¯à¦¿à¦•)":"Corporation (External)";const n=(await this.getAllCategories()).find(c=>c.id===t);return n?s==="bn"?n.bangla:n.english:"Unknown Category"}async getSubcategoryName(t,s,r="en"){if(t==="CORPORATION_INTERNAL"||t==="CORPORATION_EXTERNAL")return s.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase());const c=(await this.getCategoryById(t)).subcategories.find(i=>i.id===s);return c?r==="bn"?c.bangla:c.english:"Unknown Subcategory"}async getCategoryColor(t){if(t==="CORPORATION_INTERNAL")return"#9333ea";if(t==="CORPORATION_EXTERNAL")return"#ea580c";const r=(await this.getAllCategories()).find(n=>n.id===t);return(r==null?void 0:r.color)||"#808080"}async categoryExists(t){try{return await this.getCategoryById(t),!0}catch{return!1}}async subcategoryExists(t,s){try{return(await this.getSubcategories(t)).some(n=>n.id===s)}catch{return!1}}}const pe=new As,Ds=({categoryId:o,subcategoryId:t})=>{const[s,r]=h.useState(""),[n,c]=h.useState(""),[i,g]=h.useState(""),[p,d]=h.useState(""),[a,b]=h.useState("#808080"),[f,S]=h.useState(!0);h.useEffect(()=>{o&&t&&(async()=>{try{S(!0);const[v,E,M,T,O]=await Promise.all([pe.getCategoryName(o,"en"),pe.getCategoryName(o,"bn"),pe.getSubcategoryName(o,t,"en"),pe.getSubcategoryName(o,t,"bn"),pe.getCategoryColor(o)]);r(v),c(E),g(M),d(T),b(O)}catch(v){console.error("Error fetching category info:",v),r("Unknown Category"),c("à¦…à¦œà¦¾à¦¨à¦¾ à¦¬à¦¿à¦­à¦¾à¦—"),g("Unknown Subcategory"),d("à¦…à¦œà¦¾à¦¨à¦¾ à¦‰à¦ªà¦¬à¦¿à¦­à¦¾à¦—")}finally{S(!1)}})()},[o,t]);const C=()=>{const w={sx:{fontSize:40,color:a}};switch(o){case"home":return e.jsx(Zt,{...w});case"road_environment":return e.jsx(Jt,{...w});case"business":return e.jsx(mt,{...w});case"office":return e.jsx(Gt,{...w});case"education":return e.jsx(Vt,{...w});case"hospital":return e.jsx(_t,{...w});case"religious":return e.jsx(Ht,{...w});case"events":return e.jsx(Bt,{...w});default:return e.jsx(mt,{...w})}};return f?e.jsxs(l,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(Le,{variant:"circular",width:40,height:40}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(Le,{variant:"text",width:"60%",height:24}),e.jsx(Le,{variant:"text",width:"80%",height:20})]})]}):e.jsxs(l,{sx:{display:"flex",gap:2,alignItems:"flex-start",p:2,backgroundColor:"#f8f9fa",borderRadius:2,border:`2px solid ${a}`},children:[e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:60,height:60,borderRadius:2,backgroundColor:`${a}15`},children:C()}),e.jsxs(l,{sx:{flex:1},children:[e.jsxs(l,{sx:{mb:1},children:[e.jsx(u,{variant:"body1",sx:{fontWeight:600,color:a,mb:.5},children:s}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary",fontStyle:"italic"},children:n})]}),e.jsxs(l,{children:[e.jsx(u,{variant:"body2",sx:{fontWeight:500,mb:.5},children:i}),e.jsx(u,{variant:"caption",sx:{color:"text.secondary",fontStyle:"italic"},children:p})]})]}),e.jsx(fe,{label:s,size:"small",sx:{backgroundColor:a,color:"#fff",fontWeight:500,fontSize:"0.75rem",height:24,boxShadow:"0 1px 3px rgba(0,0,0,0.12)"}})]})},Ts=({complaintId:o,open:t,onClose:s,onStatusUpdate:r,onChatOpen:n})=>{var Ke,qe,Xe,Ye,Qe,et,tt,st,rt,at,ot,nt,it;const c=Pe(),i=le(c.breakpoints.down("sm")),g=le(c.breakpoints.down("md")),{canEditComplaints:p,canViewComplaints:d}=vs(),[a,b]=h.useState(null),[f,S]=h.useState(null),[C,w]=h.useState(!1),[v,E]=h.useState(null),[M,T]=h.useState(!1),[O,D]=h.useState(0),[y,k]=h.useState(1),[P,_]=h.useState(new Set),[I,F]=h.useState({}),[X,A]=h.useState({}),[z,G]=h.useState({}),[Y,Ue]=h.useState({}),K=ws.useRef({}),[re,ae]=h.useState(!1),[$e,oe]=h.useState(!1);h.useEffect(()=>{t&&o&&de()},[t,o]),h.useEffect(()=>{(async()=>{var $,W,V,Ae,ct;if(!a)return;let m=null,j=a.locationDetails;if(typeof j=="string")try{j=JSON.parse(j)}catch(L){console.error("Error parsing locationDetails JSON:",L)}if(j!=null&&j.ward){const xe=String(j.ward).match(/\d+/);xe&&(m=parseInt(xe[0]))}if(!m&&a.location){const L=a.location.match(/Ward\s*(\d+)/i);L&&(m=parseInt(L[1]))}if(!m&&typeof(($=a.user)==null?void 0:$.ward)=="object"&&a.user.ward.wardNumber&&(m=a.user.ward.wardNumber),!!m)try{let L=(W=a.cityCorporation)==null?void 0:W.code;if(!L&&a.location&&(a.location.toLowerCase().includes("south")||a.location.includes("à¦¦à¦•à§à¦·à¦¿à¦£")?L="DSCC":(a.location.toLowerCase().includes("north")||a.location.includes("à¦‰à¦¤à§à¦¤à¦°"))&&(L="DNCC")),!L){const ie=(V=a.user)==null?void 0:V.cityCorporation;typeof ie=="string"?ie.includes("South")?L="DSCC":ie.includes("North")&&(L="DNCC"):(ct=(Ae=a.user)==null?void 0:Ae.cityCorporation)!=null&&ct.code&&(L=a.user.cityCorporation.code)}L||(L="DNCC");const xe=await wt.getWards({cityCorporationCode:L});if(xe.wards){const ie=xe.wards.find(De=>De.wardNumber===m);if(ie)S(ie);else{const De=await wt.getWards({status:"ACTIVE"});if(De.wards){const lt=De.wards.find($t=>$t.wardNumber===m);lt&&S(lt)}}}}catch(L){console.error("Error fetching correct ward data:",L)}})()},[a]);const de=async()=>{if(o)try{w(!0),E(null);const x=await Me.getComplaintById(o);console.log("ðŸ“‹ Complaint data received:",{id:x.id,resolutionImages:x.resolutionImages,resolutionNote:x.resolutionNote,status:x.status}),b(x)}catch(x){const m=Fe(x);E(m.userMessage)}finally{w(!1)}},ne=()=>{b(null),E(null),s()},je=x=>{switch(x){case"PENDING":return{backgroundColor:"#fff3cd",color:"#856404",borderColor:"#ffeeba"};case"IN_PROGRESS":return{backgroundColor:"#d1ecf1",color:"#0c5460",borderColor:"#bee5eb"};case"RESOLVED":return{backgroundColor:"#d4edda",color:"#155724",borderColor:"#c3e6cb"};case"REJECTED":return{backgroundColor:"#f8d7da",color:"#721c24",borderColor:"#f5c6cb"};default:return{backgroundColor:"#f8f9fa",color:"#6c757d"}}},we=x=>{switch(x){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Solved";case"REJECTED":return"Rejected";default:return x}},ue=x=>new Date(x).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),ve=x=>{D(x),k(1),T(!0)},he=()=>{T(!1),k(1)},Se=()=>{a&&a.imageUrls.length>0&&(D(x=>x===0?a.imageUrls.length-1:x-1),k(1))},Ie=()=>{a&&a.imageUrls.length>0&&(D(x=>x===a.imageUrls.length-1?0:x+1),k(1))},Ee=()=>{k(x=>Math.min(x+.25,3))},ke=()=>{k(x=>Math.max(x-.25,.5))},Ne=()=>{if(a&&a.imageUrls[O]){const x=document.createElement("a");x.href=a.imageUrls[O],x.download=`complaint-${a.id}-image-${O+1}.jpg`,document.body.appendChild(x),x.click(),document.body.removeChild(x)}},Re=x=>{_(m=>new Set(m).add(x))},N=x=>{const m=K.current[x];m&&(I[x]?(m.pause(),F(j=>({...j,[x]:!1}))):(m.play(),F(j=>({...j,[x]:!0}))))},U=x=>{const m=K.current[x];if(!m)return;const j=m.currentTime/m.duration*100;A($=>({...$,[x]:j}))},R=x=>{F(m=>({...m,[x]:!1})),A(m=>({...m,[x]:0}))},H=(x,m)=>{const j=K.current[x];j&&(j.volume=m,G($=>({...$,[x]:m})))},Oe=x=>{const m=K.current[x];if(!m)return;const j=[.5,1,1.5,2],$=Y[x]||1,W=j.indexOf($),V=j[(W+1)%j.length];m.playbackRate=V,Ue(Ae=>({...Ae,[x]:V}))},ze=(x,m)=>{const j=K.current[x];if(!j)return;const $=m.currentTarget.getBoundingClientRect(),V=(m.clientX-$.left)/$.width;j.currentTime=V*j.duration},We=(x,m)=>{const j=document.createElement("a");j.href=x,j.download=`complaint-${a==null?void 0:a.id}-audio-${m+1}.mp3`,document.body.appendChild(j),j.click(),document.body.removeChild(j)},Je=x=>{if(isNaN(x))return"0:00";const m=Math.floor(x/60),j=Math.floor(x%60);return`${m}:${j.toString().padStart(2,"0")}`},Pt=async x=>{if(!(!a||!o)){if(x==="REJECTED"){oe(!0);return}try{ae(!0),r(o,x),b(m=>m?{...m,status:x}:null),Z.success("Status updated successfully",{icon:"âœ…",duration:3e3})}catch(m){const j=Fe(m);Z.error(j.userMessage,{duration:5e3,icon:"âŒ"})}finally{ae(!1)}}},Ut=async(x,m,j,$)=>{if(!(!a||!o))try{ae(!0),await Me.markComplaintAsOthers(o,{othersCategory:x,othersSubcategory:m,note:j,images:$}),r(o,"REJECTED"),Z.success("Complaint marked as Others successfully",{icon:"âœ…",duration:3e3}),oe(!1),de()}catch(W){const V=Fe(W);Z.error(V.userMessage,{duration:5e3,icon:"âŒ"})}finally{ae(!1)}},Ze=x=>({PENDING:[{status:"IN_PROGRESS",label:"Mark In Progress",color:"#0c5460"},{status:"RESOLVED",label:"Mark Solved",color:"#155724"},{status:"REJECTED",label:"Mark Rejected",color:"#721c24"}],IN_PROGRESS:[{status:"PENDING",label:"Mark Pending",color:"#856404"},{status:"RESOLVED",label:"Mark Solved",color:"#155724"},{status:"REJECTED",label:"Mark Rejected",color:"#721c24"}],RESOLVED:[{status:"PENDING",label:"Mark Pending",color:"#856404"},{status:"IN_PROGRESS",label:"Mark In Progress",color:"#0c5460"},{status:"REJECTED",label:"Mark Rejected",color:"#721c24"}],REJECTED:[{status:"PENDING",label:"Mark Pending",color:"#856404"},{status:"IN_PROGRESS",label:"Mark In Progress",color:"#0c5460"},{status:"RESOLVED",label:"Mark Solved",color:"#155724"}],OTHERS:[{status:"PENDING",label:"Mark Pending",color:"#856404"},{status:"IN_PROGRESS",label:"Mark In Progress",color:"#0c5460"},{status:"RESOLVED",label:"Mark Solved",color:"#155724"},{status:"REJECTED",label:"Mark Rejected",color:"#721c24"}]})[x]||[];return e.jsxs(e.Fragment,{children:[e.jsxs(Et,{open:t,onClose:ne,maxWidth:"md",fullWidth:!0,fullScreen:i,slotProps:{paper:{sx:{borderRadius:i?0:2,maxHeight:i?"100vh":"90vh",animation:i?`${Dt} ${J.normal.duration} ${J.smooth.timing}`:`${Ss} ${J.normal.duration} ${J.smooth.timing}`,animationFillMode:"both"}},backdrop:{sx:{animation:`${At} ${J.fast.duration} ${J.fast.timing}`}}},children:[e.jsxs(kt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(u,{component:"span",variant:"h6",sx:{fontWeight:600},children:"Complaint Details"}),e.jsx(B,{onClick:ne,size:"small",sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(be,{})})]}),e.jsxs(Nt,{sx:{pt:{xs:2,sm:3},pb:{xs:1.5,sm:2}},children:[C&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:{xs:200,sm:300}},children:e.jsx(Te,{})}),v&&!C&&e.jsx(gt,{severity:"error",sx:{mb:2},children:v}),a&&!C&&!v&&e.jsxs(l,{children:[e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:{xs:2,sm:3},gap:{xs:1,sm:2}},children:[e.jsx(u,{variant:i?"h6":"h5",sx:{fontWeight:600,color:"#4CAF50"},children:a.trackingNumber||`C${String(a.id).padStart(6,"0")}`}),e.jsx(fe,{label:we(a.status),sx:{...je(a.status),...Is,fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.875rem"},height:{xs:28,sm:32}}})]}),e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(u,{variant:i?"caption":"subtitle2",color:"text.secondary",sx:{mb:.5},children:"Complaint Title"}),e.jsx(u,{variant:i?"body2":"body1",sx:{fontWeight:500},children:a.title})]}),e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(u,{variant:i?"caption":"subtitle2",color:"text.secondary",sx:{mb:1},children:"Category"}),a.category&&a.subcategory?e.jsx(Ds,{categoryId:a.category,subcategoryId:a.subcategory}):e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,p:1.5,backgroundColor:"#f5f5f5",border:"1px dashed #bdbdbd",borderRadius:1},children:[e.jsx(Kt,{sx:{color:"#757575",fontSize:20}}),e.jsx(u,{variant:"body2",sx:{color:"#757575",fontStyle:"italic"},children:"This complaint has not been categorized yet. It was created before the category system was implemented."})]})]}),e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(u,{variant:i?"caption":"subtitle2",color:"text.secondary",sx:{mb:.5},children:"Description"}),e.jsx(u,{variant:i?"body2":"body1",sx:{whiteSpace:"pre-wrap"},children:a.description})]}),e.jsx(se,{sx:{my:{xs:2,sm:3}}}),e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:{xs:1,sm:1.5}},children:[e.jsx(Ve,{sx:{mr:1,color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsx(u,{variant:i?"body1":"subtitle1",sx:{fontWeight:600},children:"Location Information"})]}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:{xs:1.5,sm:2}},children:[e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"District"}),e.jsx(u,{variant:i?"body2":"body1",children:((Ke=a.locationDetails)==null?void 0:Ke.district)||"N/A"})]}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Thana"}),e.jsx(u,{variant:i?"body2":"body1",children:((qe=a.locationDetails)==null?void 0:qe.thana)||"N/A"})]}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Ward"}),e.jsx(u,{variant:i?"body2":"body1",children:((Xe=a.locationDetails)==null?void 0:Xe.ward)||(a.wards?typeof a.wards=="object"?`Ward ${a.wards.wardNumber||a.wards.number}`:`Ward ${a.wards}`:a.user.ward?typeof a.user.ward=="object"?`Ward ${a.user.ward.wardNumber}`:`Ward ${a.user.ward}`:"N/A")})]}),e.jsxs(l,{sx:{gridColumn:{xs:"1",sm:"1 / -1"}},children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Full Address"}),e.jsx(u,{variant:i?"body2":"body1",children:((Ye=a.locationDetails)==null?void 0:Ye.address)||a.location})]})]})]}),((f==null?void 0:f.inspectorName)||((Qe=a.wards)==null?void 0:Qe.inspectorName)||((et=a.zone)==null?void 0:et.officerName))&&e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:{xs:1,sm:1.5}},children:[e.jsx(pt,{sx:{mr:1,color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsx(u,{variant:i?"body1":"subtitle1",sx:{fontWeight:600},children:"Responsible Officials"})]}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:{xs:1.5,sm:2}},children:[((f==null?void 0:f.inspectorName)||((tt=a.wards)==null?void 0:tt.inspectorName))&&e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Ward Inspector"}),e.jsx(u,{variant:i?"body2":"body1",children:(f==null?void 0:f.inspectorName)||((st=a.wards)==null?void 0:st.inspectorName)}),((f==null?void 0:f.inspectorPhone)||((rt=a.wards)==null?void 0:rt.inspectorPhone))&&e.jsx(u,{variant:"body2",color:"text.secondary",children:(f==null?void 0:f.inspectorPhone)||((at=a.wards)==null?void 0:at.inspectorPhone)})]}),((ot=a.zone)==null?void 0:ot.officerName)&&e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Zone Officer"}),e.jsx(u,{variant:i?"body2":"body1",children:a.zone.officerName}),a.zone.officerPhone&&e.jsx(u,{variant:"body2",color:"text.secondary",children:a.zone.officerPhone})]})]})]}),e.jsx(se,{sx:{my:{xs:2,sm:3}}}),e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:{xs:1,sm:1.5}},children:[e.jsx(pt,{sx:{mr:1,color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsx(u,{variant:i?"body1":"subtitle1",sx:{fontWeight:600},children:"Citizen Information"})]}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:{xs:1.5,sm:2}},children:[e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Citizen ID"}),e.jsxs(u,{variant:i?"body2":"body1",children:["U",String(a.user.id).padStart(6,"0")]})]}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Name"}),e.jsxs(u,{variant:i?"body2":"body1",children:[a.user.firstName," ",a.user.lastName]})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ot,{sx:{fontSize:{xs:16,sm:18},color:"text.secondary"}}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Phone"}),e.jsx(u,{variant:i?"body2":"body1",children:a.user.phone})]})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(zt,{sx:{fontSize:{xs:16,sm:18},color:"text.secondary"}}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Email"}),e.jsx(u,{variant:i?"body2":"body1",sx:{wordBreak:"break-word",fontSize:{xs:"0.75rem",sm:"1rem"}},children:a.user.email||"Not provided"})]})]}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"City Corporation"}),e.jsx(u,{variant:i?"body2":"body1",children:((nt=a.user.cityCorporation)==null?void 0:nt.name)||"N/A"})]}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Zone"}),e.jsx(u,{variant:i?"body2":"body1",children:a.user.zone?`Zone ${a.user.zone}`:"N/A"})]}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Ward Number"}),e.jsx(u,{variant:i?"body2":"body1",children:a.wards?typeof a.wards=="object"?`Ward ${a.wards.wardNumber||a.wards.number}`:`Ward ${a.wards}`:a.user.ward?typeof a.user.ward=="object"?`Ward ${a.user.ward.wardNumber}`:`Ward ${a.user.ward}`:"N/A"})]}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Thana/Area"}),e.jsx(u,{variant:i?"body2":"body1",children:((it=a.user.thana)==null?void 0:it.name)||"N/A"})]}),a.user.address&&e.jsxs(l,{sx:{gridColumn:{xs:"1",sm:"1 / -1"}},children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Citizen Address"}),e.jsx(u,{variant:i?"body2":"body1",sx:{wordBreak:"break-word"},children:a.user.address})]})]})]}),e.jsx(se,{sx:{my:{xs:2,sm:3}}}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:{xs:1.5,sm:2}},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qt,{sx:{fontSize:{xs:16,sm:18},color:"text.secondary"}}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Submitted"}),e.jsx(u,{variant:i?"body2":"body1",sx:{fontSize:{xs:"0.75rem",sm:"1rem"}},children:ue(a.createdAt)})]})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xt,{sx:{fontSize:{xs:16,sm:18},color:"text.secondary"}}),e.jsxs(l,{children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",children:"Last Updated"}),e.jsx(u,{variant:i?"body2":"body1",sx:{fontSize:{xs:"0.75rem",sm:"1rem"}},children:ue(a.updatedAt)})]})]})]}),a.imageUrls&&a.imageUrls.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{sx:{my:{xs:2,sm:3}}}),e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:{xs:1,sm:1.5}},children:[e.jsx(Yt,{sx:{mr:1,color:"text.secondary",fontSize:{xs:18,sm:20}}}),e.jsxs(u,{variant:i?"body1":"subtitle1",sx:{fontWeight:600},children:["Attached Images (",a.imageUrls.length,")"]})]}),e.jsx(ft,{cols:i?2:g?3:4,gap:i?8:12,sx:{mt:{xs:1,sm:2}},children:a.imageUrls.map((x,m)=>e.jsx(yt,{sx:{cursor:"pointer",borderRadius:1,overflow:"hidden",border:"1px solid #e0e0e0","&:hover":{opacity:.8,boxShadow:2}},onClick:()=>ve(m),children:P.has(m)?e.jsxs(l,{sx:{width:"100%",height:150,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5"},children:[e.jsx(Qt,{sx:{fontSize:40,color:"text.secondary",mb:1}}),e.jsx(u,{variant:"caption",color:"text.secondary",children:"Failed to load"})]}):e.jsx("img",{src:x,alt:`Complaint image ${m+1}`,loading:"lazy",style:{width:"100%",height:150,objectFit:"cover"},onError:()=>Re(m)})},m))})]})]}),a.audioUrls&&a.audioUrls.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{sx:{my:3}}),e.jsxs(l,{sx:{mb:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(es,{sx:{mr:1,color:"text.secondary"}}),e.jsxs(u,{variant:"subtitle1",sx:{fontWeight:600},children:["Voice Recordings (",a.audioUrls.length,")"]})]}),a.audioUrls.map((x,m)=>{var j,$;return e.jsxs(l,{sx:{border:"1px solid #e0e0e0",borderRadius:2,p:2,mb:2,backgroundColor:"#f8f9fa"},children:[e.jsx("audio",{ref:W=>{K.current[m]=W},src:x,onTimeUpdate:()=>U(m),onEnded:()=>R(m),onLoadedMetadata:W=>{const V=W.currentTarget;V.volume=z[m]||1,V.playbackRate=Y[m]||1},style:{display:"none"}}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(B,{onClick:()=>N(m),sx:{backgroundColor:"#4CAF50",color:"white","&:hover":{backgroundColor:"#45a049"}},children:I[m]?e.jsx(ts,{}):e.jsx(ss,{})}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(l,{onClick:W=>ze(m,W),sx:{height:6,backgroundColor:"#e0e0e0",borderRadius:3,cursor:"pointer",position:"relative","&:hover":{backgroundColor:"#d0d0d0"}},children:e.jsx(l,{sx:{height:"100%",width:`${X[m]||0}%`,backgroundColor:"#4CAF50",borderRadius:3,transition:"width 0.1s linear"}})}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(u,{variant:"caption",color:"text.secondary",children:Je(((j=K.current[m])==null?void 0:j.currentTime)||0)}),e.jsx(u,{variant:"caption",color:"text.secondary",children:Je((($=K.current[m])==null?void 0:$.duration)||0)})]})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{size:"small",onClick:()=>H(m,z[m]>0?0:1),children:(z[m]||1)>0?e.jsx(rs,{}):e.jsx(as,{})}),e.jsx(l,{sx:{width:60},children:e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:z[m]||1,onChange:W=>H(m,parseFloat(W.target.value)),style:{width:"100%"}})})]}),e.jsxs(q,{size:"small",variant:"outlined",startIcon:e.jsx(os,{}),onClick:()=>Oe(m),sx:{minWidth:80,textTransform:"none"},children:[Y[m]||1,"x"]}),e.jsx(B,{size:"small",onClick:()=>We(x,m),children:e.jsx(bt,{})})]}),e.jsxs(u,{variant:"caption",color:"text.secondary",children:["Recording ",m+1]})]},m)})]})]}),(a.resolutionNote||a.resolutionImages)&&e.jsxs(e.Fragment,{children:[e.jsx(se,{sx:{my:{xs:2,sm:3}}}),e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:{xs:1,sm:1.5}},children:[e.jsx(Ct,{sx:{mr:1,color:"#4CAF50",fontSize:{xs:18,sm:20}}}),e.jsx(u,{variant:i?"body1":"subtitle1",sx:{fontWeight:600,color:"#4CAF50"},children:"Admin Resolution Report"})]}),a.resolutionNote&&e.jsxs(l,{sx:{mb:{xs:2,sm:3}},children:[e.jsx(u,{variant:i?"caption":"body2",color:"text.secondary",sx:{mb:.5},children:"Resolution Note"}),e.jsx(l,{sx:{p:{xs:1.5,sm:2},backgroundColor:"#f0f7f0",border:"1px solid #c3e6cb",borderRadius:1},children:e.jsx(u,{variant:i?"body2":"body1",sx:{whiteSpace:"pre-wrap"},children:a.resolutionNote})})]}),a.resolutionImages&&(()=>{const x=a.resolutionImages.split(",").filter(m=>m.trim());return x.length>0&&e.jsxs(l,{children:[e.jsxs(u,{variant:i?"caption":"body2",color:"text.secondary",sx:{mb:1},children:["Resolution Images (",x.length,")"]}),e.jsx(ft,{cols:i?2:g?3:4,gap:i?8:12,children:x.map((m,j)=>e.jsx(yt,{sx:{cursor:"pointer",borderRadius:1,overflow:"hidden",border:"2px solid #4CAF50","&:hover":{opacity:.8,boxShadow:2}},onClick:()=>{window.open(m.trim(),"_blank")},children:e.jsx("img",{src:m.trim(),alt:`Resolution image ${j+1}`,loading:"lazy",style:{width:"100%",height:150,objectFit:"cover"},onError:$=>{const W=$.target;W.style.display="none";const V=W.parentElement;V&&(V.innerHTML=`
                                                                                <div style="width: 100%; height: 150px; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: #f5f5f5;">
                                                                                    <svg style="width: 40px; height: 40px; color: #757575; margin-bottom: 8px;" fill="currentColor" viewBox="0 0 24 24">
                                                                                        <path d="M21 5v6.59l-3-3.01-4 4.01-4-4-4 4-3-3.01V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2zm-3 6.42l3 3.01V19c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2v-6.58l3 2.99 4-4 4 4 4-4z"/>
                                                                                    </svg>
                                                                                    <span style="font-size: 12px; color: #757575;">Failed to load</span>
                                                                                </div>
                                                                            `)}})},j))})]})})()]})]})]})]}),e.jsxs(Rt,{sx:{px:{xs:2,sm:3},py:{xs:1.5,sm:2},borderTop:"1px solid #e0e0e0",gap:{xs:1,sm:1.5},justifyContent:"space-between",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"stretch",sm:"center"}},children:[a&&Ze(a.status).length>0&&p()&&e.jsx(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,alignItems:{xs:"stretch",sm:"center"},width:{xs:"100%",sm:"auto"},flexWrap:"wrap"},children:Ze(a.status).map(x=>e.jsx(q,{variant:"contained",onClick:()=>Pt(x.status),disabled:re,startIcon:re?e.jsx(Te,{size:16}):e.jsx(Ct,{}),sx:{backgroundColor:x.color,"&:hover":{backgroundColor:x.color,opacity:.9},textTransform:"none",minHeight:{xs:44,sm:"auto"},fontSize:{xs:"0.875rem",sm:"0.875rem"},px:{xs:2,sm:2}},children:re?"Updating...":x.label},x.status))}),a&&!p()&&d()&&e.jsx(gt,{severity:"info",sx:{flex:1},children:e.jsx(u,{variant:"body2",children:"à¦­à¦¿à¦‰ à¦…à¦¨à¦²à¦¿ à¦®à§‹à¦¡ - à¦†à¦ªà¦¨à¦¿ à¦¶à§à¦§à§à¦®à¦¾à¦¤à§à¦° à¦•à¦®à¦ªà§à¦²à§‡à¦‡à¦¨ à¦¦à§‡à¦–à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡à¦¨, à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡à¦¨ à¦¨à¦¾à¥¤"})}),e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,width:{xs:"100%",sm:"auto"}},children:[n&&a&&e.jsx(q,{variant:"outlined",startIcon:!i&&e.jsx(ns,{}),onClick:()=>n(a.id),sx:{textTransform:"none",minHeight:{xs:44,sm:"auto"}},children:"Open Chat"}),e.jsx(q,{onClick:ne,variant:"outlined",sx:{textTransform:"none",minHeight:{xs:44,sm:"auto"}},children:"Close"})]})]})]}),e.jsx(zs,{open:$e,onClose:()=>oe(!1),onConfirm:Ut,loading:re}),a&&a.imageUrls&&a.imageUrls.length>0&&e.jsx(is,{open:M,onClick:he,sx:{zIndex:c.zIndex.modal+1,backgroundColor:"rgba(0, 0, 0, 0.9)"},children:e.jsxs(l,{onClick:x=>x.stopPropagation(),sx:{position:"relative",maxWidth:"90vw",maxHeight:"90vh",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs(l,{sx:{position:"absolute",top:-60,right:0,display:"flex",gap:1,zIndex:1},children:[e.jsx(B,{onClick:ke,disabled:y<=.5,sx:{color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:e.jsx(cs,{})}),e.jsx(B,{onClick:Ee,disabled:y>=3,sx:{color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:e.jsx(ls,{})}),e.jsx(B,{onClick:Ne,sx:{color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:e.jsx(bt,{})}),e.jsx(B,{onClick:he,sx:{color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:e.jsx(be,{})})]}),e.jsxs(l,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto",maxWidth:"100%",maxHeight:"100%"},children:[a.imageUrls.length>1&&e.jsx(B,{onClick:Se,sx:{position:"absolute",left:-60,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:e.jsx(ds,{sx:{fontSize:40}})}),e.jsx("img",{src:a.imageUrls[O],alt:`Complaint image ${O+1}`,style:{maxWidth:"100%",maxHeight:"90vh",transform:`scale(${y})`,transition:"transform 0.2s ease-in-out"}}),a.imageUrls.length>1&&e.jsx(B,{onClick:Ie,sx:{position:"absolute",right:-60,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:e.jsx(us,{sx:{fontSize:40}})})]}),a.imageUrls.length>1&&e.jsx(l,{sx:{position:"absolute",bottom:-50,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",px:2,py:1,borderRadius:1},children:e.jsxs(u,{variant:"body2",children:[O+1," / ",a.imageUrls.length]})})]})})]})},Ms=({complaint:o,citizen:t,onViewDetails:s,onStatusChange:r,onViewHistory:n})=>{const c=Pe(),i=le(c.breakpoints.down("md")),g=le(c.breakpoints.down("sm")),[p,d]=h.useState(!i),[a,b]=h.useState(null),f=!!a,S=y=>{switch(y){case"PENDING":return"#ff9800";case"IN_PROGRESS":return"#2196f3";case"RESOLVED":return"#4caf50";case"REJECTED":return"#f44336";default:return"#9e9e9e"}},C=y=>{switch(y){case"PENDING":return"Pending";case"IN_PROGRESS":return"In Progress";case"RESOLVED":return"Resolved";case"REJECTED":return"Rejected";default:return y}},w=y=>{b(y.currentTarget)},v=()=>{b(null)},E=y=>{r(y),v()},M=()=>{d(!p)},T=()=>{var P,_,I,F;const y=((_=(P=t.firstName)==null?void 0:P.charAt(0))==null?void 0:_.toUpperCase())||"",k=((F=(I=t.lastName)==null?void 0:I.charAt(0))==null?void 0:F.toUpperCase())||"";return`${y}${k}`},O=y=>new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),D=["PENDING","IN_PROGRESS","RESOLVED","REJECTED"];return e.jsxs(l,{sx:{borderBottom:"1px solid",borderColor:"divider",backgroundColor:"background.paper"},children:[e.jsxs(l,{sx:{p:{xs:1.5,sm:2,md:2},display:"flex",alignItems:"flex-start",gap:{xs:1.5,sm:2,md:2}},children:[e.jsx(hs,{src:t.profilePicture,alt:`${t.firstName} ${t.lastName}`,sx:{width:g?40:48,height:g?40:48,backgroundColor:"#4CAF50",fontSize:g?"1rem":"1.25rem",fontWeight:600},children:!t.profilePicture&&T()}),e.jsxs(l,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{variant:g?"subtitle2":"subtitle1",sx:{fontWeight:600,mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.firstName," ",t.lastName]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",mb:.5},children:[e.jsx(u,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.trackingNumber}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"â€¢"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.category})]}),e.jsx(u,{variant:"body2",sx:{mb:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:o.title}),e.jsxs(l,{sx:{display:"flex",gap:1,alignItems:"center",mb:.5},children:[e.jsx(fe,{label:C(o.status),size:"small",sx:{backgroundColor:S(o.status),color:"white",fontWeight:600,fontSize:"0.75rem"}}),t.address&&e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:.5,maxWidth:"60%"},children:[e.jsx(Ve,{sx:{fontSize:14,color:"text.secondary"}}),e.jsx(u,{variant:"caption",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.address})]})]})]}),i&&e.jsx(B,{onClick:M,size:"small",sx:{alignSelf:"flex-start"},children:p?e.jsx(xs,{}):e.jsx(ms,{})})]}),e.jsxs(gs,{in:p,timeout:"auto",unmountOnExit:!0,children:[e.jsxs(l,{sx:{px:{xs:1.5,sm:2,md:2},pb:{xs:1.5,sm:2,md:2}},children:[e.jsx(se,{sx:{mb:2}}),e.jsxs(l,{sx:{mb:2},children:[e.jsx(Ve,{sx:{fontSize:18,color:"text.secondary"}}),e.jsx(u,{variant:"body2",sx:{fontWeight:600},children:"Location"})]}),e.jsxs(l,{sx:{ml:3,display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(u,{variant:"body2",color:"text.secondary",children:[t.cityCorporationName||t.district,t.thanaName?`, ${t.thanaName}`:`, ${t.upazila}`]}),e.jsxs(l,{sx:{display:"flex",gap:1},children:[t.zone&&e.jsx(fe,{label:`Zone ${t.zone}`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}}),t.ward&&e.jsx(fe,{label:`Ward ${t.ward}`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]})]}),t.address&&e.jsx(u,{variant:"body2",color:"text.secondary",sx:{ml:3,mt:.5,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.address})]}),e.jsxs(l,{sx:{mb:2},children:[e.jsx(u,{variant:"body2",sx:{fontWeight:600,mb:1},children:"Contact Information"}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Ot,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:t.phone})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(zt,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.email})]})]}),e.jsx(l,{sx:{mb:2},children:e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Submitted on ",O(o.createdAt)]})}),e.jsxs(l,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(q,{variant:"outlined",size:"small",startIcon:e.jsx(ps,{}),onClick:s,sx:{textTransform:"none",borderRadius:2,flex:g?"1 1 100%":"0 1 auto"},children:"View Full Details"}),e.jsx(q,{variant:"outlined",size:"small",onClick:w,sx:{textTransform:"none",borderRadius:2,flex:g?"1 1 100%":"0 1 auto"},children:"Change Status"}),n&&e.jsx(q,{variant:"outlined",size:"small",startIcon:e.jsx(fs,{}),onClick:n,sx:{textTransform:"none",borderRadius:2,flex:g?"1 1 100%":"0 1 auto"},children:"View History"})]})]}),e.jsx(ys,{anchorEl:a,open:f,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:D.map(y=>e.jsxs(_e,{onClick:()=>E(y),disabled:y===o.status,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:S(y)}}),e.jsx(u,{variant:"body2",children:C(y)}),y===o.status&&e.jsx(u,{variant:"caption",color:"text.secondary",sx:{ml:1},children:"(Current)"})]},y))})]})},Ce=typeof window<"u"?h.useLayoutEffect:h.useEffect;function vt(o){if(o!==void 0)switch(typeof o){case"number":return o;case"string":{if(o.endsWith("px"))return parseFloat(o);break}}}function Ps({box:o,defaultHeight:t,defaultWidth:s,disabled:r,element:n,mode:c,style:i}){const{styleHeight:g,styleWidth:p}=h.useMemo(()=>({styleHeight:vt(i==null?void 0:i.height),styleWidth:vt(i==null?void 0:i.width)}),[i==null?void 0:i.height,i==null?void 0:i.width]),[d,a]=h.useState({height:t,width:s}),b=r||g!==void 0||c==="only-width"||g!==void 0&&p!==void 0;return Ce(()=>{if(n===null||b)return;const f=new ResizeObserver(S=>{for(const C of S){const{contentRect:w,target:v}=C;n===v&&a(E=>E.height===w.height&&E.width===w.width?E:{height:w.height,width:w.width})}});return f.observe(n,{box:o}),()=>{f==null||f.unobserve(n)}},[o,b,n,g,p]),h.useMemo(()=>({height:g??d.height,width:p??d.width}),[d,g,p])}function Tt(o){const t=h.useRef(()=>{throw new Error("Cannot call during render.")});return Ce(()=>{t.current=o},[o]),h.useCallback(s=>{var r;return(r=t.current)==null?void 0:r.call(t,s)},[t])}function He({containerElement:o,direction:t,isRtl:s,scrollOffset:r}){return r}function Q(o,t="Assertion error"){if(!o)throw console.error(t),Error(t)}function ye(o,t){if(o===t)return!0;if(!!o!=!!t||(Q(o!==void 0),Q(t!==void 0),Object.keys(o).length!==Object.keys(t).length))return!1;for(const s in o)if(!Object.is(t[s],o[s]))return!1;return!0}function Mt({cachedBounds:o,itemCount:t,itemSize:s}){if(t===0)return 0;if(typeof s=="number")return t*s;{const r=o.get(o.size===0?0:o.size-1);Q(r!==void 0,"Unexpected bounds cache miss");const n=(r.scrollOffset+r.size)/o.size;return t*n}}function Us({align:o,cachedBounds:t,index:s,itemCount:r,itemSize:n,containerScrollOffset:c,containerSize:i}){if(s<0||s>=r)throw RangeError(`Invalid index specified: ${s}`,{cause:`Index ${s} is not within the range of 0 - ${r-1}`});const g=Mt({cachedBounds:t,itemCount:r,itemSize:n}),p=t.get(s),d=Math.max(0,Math.min(g-i,p.scrollOffset)),a=Math.max(0,p.scrollOffset-i+p.size);switch(o==="smart"&&(c>=a&&c<=d?o="auto":o="center"),o){case"start":return d;case"end":return a;case"center":return p.scrollOffset<=i/2?0:p.scrollOffset+p.size/2>=g-i/2?g-i:p.scrollOffset+p.size/2-i/2;case"auto":default:return c>=a&&c<=d?c:c<a?a:d}}function St({cachedBounds:o,containerScrollOffset:t,containerSize:s,itemCount:r,overscanCount:n}){const c=r-1;let i=0,g=-1,p=0,d=-1,a=0;for(;a<c;){const b=o.get(a);if(b.scrollOffset+b.size>t)break;a++}for(i=a,p=Math.max(0,i-n);a<c;){const b=o.get(a);if(b.scrollOffset+b.size>=t+s)break;a++}return g=Math.min(c,a),d=Math.min(r-1,g+n),i<0&&(i=0,g=-1,p=0,d=-1),{startIndexVisible:i,stopIndexVisible:g,startIndexOverscan:p,stopIndexOverscan:d}}function $s({itemCount:o,itemProps:t,itemSize:s}){const r=new Map;return{get(n){for(Q(n<o,`Invalid index ${n}`);r.size-1<n;){const i=r.size;let g;switch(typeof s){case"function":{g=s(i,t);break}case"number":{g=s;break}}if(i===0)r.set(i,{size:g,scrollOffset:0});else{const p=r.get(i-1);Q(p!==void 0,`Unexpected bounds cache miss for index ${n}`),r.set(i,{scrollOffset:p.scrollOffset+p.size,size:g})}}const c=r.get(n);return Q(c!==void 0,`Unexpected bounds cache miss for index ${n}`),c},set(n,c){r.set(n,c)},get size(){return r.size}}}function Ws({itemCount:o,itemProps:t,itemSize:s}){return h.useMemo(()=>$s({itemCount:o,itemProps:t,itemSize:s}),[o,t,s])}function Ls({containerSize:o,itemSize:t}){let s;switch(typeof t){case"string":{Q(t.endsWith("%"),`Invalid item size: "${t}"; string values must be percentages (e.g. "100%")`),Q(o!==void 0,"Container size must be defined if a percentage item size is specified"),s=o*parseInt(t)/100;break}default:{s=t;break}}return s}function Fs({containerElement:o,containerStyle:t,defaultContainerSize:s=0,direction:r,isRtl:n=!1,itemCount:c,itemProps:i,itemSize:g,onResize:p,overscanCount:d}){const[a,b]=h.useState({startIndexVisible:0,startIndexOverscan:0,stopIndexVisible:-1,stopIndexOverscan:-1}),{startIndexVisible:f,startIndexOverscan:S,stopIndexVisible:C,stopIndexOverscan:w}={startIndexVisible:Math.min(c-1,a.startIndexVisible),startIndexOverscan:Math.min(c-1,a.startIndexOverscan),stopIndexVisible:Math.min(c-1,a.stopIndexVisible),stopIndexOverscan:Math.min(c-1,a.stopIndexOverscan)},{height:v=s,width:E=s}=Ps({defaultHeight:s,defaultWidth:void 0,element:o,mode:"only-height",style:t}),M=h.useRef({height:0,width:0}),T=v,O=Ls({containerSize:T,itemSize:g});h.useLayoutEffect(()=>{if(typeof p=="function"){const I=M.current;(I.height!==v||I.width!==E)&&(p({height:v,width:E},{...I}),I.height=v,I.width=E)}},[v,p,E]);const D=Ws({itemCount:c,itemProps:i,itemSize:O}),y=h.useCallback(I=>D.get(I),[D]),k=h.useCallback(()=>Mt({cachedBounds:D,itemCount:c,itemSize:O}),[D,c,O]),P=h.useCallback(I=>{const F=He({containerElement:o,direction:r,isRtl:n,scrollOffset:I});return St({cachedBounds:D,containerScrollOffset:F,containerSize:T,itemCount:c,overscanCount:d})},[D,o,T,r,n,c,d]);Ce(()=>{const I=(o==null?void 0:o.scrollTop)??0;b(P(I))},[o,r,P]),Ce(()=>{if(!o)return;const I=()=>{b(F=>{const{scrollLeft:X,scrollTop:A}=o,z=He({containerElement:o,direction:r,isRtl:n,scrollOffset:A}),G=St({cachedBounds:D,containerScrollOffset:z,containerSize:T,itemCount:c,overscanCount:d});return ye(G,F)?F:G})};return o.addEventListener("scroll",I),()=>{o.removeEventListener("scroll",I)}},[D,o,T,r,c,d]);const _=Tt(({align:I="auto",containerScrollOffset:F,index:X})=>{let A=Us({align:I,cachedBounds:D,containerScrollOffset:F,containerSize:T,index:X,itemCount:c,itemSize:O});if(o){if(A=He({containerElement:o,direction:r,isRtl:n,scrollOffset:A}),typeof o.scrollTo!="function"){const z=P(A);ye(a,z)||b(z)}return A}});return{getCellBounds:y,getEstimatedSize:k,scrollToIndex:_,startIndexOverscan:S,startIndexVisible:f,stopIndexOverscan:w,stopIndexVisible:C}}function Bs(o){return h.useMemo(()=>o,Object.values(o))}function Hs(o,t){const{ariaAttributes:s,style:r,...n}=o,{ariaAttributes:c,style:i,...g}=t;return ye(s,c)&&ye(r,i)&&ye(n,g)}function _s(o){return o!=null&&typeof o=="object"&&"getAverageRowHeight"in o&&typeof o.getAverageRowHeight=="function"}const Ge="data-react-window-index";function Vs({children:o,className:t,defaultHeight:s=0,listRef:r,onResize:n,onRowsRendered:c,overscanCount:i=3,rowComponent:g,rowCount:p,rowHeight:d,rowProps:a,tagName:b="div",style:f,...S}){const C=Bs(a),w=h.useMemo(()=>h.memo(g,Hs),[g]),[v,E]=h.useState(null),M=_s(d),T=h.useMemo(()=>M?A=>d.getRowHeight(A)??d.getAverageRowHeight():d,[M,d]),{getCellBounds:O,getEstimatedSize:D,scrollToIndex:y,startIndexOverscan:k,startIndexVisible:P,stopIndexOverscan:_,stopIndexVisible:I}=Fs({containerElement:v,containerStyle:f,defaultContainerSize:s,direction:"vertical",itemCount:p,itemProps:C,itemSize:T,onResize:n,overscanCount:i});h.useImperativeHandle(r,()=>({get element(){return v},scrollToRow({align:A="auto",behavior:z="auto",index:G}){const Y=y({align:A,containerScrollOffset:(v==null?void 0:v.scrollTop)??0,index:G});typeof(v==null?void 0:v.scrollTo)=="function"&&v.scrollTo({behavior:z,top:Y})}}),[v,y]),Ce(()=>{if(!v)return;const A=Array.from(v.children).filter((z,G)=>{if(z.hasAttribute("aria-hidden"))return!1;const Y=`${k+G}`;return z.setAttribute(Ge,Y),!0});if(M)return d.observeRowElements(A)},[v,M,d,k,_]),h.useEffect(()=>{k>=0&&_>=0&&c&&c({startIndex:P,stopIndex:I},{startIndex:k,stopIndex:_})},[c,k,P,_,I]);const F=h.useMemo(()=>{const A=[];if(p>0)for(let z=k;z<=_;z++){const G=O(z);A.push(h.createElement(w,{...C,ariaAttributes:{"aria-posinset":z+1,"aria-setsize":p,role:"listitem"},key:z,index:z,style:{position:"absolute",left:0,transform:`translateY(${G.scrollOffset}px)`,height:M?void 0:G.size,width:"100%"}}))}return A},[w,O,M,p,C,k,_]),X=e.jsx("div",{"aria-hidden":!0,style:{height:D(),width:"100%",zIndex:-1}});return h.createElement(b,{role:"list",...S,className:t,ref:E,style:{position:"relative",maxHeight:"100%",flexGrow:1,overflowY:"auto",...f}},F,o,X)}function Gs({defaultRowHeight:o,key:t}){const[s,r]=h.useState({key:t,map:new Map});s.key!==t&&r({key:t,map:new Map});const{map:n}=s,c=h.useCallback(()=>{let b=0;return n.forEach(f=>{b+=f}),b===0?o:b/n.size},[o,n]),i=h.useCallback(b=>{const f=n.get(b);return f!==void 0?f:(n.set(b,o),o)},[o,n]),g=h.useCallback((b,f)=>{r(S=>{if(S.map.get(b)===f)return S;const C=new Map(S.map);return C.set(b,f),{...S,map:C}})},[]),p=Tt(b=>{b.length!==0&&b.forEach(f=>{const{borderBoxSize:S,target:C}=f,w=C.getAttribute(Ge);Q(w!==null,`Invalid ${Ge} attribute value`);const v=parseInt(w),{blockSize:E}=S[0];E&&g(v,E)})}),[d]=h.useState(()=>new ResizeObserver(p));h.useEffect(()=>()=>{d.disconnect()},[d]);const a=h.useCallback(b=>(b.forEach(f=>d.observe(f)),()=>{b.forEach(f=>d.unobserve(f))}),[d]);return h.useMemo(()=>({getAverageRowHeight:c,getRowHeight:i,setRowHeight:g,observeRowElements:a}),[c,i,g,a])}const Js=o=>{const t=new Date,s=new Date(o),r=Math.floor((t.getTime()-s.getTime())/1e3);if(r<60)return"Just now";if(r<3600){const n=Math.floor(r/60);return`${n} min${n>1?"s":""} ago`}else return r<86400?s.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}):s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0})},It=({message:o,isAdmin:t,showSenderName:s=!1})=>{const[r,n]=h.useState(!1),c=t?"16px 16px 4px 16px":"16px 16px 16px 4px";return e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{mb:1.5,display:"flex",justifyContent:t?"flex-end":"flex-start",animation:`${At} ${J.normal.duration} ${J.normal.timing}, ${Dt} ${J.normal.duration} ${J.smooth.timing}`,animationFillMode:"both"},children:e.jsxs(l,{sx:{maxWidth:{xs:"85%",sm:"75%",md:"70%"},minWidth:"100px",p:1.5,borderRadius:c,background:t?"linear-gradient(135deg, #1976d2 0%, #2e7d32 100%)":"#ffffff",color:t?"#ffffff":"#1a1a1a",boxShadow:t?"0 2px 8px rgba(25, 118, 210, 0.25)":"0 2px 8px rgba(0, 0, 0, 0.08)",border:t?"none":"1px solid #e0e0e0",transition:`all ${J.fast.duration} ${J.fast.timing}`,"&:hover":{boxShadow:t?"0 4px 12px rgba(25, 118, 210, 0.35)":"0 4px 12px rgba(0, 0, 0, 0.12)",transform:"translateY(-1px)"}},children:[!t&&s&&o.senderName&&e.jsx(u,{variant:"caption",sx:{fontWeight:700,display:"block",mb:.5,color:"#1976d2",fontSize:"0.75rem",letterSpacing:"0.02em"},children:o.senderName}),e.jsx(u,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",lineHeight:1.5,fontSize:"0.9rem"},children:o.message}),o.imageUrl&&e.jsx(l,{component:"img",src:o.imageUrl,alt:"Message attachment",loading:"lazy",onLoad:()=>{var g;console.log("âœ… Image loaded successfully:",(g=o.imageUrl)==null?void 0:g.substring(0,100))},onError:g=>{var d,a;console.error("âŒ Image failed to load:",(d=o.imageUrl)==null?void 0:d.substring(0,100)),console.error("   Full URL:",o.imageUrl),g.currentTarget.style.display="none";const p=document.createElement("div");p.textContent="âŒ Image failed to load",p.style.color=t?"#ffcccc":"#ff0000",p.style.fontSize="0.8rem",p.style.marginTop="8px",(a=g.currentTarget.parentElement)==null||a.appendChild(p)},sx:{mt:1,maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",cursor:"pointer",objectFit:"cover",transition:`all ${J.fast.duration} ${J.fast.timing}`,"&:hover":{opacity:.9,transform:"scale(1.02)"}},onClick:()=>n(!0)}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:t?"flex-end":"flex-start",mt:.5,gap:.5},children:[e.jsx(u,{variant:"caption",sx:{opacity:t?.85:.6,fontSize:"0.7rem",fontWeight:500},children:Js(o.createdAt)}),t&&e.jsx(l,{sx:{display:"flex",alignItems:"center",opacity:.85},children:o.read?e.jsx(bs,{sx:{fontSize:"0.9rem",color:"#4caf50"}}):e.jsx(Cs,{sx:{fontSize:"0.9rem"}})})]})]})}),o.imageUrl&&e.jsx(js,{open:r,onClose:()=>n(!1),sx:{display:"flex",alignItems:"center",justifyContent:"center",p:2},children:e.jsxs(l,{sx:{position:"relative",maxWidth:"90vw",maxHeight:"90vh",outline:"none"},children:[e.jsx(B,{onClick:()=>n(!1),sx:{position:"absolute",top:-40,right:0,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:e.jsx(be,{})}),e.jsx(l,{component:"img",src:o.imageUrl,alt:"Message attachment (full size)",sx:{maxWidth:"100%",maxHeight:"90vh",objectFit:"contain",borderRadius:"8px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)"}})]})})]})},Zs=({messages:o,loading:t,loadingMore:s=!1,hasMoreMessages:r=!1,onLoadMore:n,onScroll:c})=>{const i=h.useRef(null),g=h.useRef(null),p=h.useRef(0),d=Gs({defaultRowHeight:100}),a=h.useCallback(()=>{var f;(f=g.current)==null||f.scrollIntoView({behavior:"smooth"})},[]),b=h.useCallback(f=>{if(c&&c(f),!i.current||s||!r||!n)return;const{scrollTop:S}=i.current;S<100&&(p.current=i.current.scrollHeight,n())},[c,s,r,n]);return h.useEffect(()=>{o.length>0&&!t&&!s&&setTimeout(a,100)},[o.length,t,s,a]),h.useEffect(()=>{if(s&&i.current&&p.current>0){const S=i.current.scrollHeight-p.current;i.current.scrollTop=S,p.current=0}},[o,s]),e.jsxs(l,{ref:i,onScroll:b,sx:{flex:1,overflowY:"auto",overflowX:"hidden",p:{xs:1.5,sm:2,md:2},backgroundColor:"#f5f5f5",display:"flex",flexDirection:"column"},children:[t&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4,flex:1},children:e.jsx(Te,{size:32})}),!t&&e.jsxs(e.Fragment,{children:[s&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(Te,{size:24})}),!r&&o.length>0&&e.jsx(l,{sx:{textAlign:"center",py:2},children:e.jsx(u,{variant:"caption",color:"text.secondary",children:"Start of conversation"})}),o.length>0&&e.jsx(e.Fragment,{children:o.length>200?e.jsx(Vs,{rowCount:o.length,rowHeight:d,overscanCount:10,rowComponent:({index:f,style:S})=>{const C=o[f];return e.jsx("div",{style:S,children:e.jsx(It,{message:C,isAdmin:C.senderType==="ADMIN",showSenderName:C.senderType==="CITIZEN"},C.id)})},rowProps:{},style:{height:window.innerHeight-300}}):e.jsx(l,{children:o.map(f=>e.jsx(It,{message:f,isAdmin:f.senderType==="ADMIN",showSenderName:f.senderType==="CITIZEN"},f.id))})}),o.length===0&&e.jsx(l,{sx:{flex:1,display:"flex",alignItems:"center"},children:e.jsx(Es,{type:"no-messages"})}),e.jsx("div",{ref:g})]})]})},tr=({complaintId:o,onClose:t,onMessagesRead:s,hideHeader:r=!1,onStatusUpdate:n})=>{var oe,de,ne,je,we,ue,ve,he,Se,Ie,Ee,ke,Ne,Re;const c=Pe(),i=le(c.breakpoints.down("md")),[g,p]=h.useState([]),[d,a]=h.useState(null),[b,f]=h.useState(!1),[S,C]=h.useState(null),[w,v]=h.useState(!0),[E,M]=h.useState(1),[T,O]=h.useState(!1),[D,y]=h.useState(!1),[k,P]=h.useState(!1),[_,I]=h.useState(null),[F,X]=h.useState(!1),A=h.useCallback(async(N=1,U=!1)=>{if(o)try{N===1?f(!0):O(!0),C(null);const{messages:R,pagination:H}=await ge.getChatMessages(o,N,50);p(U?Oe=>[...R,...Oe]:R),v(H.hasNextPage),M(N)}catch(R){const H=R instanceof Error?R.message:"Failed to load messages";C(H),console.error("Error fetching messages:",R),Z.error("Failed to load messages. Please check your connection.",{icon:"âŒ",duration:4e3})}finally{f(!1),O(!1)}},[o]),z=h.useCallback(async()=>{if(o)try{P(!0),I(null);const N=await Me.getComplaintById(o);a(N)}catch(N){console.error("Error fetching complaint details:",N),I("Failed to load details")}finally{P(!1)}},[o]),G=h.useCallback(async()=>{if(o)try{await ge.markAsRead(o),p(N=>N.map(U=>({...U,read:!0}))),s&&s()}catch(N){console.error("Error marking messages as read:",N)}},[o,s]),Y=h.useCallback(()=>{!w||T||A(E+1,!0)},[w,T,E,A]),Ue=()=>{X(!0)},K=async N=>{if(!(!o||!d))try{await Me.updateComplaintStatus(o,{status:N,note:"Status changed from chat interface"}),a({...d,status:N}),Z.success(`Status updated to ${N}`,{icon:"âœ…"}),n&&n(N)}catch(U){console.error("Error updating status:",U),Z.error("Failed to update status",{icon:"âŒ"})}},re=(N,U)=>{d&&N===d.id&&a({...d,status:U})},ae=async(N,U)=>{if(o)try{y(!0);const R=await ge.sendMessage(o,{message:N,imageUrl:U});p(H=>[...H,R]),Z.success("Message sent successfully",{icon:"âœ…"})}catch(R){console.error("Error sending message:",R);const H=R instanceof Error?R.message:"Failed to send message";throw Z.error(H,{icon:"âŒ"}),R}finally{y(!1)}},$e=async(N,U)=>{if(o)try{y(!0);const R=await ge.sendMessageWithFile(o,N,U);p(H=>[...H,R]),Z.success("Message sent successfully",{icon:"âœ…"})}catch(R){console.error("Error sending message with file:",R);const H=R instanceof Error?R.message:"Failed to send message";throw Z.error(H,{icon:"âŒ"}),R}finally{y(!1)}};return h.useEffect(()=>{o&&(p([]),a(null),C(null),M(1),v(!0),A(1),z(),G())},[o,A,z,G]),h.useEffect(()=>{if(!o)return;const N=setInterval(()=>{ge.getChatMessages(o,1,50).then(({messages:U})=>{p(R=>{var ze;const H=(ze=R[R.length-1])==null?void 0:ze.id;return U.some(We=>We.id>(H||0))?U:R})}).catch(U=>{console.error("Error polling messages:",U)})},5e3);return()=>{clearInterval(N)}},[o]),o?e.jsxs(l,{sx:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[!r&&(d&&d.user?e.jsxs(l,{sx:{position:"relative"},children:[i&&t&&e.jsx(B,{onClick:t,size:"small",sx:{position:"absolute",top:8,left:8,zIndex:1,backgroundColor:"background.paper",boxShadow:1,"&:hover":{backgroundColor:"background.paper"}},children:e.jsx(jt,{})}),e.jsx(Ms,{complaint:{id:d.id,trackingNumber:d.trackingNumber||`#${d.id}`,title:d.title,category:d.category,status:d.status,createdAt:new Date(d.createdAt)},citizen:{id:d.user.id,firstName:d.user.firstName,lastName:d.user.lastName,phone:d.user.phone,email:d.user.email,zone:((oe=d.zone)==null?void 0:oe.name)||(typeof d.user.zone=="string"?d.user.zone:(de=d.user.zone)==null?void 0:de.name)||"N/A",district:((ne=d.locationDetails)==null?void 0:ne.district)||((je=d.user.cityCorporation)==null?void 0:je.name)||"N/A",upazila:((we=d.locationDetails)==null?void 0:we.thana)||((ue=d.user.thana)==null?void 0:ue.name)||"N/A",ward:((ve=d.locationDetails)==null?void 0:ve.ward)||((Se=(he=d.wards)==null?void 0:he.wardNumber)==null?void 0:Se.toString())||(typeof d.user.ward=="object"?(Ee=(Ie=d.user.ward)==null?void 0:Ie.wardNumber)==null?void 0:Ee.toString():d.user.ward)||"N/A",address:((ke=d.locationDetails)==null?void 0:ke.address)||d.location||"",profilePicture:d.user.avatar||void 0,wardInspector:(Ne=d.wards)!=null&&Ne.inspectorName?{name:d.wards.inspectorName,phone:d.wards.inspectorPhone||"N/A"}:void 0,zoneOfficer:(Re=d.zone)!=null&&Re.officerName?{name:d.zone.officerName,phone:d.zone.officerPhone||"N/A"}:void 0},onViewDetails:Ue,onStatusChange:K})]}):e.jsx(l,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",backgroundColor:"background.paper"},children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[i&&t&&e.jsx(B,{onClick:t,size:"small",sx:{mr:1},children:e.jsx(jt,{})}),e.jsx(l,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:_?e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"subtitle1",color:"error",sx:{fontWeight:600},children:"Failed to load chat details"}),e.jsx(B,{size:"small",onClick:z,color:"primary",children:e.jsx(l,{component:"span",sx:{fontSize:14},children:"Retry"})})]}):e.jsx(u,{variant:"subtitle1",sx:{fontWeight:600},children:"Loading..."})})]})})),S&&!b?e.jsx(ks,{error:S,onRetry:()=>A(1,!1),variant:"centered"}):e.jsx(Zs,{messages:g,loading:b,loadingMore:T,hasMoreMessages:w,onLoadMore:Y}),e.jsx(Ns,{onSend:ae,onSendWithFile:$e,sending:D,disabled:!o||b}),d&&e.jsx(Ts,{complaintId:d.id,open:F,onClose:()=>X(!1),onStatusUpdate:re})]}):e.jsx(l,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"text.secondary",p:3},children:e.jsx(u,{variant:"body1",children:"Select a chat to start messaging"})})};export{tr as C,zs as M,Me as a,Ts as b,pe as c};
