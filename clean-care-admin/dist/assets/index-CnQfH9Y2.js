import{j as e,s as he,t as pe,B as c,T as w,i as k,v as je,w as ye,H as Q,b as A,aX as ve,C as _,az as b,g as U,bn as G,x as be,e as V,f as Z,cG as ee,a$ as se,P as we,A as K,cW as te,p as H,l as Ce,V as Ie,y as Be}from"./mui-vendor-Brc-2iiC.js";import{r as f}from"./react-vendor-D7yrL1sD.js";import{a as ae,b as F,s as ne,K as ie,P as re,D as oe,c as le,S as ce,v as de,d as ge,u as ue,C as xe}from"./sortable.esm-CBBmJpQ9.js";import{A as X,M as Se,f as Re,a as Y,V as J}from"./index-DBuvollO.js";import{a as Oe}from"./query-vendor-CZVuOxbJ.js";import"./chart-vendor-CrjdDA16.js";const v=Oe.create({baseURL:X.BASE_URL,timeout:X.TIMEOUT,withCredentials:!0,headers:{"Content-Type":"application/json"}});v.interceptors.request.use(a=>{const t=localStorage.getItem("accessToken");return t&&(a.headers.Authorization=`Bearer ${t}`),a});class Ae{async getAll(){return(await v.get("/api/officer-reviews")).data}async getActive(){return(await v.get("/api/officer-reviews/active")).data}async getById(t){return(await v.get(`/api/officer-reviews/${t}`)).data}async create(t){return(await v.post("/api/officer-reviews",t)).data}async update(t,r){return(await v.put(`/api/officer-reviews/${t}`,r)).data}async delete(t){await v.delete(`/api/officer-reviews/${t}`)}async toggleActive(t){return(await v.patch(`/api/officer-reviews/${t}/toggle-active`)).data}async reorder(t){await v.post("/api/officer-reviews/reorder",{orders:t})}async uploadImage(t){try{const r=new FormData;r.append("images",t);const d=await v.post("/api/uploads",r,{headers:{"Content-Type":"multipart/form-data"}});if(d.data.success&&d.data.data.fileUrls.length>0)return d.data.data.fileUrls[0];throw new Error("Failed to upload image")}catch(r){throw console.error("Error uploading image:",r),r}}}const D=new Ae,De=({message:a,index:t,onMessageChange:r,onRemoveMessage:d,messagesLength:g})=>{const{attributes:u,listeners:C,setNodeRef:m,transform:B,transition:l,isDragging:h}=ue({id:`message-${t}`}),I={transform:xe.Transform.toString(B),transition:l};return e.jsx(V,{ref:m,style:I,sx:{mb:2,boxShadow:h?"0 8px 24px rgba(0,0,0,0.15)":"0 2px 8px rgba(0,0,0,0.06)"},children:e.jsx(Z,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(c,{...u,...C,sx:{cursor:"grab",pt:1,"&:active":{cursor:"grabbing"}},children:e.jsx(ee,{})}),e.jsxs(c,{sx:{flex:1},children:[e.jsx(U,{fullWidth:!0,label:"Message (English)",value:a.content,onChange:y=>r(t,"content",y.target.value),multiline:!0,rows:2,required:!0,sx:{mb:1}}),e.jsx(U,{fullWidth:!0,label:"Message (Bangla)",value:a.contentBn,onChange:y=>r(t,"contentBn",y.target.value),multiline:!0,rows:2})]}),e.jsx(k,{onClick:()=>d(t),color:"error",size:"small",disabled:g===1,children:e.jsx(se,{})})]})})})},Ue=({open:a,review:t,onClose:r,onSuccess:d,onError:g})=>{const[u,C]=f.useState(!1),[m,B]=f.useState(!1),[l,h]=f.useState(null),[I,y]=f.useState(null),[i,p]=f.useState({name:"",nameBn:"",designation:"",designationBn:"",imageUrl:""}),[x,S]=f.useState([{content:"",contentBn:"",displayOrder:0}]),W=ae(F(re),F(ie,{coordinateGetter:ne}));f.useEffect(()=>{t?(p({name:t.name,nameBn:t.nameBn||"",designation:t.designation,designationBn:t.designationBn||"",imageUrl:t.imageUrl||""}),S(t.messages.map(s=>({content:s.content,contentBn:s.contentBn||"",displayOrder:s.displayOrder}))),h(t.imageUrl)):E()},[t,a]);const E=()=>{p({name:"",nameBn:"",designation:"",designationBn:"",imageUrl:""}),S([{content:"",contentBn:"",displayOrder:0}]),y(null),l&&!l.startsWith("http")&&URL.revokeObjectURL(l),h(null)},L=s=>{var O;const o=(O=s.target.files)==null?void 0:O[0];if(!o)return;if(!o.type.startsWith("image/")){g("Please select a valid image file");return}if(o.size>5*1024*1024){g("Image size should be less than 5MB");return}y(o),l&&!l.startsWith("http")&&URL.revokeObjectURL(l);const j=URL.createObjectURL(o);h(j)},n=async()=>{if(I)try{B(!0);const s=await D.uploadImage(I);p({...i,imageUrl:s}),h(s),y(null),d("Image uploaded successfully!")}catch(s){g(s.message||"Failed to upload image"),h(null)}finally{B(!1)}},R=()=>{y(null),l&&!l.startsWith("http")&&URL.revokeObjectURL(l),h(null),p({...i,imageUrl:""})},M=()=>{S([...x,{content:"",contentBn:"",displayOrder:x.length}])},T=s=>{if(x.length===1){g("At least one message is required");return}S(x.filter((o,j)=>j!==s))},P=(s,o,j)=>{const O=[...x];O[s]={...O[s],[o]:j},S(O)},z=s=>{const{active:o,over:j}=s;if(!j||o.id===j.id)return;const O=x.findIndex((N,$)=>`message-${$}`===o.id),fe=x.findIndex((N,$)=>`message-${$}`===j.id),me=ge(x,O,fe).map((N,$)=>({...N,displayOrder:$}));S(me)},q=async()=>{if(!i.name.trim()){g("Officer name is required");return}if(!i.designation.trim()){g("Designation is required");return}if(x.some(s=>!s.content.trim())){g("All messages must have content");return}try{C(!0);const s={name:i.name,nameBn:i.nameBn||void 0,designation:i.designation,designationBn:i.designationBn||void 0,imageUrl:i.imageUrl||null,messages:x.map((o,j)=>({content:o.content,contentBn:o.contentBn||void 0,displayOrder:j}))};t?(await D.update(t.id,s),d("Officer review updated successfully!")):(await D.create(s),d("Officer review created successfully!")),r(!0)}catch(s){g(s.message||"Failed to save officer review")}finally{C(!1)}};return e.jsxs(he,{open:a,onClose:()=>r(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3}},children:[e.jsx(pe,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(w,{variant:"h6",children:t?"Edit Officer Review":"Add Officer Review"}),e.jsx(k,{onClick:()=>r(!1),size:"small",children:e.jsx(je,{})})]})}),e.jsx(ye,{dividers:!0,children:e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(c,{children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"Officer Photo"}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Q,{src:l||void 0,sx:{width:100,height:100}}),e.jsxs(c,{sx:{flex:1},children:[e.jsx("input",{accept:"image/*",style:{display:"none"},id:"officer-image-upload",type:"file",onChange:L}),e.jsx("label",{htmlFor:"officer-image-upload",children:e.jsx(A,{variant:"outlined",component:"span",startIcon:e.jsx(ve,{}),fullWidth:!0,children:"Select Image"})}),I&&e.jsxs(c,{sx:{mt:1,display:"flex",gap:1},children:[e.jsx(A,{variant:"contained",size:"small",onClick:n,disabled:m,fullWidth:!0,children:m?e.jsx(_,{size:20}):"Upload"}),e.jsx(A,{variant:"outlined",size:"small",onClick:R,color:"error",children:"Remove"})]})]})]})]}),e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Name (English)",value:i.name,onChange:s=>p({...i,name:s.target.value}),required:!0})}),e.jsx(b,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Name (Bangla)",value:i.nameBn,onChange:s=>p({...i,nameBn:s.target.value})})}),e.jsx(b,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Designation (English)",value:i.designation,onChange:s=>p({...i,designation:s.target.value}),required:!0})}),e.jsx(b,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Designation (Bangla)",value:i.designationBn,onChange:s=>p({...i,designationBn:s.target.value})})})]}),e.jsxs(c,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(w,{variant:"subtitle2",children:"Messages"}),e.jsx(A,{size:"small",startIcon:e.jsx(G,{}),onClick:M,variant:"outlined",children:"Add Message"})]}),e.jsx(oe,{sensors:W,collisionDetection:le,onDragEnd:z,children:e.jsx(ce,{items:x.map((s,o)=>`message-${o}`),strategy:de,children:x.map((s,o)=>e.jsx(De,{message:s,index:o,onMessageChange:P,onRemoveMessage:T,messagesLength:x.length},`message-${o}`))})})]})]})}),e.jsxs(be,{sx:{p:2},children:[e.jsx(A,{onClick:()=>r(!1),disabled:u,children:"Cancel"}),e.jsx(A,{onClick:q,variant:"contained",disabled:u,startIcon:u?e.jsx(_,{size:20}):null,children:t?"Update":"Create"})]})]})},Me=({review:a,onEdit:t,onDelete:r,onToggleActive:d})=>{const{attributes:g,listeners:u,setNodeRef:C,transform:m,transition:B,isDragging:l}=ue({id:a.id}),h={transform:xe.Transform.toString(m),transition:B};return e.jsx(V,{ref:C,style:h,sx:{mb:2,borderRadius:3,boxShadow:l?"0 8px 24px rgba(0,0,0,0.15)":"0 4px 18px rgba(0,0,0,0.06)",border:"1px solid",borderColor:"divider",transition:"all 0.2s","&:hover":{boxShadow:"0 6px 20px rgba(0,0,0,0.1)"}},children:e.jsx(Z,{children:e.jsxs(b,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(b,{children:e.jsx(c,{...g,...u,sx:{cursor:"grab",display:"flex",alignItems:"center",color:"text.secondary","&:active":{cursor:"grabbing"}},children:e.jsx(ee,{})})}),e.jsx(b,{children:e.jsx(Q,{src:a.imageUrl||void 0,sx:{width:64,height:64},children:e.jsx(te,{})})}),e.jsxs(b,{xs:!0,children:[e.jsxs(w,{variant:"h6",gutterBottom:!0,children:[a.name,a.nameBn&&e.jsxs(w,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:1},children:["(",a.nameBn,")"]})]}),e.jsxs(w,{variant:"body2",color:"text.secondary",children:[a.designation,a.designationBn&&` (${a.designationBn})`]}),e.jsxs(c,{sx:{mt:1},children:[e.jsx(H,{label:`${a.messages.length} message${a.messages.length!==1?"s":""}`,size:"small",sx:{mr:1}}),e.jsx(H,{label:a.isActive?"Active":"Inactive",size:"small",color:a.isActive?"success":"default"})]})]}),e.jsx(b,{children:e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(k,{onClick:()=>d(a),color:a.isActive?"success":"default",title:a.isActive?"Deactivate":"Activate",children:a.isActive?e.jsx(Ce,{}):e.jsx(Ie,{})}),e.jsx(k,{onClick:()=>t(a),color:"primary",title:"Edit",children:e.jsx(Be,{})}),e.jsx(k,{onClick:()=>r(a),color:"error",title:"Delete",children:e.jsx(se,{})})]})})]})})})},Te=()=>{const[a,t]=f.useState([]),[r,d]=f.useState(!1),[g,u]=f.useState(null),[C,m]=f.useState(null),[B,l]=f.useState(!1),[h,I]=f.useState(null),y=ae(F(re),F(ie,{coordinateGetter:ne}));f.useEffect(()=>{i()},[]);const i=async()=>{try{d(!0),u(null);const n=await D.getAll();t(n)}catch(n){console.error("Failed to load officer reviews:",n),u(n.message||"Failed to load officer reviews")}finally{d(!1)}},p=()=>{I(null),l(!0)},x=n=>{I(n),l(!0)},S=async n=>{if(window.confirm(`Are you sure you want to delete ${n.name}?`))try{d(!0),await D.delete(n.id),m("Officer review deleted successfully!"),i()}catch(R){u(R.message||"Failed to delete officer review")}finally{d(!1)}},W=async n=>{try{await D.toggleActive(n.id),m(`Officer review ${n.isActive?"deactivated":"activated"} successfully!`),i()}catch(R){u(R.message||"Failed to toggle status")}},E=async n=>{const{active:R,over:M}=n;if(!M||R.id===M.id)return;const T=a.findIndex(s=>s.id===R.id),P=a.findIndex(s=>s.id===M.id),z=ge(a,T,P);t(z);const q=z.map((s,o)=>({id:s.id,displayOrder:o}));try{await D.reorder(q),m("Officer reviews reordered successfully!")}catch(s){u(s.message||"Failed to reorder officer reviews"),i()}},L=n=>{l(!1),I(null),n&&i()};return e.jsx(Se,{title:"Officer Review Management",children:e.jsxs(c,{sx:{p:{xs:2,md:3}},children:[e.jsx(we,{sx:{p:{xs:2,md:3},mb:3,borderRadius:3,background:"linear-gradient(135deg, #0f766e 0%, #22c55e 100%)",color:"white",animation:`${Re} ${Y.normal.duration} ${Y.smooth.timing}`,animationFillMode:"both"},children:e.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",gap:2},children:[e.jsxs(c,{children:[e.jsx(w,{variant:"h4",fontWeight:"bold",sx:{mb:.5},children:"Officer Review Management"}),e.jsx(w,{variant:"body2",sx:{opacity:.9},children:"Manage officer reviews displayed on the home page"})]}),e.jsx(A,{variant:"contained",startIcon:e.jsx(G,{}),onClick:p,sx:{bgcolor:"white",color:"#0f766e",width:{xs:"100%",sm:"auto"},"&:hover":{bgcolor:"#f0fdf4"},...J},children:"Add Officer Review"})]})}),g&&e.jsx(K,{severity:"error",onClose:()=>u(null),sx:{mb:2},children:g}),C&&e.jsx(K,{severity:"success",onClose:()=>m(null),sx:{mb:2},children:C}),r?e.jsx(c,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(_,{})}):a.length===0?e.jsxs(V,{sx:{p:6,textAlign:"center",borderRadius:3,boxShadow:"0 4px 18px rgba(0,0,0,0.06)"},children:[e.jsx(te,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(w,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Officer Reviews Yet"}),e.jsx(w,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Create your first officer review to display on the home page"}),e.jsx(A,{variant:"contained",startIcon:e.jsx(G,{}),onClick:p,sx:{...J},children:"Add Officer Review"})]}):e.jsx(oe,{sensors:y,collisionDetection:le,onDragEnd:E,children:e.jsx(ce,{items:a.map(n=>n.id),strategy:de,children:a.map(n=>e.jsx(Me,{review:n,onEdit:x,onDelete:S,onToggleActive:W},n.id))})}),e.jsx(Ue,{open:B,review:h,onClose:L,onSuccess:n=>{m(n),setTimeout(()=>m(null),3e3)},onError:n=>{u(n)}})]})})};export{Te as default};
