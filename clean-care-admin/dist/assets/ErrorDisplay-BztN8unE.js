import{j as e,B as u,i as S,T as v,bD as O,bE as Y,b as P,ba as B,b8 as K,bP as q,P as H,v as J,C as N,q as V,aY as Q,g as X,bQ as Z,A as ee,R as D,E as L}from"./mui-vendor-Y6GvQTLC.js";import{r as b}from"./react-vendor-D7yrL1sD.js";import{A as oe,z as h}from"./index-B_PiLh6w.js";const le=({voiceUrl:c,isAdmin:o})=>{const[r,d]=b.useState(!1),[t,x]=b.useState(!1),[s,y]=b.useState(!1),n=b.useRef(null),a=(l=>{if(!l)return"";if(l.includes("res.cloudinary.com"))return l.replace("http://","https://");if(l.startsWith("http"))return l;const p=l.startsWith("/")?l.substring(1):l;return`${oe.BASE_URL}/${p}`})(c),m=()=>{n.current&&(r?(n.current.pause(),d(!1)):(y(!0),x(!1),console.log("‚ñ∂Ô∏è Playing voice message:",a),n.current.play().then(()=>{d(!0),y(!1)}).catch(l=>{console.error("‚ùå Failed to play voice message:",l),x(!0),y(!1),d(!1)})))},g=()=>{d(!1)},w=l=>{console.error("‚ùå Voice message failed to load:",a),console.error("   Error details:",l);const p=l.target.error;p&&console.error("   Media Error Code:",p.code,p.message),x(!0),d(!1),y(!1)},j=()=>{console.log("‚úÖ Voice message loaded successfully"),x(!1)},E=()=>{if(!n.current)return;console.log("üîÑ Retrying voice message load:",a),x(!1),y(!0);const l=n.current.src;n.current.src="",n.current.src=l,n.current.load(),setTimeout(()=>{m()},500)};return e.jsxs(u,{sx:{mt:1,p:1,borderRadius:"20px",backgroundColor:o?"rgba(255, 255, 255, 0.2)":"rgba(25, 118, 210, 0.08)",border:o?"none":"1px solid rgba(25, 118, 210, 0.2)",display:"flex",alignItems:"center",gap:1,maxWidth:"280px"},children:[e.jsx("audio",{ref:n,src:a,onEnded:g,onError:w,onLoadedData:j,preload:"none",style:{display:"none"}}),t?e.jsx(S,{onClick:E,size:"small",title:"Retry loading voice message",sx:{backgroundColor:"#f44336",color:"#ffffff",width:32,height:32,"&:hover":{backgroundColor:"#d32f2f"}},children:e.jsx(v,{sx:{fontSize:"0.8rem",fontWeight:"bold"},children:"!"})}):e.jsx(S,{onClick:m,size:"small",disabled:s,sx:{backgroundColor:o?"#ffffff":"#1976d2",color:o?"#1976d2":"#ffffff",width:32,height:32,"&:hover":{backgroundColor:o?"#f5f5f5":"#1565c0"},"&:disabled":{backgroundColor:o?"rgba(255, 255, 255, 0.5)":"rgba(25, 118, 210, 0.5)",color:o?"rgba(25, 118, 210, 0.5)":"rgba(255, 255, 255, 0.5)"}},children:s?e.jsx(v,{sx:{fontSize:"0.6rem"},children:"..."}):r?e.jsx(O,{sx:{fontSize:"1rem"}}):e.jsx(Y,{sx:{fontSize:"1rem"}})}),t?e.jsx(u,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(v,{variant:"caption",sx:{fontSize:"0.7rem",color:"#f44336",fontWeight:500},children:"Failed to load"})}):e.jsx(u,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"space-evenly",height:"30px",gap:"2px"},children:[...Array(20)].map((l,p)=>{const R=[8,12,18,12,8,15,10,18,12,8,15,12,18,10,8,12,18,12,8,15];return e.jsx(u,{sx:{width:"2px",height:`${R[p]}px`,backgroundColor:o?"rgba(255, 255, 255, 0.7)":"rgba(25, 118, 210, 0.6)",borderRadius:"1px",transition:"all 0.3s ease",...r&&{animation:`pulse ${.5+p%3*.2}s ease-in-out infinite`,"@keyframes pulse":{"0%, 100%":{transform:"scaleY(1)"},"50%":{transform:"scaleY(1.5)"}}}}},p)})}),e.jsx(v,{variant:"caption",sx:{fontSize:"0.7rem",color:t?"#f44336":o?"rgba(255, 255, 255, 0.85)":"rgba(0, 0, 0, 0.6)",minWidth:"35px",textAlign:"right"},children:t?"Error":s||r?"...":"Voice"})]})},ce=({type:c,onAction:o,actionLabel:r})=>{const t=(()=>{switch(c){case"no-chats":return{icon:e.jsx(B,{sx:{fontSize:64,color:"text.disabled"}}),title:"No users found",description:"No users found in your jurisdiction to chat with.",showAction:!1};case"no-messages":return{icon:e.jsx(q,{sx:{fontSize:64,color:"text.disabled"}}),title:"No messages yet",description:"Start the conversation by sending a message below.",showAction:!1};case"no-results":return{icon:e.jsx(K,{sx:{fontSize:64,color:"text.disabled"}}),title:"No results found",description:"Try adjusting your search or filters to find what you're looking for.",showAction:!0};default:return{icon:e.jsx(B,{sx:{fontSize:64,color:"text.disabled"}}),title:"Nothing here",description:"",showAction:!1}}})();return e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:{xs:4,sm:6,md:8},px:3,textAlign:"center"},children:[e.jsx(u,{sx:{mb:2},children:t.icon}),e.jsx(v,{variant:"h6",color:"text.secondary",sx:{mb:1,fontWeight:500,fontSize:{xs:"1rem",sm:"1.25rem"}},children:t.title}),t.description&&e.jsx(v,{variant:"body2",color:"text.secondary",sx:{mb:t.showAction?3:0,maxWidth:400,lineHeight:1.6},children:t.description}),t.showAction&&o&&e.jsx(P,{variant:"outlined",size:"small",onClick:o,sx:{textTransform:"none"},children:r||"Clear Filters"})]})};async function re(c,o=1920,r=1080,d=.8){return new Promise((t,x)=>{const s=new FileReader;s.onload=y=>{var I;const n=new Image;n.onload=()=>{let a=n.width,m=n.height;a>o&&(m=m*o/a,a=o),m>r&&(a=a*r/m,m=r);const g=document.createElement("canvas");g.width=a,g.height=m;const w=g.getContext("2d");if(!w){x(new Error("Failed to get canvas context"));return}w.drawImage(n,0,0,a,m),g.toBlob(j=>{j?t(j):x(new Error("Failed to compress image"))},"image/jpeg",d)},n.onerror=()=>{x(new Error("Failed to load image"))},n.src=(I=y.target)==null?void 0:I.result},s.onerror=()=>{x(new Error("Failed to read file"))},s.readAsDataURL(c)})}function te(c,o=5){if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(c.type))return{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, GIF, or WebP image."};const d=o*1024*1024;return c.size>d?{valid:!1,error:`File size exceeds ${o}MB. Please choose a smaller image.`}:{valid:!0}}function se(c,o){return new File([c],o,{type:c.type})}const de=({onSend:c,onSendWithFile:o,sending:r,disabled:d=!1})=>{const[t,x]=b.useState(""),[s,y]=b.useState(null),[n,I]=b.useState(null),[a,m]=b.useState(!1),[g,w]=b.useState(null),j=b.useRef(null),E=b.useRef(null),l=i=>{x(i.target.value)},p=async i=>{var W;const f=(W=i.target.files)==null?void 0:W[0];if(!f)return;const k=te(f,5);if(!k.valid){h.error(k.error||"Invalid image file",{icon:"‚ùå"});return}try{const F=h.loading("Compressing image..."),_=await re(f,1920,1080,.8),C=se(_,f.name),G=((1-C.size/f.size)*100).toFixed(0);h.dismiss(F),C.size<f.size&&h.success(`Image compressed by ${G}%`,{icon:"‚úÖ",duration:2e3}),y(C);const A=new FileReader;A.onloadend=()=>{I(A.result)},A.readAsDataURL(C),R(C)}catch(F){console.error("Error compressing image:",F),h.error("Failed to process image. Please try again.",{icon:"‚ùå"})}},R=async i=>{try{m(!0),w("READY_TO_SEND"),h.success("Image ready to send",{icon:"‚úÖ",duration:2e3})}catch(f){console.error("Error processing image:",f),h.error("Failed to process image. Please try again.",{icon:"‚ùå"}),T()}finally{m(!1)}},T=()=>{y(null),I(null),w(null),j.current&&(j.current.value="")},U=async()=>{var f;const i=t.trim();if(console.log("üîç Validation check:",{text:t,trimmedText:i,uploadedImageUrl:g,imageFile:s==null?void 0:s.name,hasText:!!i,hasImage:!!g}),!i&&!g){console.error("‚ùå Validation failed: No text and no image"),h.error("Please enter a message or select an image",{icon:"‚ö†Ô∏è",duration:3e3});return}if(s&&!g){console.error("‚ùå Validation failed: Image not uploaded yet"),h.error("Please wait for image to finish uploading",{icon:"‚è≥"});return}try{if(console.log("üì§ Sending message with image file:",s==null?void 0:s.name),console.log("üì§ onSendWithFile available:",!!o),s&&o)console.log("‚úÖ Using onSendWithFile for file:",s.name),await o(i||"Image",s);else if(s&&!o){console.error("‚ùå onSendWithFile not available!"),console.error("‚ùå This means ChatConversationPanel did not pass onSendWithFile prop"),h.error("Cannot send image - feature not available",{icon:"‚ùå"});return}else if(console.log("‚úÖ Sending text only (no image)"),console.log("‚úÖ Text content:",i),i)await c(i,void 0);else{console.error("‚ùå Cannot send: No text content"),h.error("Please enter a message",{icon:"‚ö†Ô∏è",duration:3e3});return}x(""),T(),(f=E.current)==null||f.focus()}catch(k){console.error("‚ùå Error sending message:",k)}},M=i=>{if(i.key==="Enter"&&!i.shiftKey){i.preventDefault(),console.log("‚å®Ô∏è Enter key pressed");const f=t.trim();if(console.log("üîç Enter validation:",{text:t,trimmedText:f,uploadedImageUrl:g,hasText:!!f,hasImage:!!g}),!f&&!g){console.error("‚ùå Enter validation failed: No text and no image"),h.error("Please enter a message or select an image",{icon:"‚ö†Ô∏è",duration:2e3});return}!r&&!a&&!d?(console.log("‚úÖ Enter validation passed, calling handleSend"),U()):console.log("‚è∏Ô∏è Cannot send: sending=",r,"uploading=",a,"disabled=",d)}},$=()=>{var i;(i=j.current)==null||i.click()},z=d||r||a||!t.trim()&&!g;return e.jsxs(u,{sx:{p:2,backgroundColor:"#ffffff",borderTop:"1px solid #f3f4f6"},children:[n&&e.jsxs(H,{elevation:0,sx:{mb:2,p:1,position:"relative",display:"inline-block",maxWidth:"200px",borderRadius:3,border:"1px solid #e5e7eb",overflow:"hidden"},children:[e.jsx(u,{component:"img",src:n,alt:"Preview",sx:{width:"100%",height:"auto",maxHeight:"150px",objectFit:"cover",borderRadius:2}}),e.jsx(S,{size:"small",onClick:T,disabled:a,sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},children:e.jsx(J,{fontSize:"small"})}),a&&e.jsx(u,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.8)"},children:e.jsx(N,{size:24})})]}),e.jsxs(u,{sx:{display:"flex",gap:1.5,alignItems:"flex-end",bgcolor:"#f9fafb",p:1.5,borderRadius:"24px",border:"1px solid #e5e7eb",transition:"border-color 0.2s, box-shadow 0.2s","&:focus-within":{borderColor:"#3fa564",boxShadow:"0 0 0 3px rgba(63, 165, 100, 0.1)"}},children:[e.jsx("input",{ref:j,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",style:{display:"none"},onChange:p}),e.jsx(V,{title:"‡¶õ‡¶¨‡¶ø ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®",children:e.jsx(S,{onClick:$,disabled:d||r||a||!!s,sx:{color:"#6b7280","&:hover":{color:"#3fa564",bgcolor:"#f0fdf4"},p:1},children:e.jsx(Q,{})})}),e.jsx(X,{inputRef:E,fullWidth:!0,multiline:!0,maxRows:6,placeholder:"Type a message...",value:t,onChange:l,onKeyDown:M,disabled:d||r,variant:"standard",InputProps:{disableUnderline:!0},sx:{"& .MuiInputBase-root":{fontSize:"1rem",py:1,color:"#1f2937",lineHeight:1.5}}}),e.jsx(V,{title:r?"‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...":"‡¶™‡¶æ‡¶†‡¶æ‡¶® (Enter)",children:e.jsx(S,{onClick:U,disabled:z,sx:{backgroundColor:z?"#e5e7eb":"#3fa564",color:"white",width:40,height:40,"&:hover":{backgroundColor:z?"#e5e7eb":"#15803d"},transition:"all 0.2s",transform:r?"scale(0.9)":"scale(1)",boxShadow:z?"none":"0 2px 4px rgba(63, 165, 100, 0.3)"},children:r?e.jsx(N,{size:20,color:"inherit"}):e.jsx(Z,{fontSize:"small",sx:{ml:.5}})})})]}),t.length>0&&e.jsx(u,{sx:{mt:1,mr:1,textAlign:"right"},children:e.jsxs(u,{component:"span",sx:{fontSize:"0.75rem",color:t.length>1e3?"error.main":"text.secondary",fontWeight:500},children:[t.length," / 1000"]})})]})},ge=({error:c,onRetry:o,variant:r="centered"})=>r==="alert"?e.jsx(ee,{severity:"error",sx:{m:2},action:o&&e.jsx(P,{color:"inherit",size:"small",onClick:o,startIcon:e.jsx(D,{}),children:"Retry"}),children:c}):r==="inline"?e.jsxs(u,{sx:{p:2,backgroundColor:"#ffebee",borderRadius:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(L,{sx:{color:"error.main"}}),e.jsx(u,{sx:{flex:1},children:e.jsx(v,{variant:"body2",color:"error",children:c})}),o&&e.jsx(P,{size:"small",variant:"outlined",color:"error",onClick:o,startIcon:e.jsx(D,{}),children:"Retry"})]}):e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:6,px:3},children:[e.jsx(L,{sx:{fontSize:48,color:"error.main",mb:2}}),e.jsx(v,{variant:"h6",color:"error",sx:{mb:1,textAlign:"center"},children:"Something went wrong"}),e.jsx(v,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center",maxWidth:400},children:c}),o&&e.jsx(P,{variant:"contained",color:"primary",onClick:o,startIcon:e.jsx(D,{}),children:"Try Again"})]});export{ge as E,de as M,le as V,ce as a};
